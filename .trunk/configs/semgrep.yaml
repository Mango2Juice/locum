rules:
    - id: bash.curl.security.curl-eval.curl-eval
      languages:
        - bash
      message: Data is being eval'd from a `curl` command. An attacker with control of the server in the `curl` command could inject malicious code into the `eval`, resulting in a system comrpomise. Avoid eval'ing untrusted data if you can. If you must do this, consider checking the SHA sum of the content returned by the server to verify its integrity.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - bash
            - curl
      mode: taint
      pattern-sinks:
        - pattern: eval ...
      pattern-sources:
        - pattern: |
            $(curl ...)
        - pattern: |
            `curl ...`
      severity: WARNING
    - id: bash.curl.security.curl-pipe-bash.curl-pipe-bash
      languages:
        - bash
      message: Data is being piped into `bash` from a `curl` command. An attacker with control of the server in the `curl` command could inject malicious code into the pipe, resulting in a system compromise. Avoid piping untrusted data into `bash` or any other shell if you can. If you must do this, consider checking the SHA sum of the content returned by the server to verify its integrity.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - bash
            - curl
      patterns:
        - pattern-either:
            - pattern: curl ... | ... bash ...
            - pattern: curl ... | ... /bin/bash ...
            - pattern: '... bash <(curl ...)'
            - pattern: '... /bin/bash <(curl ...)'
            - pattern: '... bash -c "$(curl ...)"'
            - pattern: '... /bin/bash -c "$(curl ...)"'
      severity: WARNING
    - id: c.lang.security.function-use-after-free.function-use-after-free
      languages:
        - c
        - cpp
      message: Variable '$VAR' was passed to a function after being freed. This can lead to undefined behavior.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-416: Use After Free'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/416.html
            - https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/use_after_free/
        subcategory:
            - vuln
        technology:
            - c
            - cpp
      patterns:
        - pattern-either:
            - pattern: $FUNC(..., <... $VAR ...>, ...)
            - pattern: $FUNC(..., <... $VAR->$ACCESSOR ...>, ...)
            - pattern: $FUNC(..., <... (*$VAR).$ACCESSOR ...>, ...)
            - pattern: $FUNC(..., <... $VAR[$NUM] ...>, ...)
        - metavariable-regex:
            metavariable: $FUNC
            regex: (?!^free$)
        - pattern-inside: free($VAR); ...
        - pattern-not-inside: free($VAR); ... $VAR = NULL; ...
        - pattern-not-inside: free($VAR); ... $VAR = malloc(...); ...
      severity: WARNING
    - id: c.lang.security.insecure-use-gets-fn.insecure-use-gets-fn
      languages:
        - c
        - cpp
      message: Avoid 'gets()'. This function does not consider buffer boundaries and can lead to buffer overflows. Use 'fgets()' or 'gets_s()' instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-676: Use of Potentially Dangerous Function'
        impact: HIGH
        likelihood: LOW
        references:
            - https://us-cert.cisa.gov/bsi/articles/knowledge/coding-practices/fgets-and-gets_s
        subcategory:
            - audit
        technology:
            - c
            - cpp
      pattern: gets(...)
      severity: ERROR
    - id: c.lang.security.insecure-use-printf-fn.insecure-use-printf-fn
      languages:
        - c
        - cpp
      message: Avoid using user-controlled format strings passed into 'sprintf', 'printf' and 'vsprintf'. These functions put you at risk of buffer overflow vulnerabilities through the use of format string exploits. Instead, use 'snprintf' and 'vsnprintf'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-134: Use of Externally-Controlled Format String'
        impact: HIGH
        likelihood: MEDIUM
        references:
            - https://doc.castsoftware.com/display/SBX/Never+use+sprintf%28%29+or+vsprintf%28%29+functions
            - https://www.cvedetails.com/cwe-details/134/Uncontrolled-Format-String.html
        subcategory:
            - vuln
        technology:
            - c
            - cpp
      patterns:
        - pattern-either:
            - pattern: |
                $FUNC($BUFFER, argv[$NUM], ...);
                ...
                vsprintf(..., $BUFFER, ...);
            - pattern: vsprintf(..., argv[$NUM], ...)
            - pattern: |
                $FUNC($BUFFER, argv[$NUM], ...);
                ...
                sprintf(..., $BUFFER, ...);
            - pattern: sprintf(...,argv[$NUM],...)
            - pattern: |
                $FUNC($BUFFER, argv[$NUM], ...);
                ...
                printf(..., $BUFFER, ...);
            - pattern: printf(...,argv[$NUM],...)
        - metavariable-comparison:
            comparison: int($NUM) > 0
            metavariable: $NUM
      severity: WARNING
    - id: c.lang.security.insecure-use-string-copy-fn.insecure-use-string-copy-fn
      languages:
        - c
        - cpp
      message: Finding triggers whenever there is a strcpy or strncpy used. This is an issue because strcpy does not affirm the size of the destination array and strncpy will not automatically NULL-terminate strings. This can lead to buffer overflows, which can cause program crashes and potentially let an attacker inject code in the program. Fix this by using strcpy_s instead (although note that strcpy_s is an optional part of the C11 standard, and so may not be available).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-676: Use of Potentially Dangerous Function'
        impact: HIGH
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/676
            - https://nvd.nist.gov/vuln/detail/CVE-2019-11365
        subcategory:
            - audit
        technology:
            - c
            - cpp
      pattern-either:
        - pattern: strcpy(...)
        - pattern: strncpy(...)
      severity: WARNING
    - id: c.lang.security.random-fd-exhaustion.random-fd-exhaustion
      languages:
        - c
        - cpp
      message: Call to 'read()' without error checking is susceptible to file descriptor exhaustion. Consider using the 'getrandom()' function.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-774: Allocation of File Descriptors or Handles Without Limits or Throttling'
        impact: HIGH
        likelihood: LOW
        references:
            - https://lwn.net/Articles/606141/
        subcategory:
            - audit
        technology:
            - c
            - cpp
      pattern-either:
        - patterns:
            - pattern: |
                $FD = open("/dev/urandom", ...);
                ...
                read($FD, ...);
            - pattern-not: |
                $FD = open("/dev/urandom", ...);
                ...
                $BYTES_READ = read($FD, ...);
        - patterns:
            - pattern: |
                $FD = open("/dev/random", ...);
                ...
                read($FD, ...);
            - pattern-not: |
                $FD = open("/dev/random", ...);
                ...
                $BYTES_READ = read($FD, ...);
      severity: WARNING
    - id: c.lang.security.use-after-free.use-after-free
      languages:
        - c
        - cpp
      message: Variable '$VAR' was used after being freed. This can lead to undefined behavior.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-416: Use After Free'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/416.html
            - https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/use_after_free/
        subcategory:
            - vuln
        technology:
            - c
            - cpp
      patterns:
        - pattern-either:
            - pattern: $VAR->$ACCESSOR
            - pattern: (*$VAR).$ACCESSOR
            - pattern: $VAR[$NUM]
        - pattern-inside: free($VAR); ...
        - pattern-not-inside: $VAR = NULL; ...
        - pattern-not-inside: free($VAR); ... $VAR = malloc(...); ...
      severity: WARNING
    - id: clojure.lang.security.command-injection-shell-call.command-injection-shell-call
      languages:
        - clojure
      message: A call to clojure.java.shell has been found, this could lead to an RCE if the inputs are user-controllable. Please ensure their origin is validated and sanitized.
      metadata:
        author: Gabriel Marquet <gab.marquet@gmail.com>
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://clojuredocs.org/clojure.java.shell/sh
        subcategory:
            - audit
        technology:
            - clojure
      patterns:
        - pattern-either:
            - pattern-inside: "(ns ...\n...\n(:require \n... \n[clojure.java.shell ... [sh]]\n...\n))\n...\n"
            - pattern-inside: "(ns ...\n...\n(:use \n... \n[clojure.java.shell ... [sh]]\n...\n))\n...\n"
        - pattern-either:
            - patterns:
                - pattern: (sh $BASH ...)
                - metavariable-regex:
                    metavariable: $BASH
                    regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
            - patterns:
                - pattern: (sh $ARG ...)
                - pattern-not: (sh "..." ...)
      severity: ERROR
    - id: clojure.lang.security.documentbuilderfactory-xxe.documentbuilderfactory-xxe
      languages:
        - clojure
      message: DOCTYPE declarations are enabled for javax.xml.parsers.SAXParserFactory. Without prohibiting external entity declarations, this is vulnerable to XML external entity attacks. Disable this by setting the feature "http://apache.org/xml/features/disallow-doctype-decl" to true. Alternatively, allow DOCTYPE declarations and only prohibit external entities declarations. This can be done by setting the features "http://xml.org/sax/features/external-general-entities" and "http://xml.org/sax/features/external-parameter-entities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://xerces.apache.org/xerces2-j/features.html
        source-rule-url: https://github.com/clj-holmes/clj-holmes-rules/blob/main/security/xxe-clojure-xml/xxe-clojure-xml.yml
        subcategory:
            - vuln
        technology:
            - clojure
            - xml
      patterns:
        - pattern-inside: |
            (ns ... (:require [clojure.xml :as ...]))
            ...
        - pattern-either:
            - pattern-inside: |
                (def ... ... ( ... ))
            - pattern-inside: |
                (defn ... ... ( ... ))
        - pattern-either:
            - pattern: (clojure.xml/parse $INPUT)
            - patterns:
                - pattern-inside: |
                    (doto (javax.xml.parsers.SAXParserFactory/newInstance) ...)
                - pattern: (.setFeature "http://apache.org/xml/features/disallow-doctype-decl" false)
                - pattern-not-inside: |
                    (doto (javax.xml.parsers.SAXParserFactory/newInstance)
                      ...
                      (.setFeature "http://xml.org/sax/features/external-general-entities" false)
                      ...
                      (.setFeature "http://xml.org/sax/features/external-parameter-entities" false)
                      ...)
                - pattern-not-inside: |
                    (doto (javax.xml.parsers.SAXParserFactory/newInstance)
                      ...
                      (.setFeature "http://xml.org/sax/features/external-parameter-entities" false)
                      ...
                      (.setFeature "http://xml.org/sax/features/external-general-entities" false)
                      ...)
      severity: ERROR
    - id: clojure.lang.security.use-of-md5.use-of-md5
      languages:
        - clojure
      message: MD5 hash algorithm detected. This is not collision resistant and leads to easily-cracked password hashes. Replace with current recommended hashing algorithms.
      metadata:
        author: Gabriel Marquet <gab.marquet@gmail.com>
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html
            - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
        source-rule-url: https://github.com/clj-holmes/clj-holmes-rules/blob/main/security/weak-hash-function-md5.yml
        subcategory:
            - vuln
        technology:
            - clojure
      pattern-either:
        - pattern: (MessageDigest/getInstance "MD5")
        - pattern: (MessageDigest/getInstance MessageDigestAlgorithms/MD5)
        - pattern: (MessageDigest/getInstance org.apache.commons.codec.digest.MessageDigestAlgorithms/MD5)
        - pattern: (java.security.MessageDigest/getInstance "MD5")
        - pattern: (java.security.MessageDigest/getInstance MessageDigestAlgorithms/MD5)
        - pattern: (java.security.MessageDigest/getInstance org.apache.commons.codec.digest.MessageDigestAlgorithms/MD5)
      severity: WARNING
    - id: clojure.lang.security.use-of-sha1.use-of-sha1
      languages:
        - clojure
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Instead, use PBKDF2 for password hashing or SHA256 or SHA512 for other hash function applications.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
            - 'CWE-328: Use of Weak Hash'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html
            - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - clojure
      patterns:
        - pattern-either:
            - pattern: (MessageDigest/getInstance $ALGO)
            - pattern: (java.security.MessageDigest/getInstance $ALGO)
        - metavariable-regex:
            metavariable: $ALGO
            regex: (((org\.apache\.commons\.codec\.digest\.)?MessageDigestAlgorithms/)?"?(SHA-1|SHA1)"?)
      severity: WARNING
    - id: clojure.security.clojure-read-string.read-string-unsafe.read-string-unsafe
      languages:
        - clojure
      message: The default core Clojure read-string method is dangerous and can lead to deserialization vulnerabilities. Use the edn/read-string instead.
      metadata:
        author: Gabriel Marquet <gab.marquet@gmail.com>
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2020-top25: true
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - http://www.learningclojure.com/2013/02/clojures-reader-is-unsafe.html#post-body-2898830171141471587
            - https://ericnormand.me/article/clojure-web-security
            - https://github.com/jafingerhut/jafingerhut.github.com/blob/master/clojure-info/using-edn-safely.md#vulnerabilities-in-clojurecores-read-and-read-string
        source-rule-url: https://github.com/clj-holmes/clj-holmes-rules/tree/main/security/clojure-read-string
        subcategory:
            - audit
        technology:
            - clojure
      patterns:
        - pattern-not-inside: |
            (ns ...
            (... :exclude [read read-string]))
            ...
            (defn $VAR [$X]...)
        - pattern-inside: |
            (defn $VAR [$X]...)
        - pattern: |
            (read-string $X)
      severity: ERROR
    - id: csharp.dotnet.security.audit.ldap-injection.ldap-injection
      languages:
        - csharp
      message: LDAP queries are constructed dynamically on user-controlled input. This vulnerability in code could lead to an arbitrary LDAP query execution.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query (''LDAP Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection/
            - https://cwe.mitre.org/data/definitions/90
            - https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html#safe-c-sharp-net-tba-example
        subcategory:
            - vuln
        technology:
            - .net
      mode: taint
      options:
        taint_unify_mvars: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: Regex.Replace($INPUT, ...)
            - pattern: $ENCODER.LdapFilterEncode($INPUT)
            - pattern: $ENCODER.LdapDistinguishedNameEncode($INPUT)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $S.Filter = ... + $INPUT + ...
                - pattern: $S.Filter = String.Format(...,$INPUT)
                - pattern: $S.Filter = String.Concat(...,$INPUT)
      pattern-sources:
        - patterns:
            - focus-metavariable: $INPUT
            - pattern-inside: $T $M($INPUT,...) {...}
      severity: ERROR
    - id: csharp.dotnet.security.audit.mass-assignment.mass-assignment
      languages:
        - csharp
      message: Mass assignment or Autobinding vulnerability in code allows an attacker to execute over-posting attacks, which could create a new parameter in the binding request and manipulate the underlying object in the application.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://cwe.mitre.org/data/definitions/915.html
            - https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa6-mass-assignment.md
        subcategory:
            - vuln
        technology:
            - .net
      mode: taint
      pattern-sinks:
        - pattern: View(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    public IActionResult $METHOD(..., $TYPE $ARG, ...){
                      ...
                    }
                - pattern: |
                    public ActionResult $METHOD(..., $TYPE $ARG, ...){
                      ...
                    }
            - pattern-inside: |
                using Microsoft.AspNetCore.Mvc;
                ...
            - pattern-not: |
                public IActionResult $METHOD(..., [Bind(...)] $TYPE $ARG, ...){
                  ...
                }
            - pattern-not: |
                public ActionResult $METHOD(..., [Bind(...)] $TYPE $ARG, ...){
                  ...
                }
            - focus-metavariable: $ARG
      severity: WARNING
    - id: csharp.dotnet.security.audit.missing-or-broken-authorization.missing-or-broken-authorization
      languages:
        - csharp
      message: Anonymous access shouldn't be allowed unless explicit by design. Access control checks are missing and potentially can be bypassed. This finding violates the principle of least privilege or deny by default, where access should only be permitted for a specific set of roles or conforms to a custom policy or users.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-862: Missing Authorization'
        cwe2021-top25: true
        cwe2022-top25: true
        cwe2023-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
            - https://cwe.mitre.org/data/definitions/862.html
            - https://docs.microsoft.com/en-us/aspnet/core/security/authorization/simple?view=aspnetcore-7.0
        subcategory:
            - vuln
        technology:
            - .net
            - mvc
      patterns:
        - pattern: |
            public class $CLASS : Controller {
              ...
            }
        - pattern-inside: |
            using Microsoft.AspNetCore.Mvc;
            ...
        - pattern-not: |
            [AllowAnonymous]
            public class $CLASS : Controller {
              ...
            }
        - pattern-not: |
            [Authorize]
            public class $CLASS : Controller {
              ...
            }
        - pattern-not: |
            [Authorize(Roles = ...)]
            public class $CLASS : Controller {
              ...
            }
        - pattern-not: |
            [Authorize(Policy = ...)]
            public class $CLASS : Controller {
              ...
            }
      severity: INFO
    - id: csharp.dotnet.security.audit.open-directory-listing.open-directory-listing
      languages:
        - csharp
      message: An open directory listing is potentially exposed, potentially revealing sensitive information to attackers.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-548: Exposure of Information Through Directory Listing'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A06:2017 - Security Misconfiguration
            - A01:2021 - Broken Access Control
        references:
            - https://cwe.mitre.org/data/definitions/548.html
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration/
            - https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files?view=aspnetcore-7.0#directory-browsing
        subcategory:
            - vuln
        technology:
            - .net
            - mvc
      patterns:
        - pattern-either:
            - pattern: (IApplicationBuilder $APP).UseDirectoryBrowser(...);
            - pattern: $BUILDER.Services.AddDirectoryBrowser(...);
        - pattern-inside: |
            public void Configure(...) {
              ...
            }
      severity: INFO
    - id: csharp.dotnet.security.audit.razor-use-of-htmlstring.razor-use-of-htmlstring
      languages:
        - generic
      message: ASP.NET Core MVC provides an HtmlString class which isn't automatically encoded upon output. This should never be used in combination with untrusted input as this will expose an XSS vulnerability.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-116: Improper Encoding or Escaping of Output'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://cwe.mitre.org/data/definitions/116.html
            - https://owasp.org/Top10/A03_2021-Injection/
            - https://docs.microsoft.com/en-us/aspnet/core/security/cross-site-scripting?view=aspnetcore-6.0#html-encoding-using-razor
        subcategory:
            - audit
        technology:
            - .net
      paths:
        include:
            - '*.cshtml'
      patterns:
        - pattern-either:
            - pattern: new ...HtmlString(...)
            - pattern: '@(new ...HtmlString(...))'
        - pattern-not-inside: '@(new ...HtmlString(...HtmlEncode(...)))'
        - pattern-not-inside: '@(new ...HtmlString(...Encode(...)))'
        - pattern-not-inside: new ...HtmlString(...HtmlEncode(...))
        - pattern-not-inside: new ...HtmlString(...Encode(...))
      severity: WARNING
    - id: csharp.dotnet.security.audit.xpath-injection.xpath-injection
      languages:
        - csharp
      message: XPath queries are constructed dynamically on user-controlled input. This vulnerability in code could lead to an XPath Injection exploitation.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-643: Improper Neutralization of Data within XPath Expressions (''XPath Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection/
            - https://cwe.mitre.org/data/definitions/643.html
        subcategory:
            - vuln
        technology:
            - .net
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: XPathExpression $EXPR = $NAV.Compile("..." + $INPUT + "...");
            - pattern: var $EXPR = $NAV.Compile("..." + $INPUT + "...");
            - pattern: XPathNodeIterator $NODE = $NAV.Select("..." + $INPUT + "...");
            - pattern: var $NODE = $NAV.Select("..." + $INPUT + "...");
            - pattern: Object $OBJ = $NAV.Evaluate("..." + $INPUT + "...");
            - pattern: var $OBJ = $NAV.Evaluate("..." + $INPUT + "...");
      pattern-sources:
        - pattern-either:
            - pattern: $T $M($INPUT,...) {...}
            - pattern: |
                $T $M(...) {
                  ...
                  string $INPUT;
                }
      severity: ERROR
    - id: csharp.dotnet.security.mvc-missing-antiforgery.mvc-missing-antiforgery
      languages:
        - csharp
      message: $METHOD is a state-changing MVC method that does not validate the antiforgery token or do strict content-type checking. State-changing controller methods should either enforce antiforgery tokens or do strict content-type checking to prevent simple HTTP request types from bypassing CORS preflight controls.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html#cross-site-request-forgery
            - https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests
        subcategory:
            - audit
        technology:
            - .net
            - mvc
      patterns:
        - pattern: |
            [$HTTPMETHOD]
            public IActionResult $METHOD(...){
                ...
            }
        - pattern-inside: |
            using Microsoft.AspNetCore.Mvc;
            ...
        - pattern-not: |
            [ValidateAntiForgeryToken]
            public IActionResult $METHOD(...){
                ...
            }
        - pattern-not: |
            [Consumes(...)]
            public IActionResult $METHOD(...){
              ...
            }
        - metavariable-regex:
            metavariable: $HTTPMETHOD
            regex: Http(Post|Put|Delete|Patch)
      severity: WARNING
    - id: csharp.dotnet.security.razor-template-injection.razor-template-injection
      languages:
        - csharp
      message: User-controllable string passed to Razor.Parse. This leads directly to code execution in the context of the process.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/
        subcategory:
            - vuln
        technology:
            - .net
            - razor
            - asp
      mode: taint
      pattern-sanitizers:
        - not_conflicting: true
          pattern: $F(...)
      pattern-sinks:
        - pattern: |
            Razor.Parse(...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $ARG
            - pattern-inside: |
                public ActionResult $METHOD(..., string $ARG,...){...}
      severity: WARNING
    - id: csharp.dotnet.security.use_deprecated_cipher_algorithm.use_deprecated_cipher_algorithm
      languages:
        - csharp
      message: Usage of deprecated cipher algorithm detected. Use Aes or ChaCha20Poly1305 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.des?view=net-6.0#remarks
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.rc2?view=net-6.0#remarks
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.aes?view=net-6.0
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.chacha20poly1305?view=net-6.0
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern: $KEYTYPE.Create(...);
        - metavariable-pattern:
            metavariable: $KEYTYPE
            pattern-either:
                - pattern: DES
                - pattern: RC2
      severity: ERROR
    - id: csharp.dotnet.security.use_ecb_mode.use_ecb_mode
      languages:
        - csharp
      message: Usage of the insecure ECB mode detected. You should use an authenticated encryption mode instead, which is implemented by the classes AesGcm or ChaCha20Poly1305.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.chacha20poly1305?view=net-6.0
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.aesgcm?view=net-6.0
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.ciphermode?view=net-6.0
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#cipher-modes
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-either:
            - pattern: ($KEYTYPE $KEY).EncryptEcb(...);
            - pattern: ($KEYTYPE $KEY).DecryptEcb(...);
            - pattern: ($KEYTYPE $KEY).Mode = CipherMode.ECB;
        - metavariable-pattern:
            metavariable: $KEYTYPE
            pattern-either:
                - pattern: SymmetricAlgorithm
                - pattern: Aes
                - pattern: Rijndael
                - pattern: DES
                - pattern: TripleDES
                - pattern: RC2
      severity: WARNING
    - id: csharp.dotnet.security.use_weak_rng_for_keygeneration.use_weak_rng_for_keygeneration
      languages:
        - csharp
      message: You are using an insecure random number generator (RNG) to create a cryptographic key. System.Random must never be used for cryptographic purposes. Use System.Security.Cryptography.RandomNumberGenerator instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://learn.microsoft.com/en-us/dotnet/api/system.random?view=net-6.0#remarks
            - https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.randomnumbergenerator?view=net-6.0
            - https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.aesgcm?view=net-6.0#constructors
            - https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.symmetricalgorithm.key?view=net-6.0#system-security-cryptography-symmetricalgorithm-key
        subcategory:
            - vuln
        technology:
            - .net
      mode: taint
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: ($KEYTYPE $CIPHER).Key = $SINK;
                - focus-metavariable: $SINK
                - metavariable-pattern:
                    metavariable: $KEYTYPE
                    pattern-either:
                        - pattern: SymmetricAlgorithm
                        - pattern: Aes
                        - pattern: Rijndael
                        - pattern: DES
                        - pattern: TripleDES
                        - pattern: RC2
            - pattern: new AesGcm(...)
            - pattern: new AesCcm(...)
            - pattern: new ChaCha20Poly1305(...)
      pattern-sources:
        - patterns:
            - pattern-inside: (System.Random $RNG).NextBytes($KEY); ...
            - pattern: $KEY
      severity: ERROR
    - id: csharp.dotnet.security.use_weak_rsa_encryption_padding.use_weak_rsa_encryption_padding
      languages:
        - csharp
      message: You are using the outdated PKCS#1 v1.5 encryption padding for your RSA key. Use the OAEP padding instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-780: Use of RSA Algorithm without OAEP'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.rsapkcs1keyexchangeformatter
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.rsaoaepkeyexchangeformatter
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.rsapkcs1keyexchangedeformatter
            - https://learn.microsoft.com/en-gb/dotnet/api/system.security.cryptography.rsaoaepkeyexchangedeformatter
        subcategory:
            - vuln
        technology:
            - .net
      pattern-either:
        - pattern: (RSAPKCS1KeyExchangeFormatter $FORMATER).CreateKeyExchange(...);
        - pattern: (RSAPKCS1KeyExchangeDeformatter $DEFORMATER).DecryptKeyExchange(...);
      severity: WARNING
    - id: csharp.lang.correctness.double.double-epsilon-equality.correctness-double-epsilon-equality
      languages:
        - csharp
      message: Double.Epsilon is defined by .NET as the smallest value that can be added to or subtracted from a zero-value Double. It is unsuitable for equality comparisons of non-zero Double values. Furthermore, the value of Double.Epsilon is framework and processor architecture dependent. Wherever possible, developers should prefer the framework Equals() method over custom equality implementations.
      metadata:
        category: correctness
        confidence: MEDIUM
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.double?view=net-6.0#testing-for-equality
            - https://docs.microsoft.com/en-us/dotnet/api/system.double.epsilon?view=net-6.0#platform-notes
        technology:
            - .net
      patterns:
        - pattern: |
            $V1 - $V2
        - pattern-either:
            - pattern-inside: |
                ... <= Double.Epsilon
            - pattern-inside: |
                Double.Epsilon <= ...
        - pattern-not-inside: |
            double $V1 = 0;
            ...
        - pattern-not-inside: |
            double $V2 = 0;
            ...
        - pattern-not-inside: |
            $V1 = 0;
            ...
        - pattern-not-inside: |
            $V2 = 0;
            ...
      severity: WARNING
    - id: csharp.lang.correctness.regioninfo.regioninfo-interop.correctness-regioninfo-interop
      languages:
        - csharp
      message: Potential inter-process write of RegionInfo $RI via $PIPESTREAM $P that was instantiated with a two-character culture code $REGION.  Per .NET documentation, if you want to persist a RegionInfo object or communicate it between processes, you should instantiate it by using a full culture name rather than a two-letter ISO region code.
      metadata:
        category: correctness
        confidence: MEDIUM
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.globalization.regioninfo.twoletterisoregionname?view=net-6.0#remarks
        technology:
            - .net
      patterns:
        - pattern-either:
            - pattern: |
                $WRITER.Write($RI);
            - pattern: |
                $WRITER.WriteAsync($RI);
            - pattern: |
                $WRITER.WriteLine($RI);
            - pattern: |
                $WRITER.WriteLineAsync($RI);
        - pattern-inside: |
            RegionInfo $RI = new RegionInfo($REGION);
            ...
            using($PIPESTREAM $P = ...){
              ...
            }
        - metavariable-regex:
            metavariable: $REGION
            regex: ^"\w{2}"$
        - metavariable-regex:
            metavariable: $PIPESTREAM
            regex: (Anonymous|Named)Pipe(Server|Client)Stream
      severity: WARNING
    - fix: SslCertificateTrust.$METHOD($COLLECTION,false)
      id: csharp.lang.correctness.sslcertificatetrust.sslcertificatetrust-handshake-no-trust.correctness-sslcertificatetrust-handshake-no-trust
      languages:
        - csharp
      message: Sending the trusted CA list increases the size of the handshake request and can leak system configuration information.
      metadata:
        category: correctness
        confidence: HIGH
        cwe: 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.net.security.sslcertificatetrust.createforx509collection?view=net-6.0#remarks
            - https://docs.microsoft.com/en-us/dotnet/api/system.net.security.sslcertificatetrust.createforx509store?view=net-6.0#remarks
        technology:
            - .net
      patterns:
        - pattern-either:
            - pattern: SslCertificateTrust.$METHOD($COLLECTION,sendTrustInHandshake=true)
            - pattern: SslCertificateTrust.$METHOD($COLLECTION,true)
        - metavariable-regex:
            metavariable: $METHOD
            regex: CreateForX509(Collection|Store)
      severity: WARNING
    - fix: |
        true
      id: csharp.lang.security.ad.jwt-tokenvalidationparameters-no-expiry-validation.jwt-tokenvalidationparameters-no-expiry-validation
      languages:
        - csharp
      message: The TokenValidationParameters.$LIFETIME is set to $FALSE, this means the JWT tokens lifetime is not validated. This can lead to an JWT token being used after it has expired, which has security implications. It is recommended to validate the JWT lifetime to ensure only valid tokens are used.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-613: Insufficient Session Expiration'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/
            - https://cwe.mitre.org/data/definitions/613.html
            - https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters?view=azure-dotnet
        subcategory:
            - audit
        technology:
            - csharp
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $LIFETIME = $FALSE
                - pattern-inside: new TokenValidationParameters {...}
            - patterns:
                - pattern: |
                    (TokenValidationParameters $OPTS). ... .$LIFETIME = $FALSE
        - metavariable-regex:
            metavariable: $LIFETIME
            regex: (RequireExpirationTime|ValidateLifetime)
        - metavariable-regex:
            metavariable: $FALSE
            regex: (false)
        - focus-metavariable: $FALSE
      severity: WARNING
    - id: csharp.lang.security.cryptography.x509-subject-name-validation.x509-subject-name-validation
      languages:
        - csharp
      message: Validating certificates based on subject name is bad practice. Use the X509Certificate2.Verify() method instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.issuernameregistry?view=netframework-4.8
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.IdentityModel.Tokens;
            ...
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        X509SecurityToken $TOK = $RHS;
                        ...
                    - pattern-inside: |
                        $T $M(..., X509SecurityToken $TOK, ...) {
                            ...
                        }
                - metavariable-pattern:
                    metavariable: $RHS
                    pattern-either:
                        - pattern: $T as X509SecurityToken
                        - pattern: new X509SecurityToken(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        X509Certificate2 $CERT = new X509Certificate2(...);
                        ...
                    - pattern-inside: |
                        $T $M(..., X509Certificate2 $CERT, ...) {
                            ...
                        }
                    - pattern-inside: |
                        foreach (X509Certificate2 $CERT in $COLLECTION) {
                            ...
                        }
        - patterns:
            - pattern-either:
                - pattern: String.Equals($NAME, "...")
                - pattern: String.Equals("...", $NAME)
                - pattern: $NAME.Equals("...")
                - pattern: $NAME == "..."
                - pattern: $NAME != "..."
                - pattern: |
                    "..." == $NAME
                - pattern: |
                    "..." != $NAME
            - metavariable-pattern:
                metavariable: $NAME
                pattern-either:
                    - pattern: $TOK.Certificate.SubjectName.Name
                    - pattern: $CERT.SubjectName.Name
                    - pattern: $CERT.GetNameInfo(...)
      severity: WARNING
    - fix: RequireSignedTokens = true
      id: csharp.lang.security.cryptography.unsigned-security-token.unsigned-security-token
      languages:
        - csharp
      message: Accepting unsigned security tokens as valid security tokens allows an attacker to remove its signature and potentially forge an identity. As a fix, set RequireSignedTokens to be true.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-347: Improper Verification of Cryptographic Signature'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control/
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/
            - https://cwe.mitre.org/data/definitions/347
        subcategory:
            - vuln
        technology:
            - csharp
      patterns:
        - pattern: RequireSignedTokens = false
        - pattern-inside: |
            new TokenValidationParameters {
              ...
            }
      severity: ERROR
    - id: csharp.lang.security.filesystem.unsafe-path-combine.unsafe-path-combine
      languages:
        - csharp
      message: String argument $A is used to read or write data from a file via Path.Combine without direct sanitization via Path.GetFileName. If the path is user-supplied data this can lead to path traversal.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://www.praetorian.com/blog/pathcombine-security-issues-in-aspnet-applications/
            - https://docs.microsoft.com/en-us/dotnet/api/system.io.path.combine?view=net-6.0#remarks
        subcategory:
            - vuln
        technology:
            - .net
      mode: taint
      pattern-sanitizers:
        - pattern: |
            Path.GetFileName(...)
        - patterns:
            - pattern-inside: |
                $X = Path.GetFileName(...);
                ...
            - pattern: $X
        - patterns:
            - pattern: $X
            - pattern-inside: |
                if(<... Path.GetFileName($X) != $X ...>){
                  ...
                  throw new $EXCEPTION(...);
                }
                ...
      pattern-sinks:
        - patterns:
            - focus-metavariable: $X
            - pattern: |
                File.$METHOD($X,...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (?i)^(read|write)
      pattern-sources:
        - patterns:
            - pattern: $A
            - pattern-inside: |
                Path.Combine(...,$A,...)
            - pattern-inside: |
                public $TYPE $M(...,$A,...){...}
            - pattern-not-inside: |
                <... Path.GetFileName($A) != $A ...>
      severity: WARNING
    - id: csharp.lang.security.http.http-listener-wildcard-bindings.http-listener-wildcard-bindings
      languages:
        - C#
      message: The top level wildcard bindings $PREFIX leaves your application open to security vulnerabilities and give attackers more control over where traffic is routed. If you must use wildcards, consider using subdomain wildcard binding. For example, you can use "*.asdf.gov" if you own all of "asdf.gov".
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-706: Use of Incorrectly-Resolved Name or Reference'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.net.httplistener?view=net-6.0
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Net;
            ...
        - pattern: $LISTENER.Prefixes.Add("$PREFIX")
        - metavariable-regex:
            metavariable: $PREFIX
            regex: (http|https)://(\*|\+)(.[a-zA-Z]{2,})?:[0-9]+
      severity: WARNING
    - id: csharp.lang.security.injections.os-command.os-command-injection
      languages:
        - csharp
      message: The software constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/Command_Injection
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Diagnostics;
            ...
        - pattern-inside: |
            public $T $F(..., $ARG, ...)
            {
              ...
            }
        - pattern-either:
            - patterns:
                - pattern: |
                    Process.Start($ARG, ...);
                - focus-metavariable: $ARG
            - patterns:
                - pattern-inside: |
                    Process $PROC = new Process();
                    ...
                - pattern-either:
                    - pattern-inside: |
                        $PROC.StartInfo.FileName = $ARG;
                        ...
                    - pattern-inside: |
                        $PROC.StartInfo.Arguments = <... $ARG ...>;
                        ...
                - pattern: |
                    $PROC.Start();
            - patterns:
                - patterns:
                    - pattern-inside: |
                        ProcessStartInfo $PSINFO = new ProcessStartInfo()
                        {
                          ...
                        };
                        ...
                    - pattern-either:
                        - pattern-inside: |
                            FileName = $ARG;
                            ...
                        - pattern-inside: |
                            Arguments = <... $ARG ...>;
                            ...
                - pattern: |
                    Process.Start($PSINFO);
                - focus-metavariable: $PSINFO
            - patterns:
                - pattern-inside: |
                    Process $PROC = new Process()
                    {
                      StartInfo = new ProcessStartInfo()
                      {
                        ...
                      }
                    };
                    ...
                - pattern-either:
                    - pattern-inside: |
                        FileName = $ARG;
                        ...
                    - pattern-inside: |
                        Arguments = $ARG;
                        ...
                - pattern: |
                    $PROC.Start();
      severity: ERROR
    - id: csharp.lang.security.insecure-deserialization.binary-formatter.insecure-binaryformatter-deserialization
      languages:
        - C#
      message: The BinaryFormatter type is dangerous and is not recommended for data processing. Applications should stop using BinaryFormatter as soon as possible, even if they believe the data they're processing to be trustworthy. BinaryFormatter is insecure and can't be made secure
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Runtime.Serialization.Formatters.Binary;
            ...
        - pattern: |
            new BinaryFormatter();
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.fs-pickler.insecure-fspickler-deserialization
      languages:
        - C#
      message: The FsPickler is dangerous and is not recommended for data processing. Default configuration tend to insecure deserialization vulnerability.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://mbraceproject.github.io/FsPickler/tutorial.html#Disabling-Subtype-Resolution
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using MBrace.FsPickler.Json;
            ...
        - pattern: |
            FsPickler.CreateJsonSerializer();
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.insecure-typefilterlevel-full.insecure-typefilterlevel-full
      languages:
        - C#
      message: Using a .NET remoting service can lead to RCE, even if you try to configure TypeFilterLevel. Recommended to switch from .NET Remoting to WCF https://docs.microsoft.com/en-us/dotnet/framework/wcf/migrating-from-net-remoting-to-wcf
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.typefilterlevel?view=net-6.0
            - https://www.synacktiv.com/en/publications/izi-izi-pwn2own-ics-miami.html
        subcategory:
            - audit
        technology:
            - .net
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern: new BinaryServerFormatterSinkProvider { TypeFilterLevel = $LEVEL }
                - patterns:
                    - pattern-inside: |
                        $TYPE $SP = new BinaryServerFormatterSinkProvider(...);
                        ...
                    - pattern: |
                        $SP.TypeFilterLevel = $LEVEL
            - metavariable-regex:
                metavariable: $LEVEL
                regex: (.*)TypeFilterLevel\.(Full|Low)
        - patterns:
            - pattern-inside: |
                $DICT["typeFilterLevel"] = $VAL;
                ...
            - pattern: new BinaryServerFormatterSinkProvider(..., $DICT, ...)
            - metavariable-regex:
                metavariable: $VAL
                regex: (\"Full\"|\"Low\")
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.javascript-serializer.insecure-javascriptserializer-deserialization
      languages:
        - C#
      message: The SimpleTypeResolver class is insecure and should not be used. Using SimpleTypeResolver to deserialize JSON could allow the remote client to execute malicious code within the app and take control of the web server.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.web.script.serialization.simpletyperesolver?view=netframework-4.8#remarks
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Web.Script.Serialization;
            ...
        - pattern: |
            new JavaScriptSerializer((SimpleTypeResolver $RESOLVER))
      severity: ERROR
    - id: csharp.lang.security.insecure-deserialization.los-formatter.insecure-losformatter-deserialization
      languages:
        - C#
      message: The LosFormatter type is dangerous and is not recommended for data processing. Applications should stop using LosFormatter as soon as possible, even if they believe the data they're processing to be trustworthy. LosFormatter is insecure and can't be made secure
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.losformatter?view=netframework-4.8
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Web.UI;
            ...
        - pattern: |
            new LosFormatter();
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.net-data-contract.insecure-netdatacontract-deserialization
      languages:
        - C#
      message: The NetDataContractSerializer type is dangerous and is not recommended for data processing. Applications should stop using NetDataContractSerializer as soon as possible, even if they believe the data they're processing to be trustworthy. NetDataContractSerializer is insecure and can't be made secure
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer?view=netframework-4.8#security
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Runtime.Serialization;
            ...
        - pattern: |
            new NetDataContractSerializer();
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.newtonsoft.insecure-newtonsoft-deserialization
      languages:
        - csharp
      message: TypeNameHandling $TYPEHANDLER is unsafe and can lead to arbitrary code execution in the context of the process. Use a custom SerializationBinder whenever using a setting other than TypeNameHandling.None.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_TypeNameHandling.htm#remarks
        subcategory:
            - audit
        technology:
            - .net
            - newtonsoft
            - json
      patterns:
        - pattern-either:
            - pattern: TypeNameHandling = TypeNameHandling.$TYPEHANDLER
            - pattern: |
                $SETTINGS.TypeNameHandling = TypeNameHandling.$TYPEHANDLER;
                ...
                JsonConvert.DeserializeObject<$TYPE>(...,$SETTINGS);
            - pattern: |
                $SETTINGS.TypeNameHandling = TypeNameHandling.$TYPEHANDLER;
                ...
                JsonConvert.DeserializeObject(...,$SETTINGS);
        - pattern-inside: |
            using Newtonsoft.Json;
            ...
        - metavariable-regex:
            metavariable: $TYPEHANDLER
            regex: (All|Auto|Objects|Arrays)
      severity: WARNING
    - id: csharp.lang.security.insecure-deserialization.soap-formatter.insecure-soapformatter-deserialization
      languages:
        - C#
      message: The SoapFormatter type is dangerous and is not recommended for data processing. Applications should stop using SoapFormatter as soon as possible, even if they believe the data they're processing to be trustworthy. SoapFormatter is insecure and can't be made secure
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter?view=netframework-4.8#remarks
        subcategory:
            - vuln
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Runtime.Serialization.Formatters.Soap;
            ...
        - pattern: |
            new SoapFormatter();
      severity: WARNING
    - id: csharp.lang.security.regular-expression-dos.regular-expression-dos-infinite-timeout.regular-expression-dos-infinite-timeout
      languages:
        - C#
      message: 'Specifying the regex timeout leaves the system vulnerable to a regex-based Denial of Service (DoS) attack. Consider setting the timeout to a short amount of time like 2 or 3 seconds. If you are sure you need an infinite timeout, double check that your context meets the conditions outlined in the "Notes to Callers" section at the bottom of this page: https://docs.microsoft.com/en-us/dotnet/api/system.text.regularexpressions.regex.-ctor?view=net-6.0'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1333: Inefficient Regular Expression Complexity'
        impact: MEDIUM
        likelihood: LOW
        owasp: A01:2017 - Injection
        references:
            - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
            - https://docs.microsoft.com/en-us/dotnet/api/system.text.regularexpressions.regex.infinitematchtimeout
            - https://docs.microsoft.com/en-us/dotnet/api/system.text.regularexpressions.regex.-ctor?view=net-6.0
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Text.RegularExpressions;
            ...
        - pattern-either:
            - pattern: new Regex(..., TimeSpan.InfiniteMatchTimeout)
            - patterns:
                - pattern: new Regex(..., TimeSpan.FromSeconds($TIME))
                - metavariable-comparison:
                    comparison: $TIME > 5
                    metavariable: $TIME
            - pattern: new Regex(..., TimeSpan.FromMinutes(...))
            - pattern: new Regex(..., TimeSpan.FromHours(...))
      severity: WARNING
    - id: csharp.lang.security.regular-expression-dos.regular-expression-dos.regular-expression-dos
      languages:
        - C#
      message: When using `System.Text.RegularExpressions` to process untrusted input, pass a timeout.  A malicious user can provide input to `RegularExpressions` that abuses the backtracking behaviour of this regular expression engine. This will lead to excessive CPU usage, causing a Denial-of-Service attack
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1333: Inefficient Regular Expression Complexity'
        impact: MEDIUM
        likelihood: LOW
        owasp: A01:2017 - Injection
        references:
            - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
            - https://docs.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions#regular-expression-examples
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Text.RegularExpressions;
            ...
        - pattern-either:
            - pattern: |
                public $T $F($X)
                {
                  Regex $Y = new Regex($P);
                  ...
                  $Y.Match($X);
                }
            - pattern: |
                public $T $F($X)
                {
                  Regex $Y = new Regex($P, $O);
                  ...
                  $Y.Match($X);
                }
            - pattern: |
                public $T $F($X)
                {
                  ... Regex.Match($X, $P);
                }
            - pattern: |
                public $T $F($X)
                {
                  ... Regex.Match($X, $P, $O);
                }
      severity: WARNING
    - id: csharp.lang.security.sqli.csharp-sqli.csharp-sqli
      languages:
        - csharp
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements instead. You can obtain a PreparedStatement using 'SqlCommand' and 'SqlParameter'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - csharp
      mode: taint
      pattern-propagators:
        - from: $X
          pattern: (StringBuilder $B).$ANY(...,(string $X),...)
          to: $B
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - pattern: |
                $CMD.Parameters.add(...)
            - pattern: |
                $CMD.Parameters[$IDX] = ...
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        new $PATTERN($CMD,...)
                    - focus-metavariable: $CMD
                - pattern: |
                    $CMD.$PATTERN = ...;
            - metavariable-regex:
                metavariable: $PATTERN
                regex: ^(SqlCommand|CommandText|OleDbCommand|OdbcCommand|OracleCommand)$
      pattern-sources:
        - patterns:
            - pattern: |
                (string $X)
            - pattern-not: |
                "..."
      severity: ERROR
    - id: csharp.lang.security.ssrf.http-client.ssrf
      languages:
        - csharp
      message: SSRF is an attack vector that abuses an application to interact with the internal/external network or the machine itself.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Net.Http;
            ...
        - pattern-either:
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                HttpClient $Y = new HttpClient();
                ...
                ... $Y.GetAsync(<... $X ...>, ...);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                HttpClient $Y = new HttpClient();
                ...
                ... $Y.GetAsync($B, ...);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                HttpClient $Y = new HttpClient();
                ...
                ... $Y.GetStringAsync(<... $X ...>);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                HttpClient $Y = new HttpClient();
                ...
                ... $Y.GetStringAsync($B);
                }
      severity: ERROR
    - id: csharp.lang.security.ssrf.rest-client.ssrf
      languages:
        - csharp
      message: SSRF is an attack vector that abuses an application to interact with the internal/external network or the machine itself.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using RestSharp;
            ...
        - pattern-either:
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                ... new RestClient(<... $X ...>);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                ... new RestClient($B);
                }
      severity: ERROR
    - id: csharp.lang.security.ssrf.web-client.ssrf
      languages:
        - csharp
      message: SSRF is an attack vector that abuses an application to interact with the internal/external network or the machine itself.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Net;
            ...
        - pattern-either:
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.OpenRead(<... $X ...>);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.OpenRead($B);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.OpenReadAsync(<... $X ...>, ...);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.OpenReadAsync($B, ...);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.DownloadString(<... $X ...>);
                }
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                $A $B = <... $X ...>;
                ...
                WebClient $Y = new WebClient();
                ...
                ... $Y.DownloadString($B);
                }
      severity: ERROR
    - id: csharp.lang.security.ssrf.web-request.ssrf
      languages:
        - csharp
      message: The web server receives a URL or similar request from an upstream component and retrieves the contents of this URL, but it does not sufficiently ensure that the request is being sent to the expected destination. Many different options exist to fix this issue depending the use case (Application can send request only to identified and trusted applications, Application can send requests to ANY external IP address or domain name).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cwe.mitre.org/data/definitions/918.html
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - .net
      patterns:
        - pattern-inside: |
            using System.Net;
            ...
        - pattern-either:
            - pattern: |
                $T $F(..., $X, ...)
                {
                ...
                ... WebRequest.Create(<... $X ...>);
                }
            - pattern: |
                $T $F($X)
                {
                ...
                $A $B = <... $X ...>;
                ...
                ... WebRequest.Create($B);
                }
            - pattern: |
                $T $F($X)
                {
                ...
                $A $B = <... $X ...>;
                ...
                $C $D = <... $B ...>;
                ...
                ... WebRequest.Create($D);
                }
      severity: ERROR
    - id: csharp.lang.security.stacktrace-disclosure.stacktrace-disclosure
      languages:
        - csharp
      message: Stacktrace information is displayed in a non-Development environment. Accidentally disclosing sensitive stack trace information in a production environment aids an attacker in reconnaissance and information gathering.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-209: Generation of Error Message Containing Sensitive Information'
        impact: LOW
        likelihood: LOW
        owasp:
            - A06:2017 - Security Misconfiguration
            - A04:2021 - Insecure Design
        references:
            - https://cwe.mitre.org/data/definitions/209.html
            - https://owasp.org/Top10/A04_2021-Insecure_Design/
        subcategory:
            - audit
        technology:
            - csharp
      patterns:
        - pattern: $APP.UseDeveloperExceptionPage(...);
        - pattern-not-inside: "if ($ENV.IsDevelopment(...)) {\n  ... \n  $APP.UseDeveloperExceptionPage(...); \n  ...\n}\n"
      severity: WARNING
    - id: csharp.lang.security.xxe.xmldocument-unsafe-parser-override.xmldocument-unsafe-parser-override
      languages:
        - csharp
      message: XmlReaderSettings found with DtdProcessing.Parse on an XmlReader handling a string argument from a public method. Enabling Document Type Definition (DTD) parsing may cause XML External Entity (XXE) injection if supplied with user-controllable data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.jardinesoftware.net/2016/05/26/xxe-and-net/
            - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmldocument.xmlresolver?view=net-6.0#remarks
        subcategory:
            - vuln
        technology:
            - .net
            - xml
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $XMLDOCUMENT.$METHOD(...)
            - pattern-inside: "XmlDocument $XMLDOCUMENT = new XmlDocument(...);\n...\n$XMLDOCUMENT.XmlResolver = new XmlUrlResolver(...);\n...  \n"
      pattern-sources:
        - patterns:
            - focus-metavariable: $ARG
            - pattern-inside: |
                public $T $M(...,string $ARG,...){...}
      severity: WARNING
    - id: csharp.lang.security.xxe.xmlreadersettings-unsafe-parser-override.xmlreadersettings-unsafe-parser-override
      languages:
        - csharp
      message: XmlReaderSettings found with DtdProcessing.Parse on an XmlReader handling a string argument from a public method. Enabling Document Type Definition (DTD) parsing may cause XML External Entity (XXE) injection if supplied with user-controllable data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.jardinesoftware.net/2016/05/26/xxe-and-net/
            - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmldocument.xmlresolver?view=net-6.0#remarks
        subcategory:
            - vuln
        technology:
            - .net
            - xml
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                XmlReader $READER = XmlReader.Create(...,$RS,...);
            - pattern-inside: "XmlReaderSettings $RS = new XmlReaderSettings();\n...\n$RS.DtdProcessing = DtdProcessing.Parse;\n...        \n"
      pattern-sources:
        - patterns:
            - focus-metavariable: $ARG
            - pattern-inside: |
                public $T $M(...,string $ARG,...){...}
      severity: WARNING
    - id: csharp.lang.security.xxe.xmltextreader-unsafe-defaults.xmltextreader-unsafe-defaults
      languages:
        - csharp
      message: XmlReaderSettings found with DtdProcessing.Parse on an XmlReader handling a string argument from a public method. Enabling Document Type Definition (DTD) parsing may cause XML External Entity (XXE) injection if supplied with user-controllable data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.jardinesoftware.net/2016/05/26/xxe-and-net/
            - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmldocument.xmlresolver?view=net-6.0#remarks
        subcategory:
            - vuln
        technology:
            - .net
            - xml
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $READER.$METHOD(...)
            - pattern-not-inside: |
                $READER.DtdProcessing = DtdProcessing.Prohibit;
                ...
            - pattern-inside: |
                XmlTextReader $READER = new XmlTextReader(...);
                ...
      pattern-sources:
        - patterns:
            - focus-metavariable: $ARG
            - pattern-inside: |
                public $T $M(...,string $ARG,...){...}
      severity: WARNING
    - id: csharp.razor.security.html-raw-json.html-raw-json
      languages:
        - generic
      message: Unencoded JSON in HTML context is vulnerable to cross-site scripting, because `</script>` is not properly encoded.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - razor
      paths:
        include:
            - '*.cshtml'
      patterns:
        - pattern-either:
            - pattern: '@Html.Raw(Json.Encode(...))'
            - pattern: '@Html.Raw(JsonConvert.SerializeObject(...))'
            - pattern: '@Html.Raw(...ToJson(...))'
      severity: ERROR
    - id: dockerfile.security.last-user-is-root.last-user-is-root
      languages:
        - dockerfile
      message: The last user in the container is 'root'. This is a security hazard because if an attacker gains control of the container they will have root access. Switch back to another user after running commands as 'root'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://github.com/hadolint/hadolint/wiki/DL3002
        source-rule-url: https://github.com/hadolint/hadolint/wiki/DL3002
        subcategory:
            - audit
        technology:
            - dockerfile
      patterns:
        - pattern: USER root
        - pattern-not-inside:
            patterns:
                - pattern: |
                    USER root
                    ...
                    USER $X
                - metavariable-pattern:
                    metavariable: $X
                    patterns:
                        - pattern-not: root
      severity: ERROR
    - fix: |
        USER non-root
        ENTRYPOINT $...VARS
      id: dockerfile.security.missing-user-entrypoint.missing-user-entrypoint
      languages:
        - dockerfile
      message: By not specifying a USER, a program in the container may run as 'root'. This is a security hazard. If an attacker can control a process running as root, they may have control over the container. Ensure that the last USER in a Dockerfile is a USER other than 'root'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - audit
        technology:
            - dockerfile
      patterns:
        - pattern: |
            ENTRYPOINT $...VARS
        - pattern-not-inside: |
            USER $USER
            ...
      severity: ERROR
    - fix: |
        USER non-root
        CMD $...VARS
      id: dockerfile.security.missing-user.missing-user
      languages:
        - dockerfile
      message: By not specifying a USER, a program in the container may run as 'root'. This is a security hazard. If an attacker can control a process running as root, they may have control over the container. Ensure that the last USER in a Dockerfile is a USER other than 'root'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - audit
        technology:
            - dockerfile
      patterns:
        - pattern: |
            CMD $...VARS
        - pattern-not-inside: |
            USER $USER
            ...
      severity: ERROR
    - id: dockerfile.security.no-sudo-in-dockerfile.no-sudo-in-dockerfile
      languages:
        - dockerfile
      message: Avoid using sudo in Dockerfiles. Running processes as a non-root user can help  reduce the potential impact of configuration errors and security vulnerabilities.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/250.html
            - https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#user
        subcategory:
            - audit
        technology:
            - dockerfile
      patterns:
        - pattern: |
            RUN sudo ...
      severity: WARNING
    - fix: $MODULE.to_existing_atom($STRING)
      id: elixir.lang.correctness.atom-exhaustion.atom_exhaustion
      languages:
        - elixir
      message: Atom values are appended to a global table but never removed. If input is user-controlled, dynamic instantiations such as `String.to_atom` or `List.to_atom` can lead to possible memory leaks. Instead, use `String.to_existing_atom` or `List.to_existing_atom`.
      metadata:
        category: correctness
        references:
            - https://erlef.github.io/security-wg/secure_coding_and_deployment_hardening/atom_exhaustion.html
        technology:
            - elixir
      patterns:
        - pattern: $MODULE.to_atom($STRING)
        - metavariable-regex:
            metavariable: $MODULE
            regex: ^(String|List)$
      severity: ERROR
    - id: generic.secrets.gitleaks.adobe-client-id.adobe-client-id
      languages:
        - regex
      message: A gitleaks adobe-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:adobe)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.adobe-client-secret.adobe-client-secret
      languages:
        - regex
      message: A gitleaks adobe-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b((p8e-)(?i)[a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.age-secret-key.age-secret-key
      languages:
        - regex
      message: A gitleaks age-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: AGE-SECRET-KEY-1[QPZRY9X8GF2TVDW0S3JN54KHCE6MUA7L]{58}
      severity: INFO
    - id: generic.secrets.gitleaks.airtable-api-key.airtable-api-key
      languages:
        - regex
      message: A gitleaks airtable-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:airtable)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{17})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.algolia-api-key.algolia-api-key
      languages:
        - regex
      message: A gitleaks algolia-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:algolia)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.alibaba-access-key-id.alibaba-access-key-id
      languages:
        - regex
      message: A gitleaks alibaba-access-key-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b((LTAI)(?i)[a-z0-9]{20})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.alibaba-secret-key.alibaba-secret-key
      languages:
        - regex
      message: A gitleaks alibaba-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:alibaba)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{30})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.asana-client-id.asana-client-id
      languages:
        - regex
      message: A gitleaks asana-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:asana)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9]{16})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.asana-client-secret.asana-client-secret
      languages:
        - regex
      message: A gitleaks asana-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:asana)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.atlassian-api-token.atlassian-api-token
      languages:
        - regex
      message: A gitleaks atlassian-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:atlassian|confluence|jira)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{24})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.authress-service-client-access-key.authress-service-client-access-key
      languages:
        - regex
      message: A gitleaks authress-service-client-access-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b((?:sc|ext|scauth|authress)_[a-z0-9]{5,30}\.[a-z0-9]{4,6}\.acc[_-][a-z0-9-]{10,32}\.[a-z0-9+/_=-]{30,120})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.aws-access-token.aws-access-token
      languages:
        - regex
      message: A gitleaks aws-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?:A3T[A-Z0-9]|AKIA|ASIA|ABIA|ACCA)[A-Z0-9]{16}
      severity: INFO
    - id: generic.secrets.gitleaks.beamer-api-token.beamer-api-token
      languages:
        - regex
      message: A gitleaks beamer-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:beamer)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(b_[a-z0-9=_\-]{44})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.bitbucket-client-id.bitbucket-client-id
      languages:
        - regex
      message: A gitleaks bitbucket-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:bitbucket)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.bitbucket-client-secret.bitbucket-client-secret
      languages:
        - regex
      message: A gitleaks bitbucket-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:bitbucket)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.bittrex-access-key.bittrex-access-key
      languages:
        - regex
      message: A gitleaks bittrex-access-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:bittrex)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.bittrex-secret-key.bittrex-secret-key
      languages:
        - regex
      message: A gitleaks bittrex-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:bittrex)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.clojars-api-token.clojars-api-token
      languages:
        - regex
      message: A gitleaks clojars-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(CLOJARS_)[a-z0-9]{60}
      severity: INFO
    - id: generic.secrets.gitleaks.cloudflare-api-key.cloudflare-api-key
      languages:
        - regex
      message: A gitleaks cloudflare-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:cloudflare)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9_-]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.cloudflare-global-api-key.cloudflare-global-api-key
      languages:
        - regex
      message: A gitleaks cloudflare-global-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:cloudflare)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{37})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.cloudflare-origin-ca-key.cloudflare-origin-ca-key
      languages:
        - regex
      message: A gitleaks cloudflare-origin-ca-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: \b(v1\.0-[a-f0-9]{24}-[a-f0-9]{146})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.codecov-access-token.codecov-access-token
      languages:
        - regex
      message: A gitleaks codecov-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:codecov)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.coinbase-access-token.coinbase-access-token
      languages:
        - regex
      message: A gitleaks coinbase-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:coinbase)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9_-]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.confluent-access-token.confluent-access-token
      languages:
        - regex
      message: A gitleaks confluent-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:confluent)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{16})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.confluent-secret-key.confluent-secret-key
      languages:
        - regex
      message: A gitleaks confluent-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:confluent)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.databricks-api-token.databricks-api-token
      languages:
        - regex
      message: A gitleaks databricks-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(dapi[a-h0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.datadog-access-token.datadog-access-token
      languages:
        - regex
      message: A gitleaks datadog-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:datadog)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.defined-networking-api-token.defined-networking-api-token
      languages:
        - regex
      message: A gitleaks defined-networking-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:dnkey)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(dnkey-[a-z0-9=_\-]{26}-[a-z0-9=_\-]{52})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.digitalocean-access-token.digitalocean-access-token
      languages:
        - regex
      message: A gitleaks digitalocean-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(doo_v1_[a-f0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.digitalocean-pat.digitalocean-pat
      languages:
        - regex
      message: A gitleaks digitalocean-pat was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(dop_v1_[a-f0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.digitalocean-refresh-token.digitalocean-refresh-token
      languages:
        - regex
      message: A gitleaks digitalocean-refresh-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(dor_v1_[a-f0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.discord-api-token.discord-api-token
      languages:
        - regex
      message: A gitleaks discord-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:discord)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.discord-client-secret.discord-client-secret
      languages:
        - regex
      message: A gitleaks discord-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:discord)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.doppler-api-token.doppler-api-token
      languages:
        - regex
      message: A gitleaks doppler-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (dp\.pt\.)(?i)[a-z0-9]{43}
      severity: INFO
    - id: generic.secrets.gitleaks.droneci-access-token.droneci-access-token
      languages:
        - regex
      message: A gitleaks droneci-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:droneci)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.dropbox-api-token.dropbox-api-token
      languages:
        - regex
      message: A gitleaks dropbox-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:dropbox)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{15})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.dropbox-long-lived-api-token.dropbox-long-lived-api-token
      languages:
        - regex
      message: A gitleaks dropbox-long-lived-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:dropbox)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{11}(AAAAAAAAAA)[a-z0-9\-_=]{43})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.dropbox-short-lived-api-token.dropbox-short-lived-api-token
      languages:
        - regex
      message: A gitleaks dropbox-short-lived-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:dropbox)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(sl\.[a-z0-9\-=_]{135})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.duffel-api-token.duffel-api-token
      languages:
        - regex
      message: A gitleaks duffel-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: duffel_(test|live)_(?i)[a-z0-9_\-=]{43}
      severity: INFO
    - id: generic.secrets.gitleaks.dynatrace-api-token.dynatrace-api-token
      languages:
        - regex
      message: A gitleaks dynatrace-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: dt0c01\.(?i)[a-z0-9]{24}\.[a-z0-9]{64}
      severity: INFO
    - id: generic.secrets.gitleaks.easypost-api-token.easypost-api-token
      languages:
        - regex
      message: A gitleaks easypost-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: \bEZAK(?i)[a-z0-9]{54}
      severity: INFO
    - id: generic.secrets.gitleaks.easypost-test-api-token.easypost-test-api-token
      languages:
        - regex
      message: A gitleaks easypost-test-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: \bEZTK(?i)[a-z0-9]{54}
      severity: INFO
    - id: generic.secrets.gitleaks.etsy-access-token.etsy-access-token
      languages:
        - regex
      message: A gitleaks etsy-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:etsy)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{24})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.facebook-access-token.facebook-access-token
      languages:
        - regex
      message: A gitleaks facebook-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(\d{15,16}(\||%)[0-9a-z\-_]{27,40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.facebook-page-access-token.facebook-page-access-token
      languages:
        - regex
      message: A gitleaks facebook-page-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(EAA[MC][a-z0-9]{20,})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.facebook-secret.facebook-secret
      languages:
        - regex
      message: A gitleaks facebook-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:facebook)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.facebook.facebook
      languages:
        - regex
      message: A gitleaks facebook was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:facebook)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.fastly-api-token.fastly-api-token
      languages:
        - regex
      message: A gitleaks fastly-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:fastly)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.finicity-api-token.finicity-api-token
      languages:
        - regex
      message: A gitleaks finicity-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:finicity)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.finicity-client-secret.finicity-client-secret
      languages:
        - regex
      message: A gitleaks finicity-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:finicity)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{20})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.finnhub-access-token.finnhub-access-token
      languages:
        - regex
      message: A gitleaks finnhub-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:finnhub)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{20})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.flickr-access-token.flickr-access-token
      languages:
        - regex
      message: A gitleaks flickr-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:flickr)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.flutterwave-encryption-key.flutterwave-encryption-key
      languages:
        - regex
      message: A gitleaks flutterwave-encryption-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: FLWSECK_TEST-(?i)[a-h0-9]{12}
      severity: INFO
    - id: generic.secrets.gitleaks.flutterwave-secret-key.flutterwave-secret-key
      languages:
        - regex
      message: A gitleaks flutterwave-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: FLWSECK_TEST-(?i)[a-h0-9]{32}-X
      severity: INFO
    - id: generic.secrets.gitleaks.frameio-api-token.frameio-api-token
      languages:
        - regex
      message: A gitleaks frameio-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: fio-u-(?i)[a-z0-9\-_=]{64}
      severity: INFO
    - id: generic.secrets.gitleaks.freshbooks-access-token.freshbooks-access-token
      languages:
        - regex
      message: A gitleaks freshbooks-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:freshbooks)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.gcp-api-key.gcp-api-key
      languages:
        - regex
      message: A gitleaks gcp-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(AIza[0-9A-Za-z\\-_]{35})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.github-app-token.github-app-token
      languages:
        - regex
      message: A gitleaks github-app-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (ghu|ghs)_[0-9a-zA-Z]{36}
      severity: INFO
    - id: generic.secrets.gitleaks.github-fine-grained-pat.github-fine-grained-pat
      languages:
        - regex
      message: A gitleaks github-fine-grained-pat was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: github_pat_[0-9a-zA-Z_]{82}
      severity: INFO
    - id: generic.secrets.gitleaks.github-oauth.github-oauth
      languages:
        - regex
      message: A gitleaks github-oauth was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: gho_[0-9a-zA-Z]{36}
      severity: INFO
    - id: generic.secrets.gitleaks.github-pat.github-pat
      languages:
        - regex
      message: A gitleaks github-pat was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: ghp_[0-9a-zA-Z]{36}
      severity: INFO
    - id: generic.secrets.gitleaks.github-refresh-token.github-refresh-token
      languages:
        - regex
      message: A gitleaks github-refresh-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: ghr_[0-9a-zA-Z]{36}
      severity: INFO
    - id: generic.secrets.gitleaks.gitlab-pat.gitlab-pat
      languages:
        - regex
      message: A gitleaks gitlab-pat was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: glpat-[0-9a-zA-Z\-\_]{20}
      severity: INFO
    - id: generic.secrets.gitleaks.gitlab-ptt.gitlab-ptt
      languages:
        - regex
      message: A gitleaks gitlab-ptt was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: glptt-[0-9a-f]{40}
      severity: INFO
    - id: generic.secrets.gitleaks.gitlab-rrt.gitlab-rrt
      languages:
        - regex
      message: A gitleaks gitlab-rrt was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: GR1348941[0-9a-zA-Z\-\_]{20}
      severity: INFO
    - id: generic.secrets.gitleaks.gitter-access-token.gitter-access-token
      languages:
        - regex
      message: A gitleaks gitter-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:gitter)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9_-]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.grafana-api-key.grafana-api-key
      languages:
        - regex
      message: A gitleaks grafana-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(eyJrIjoi[A-Za-z0-9]{70,400}={0,2})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.grafana-cloud-api-token.grafana-cloud-api-token
      languages:
        - regex
      message: A gitleaks grafana-cloud-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(glc_[A-Za-z0-9+/]{32,400}={0,2})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.grafana-service-account-token.grafana-service-account-token
      languages:
        - regex
      message: A gitleaks grafana-service-account-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(glsa_[A-Za-z0-9]{32}_[A-Fa-f0-9]{8})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.harness-api-key.harness-api-key
      languages:
        - regex
      message: A gitleaks harness-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: ((?:pat|sat)\.[a-zA-Z0-9]{22}\.[a-zA-Z0-9]{24}\.[a-zA-Z0-9]{20})
      severity: INFO
    - id: generic.secrets.gitleaks.hashicorp-tf-api-token.hashicorp-tf-api-token
      languages:
        - regex
      message: A gitleaks hashicorp-tf-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)[a-z0-9]{14}\.atlasv1\.[a-z0-9\-_=]{60,70}
      severity: INFO
    - id: generic.secrets.gitleaks.hashicorp-tf-password.hashicorp-tf-password
      languages:
        - regex
      message: A gitleaks hashicorp-tf-password was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:administrator_login_password|password)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}("[a-z0-9=_\-]{8,20}")(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.heroku-api-key.heroku-api-key
      languages:
        - regex
      message: A gitleaks heroku-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:heroku)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.hubspot-api-key.hubspot-api-key
      languages:
        - regex
      message: A gitleaks hubspot-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:hubspot)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.huggingface-access-token.huggingface-access-token
      languages:
        - regex
      message: A gitleaks huggingface-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?:^|[\\'"` >=:])(hf_[a-zA-Z]{34})(?:$|[\\'"` <])
      severity: INFO
    - id: generic.secrets.gitleaks.huggingface-organization-api-token.huggingface-organization-api-token
      languages:
        - regex
      message: A gitleaks huggingface-organization-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?:^|[\\'"` >=:\(,)])(api_org_[a-zA-Z]{34})(?:$|[\\'"` <\),])
      severity: INFO
    - id: generic.secrets.gitleaks.infracost-api-token.infracost-api-token
      languages:
        - regex
      message: A gitleaks infracost-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(ico-[a-zA-Z0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.intercom-api-key.intercom-api-key
      languages:
        - regex
      message: A gitleaks intercom-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:intercom)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{60})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.intra42-client-secret.intra42-client-secret
      languages:
        - regex
      message: A gitleaks intra42-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(s-s4t2(?:ud|af)-[abcdef0123456789]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.jfrog-api-key.jfrog-api-key
      languages:
        - regex
      message: A gitleaks jfrog-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:jfrog|artifactory|bintray|xray)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{73})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.jfrog-identity-token.jfrog-identity-token
      languages:
        - regex
      message: A gitleaks jfrog-identity-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:jfrog|artifactory|bintray|xray)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.jwt.jwt
      languages:
        - regex
      message: A gitleaks jwt was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: \b(ey[a-zA-Z0-9]{17,}\.ey[a-zA-Z0-9\/\\_-]{17,}\.(?:[a-zA-Z0-9\/\\_-]{10,}={0,2})?)(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.kraken-access-token.kraken-access-token
      languages:
        - regex
      message: A gitleaks kraken-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:kraken)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9\/=_\+\-]{80,90})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.kucoin-access-token.kucoin-access-token
      languages:
        - regex
      message: A gitleaks kucoin-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:kucoin)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{24})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.kucoin-secret-key.kucoin-secret-key
      languages:
        - regex
      message: A gitleaks kucoin-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:kucoin)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.launchdarkly-access-token.launchdarkly-access-token
      languages:
        - regex
      message: A gitleaks launchdarkly-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:launchdarkly)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.linear-api-key.linear-api-key
      languages:
        - regex
      message: A gitleaks linear-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: lin_api_(?i)[a-z0-9]{40}
      severity: INFO
    - id: generic.secrets.gitleaks.linear-client-secret.linear-client-secret
      languages:
        - regex
      message: A gitleaks linear-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:linear)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.linkedin-client-id.linkedin-client-id
      languages:
        - regex
      message: A gitleaks linkedin-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:linkedin|linked-in)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{14})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.linkedin-client-secret.linkedin-client-secret
      languages:
        - regex
      message: A gitleaks linkedin-client-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:linkedin|linked-in)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{16})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.lob-api-key.lob-api-key
      languages:
        - regex
      message: A gitleaks lob-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:lob)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}((live|test)_[a-f0-9]{35})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.mailchimp-api-key.mailchimp-api-key
      languages:
        - regex
      message: A gitleaks mailchimp-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:MailchimpSDK.initialize|mailchimp)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{32}-us\d\d)(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.mailgun-private-api-token.mailgun-private-api-token
      languages:
        - regex
      message: A gitleaks mailgun-private-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:mailgun)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(key-[a-f0-9]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.mailgun-signing-key.mailgun-signing-key
      languages:
        - regex
      message: A gitleaks mailgun-signing-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:mailgun)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-h0-9]{32}-[a-h0-9]{8}-[a-h0-9]{8})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.mattermost-access-token.mattermost-access-token
      languages:
        - regex
      message: A gitleaks mattermost-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:mattermost)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{26})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.messagebird-api-token.messagebird-api-token
      languages:
        - regex
      message: A gitleaks messagebird-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:messagebird|message-bird|message_bird)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{25})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.messagebird-client-id.messagebird-client-id
      languages:
        - regex
      message: A gitleaks messagebird-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:messagebird|message-bird|message_bird)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.microsoft-teams-webhook.microsoft-teams-webhook
      languages:
        - regex
      message: A gitleaks microsoft-teams-webhook was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: https:\/\/[a-z0-9]+\.webhook\.office\.com\/webhookb2\/[a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12}@[a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12}\/IncomingWebhook\/[a-z0-9]{32}\/[a-z0-9]{8}-([a-z0-9]{4}-){3}[a-z0-9]{12}
      severity: INFO
    - id: generic.secrets.gitleaks.netlify-access-token.netlify-access-token
      languages:
        - regex
      message: A gitleaks netlify-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:netlify)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{40,46})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.new-relic-browser-api-token.new-relic-browser-api-token
      languages:
        - regex
      message: A gitleaks new-relic-browser-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:new-relic|newrelic|new_relic)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(NRJS-[a-f0-9]{19})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.new-relic-insert-key.new-relic-insert-key
      languages:
        - regex
      message: A gitleaks new-relic-insert-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:new-relic|newrelic|new_relic)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(NRII-[a-z0-9-]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.new-relic-user-api-id.new-relic-user-api-id
      languages:
        - regex
      message: A gitleaks new-relic-user-api-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:new-relic|newrelic|new_relic)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.new-relic-user-api-key.new-relic-user-api-key
      languages:
        - regex
      message: A gitleaks new-relic-user-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:new-relic|newrelic|new_relic)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(NRAK-[a-z0-9]{27})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.npm-access-token.npm-access-token
      languages:
        - regex
      message: A gitleaks npm-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(npm_[a-z0-9]{36})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.nytimes-access-token.nytimes-access-token
      languages:
        - regex
      message: A gitleaks nytimes-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:nytimes|new-york-times,|newyorktimes)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{32})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.okta-access-token.okta-access-token
      languages:
        - regex
      message: A gitleaks okta-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:okta)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9=_\-]{42})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.openai-api-key.openai-api-key
      languages:
        - regex
      message: A gitleaks openai-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(sk-[a-zA-Z0-9]{20}T3BlbkFJ[a-zA-Z0-9]{20})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.plaid-api-token.plaid-api-token
      languages:
        - regex
      message: A gitleaks plaid-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:plaid)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(access-(?:sandbox|development|production)-[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.plaid-client-id.plaid-client-id
      languages:
        - regex
      message: A gitleaks plaid-client-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:plaid)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{24})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.plaid-secret-key.plaid-secret-key
      languages:
        - regex
      message: A gitleaks plaid-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:plaid)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{30})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.planetscale-api-token.planetscale-api-token
      languages:
        - regex
      message: A gitleaks planetscale-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(pscale_tkn_(?i)[a-z0-9=\-_\.]{32,64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.planetscale-oauth-token.planetscale-oauth-token
      languages:
        - regex
      message: A gitleaks planetscale-oauth-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(pscale_oauth_(?i)[a-z0-9=\-_\.]{32,64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.planetscale-password.planetscale-password
      languages:
        - regex
      message: A gitleaks planetscale-password was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(pscale_pw_(?i)[a-z0-9=\-_\.]{32,64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.postman-api-token.postman-api-token
      languages:
        - regex
      message: A gitleaks postman-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(PMAK-(?i)[a-f0-9]{24}\-[a-f0-9]{34})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.prefect-api-token.prefect-api-token
      languages:
        - regex
      message: A gitleaks prefect-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(pnu_[a-z0-9]{36})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.private-key.private-key
      languages:
        - regex
      message: A gitleaks private-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)-----BEGIN[ A-Z0-9_-]{0,100}PRIVATE KEY( BLOCK)?-----[\s\S-]*KEY( BLOCK)?----
      severity: INFO
    - id: generic.secrets.gitleaks.pulumi-api-token.pulumi-api-token
      languages:
        - regex
      message: A gitleaks pulumi-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(pul-[a-f0-9]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.pypi-upload-token.pypi-upload-token
      languages:
        - regex
      message: A gitleaks pypi-upload-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: pypi-AgEIcHlwaS5vcmc[A-Za-z0-9\-_]{50,1000}
      severity: INFO
    - id: generic.secrets.gitleaks.rapidapi-access-token.rapidapi-access-token
      languages:
        - regex
      message: A gitleaks rapidapi-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:rapidapi)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9_-]{50})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.readme-api-token.readme-api-token
      languages:
        - regex
      message: A gitleaks readme-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(rdme_[a-z0-9]{70})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.rubygems-api-token.rubygems-api-token
      languages:
        - regex
      message: A gitleaks rubygems-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(rubygems_[a-f0-9]{48})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.scalingo-api-token.scalingo-api-token
      languages:
        - regex
      message: A gitleaks scalingo-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: \b(tk-us-[a-zA-Z0-9-_]{48})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sendbird-access-token.sendbird-access-token
      languages:
        - regex
      message: A gitleaks sendbird-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:sendbird)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sendgrid-api-token.sendgrid-api-token
      languages:
        - regex
      message: A gitleaks sendgrid-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(SG\.(?i)[a-z0-9=_\-\.]{66})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sendinblue-api-token.sendinblue-api-token
      languages:
        - regex
      message: A gitleaks sendinblue-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(xkeysib-[a-f0-9]{64}\-(?i)[a-z0-9]{16})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sentry-access-token.sentry-access-token
      languages:
        - regex
      message: A gitleaks sentry-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:sentry)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.shippo-api-token.shippo-api-token
      languages:
        - regex
      message: A gitleaks shippo-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(shippo_(live|test)_[a-f0-9]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.shopify-access-token.shopify-access-token
      languages:
        - regex
      message: A gitleaks shopify-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: shpat_[a-fA-F0-9]{32}
      severity: INFO
    - id: generic.secrets.gitleaks.shopify-custom-access-token.shopify-custom-access-token
      languages:
        - regex
      message: A gitleaks shopify-custom-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: shpca_[a-fA-F0-9]{32}
      severity: INFO
    - id: generic.secrets.gitleaks.shopify-private-app-access-token.shopify-private-app-access-token
      languages:
        - regex
      message: A gitleaks shopify-private-app-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: shppa_[a-fA-F0-9]{32}
      severity: INFO
    - id: generic.secrets.gitleaks.shopify-shared-secret.shopify-shared-secret
      languages:
        - regex
      message: A gitleaks shopify-shared-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: shpss_[a-fA-F0-9]{32}
      severity: INFO
    - id: generic.secrets.gitleaks.sidekiq-secret.sidekiq-secret
      languages:
        - regex
      message: A gitleaks sidekiq-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:BUNDLE_ENTERPRISE__CONTRIBSYS__COM|BUNDLE_GEMS__CONTRIBSYS__COM)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-f0-9]{8}:[a-f0-9]{8})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sidekiq-sensitive-url.sidekiq-sensitive-url
      languages:
        - regex
      message: A gitleaks sidekiq-sensitive-url was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(http(?:s??):\/\/)([a-f0-9]{8}:[a-f0-9]{8})@(?:gems.contribsys.com|enterprise.contribsys.com)(?:[\/|\#|\?|:]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.slack-app-token.slack-app-token
      languages:
        - regex
      message: A gitleaks slack-app-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(xapp-\d-[A-Z0-9]+-\d+-[a-z0-9]+)
      severity: INFO
    - id: generic.secrets.gitleaks.slack-bot-token.slack-bot-token
      languages:
        - regex
      message: A gitleaks slack-bot-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (xoxb-[0-9]{10,13}\-[0-9]{10,13}[a-zA-Z0-9-]*)
      severity: INFO
    - id: generic.secrets.gitleaks.slack-config-access-token.slack-config-access-token
      languages:
        - regex
      message: A gitleaks slack-config-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(xoxe.xox[bp]-\d-[A-Z0-9]{163,166})
      severity: INFO
    - id: generic.secrets.gitleaks.slack-legacy-bot-token.slack-legacy-bot-token
      languages:
        - regex
      message: A gitleaks slack-legacy-bot-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (xoxb-[0-9]{8,14}\-[a-zA-Z0-9]{18,26})
      severity: INFO
    - id: generic.secrets.gitleaks.slack-legacy-token.slack-legacy-token
      languages:
        - regex
      message: A gitleaks slack-legacy-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (xox[os]-\d+-\d+-\d+-[a-fA-F\d]+)
      severity: INFO
    - id: generic.secrets.gitleaks.slack-legacy-workspace-token.slack-legacy-workspace-token
      languages:
        - regex
      message: A gitleaks slack-legacy-workspace-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (xox[ar]-(?:\d-)?[0-9a-zA-Z]{8,48})
      severity: INFO
    - id: generic.secrets.gitleaks.slack-user-token.slack-user-token
      languages:
        - regex
      message: A gitleaks slack-user-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (xox[pe](?:-[0-9]{10,13}){3}-[a-zA-Z0-9-]{28,34})
      severity: INFO
    - id: generic.secrets.gitleaks.slack-webhook-url.slack-webhook-url
      languages:
        - regex
      message: A gitleaks slack-webhook-url was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (https?:\/\/)?hooks.slack.com\/(services|workflows)\/[A-Za-z0-9+\/]{43,46}
      severity: INFO
    - id: generic.secrets.gitleaks.snyk-api-token.snyk-api-token
      languages:
        - regex
      message: A gitleaks snyk-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:snyk_token|snyk_key|snyk_api_token|snyk_api_key|snyk_oauth_token)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.square-access-token.square-access-token
      languages:
        - regex
      message: A gitleaks square-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b((EAAA|sq0atp-)[0-9A-Za-z\-_]{22,60})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.squarespace-access-token.squarespace-access-token
      languages:
        - regex
      message: A gitleaks squarespace-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:squarespace)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.stripe-access-token.stripe-access-token
      languages:
        - regex
      message: A gitleaks stripe-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b((sk|rk)_(test|live|prod)_[0-9a-z]{10,99})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sumologic-access-id.sumologic-access-id
      languages:
        - regex
      message: A gitleaks sumologic-access-id was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i:(?:sumo)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3})(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(su[a-zA-Z0-9]{12})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.sumologic-access-token.sumologic-access-token
      languages:
        - regex
      message: A gitleaks sumologic-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:sumo)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{64})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.telegram-bot-api-token.telegram-bot-api-token
      languages:
        - regex
      message: A gitleaks telegram-bot-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i:(?:telegr)(?:[0-9a-z\(-_\t .\\]{0,40})(?:[\s|']|[\s|"]){0,3})(?:=|\|\|:|<=|=>|:|\?=|\()(?:'|\"|\s|=|\x60){0,5}([0-9]{5,16}:A[a-z0-9_\-]{34})(?:['|\"|\n|\r|\s|\x60|;|\\]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.travisci-access-token.travisci-access-token
      languages:
        - regex
      message: A gitleaks travisci-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:travis)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{22})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.twilio-api-key.twilio-api-key
      languages:
        - regex
      message: A gitleaks twilio-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: SK[0-9a-fA-F]{32}
      severity: INFO
    - id: generic.secrets.gitleaks.twitch-api-token.twitch-api-token
      languages:
        - regex
      message: A gitleaks twitch-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:twitch)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{30})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.twitter-access-secret.twitter-access-secret
      languages:
        - regex
      message: A gitleaks twitter-access-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:twitter)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{45})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.twitter-access-token.twitter-access-token
      languages:
        - regex
      message: A gitleaks twitter-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:twitter)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([0-9]{15,25}-[a-zA-Z0-9]{20,40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.twitter-api-key.twitter-api-key
      languages:
        - regex
      message: A gitleaks twitter-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:twitter)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{25})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.twitter-api-secret.twitter-api-secret
      languages:
        - regex
      message: A gitleaks twitter-api-secret was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:twitter)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{50})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.typeform-api-token.typeform-api-token
      languages:
        - regex
      message: A gitleaks typeform-api-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:typeform)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(tfp_[a-z0-9\-_\.=]{59})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.vault-batch-token.vault-batch-token
      languages:
        - regex
      message: A gitleaks vault-batch-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(hvb\.[a-z0-9_-]{138,212})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.vault-service-token.vault-service-token
      languages:
        - regex
      message: A gitleaks vault-service-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)\b(hvs\.[a-z0-9_-]{90,100})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.yandex-access-token.yandex-access-token
      languages:
        - regex
      message: A gitleaks yandex-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:yandex)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(t1\.[A-Z0-9a-z_-]+[=]{0,2}\.[A-Z0-9a-z_-]{86}[=]{0,2})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.yandex-api-key.yandex-api-key
      languages:
        - regex
      message: A gitleaks yandex-api-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:yandex)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(AQVN[A-Za-z0-9_\-]{35,38})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.yandex-aws-access-token.yandex-aws-access-token
      languages:
        - regex
      message: A gitleaks yandex-aws-access-token was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:yandex)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}(YC[a-zA-Z0-9_\-]{38})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.gitleaks.zendesk-secret-key.zendesk-secret-key
      languages:
        - regex
      message: A gitleaks zendesk-secret-key was detected which attempts to identify hard-coded credentials. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/zricethezav/gitleaks/tree/master/cmd/generate/config/rules
        subcategory:
            - vuln
        technology:
            - gitleaks
      patterns:
        - pattern-regex: (?i)(?:zendesk)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:{1,3}=|\|\|:|<=|=>|:|\?=)(?:'|\"|\s|=|\x60){0,5}([a-z0-9]{40})(?:['|\"|\n|\r|\s|\x60|;]|$)
      severity: INFO
    - id: generic.secrets.security.detected-amazon-mws-auth-token.detected-amazon-mws-auth-token
      languages:
        - regex
      message: Amazon MWS Auth Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - aws
      pattern-regex: amzn\.mws\.[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}
      severity: ERROR
    - id: generic.secrets.security.detected-artifactory-password.detected-artifactory-password
      languages:
        - regex
      message: Artifactory token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/Yelp/detect-secrets/blob/master/detect_secrets/plugins/artifactory.py
        subcategory:
            - audit
        technology:
            - secrets
            - artifactory
      paths:
        exclude:
            - '*.svg'
            - '*go.sum'
            - '*package.json'
            - '*cargo.lock'
            - '*package-lock.json'
            - '*bundle.js'
            - '*pnpm-lock*'
            - '*Podfile.lock'
            - '*/openssl/*.h'
            - '*.xcscmblueprint'
      patterns:
        - pattern-regex: (?<ITEM>\bAP[\dABCDEF][a-zA-Z0-9]{8,})
        - pattern-regex: .*(?i)arti[-_]?factory.*
        - pattern-not-regex: .*(?i)sha(1|2|3|118|256|512).*
        - pattern-not-regex: (?i)-----\s*?BEGIN[ A-Z0-9_-]*? KEY( BLOCK)?-----[\s\S]*?-----\s*?END[ A-Z0-9_-]*?\s*?-----
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $ITEM
        - pattern-not-regex: (\w|\.|\*)\1{4}
      severity: ERROR
    - id: generic.secrets.security.detected-artifactory-token.detected-artifactory-token
      languages:
        - regex
      message: Artifactory token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/Yelp/detect-secrets/blob/master/detect_secrets/plugins/artifactory.py
        subcategory:
            - audit
        technology:
            - secrets
            - artifactory
      paths:
        exclude:
            - '*.svg'
            - '*go.sum'
            - '*package.json'
            - '*package-lock.json'
            - '*bundle.js'
            - '*pnpm-lock*'
            - '*Podfile.lock'
            - '*/openssl/*.h'
            - '*.xcscmblueprint'
            - '*cargo.lock'
      patterns:
        - pattern-regex: |
            \bAKC[a-zA-Z0-9]{10,}
        - pattern-not-regex: |
            sha(128|256|512).*
        - pattern-not-regex: (?s)---BEGIN.*---\Z
      severity: ERROR
    - id: generic.secrets.security.detected-aws-access-key-id-value.detected-aws-access-key-id-value
      languages:
        - regex
      message: AWS Access Key ID Value detected. This is a sensitive credential and should not be hardcoded here. Instead, read this value from an environment variable or keep it in a separate, private file.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - aws
      patterns:
        - pattern-regex: \b(A3T[A-Z0-9]|AKIA|AGPA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}\b
        - pattern-not-regex: (?i)example|sample|test|fake
      severity: ERROR
    - id: generic.secrets.security.detected-aws-secret-access-key.detected-aws-secret-access-key
      languages:
        - regex
      message: AWS Secret Access Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - aws
      patterns:
        - pattern-regex: (("|'|`)?((?i)aws)_?\w*((?i)secret)_?\w*("|'|`)?\s{0,50}(:|=>|=)\s{0,50}("|'|`)?[A-Za-z0-9/+=]{40}("|'|`)?)
        - pattern-not-regex: (?i)example|sample|test|fake|xxxxxx
      severity: ERROR
    - id: generic.secrets.security.detected-aws-session-token.detected-aws-session-token
      languages:
        - regex
      message: AWS Session Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - aws
      patterns:
        - pattern-regex: ((?i)AWS_SESSION_TOKEN)\s*(:|=>|=)\s*(?P<TOKEN>[A-Za-z0-9/+=]{16,})
        - pattern-not-regex: (?i)example|sample|test|fake
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $TOKEN
      severity: ERROR
    - id: generic.secrets.security.detected-etc-shadow.detected-etc-shadow
      languages:
        - regex
      message: linux shadow file detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - audit
        technology:
            - secrets
      patterns:
        - pattern-regex: ^(\s*)(?P<ROOT>root:[x!*]*:[0-9]*:[0-9]*)
        - focus-metavariable: $ROOT
      severity: ERROR
    - id: generic.secrets.security.detected-facebook-access-token.detected-facebook-access-token
      languages:
        - regex
      message: Facebook Access Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - facebook
      pattern-either:
        - pattern-regex: EAACEdEose0cBA[0-9A-Za-z]+
        - pattern-regex: EAAAACZAVC6ygB[0-9A-Za-z]+
        - pattern-regex: EAAAAZAw4[0-9A-Za-z]+
      severity: ERROR
    - id: generic.secrets.security.detected-facebook-oauth.detected-facebook-oauth
      languages:
        - regex
      message: Facebook OAuth detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - facebook
      pattern-regex: '[fF][aA][cC][eE][bB][oO][oO][kK].*[tT][oO][kK][eE][nN].*[''|"]?[0-9a-f]{32}[''|"]?'
      severity: ERROR
    - id: generic.secrets.security.detected-generic-api-key.detected-generic-api-key
      languages:
        - regex
      message: Generic API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
      patterns:
        - pattern-regex: '[aA][pP][iI]_?[kK][eE][yY][=_:\s-]+[''|"]?(?<SECRET>[0-9a-zA-Z]{32,45})[''|"]?'
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $SECRET
      severity: ERROR
    - id: generic.secrets.security.detected-generic-secret.detected-generic-secret
      languages:
        - regex
      message: Generic Secret detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
      patterns:
        - pattern-regex: '[sS][eE][cC][rR][eE][tT][:= \t]*[''|\"]?(?<SECRET>[0-9a-zA-Z]{32,45})[''|\"]?'
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $SECRET
      severity: ERROR
    - id: generic.secrets.security.detected-github-token.detected-github-token
      languages:
        - generic
      message: GitHub Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.blog/changelog/2021-03-04-authentication-token-format-updates/
        subcategory:
            - audit
        technology:
            - secrets
            - github
      patterns:
        - pattern-either:
            - pattern: |
                $VAR = $SECRET
            - pattern: |
                $VAR: $SECRET
            - pattern: |
                $VAR = '$SECRET'
            - pattern: |
                $VAR: '$SECRET'
            - pattern: |
                '$VAR' = '$SECRET'
            - pattern: |
                '$VAR': '$SECRET'
            - pattern: |
                "[hH][tT][tT][pP][sS]?://.*$SECRET.*"
        - metavariable-regex:
            metavariable: $SECRET
            regex: gh[pousr]_[A-Za-z0-9_]{36,251}
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $SECRET
      severity: ERROR
    - id: generic.secrets.security.detected-google-api-key.detected-google-api-key
      languages:
        - regex
      message: Google API Key Detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - google
      patterns:
        - pattern-regex: \bAIzaSy[0-9A-Za-z-_]{33}\b
        - pattern-not-regex: \bAIzaSy[0-9A-Za-z-_]{33}\b[=]
      severity: ERROR
    - id: generic.secrets.security.detected-google-cloud-api-key.detected-google-cloud-api-key
      languages:
        - regex
      message: Google Cloud API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - google-cloud
      pattern-regex: AIza[0-9A-Za-z\\-_]{35}
      severity: ERROR
    - id: generic.secrets.security.detected-google-gcm-service-account.detected-google-gcm-service-account
      languages:
        - regex
      message: Google (GCM) Service account detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - google-cloud
      pattern-regex: (("|'|`)?type("|'|`)?\s{0,50}(:|=>|=)\s{0,50}("|'|`)?service_account("|'|`)?,?)
      severity: ERROR
    - id: generic.secrets.security.detected-google-oauth-access-token.detected-google-oauth-access-token
      languages:
        - regex
      message: Google OAuth Access Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - google
      pattern-regex: ya29\.[0-9A-Za-z\-_]+
      severity: ERROR
    - id: generic.secrets.security.detected-heroku-api-key.detected-heroku-api-key
      languages:
        - regex
      message: Heroku API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - heroku
      pattern-regex: '[hH][eE][rR][oO][kK][uU].*[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}'
      severity: ERROR
    - id: generic.secrets.security.detected-jwt-token.detected-jwt-token
      languages:
        - regex
      message: JWT token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-321: Use of Hard-coded Cryptographic Key'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        source-rule-url: https://github.com/Yelp/detect-secrets/blob/master/detect_secrets/plugins/jwt.py
        subcategory:
            - audit
        technology:
            - secrets
            - jwt
      pattern-regex: eyJ[A-Za-z0-9-_=]{14,}\.[A-Za-z0-9-_=]{13,}\.?[A-Za-z0-9-_.+/=]*?
      severity: ERROR
    - id: generic.secrets.security.detected-kolide-api-key.detected-kolide-api-key
      languages:
        - regex
      message: Kolide API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - audit
        technology:
            - secrets
            - kolide
      pattern-regex: k2sk_v[0-9]_[0-9a-zA-Z]{24}
      severity: ERROR
    - id: generic.secrets.security.detected-mailchimp-api-key.detected-mailchimp-api-key
      languages:
        - regex
      message: MailChimp API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - mailchimp
      pattern-regex: '[0-9a-f]{32}-us[0-9]{1,2}'
      severity: ERROR
    - id: generic.secrets.security.detected-mailgun-api-key.detected-mailgun-api-key
      languages:
        - regex
      message: Mailgun API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - mailgun
      pattern-regex: key-[0-9a-zA-Z]{32}
      severity: ERROR
    - id: generic.secrets.security.detected-npm-registry-auth-token.detected-npm-registry-auth-token
      languages:
        - generic
      message: NPM registry authentication token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - audit
        technology:
            - secrets
            - npm
      paths:
        include:
            - '*npmrc*'
      patterns:
        - pattern: $AUTHTOKEN = $VALUE
        - metavariable-regex:
            metavariable: $AUTHTOKEN
            regex: _(authToken|auth|password)
        - pattern-not: $AUTHTOKEN = ${...}
      severity: ERROR
    - id: generic.secrets.security.detected-paypal-braintree-access-token.detected-paypal-braintree-access-token
      languages:
        - regex
      message: PayPal Braintree Access Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - paypal
            - braintree
      pattern-regex: access_token\$production\$[0-9a-z]{16}\$[0-9a-z]{32}
      severity: ERROR
    - id: generic.secrets.security.detected-pgp-private-key-block.detected-pgp-private-key-block
      languages:
        - regex
      message: Something that looks like a PGP private key block is detected. This is a potential hardcoded secret that could be leaked if this code is committed. Instead, remove this code block from the commit.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
      pattern-regex: '-----BEGIN PGP PRIVATE KEY BLOCK-----'
      severity: ERROR
    - id: generic.secrets.security.detected-private-key.detected-private-key
      languages:
        - generic
      message: Private Key detected. This is a sensitive credential and should not be hardcoded here. Instead, store this in a separate, private file.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
      patterns:
        - pattern-either:
            - patterns:
                - pattern: '-----BEGIN $TYPE PRIVATE KEY----- $KEY'
                - metavariable-regex:
                    metavariable: $TYPE
                    regex: (?i)([dr]sa|ec|openssh|encrypted)?
            - patterns:
                - pattern: |
                    -----BEGIN PRIVATE KEY-----
                    $KEY
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $KEY
      severity: ERROR
    - id: generic.secrets.security.detected-sauce-token.detected-sauce-token
      languages:
        - regex
      message: Sauce Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - sauce
      pattern-regex: (?i)sauce.{0,50}(\\\"|'|`)?[0-9a-f-]{36}(\\\"|'|`)?
      severity: ERROR
    - id: generic.secrets.security.detected-sendgrid-api-key.detected-sendgrid-api-key
      languages:
        - regex
      message: SendGrid API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/narendrakadali/gitrob/blob/master/rules/contentsignatures.json
        subcategory:
            - audit
        technology:
            - secrets
            - sendgrid
      pattern-regex: SG\.[a-zA-Z0-9]{22}\.[a-zA-Z0-9-]{43}\b
      severity: ERROR
    - id: generic.secrets.security.detected-slack-token.detected-slack-token
      languages:
        - regex
      message: Slack Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://github.com/davidburkitt/python-secret-scanner/blob/335a1f6dab8de59cf39063e57aea39a58951e939/patterns.txt#L58
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - slack
      pattern-either:
        - pattern-regex: (xox[pboa]-[0-9]{12}-[0-9]{12}-[0-9]{12}-[a-z0-9]{32})
        - pattern-regex: xox.-[0-9]{12}-[0-9]{12}-[0-9a-zA-Z]{24}
      severity: ERROR
    - id: generic.secrets.security.detected-slack-webhook.detected-slack-webhook
      languages:
        - regex
      message: Slack Webhook detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://api.slack.com/messaging/webhooks
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - slack
      pattern-regex: https://hooks\.slack\.com/services/T[a-zA-Z0-9_]{8,10}/B[a-zA-Z0-9_]{8,10}/[a-zA-Z0-9_]{24}
      severity: ERROR
    - id: generic.secrets.security.detected-snyk-api-key.detected-snyk-api-key
      languages:
        - regex
      message: Snyk API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - audit
        technology:
            - secrets
            - snyk
      pattern-regex: (?i)snyk.{0,50}['|"|`]?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}['"\s]?
      severity: ERROR
    - id: generic.secrets.security.detected-softlayer-api-key.detected-softlayer-api-key
      languages:
        - regex
      message: SoftLayer API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/Yelp/detect-secrets/blob/master/detect_secrets/plugins/softlayer.py
        subcategory:
            - audit
        technology:
            - secrets
            - softlayer
      pattern-regex: (?i)softlayer.{0,50}["|'|`]?[a-z0-9]{64}["|'|`]?
      severity: ERROR
    - id: generic.secrets.security.detected-sonarqube-docs-api-key.detected-sonarqube-docs-api-key
      languages:
        - regex
      message: SonarQube Docs API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - sonarqube
      paths:
        exclude:
            - '*.svg'
            - '*go.sum'
            - '*cargo.lock'
            - '*package.json'
            - '*yarn.lock'
            - '*package-lock.json'
            - '*bundle.js'
            - '*pnpm-lock*'
            - '*Podfile.lock'
            - '*/openssl/*.h'
            - '*.xcscmblueprint'
      pattern-regex: (?i)sonar.{0,50}(\\\"|'|`)?[0-9a-f]{40}(\\\"|'|`)?
      severity: ERROR
    - id: generic.secrets.security.detected-square-access-token.detected-square-access-token
      languages:
        - regex
      message: Square Access Token detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - square
      pattern-regex: sq0atp-[0-9A-Za-z\-_]{22}
      severity: ERROR
    - id: generic.secrets.security.detected-square-oauth-secret.detected-square-oauth-secret
      languages:
        - regex
      message: Square OAuth Secret detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://github.com/Yelp/detect-secrets/blob/master/tests/plugins/square_oauth_test.py
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - square
      pattern-regex: sq0csp-[0-9A-Za-z\\\-_]{43}
      severity: ERROR
    - id: generic.secrets.security.detected-ssh-password.detected-ssh-password
      languages:
        - regex
      message: SSH Password detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - audit
        technology:
            - secrets
            - ssh
      pattern-regex: sshpass -p\s*['|\\\"][^%]
      severity: ERROR
    - id: generic.secrets.security.detected-stripe-api-key.detected-stripe-api-key
      languages:
        - regex
      message: Stripe API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - stripe
      pattern-regex: sk_live_[0-9a-zA-Z]{24}
      severity: ERROR
    - id: generic.secrets.security.detected-stripe-restricted-api-key.detected-stripe-restricted-api-key
      languages:
        - regex
      message: Stripe Restricted API Key detected
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - stripe
      pattern-regex: rk_live_[0-9a-zA-Z]{24}
      severity: ERROR
    - id: generic.secrets.security.detected-telegram-bot-api-key.detected-telegram-bot-api-key
      languages:
        - regex
      message: Telegram Bot API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - telegram
      patterns:
        - pattern-regex: '[0-9]+:AA[0-9A-Za-z\-_]{33}'
        - pattern-not-regex: go\.mod.*
        - pattern-not-regex: v[\d]+\.[\d]+\.[\d]+.*
      severity: ERROR
    - id: generic.secrets.security.detected-twilio-api-key.detected-twilio-api-key
      languages:
        - regex
      message: Twilio API Key detected
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://github.com/dxa4481/truffleHogRegexes/blob/master/truffleHogRegexes/regexes.json
        subcategory:
            - audit
        technology:
            - secrets
            - twilio
      pattern-regex: SK[0-9a-fA-F]{32}
      severity: ERROR
    - id: generic.secrets.security.detected-username-and-password-in-uri.detected-username-and-password-in-uri
      languages:
        - generic
      message: Username and password in URI detected
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://github.com/grab/secret-scanner/blob/master/scanner/signatures/pattern.go
        subcategory:
            - vuln
        technology:
            - secrets
      patterns:
        - pattern: $PROTOCOL://$...USERNAME:$...PASSWORD@$END
        - metavariable-regex:
            metavariable: $...USERNAME
            regex: \A({?)([A-Za-z])([A-Za-z0-9_-]){5,31}(}?)\Z
        - metavariable-regex:
            metavariable: $...PASSWORD
            regex: (?!.*[\s])(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]){6,32}
        - metavariable-regex:
            metavariable: $PROTOCOL
            regex: (.*http.*)|(.*sql.*)|(.*ftp.*)|(.*smtp.*)
      severity: ERROR
    - id: generic.secrets.security.google-maps-apikeyleak.google-maps-apikeyleak
      languages:
        - generic
      message: Detects potential Google Maps API keys in code
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-538: Insertion of Sensitive Information into Externally-Accessible File or Directory'
        description: Detects potential Google Maps API keys in code
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A3:2017 Sensitive Data Exposure
        references:
            - https://ozguralp.medium.com/unauthorized-google-maps-api-key-usage-cases-and-why-you-need-to-care-1ccb28bf21e
        severity: MEDIUM
        subcategory:
            - audit
        technology:
            - Google Maps
      patterns:
        - pattern-regex: ^(AIza[0-9A-Za-z_-]{35}(?!\S))$
      severity: WARNING
    - id: generic.visualforce.security.ncino.html.usesriforcdns.use-sri-for-cdns
      languages:
        - generic
      message: 'Consuming CDNs without including a SubResource Integrity (SRI) can expose your application and its users to compromised code. SRIs allow you to consume specific versions of content where if even a single byte is compromised, the resource will not be loaded. Add an integrity attribute to your <script> and <link> tags pointing to CDN content to ensure the resources have not been compromised. A crossorigin attribute should also be added. For a more thorough explanation along with explicit instructions on remediating, follow the directions from Mozilla here: https://developer.mozilla.org/en-US/blog/securing-cdn-using-sri-why-how/'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-346: Origin Validation Error'
        cwe2020-top25': true
        cwe2021-top25': true
        cwe2022-top25': true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cwe.mitre.org/data/definitions/352.html
            - https://developer.mozilla.org/en-US/blog/securing-cdn-using-sri-why-how/
        subcategory:
            - vuln
        technology:
            - salesforce
            - visualforce
      paths:
        include:
            - '*.component'
            - '*.page'
      patterns:
        - pattern-either:
            - pattern: <link...href="$URL..."...>
            - pattern: <script...src="$URL..."...>
        - metavariable-regex:
            metavariable: $URL
            regex: http[A-Za-z0-9\/\.\-\:]
        - pattern-not: <script...integrity="..."...src="..."...>
        - pattern-not: <script...src="..."...integrity="..."...>
        - pattern-not: <link...integrity="..."...href="..."...>
        - pattern-not: <link...href="..."...integrity="..."...>
      severity: WARNING
    - id: generic.visualforce.security.ncino.vf.xssfromunescapedurlparam.xss-from-unescaped-url-param
      languages:
        - generic
      message: To remediate this issue, ensure that all URL parameters are properly escaped before including them in scripts. Please update your code to use either the JSENCODE method to escape URL parameters or the escape="true" attribute on <apex:outputText> tags. Passing URL parameters directly into scripts and DOM sinks creates an opportunity for Cross-Site Scripting attacks. Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. To remediate this issue, ensure that all URL parameters are properly escaped before including them in scripts.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/pages_security_tips_xss.htm
        subcategory:
            - vuln
        technology:
            - salesforce
            - visualforce
      paths:
        include:
            - '*.component'
            - '*.page'
      patterns:
        - pattern-either:
            - pattern: <apex:outputText...escape="false"...value="{!...CurrentPage.parameters.$URL_PARAM}".../>
            - pattern: <apex:outputText...value="{!...CurrentPage.parameters.$URL_PARAM}"...escape="false".../>
            - pattern: <script>...'{!...CurrentPage.parameters.$URL_PARAM}'...</script>
        - pattern-not: <script>...'{!...JSENCODE(...CurrentPage.parameters.$URL_PARAM})'...</script>
      severity: ERROR
    - id: generic.visualforce.security.ncino.xml.cspheaderattribute.csp-header-attribute
      languages:
        - generic
      message: Visualforce Pages must have the cspHeader attribute set to true. This attribute is available in API version 55 or higher.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://help.salesforce.com/s/articleView?id=sf.csp_trusted_sites.htm&type=5
        subcategory:
            - vuln
        technology:
            - salesforce
            - visualforce
      paths:
        include:
            - '*.page'
      patterns:
        - pattern: <apex:page...>...</apex:page>
        - pattern-not: <apex:page...cspHeader="true"...>...</apex:page>
        - pattern-not: <apex:page...>...<!--deprecated-->...</apex:page>
        - pattern-not: <apex:page...>...<!-- deprecated -->...</apex:page>
      severity: INFO
    - id: generic.visualforce.security.ncino.xml.visualforceapiversion.visualforce-page-api-version
      languages:
        - generic
      message: Visualforce Pages must use API version 55 or higher for required use of the cspHeader attribute set to true.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_pages.htm
        subcategory:
            - vuln
        technology:
            - salesforce
            - visualforce
      paths:
        include:
            - '*.page-meta.xml'
      patterns:
        - pattern-inside: <apiVersion.../apiVersion>
        - pattern-either:
            - pattern-regex: '[>][0-9].[0-9][<]'
            - pattern-regex: '[>][1-4][0-9].[0-9][<]'
            - pattern-regex: '[>][5][0-4].[0-9][<]'
      severity: WARNING
    - id: go.aws-lambda.security.database-sqli.database-sqli
      languages:
        - go
      message: Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use prepared statements with the 'Prepare' and 'PrepareContext' calls.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://pkg.go.dev/database/sql#DB.Query
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - database
            - sql
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $DB.Exec($QUERY,...)
                - pattern: $DB.ExecContent($QUERY,...)
                - pattern: $DB.Query($QUERY,...)
                - pattern: $DB.QueryContext($QUERY,...)
                - pattern: $DB.QueryRow($QUERY,...)
                - pattern: $DB.QueryRowContext($QUERY,...)
            - pattern-inside: |
                import "database/sql"
                ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    func $HANDLER($CTX $CTXTYPE, $EVENT $TYPE, ...) {...}
                    ...
                    lambda.Start($HANDLER, ...)
                - patterns:
                    - pattern-inside: |
                        func $HANDLER($EVENT $TYPE) {...}
                        ...
                        lambda.Start($HANDLER, ...)
                    - pattern-not-inside: |
                        func $HANDLER($EVENT context.Context) {...}
                        ...
                        lambda.Start($HANDLER, ...)
            - focus-metavariable: $EVENT
      severity: WARNING
    - id: go.aws-lambda.security.tainted-sql-string.tainted-sql-string
      languages:
        - go
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sanitizers:
        - pattern: strconv.Atoi(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        "$SQLSTR" + ...
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(\s*select|\s*delete|\s*insert|\s*create|\s*update|\s*alter|\s*drop).*
                - patterns:
                    - pattern-either:
                        - pattern: fmt.Fprintf($F, "$SQLSTR", ...)
                        - pattern: fmt.Sprintf("$SQLSTR", ...)
                        - pattern: fmt.Printf("$SQLSTR", ...)
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*%(v|s|q).*
            - pattern-not-inside: |
                log.$PRINT(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    func $HANDLER($CTX $CTXTYPE, $EVENT $TYPE, ...) {...}
                    ...
                    lambda.Start($HANDLER, ...)
                - patterns:
                    - pattern-inside: |
                        func $HANDLER($EVENT $TYPE) {...}
                        ...
                        lambda.Start($HANDLER, ...)
                    - pattern-not-inside: |
                        func $HANDLER($EVENT context.Context) {...}
                        ...
                        lambda.Start($HANDLER, ...)
            - focus-metavariable: $EVENT
      severity: ERROR
    - id: go.gorilla.security.audit.handler-assignment-from-multiple-sources.handler-assignment-from-multiple-sources
      languages:
        - go
      message: 'Variable $VAR is assigned from two different sources: ''$Y'' and ''$R''. Make sure this is intended, as this could cause logic bugs if they are treated as they are the same object.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-289: Authentication Bypass by Alternate Name'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/289.html
        subcategory:
            - audit
        technology:
            - gorilla
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $Y, err := store.Get(...)
                ...
                $VAR := $Y.Values[...]
                ...
                $VAR = $R
            - focus-metavariable: $R
        - patterns:
            - pattern: |
                $Y, err := store.Get(...)
                ...
                var $VAR $INT = $Y.Values["..."].($INT)
                ...
                $VAR = $R
            - focus-metavariable: $R
      pattern-sources:
        - patterns:
            - pattern-inside: |
                func $HANDLER(..., $R *http.Request, ...) {
                  ...
                }
            - focus-metavariable: $R
            - pattern-either:
                - pattern: $R.query
      severity: WARNING
    - fix-regex:
        regex: (HttpOnly\s*:\s+)false
        replacement: \1true
      id: go.gorilla.security.audit.session-cookie-missing-httponly.session-cookie-missing-httponly
      languages:
        - go
      message: A session cookie was detected without setting the 'HttpOnly' flag. The 'HttpOnly' flag for cookies instructs the browser to forbid client-side scripts from reading the cookie which mitigates XSS attacks. Set the 'HttpOnly' flag by setting 'HttpOnly' to 'true' in the Options struct.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/user/session/session.go#L69
        subcategory:
            - audit
        technology:
            - gorilla
      patterns:
        - pattern-not-inside: |
            &sessions.Options{
              ...,
              HttpOnly: true,
              ...,
            }
        - pattern: |
            &sessions.Options{
              ...,
            }
      severity: WARNING
    - fix-regex:
        regex: (Secure\s*:\s+)false
        replacement: \1true
      id: go.gorilla.security.audit.session-cookie-missing-secure.session-cookie-missing-secure
      languages:
        - go
      message: A session cookie was detected without setting the 'Secure' flag. The 'secure' flag for cookies prevents the client from transmitting the cookie over insecure channels such as HTTP. Set the 'Secure' flag by setting 'Secure' to 'true' in the Options struct.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/user/session/session.go#L69
        subcategory:
            - audit
        technology:
            - gorilla
      patterns:
        - pattern-not-inside: |
            &sessions.Options{
              ...,
              Secure: true,
              ...,
            }
        - pattern: |
            &sessions.Options{
              ...,
            }
      severity: WARNING
    - fix-regex:
        regex: (SameSite\s*:\s+)http.SameSiteNoneMode
        replacement: \1http.SameSiteDefaultMode
      id: go.gorilla.security.audit.session-cookie-samesitenone.session-cookie-samesitenone
      languages:
        - go
      message: Found SameSiteNoneMode setting in Gorilla session options. Consider setting SameSite to Lax, Strict or Default for enhanced security.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1275: Sensitive Cookie with Improper SameSite Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://pkg.go.dev/github.com/gorilla/sessions#Options
        subcategory:
            - audit
        technology:
            - gorilla
      patterns:
        - pattern-inside: |
            &sessions.Options{
              ...,
              SameSite: http.SameSiteNoneMode,
              ...,
            }
        - pattern: |
            &sessions.Options{
              ...,
            }
      severity: WARNING
    - id: go.gorilla.security.audit.websocket-missing-origin-check.websocket-missing-origin-check
      languages:
        - go
      message: 'The Origin header in the HTTP WebSocket handshake is used to guarantee that the connection accepted by the WebSocket is from a trusted origin domain. Failure to enforce can lead to Cross Site Request Forgery (CSRF). As per "gorilla/websocket" documentation: "A CheckOrigin function should carefully validate the request origin to prevent cross-site request forgery."'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://pkg.go.dev/github.com/gorilla/websocket#Upgrader
        subcategory:
            - audit
        technology:
            - gorilla
      patterns:
        - pattern-inside: |
            import ("github.com/gorilla/websocket")
            ...
        - patterns:
            - pattern-not-inside: |
                $UPGRADER = websocket.Upgrader{..., CheckOrigin: $FN ,...}
                ...
            - pattern-not-inside: |
                $UPGRADER.CheckOrigin = $FN2
                ...
            - pattern: |
                $UPGRADER.Upgrade(...)
      severity: WARNING
    - id: go.gorm.security.audit.gorm-dangerous-methods-usage.gorm-dangerous-method-usage
      languages:
        - go
      message: Detected usage of dangerous method $METHOD which does not escape inputs (see link in references). If the argument is user-controlled, this can lead to SQL injection. When using $METHOD function, do not trust user-submitted data and only allow approved list of input (possibly, use an allowlist approach).
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://gorm.io/docs/security.html#SQL-injection-Methods
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - gorm
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: strconv.Atoi(...)
            - pattern: |
                ($X: bool)
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                import ("gorm.io/gorm")
                ...
            - patterns:
                - pattern-inside: |
                    func $VAL(..., $GORM *gorm.DB,... ) {
                      ...
                    }
                - pattern-either:
                    - pattern: |
                        $GORM. ... .$METHOD($VALUE)
                    - pattern: |
                        $DB := $GORM. ... .$ANYTHING(...)
                        ...
                        $DB. ... .$METHOD($VALUE)
            - focus-metavariable: $VALUE
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(Order|Exec|Raw|Group|Having|Distinct|Select|Pluck)$
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
      severity: WARNING
    - fix-regex:
        regex: (.*)WithInsecure\(.*?\)
        replacement: \1WithTransportCredentials(credentials.NewTLS(<your_tls_config_here>))
      id: go.grpc.security.grpc-client-insecure-connection.grpc-client-insecure-connection
      languages:
        - go
      message: 'Found an insecure gRPC connection using ''grpc.WithInsecure()''. This creates a connection without encryption to a gRPC server. A malicious attacker could tamper with the gRPC message, which could compromise the machine. Instead, establish a secure connection with an SSL certificate using the ''grpc.WithTransportCredentials()'' function. You can create a create credentials using a ''tls.Config{}'' struct with ''credentials.NewTLS()''. The final fix looks like this: ''grpc.WithTransportCredentials(credentials.NewTLS(<config>))''.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-300: Channel Accessible by Non-Endpoint'
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://blog.gopheracademy.com/advent-2019/go-grps-and-tls/#connection-without-encryption
        subcategory:
            - audit
        technology:
            - grpc
      pattern: $GRPC.Dial($ADDR, ..., $GRPC.WithInsecure(...), ...)
      severity: ERROR
    - id: go.grpc.security.grpc-server-insecure-connection.grpc-server-insecure-connection
      languages:
        - go
      message: Found an insecure gRPC server without 'grpc.Creds()' or options with credentials. This allows for a connection without encryption to this server. A malicious attacker could tamper with the gRPC message, which could compromise the machine. Include credentials derived from an SSL certificate in order to create a secure gRPC connection. You can create credentials using 'credentials.NewServerTLSFromFile("cert.pem", "cert.key")'.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-300: Channel Accessible by Non-Endpoint'
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://blog.gopheracademy.com/advent-2019/go-grps-and-tls/#connection-without-encryption
        subcategory:
            - audit
        technology:
            - grpc
      mode: taint
      pattern-sinks:
        - pattern: grpc.NewServer($OPT, ...)
          requires: OPTIONS and not CREDS
        - pattern: grpc.NewServer()
          requires: EMPTY_CONSTRUCTOR
      pattern-sources:
        - label: OPTIONS
          pattern: grpc.ServerOption{ ... }
        - label: CREDS
          pattern: grpc.Creds(...)
        - label: EMPTY_CONSTRUCTOR
          pattern: grpc.NewServer()
      severity: ERROR
    - id: go.jwt-go.security.audit.jwt-parse-unverified.jwt-go-parse-unverified
      languages:
        - go
      message: Detected the decoding of a JWT token without a verify step. Don't use `ParseUnverified` unless you know what you're doing This method parses the token but doesn't validate the signature. It's only ever useful in cases where you know the signature is valid (because it has been checked previously in the stack) and you want to extract values from it.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            import "github.com/dgrijalva/jwt-go"
            ...
        - pattern: |
            $JWT.ParseUnverified(...)
      severity: WARNING
    - id: go.jwt-go.security.jwt-none-alg.jwt-go-none-algorithm
      languages:
        - go
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-either:
            - pattern-inside: |
                import "github.com/golang-jwt/jwt"
                ...
            - pattern-inside: |
                import "github.com/dgrijalva/jwt-go"
                ...
        - pattern-either:
            - pattern: |
                jwt.SigningMethodNone
            - pattern: jwt.UnsafeAllowNoneSignatureType
      severity: ERROR
    - id: go.jwt-go.security.jwt.hardcoded-jwt-key
      languages:
        - go
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - jwt
            - secrets
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $TOKEN.SignedString($F)
            - focus-metavariable: $F
      pattern-sources:
        - patterns:
            - pattern-inside: |
                []byte("$F")
      severity: WARNING
    - id: go.lang.security.audit.crypto.bad_imports.insecure-module-used
      languages:
        - go
      message: The package `net/http/cgi` is on the import blocklist.  The package is vulnerable to httpoxy attacks (CVE-2015-5386). It is recommended to use `net/http` or a web framework to build a web application instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://godoc.org/golang.org/x/crypto/sha3
        source-rule-url: https://github.com/securego/gosec
        subcategory:
            - audit
        technology:
            - go
      pattern-either:
        - patterns:
            - pattern-inside: |
                import "net/http/cgi"
                ...
            - pattern: |
                cgi.$FUNC(...)
      severity: WARNING
    - id: go.lang.security.audit.crypto.insecure_ssh.avoid-ssh-insecure-ignore-host-key
      languages:
        - go
      message: Disabled host key verification detected. This allows man-in-the-middle attacks. Use the 'golang.org/x/crypto/ssh/knownhosts' package to do host key verification. See https://skarlso.github.io/2019/02/17/go-ssh-with-host-key-verification/ to learn more about the problem and how to fix it.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-322: Key Exchange without Entity Authentication'
        impact: LOW
        likelihood: LOW
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://skarlso.github.io/2019/02/17/go-ssh-with-host-key-verification/
            - https://gist.github.com/Skarlso/34321a230cf0245018288686c9e70b2d
        source-rule-url: https://github.com/securego/gosec
        subcategory:
            - audit
        technology:
            - go
      pattern: ssh.InsecureIgnoreHostKey()
      severity: WARNING
    - fix: |
        crypto/rand
      id: go.lang.security.audit.crypto.math_random.math-random-used
      languages:
        - go
      message: Do not use `math/rand`. Use `crypto/rand` instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern: |
                import $RAND "$MATH"
            - pattern: |
                import "$MATH"
        - metavariable-regex:
            metavariable: $MATH
            regex: ^(math/rand(\/v[0-9]+)*)$
        - pattern-either:
            - pattern-inside: |
                ...
                rand.$FUNC(...)
            - pattern-inside: |
                ...
                $RAND.$FUNC(...)
        - focus-metavariable:
            - $MATH
      severity: WARNING
    - fix: |
        tls.Config{ $...CONF, MinVersion: tls.VersionTLS13 }
      id: go.lang.security.audit.crypto.missing-ssl-minversion.missing-ssl-minversion
      languages:
        - go
      message: '`MinVersion` is missing from this TLS configuration.  By default, TLS 1.2 is currently used as the minimum when acting as a client, and TLS 1.0 when acting as a server. General purpose web applications should default to TLS 1.3 with all other protocols disabled.  Only where it is known that a web server must support legacy clients with unsupported an insecure browsers (such as Internet Explorer 10), it may be necessary to enable TLS 1.0 to provide support. Add `MinVersion: tls.VersionTLS13'' to the TLS configuration to bump the minimum version to TLS 1.3.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://golang.org/doc/go1.14#crypto/tls
            - https://golang.org/pkg/crypto/tls/#:~:text=MinVersion
            - https://www.us-cert.gov/ncas/alerts/TA14-290A
        source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls_config.go
        subcategory:
            - guardrail
        technology:
            - go
      patterns:
        - pattern: |
            tls.Config{ $...CONF }
        - pattern-not: |
            tls.Config{..., MinVersion: ..., ...}
      severity: WARNING
    - fix-regex:
        regex: VersionSSL30
        replacement: VersionTLS13
      id: go.lang.security.audit.crypto.ssl.ssl-v3-is-insecure
      languages:
        - go
      message: SSLv3 is insecure because it has known vulnerabilities. Starting with go1.14, SSLv3 will be removed. Instead, use 'tls.VersionTLS13'.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://golang.org/doc/go1.14#crypto/tls
            - https://www.us-cert.gov/ncas/alerts/TA14-290A
        source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls_config.go
        subcategory:
            - vuln
        technology:
            - go
      pattern: 'tls.Config{..., MinVersion: $TLS.VersionSSL30, ...}'
      severity: WARNING
    - id: go.lang.security.audit.crypto.tls.tls-with-insecure-cipher
      languages:
        - go
      message: Detected an insecure CipherSuite via the 'tls' module. This suite is considered weak. Use the function 'tls.CipherSuites()' to get a list of good cipher suites. See https://golang.org/pkg/crypto/tls/#InsecureCipherSuites for why and what other cipher suites to use.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://golang.org/pkg/crypto/tls/#InsecureCipherSuites
        source-rule-url: https://github.com/securego/gosec/blob/master/rules/tls.go
        subcategory:
            - vuln
        technology:
            - go
      pattern-either:
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_RC4_128_SHA, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_3DES_EDE_CBC_SHA, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_RSA_WITH_AES_128_CBC_SHA256, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_ECDSA_WITH_RC4_128_SHA, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_RC4_128_SHA, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, ...}}
        - pattern: |
            tls.Config{..., CipherSuites: []$TYPE{..., tls.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, ...}}
        - pattern: |
            tls.CipherSuite{..., TLS_RSA_WITH_RC4_128_SHA, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_RSA_WITH_3DES_EDE_CBC_SHA, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_RSA_WITH_AES_128_CBC_SHA256, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_ECDHE_ECDSA_WITH_RC4_128_SHA, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_RC4_128_SHA, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, ...}
        - pattern: |
            tls.CipherSuite{..., TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, ...}
      severity: WARNING
    - id: go.lang.security.audit.crypto.use_of_weak_crypto.use-of-md5
      languages:
        - go
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://github.com/securego/gosec#available-rules
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            import "crypto/md5"
            ...
        - pattern-either:
            - pattern: |
                md5.New()
            - pattern: |
                md5.Sum(...)
      severity: WARNING
    - id: go.lang.security.audit.crypto.use_of_weak_crypto.use-of-sha1
      languages:
        - go
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://github.com/securego/gosec#available-rules
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            import "crypto/sha1"
            ...
        - pattern-either:
            - pattern: |
                sha1.New()
            - pattern: |
                sha1.Sum(...)
      severity: WARNING
    - id: go.lang.security.audit.crypto.use_of_weak_crypto.use-of-des
      languages:
        - go
      message: Detected DES cipher algorithm which is insecure. The algorithm is considered weak and has been deprecated. Use AES instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://github.com/securego/gosec#available-rules
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            import "crypto/des"
            ...
        - pattern-either:
            - pattern: |
                des.NewTripleDESCipher(...)
            - pattern: |
                des.NewCipher(...)
      severity: WARNING
    - id: go.lang.security.audit.crypto.use_of_weak_crypto.use-of-rc4
      languages:
        - go
      message: Detected RC4 cipher algorithm which is insecure. The algorithm has many known vulnerabilities. Use AES instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://github.com/securego/gosec#available-rules
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            import "crypto/rc4"
            ...
        - pattern: rc4.NewCipher(...)
      severity: WARNING
    - fix: |
        2048
      id: go.lang.security.audit.crypto.use_of_weak_rsa_key.use-of-weak-rsa-key
      languages:
        - go
      message: RSA keys should be at least 2048 bits
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
        source-rule-url: https://github.com/securego/gosec/blob/master/rules/rsa.go
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern: |
                rsa.GenerateKey(..., $BITS)
            - pattern: |
                rsa.GenerateMultiPrimeKey(..., $BITS)
        - metavariable-comparison:
            comparison: $BITS < 2048
            metavariable: $BITS
        - focus-metavariable:
            - $BITS
      severity: WARNING
    - id: go.lang.security.audit.dangerous-command-write.dangerous-command-write
      languages:
        - go
      message: Detected non-static command inside Write. Audit the input to '$CW.Write'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern: |
            $CW.Write($BYTE)
        - pattern-inside: |
            $CW,$ERR := $CMD.StdinPipe()
            ...
        - pattern-not: |
            $CW.Write("...")
        - pattern-not: |
            $CW.Write([]byte("..."))
        - pattern-not: |
            $CW.Write([]byte("..."+"..."))
        - pattern-not-inside: |
            $BYTE = []byte("...");
            ...
        - pattern-not-inside: |
            $BYTE = []byte("..."+"...");
            ...
        - pattern-inside: |
            import "os/exec"
            ...
      severity: ERROR
    - id: go.lang.security.audit.dangerous-exec-cmd.dangerous-exec-cmd
      languages:
        - go
      message: Detected non-static command inside exec.Cmd. Audit the input to 'exec.Cmd'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    exec.Cmd {...,Path: $CMD,...}
                - pattern-not: |
                    exec.Cmd {...,Path: "...",...}
                - pattern-not-inside: |
                    $CMD,$ERR := exec.LookPath("...");
                    ...
                - pattern-not-inside: |
                    $CMD = "...";
                    ...
            - patterns:
                - pattern: |
                    exec.Cmd {...,Args: $ARGS,...}
                - pattern-not: |
                    exec.Cmd {...,Args: []string{...},...}
                - pattern-not-inside: |
                    $ARGS = []string{"...",...};
                    ...
                - pattern-not-inside: |
                    $CMD = "...";
                    ...
                    $ARGS = []string{$CMD,...};
                    ...
                - pattern-not-inside: |
                    $CMD = exec.LookPath("...");
                    ...
                    $ARGS = []string{$CMD,...};
                    ...
            - patterns:
                - pattern: |
                    exec.Cmd {...,Args: []string{$CMD,...},...}
                - pattern-not: |
                    exec.Cmd {...,Args: []string{"...",...},...}
                - pattern-not-inside: |
                    $CMD,$ERR := exec.LookPath("...");
                    ...
                - pattern-not-inside: |
                    $CMD = "...";
                    ...
            - patterns:
                - pattern-either:
                    - pattern: |
                        exec.Cmd {...,Args: []string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...},...}
                    - patterns:
                        - pattern: |
                            exec.Cmd {...,Args: []string{$CMD,"-c",$EXE,...},...}
                        - pattern-inside: |
                            $CMD,$ERR := exec.LookPath("=~/(sh|bash|ksh|csh|tcsh|zsh)/");
                            ...
                - pattern-not: |
                    exec.Cmd {...,Args: []string{"...","...","...",...},...}
                - pattern-not-inside: |
                    $EXE = "...";
                    ...
        - pattern-inside: |
            import "os/exec"
            ...
      severity: ERROR
    - id: go.lang.security.audit.dangerous-exec-command.dangerous-exec-command
      languages:
        - go
      message: Detected non-static command inside Command. Audit the input to 'exec.Command'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        exec.Command($CMD,...)
                    - pattern: |
                        exec.CommandContext($CTX,$CMD,...)
                - pattern-not: |
                    exec.Command("...",...)
                - pattern-not: |
                    exec.CommandContext($CTX,"...",...)
            - patterns:
                - pattern-either:
                    - pattern: |
                        exec.Command("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)
                    - pattern: |
                        exec.CommandContext($CTX,"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)
                - pattern-not: |
                    exec.Command("...","...","...",...)
                - pattern-not: |
                    exec.CommandContext($CTX,"...","...","...",...)
            - pattern-either:
                - pattern: |
                    exec.Command("=~/\/bin\/env/","=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)
                - pattern: |
                    exec.CommandContext($CTX,"=~/\/bin\/env/","=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$CMD,...)
        - pattern-inside: |
            import "os/exec"
            ...
        - pattern-not-inside: |
            $CMD,$ERR := exec.LookPath("...");
            ...
        - pattern-not-inside: |
            $CMD = "...";
            ...
      severity: ERROR
    - id: go.lang.security.audit.dangerous-syscall-exec.dangerous-syscall-exec
      languages:
        - go
      message: Detected non-static command inside Exec. Audit the input to 'syscall.Exec'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    syscall.$METHOD($BIN,...)
                - pattern-not: |
                    syscall.$METHOD("...",...)
                - pattern-not-inside: |
                    $BIN,$ERR := exec.LookPath("...");
                    ...
                - pattern-not-inside: |
                    $BIN = "...";
                    ...
            - patterns:
                - pattern: |
                    syscall.$METHOD($BIN,$ARGS,...)
                - pattern-not: |
                    syscall.$METHOD($BIN,[]string{"...",...},...)
                - pattern-not-inside: |
                    $ARGS := []string{"...",...};
                    ...
                - pattern-not-inside: |
                    $CMD = "...";
                    ...
                    $ARGS = []string{$CMD,...};
                    ...
                - pattern-not-inside: |
                    $CMD,$ERR := exec.LookPath("...");
                    ...
                    $ARGS = []string{$CMD,...};
                    ...
            - patterns:
                - pattern: |
                    syscall.$METHOD($BIN,[]string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...},...)
                - pattern-not: |
                    syscall.$METHOD($BIN,[]string{"...","...","...",...},...)
            - patterns:
                - pattern: |
                    syscall.$METHOD($BIN,$ARGS,...)
                - pattern-either:
                    - pattern-inside: |
                        $ARGS := []string{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$EXE,...};
                        ...
                    - pattern-inside: |
                        $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";
                        ...
                        $ARGS = []string{$CMD,"-c",$EXE,...};
                        ...
                    - pattern-inside: |
                        $CMD,$ERR := exec.LookPath("=~/(sh|bash|ksh|csh|tcsh|zsh)/");
                        ...
                        $ARGS = []string{$CMD,"-c",$EXE,...};
                        ...
                - pattern-not-inside: |
                    $ARGS := []string{"...","...","...",...};
                    ...
                - pattern-not-inside: |
                    $CMD = "...";
                    ...
                    $ARGS = []string{$CMD,"...","...",...};
                    ...
                - pattern-not-inside: |
                    $CMD,$ERR := exec.LookPath("...");
                    ...
                    $ARGS = []string{$CMD,"...","...",...};
                    ...
        - pattern-inside: |
            import "syscall"
            ...
        - metavariable-regex:
            metavariable: $METHOD
            regex: (Exec|ForkExec)
      severity: ERROR
    - id: go.lang.security.audit.database.string-formatted-query.string-formatted-query
      languages:
        - go
      message: String-formatted SQL query detected. This could lead to SQL injection if the string is not sanitized properly. Audit this call to ensure the SQL is not manipulable by external data.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://github.com/securego/gosec
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - metavariable-regex:
            metavariable: $OBJ
            regex: (?i).*(db|database)
        - pattern-not-inside: |
            $VAR = "..." + "..."
            ...
            $OBJ.$SINK(..., $VAR, ...)
        - pattern-not: $OBJ.Exec("...")
        - pattern-not: $OBJ.ExecContext($CTX, "...")
        - pattern-not: $OBJ.Query("...")
        - pattern-not: $OBJ.QueryContext($CTX, "...")
        - pattern-not: $OBJ.QueryRow("...")
        - pattern-not: $OBJ.QueryRow($CTX, "...")
        - pattern-not: $OBJ.QueryRowContext($CTX, "...")
        - pattern-either:
            - pattern: $OBJ.Exec($X + ...)
            - pattern: $OBJ.ExecContext($CTX, $X + ...)
            - pattern: $OBJ.Query($X + ...)
            - pattern: $OBJ.QueryContext($CTX, $X + ...)
            - pattern: $OBJ.QueryRow($X + ...)
            - pattern: $OBJ.QueryRow($CTX, $X + ...)
            - pattern: $OBJ.QueryRowContext($CTX, $X + ...)
            - pattern: $OBJ.Exec(fmt.$P("...", ...))
            - pattern: $OBJ.ExecContext($CTX, fmt.$P("...", ...))
            - pattern: $OBJ.Query(fmt.$P("...", ...))
            - pattern: $OBJ.QueryContext($CTX, fmt.$P("...", ...))
            - pattern: $OBJ.QueryRow(fmt.$P("...", ...))
            - pattern: $OBJ.QueryRow($CTX, fmt.$U("...", ...))
            - pattern: $OBJ.QueryRowContext($CTX, fmt.$P("...", ...))
            - patterns:
                - pattern-either:
                    - pattern: $QUERY = fmt.Fprintf($F, "$SQLSTR", ...)
                    - pattern: $QUERY = fmt.Sprintf("$SQLSTR", ...)
                    - pattern: $QUERY = fmt.Printf("$SQLSTR", ...)
                    - pattern: $QUERY = $X + ...
                - pattern-either:
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.Query($QUERY, ...)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.ExecContext($CTX, $QUERY, ...)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.Exec($QUERY, ...)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.QueryRow($CTX, $QUERY)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.QueryRow($QUERY)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.QueryContext($CTX, $QUERY)
                            ...
                        }
                    - pattern-inside: |
                        func $FUNC(...) {
                            ...
                            $OBJ.QueryRowContext($CTX, $QUERY, ...)
                            ...
                        }
      severity: WARNING
    - id: go.lang.security.audit.md5-used-as-password.md5-used-as-password
      languages:
        - go
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Use a suitable password hashing function such as bcrypt. You can use the `golang.org/x/crypto/bcrypt` package.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
            - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
            - https://github.com/returntocorp/semgrep-rules/issues/1609
            - https://pkg.go.dev/golang.org/x/crypto/bcrypt
        subcategory:
            - vuln
        technology:
            - md5
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern: $FUNCTION(...)
            - metavariable-regex:
                metavariable: $FUNCTION
                regex: (?i)(.*password.*)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: md5.New
                - pattern: md5.Sum
      severity: WARNING
    - id: go.lang.security.audit.net.bind_all.avoid-bind-to-all-interfaces
      languages:
        - go
      message: Detected a network listener listening on 0.0.0.0 or an empty string. This could unexpectedly expose the server publicly as it binds to all available interfaces. Instead, specify another IP address that is not 0.0.0.0 nor the empty string.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://github.com/securego/gosec
        subcategory:
            - audit
        technology:
            - go
      pattern-either:
        - pattern: tls.Listen($NETWORK, "=~/^0.0.0.0:.*$/", ...)
        - pattern: net.Listen($NETWORK, "=~/^0.0.0.0:.*$/", ...)
        - pattern: tls.Listen($NETWORK, "=~/^:.*$/", ...)
        - pattern: net.Listen($NETWORK, "=~/^:.*$/", ...)
      severity: WARNING
    - fix-regex:
        regex: (HttpOnly\s*:\s+)false
        replacement: \1true
      id: go.lang.security.audit.net.cookie-missing-httponly.cookie-missing-httponly
      languages:
        - go
      message: A session cookie was detected without setting the 'HttpOnly' flag. The 'HttpOnly' flag for cookies instructs the browser to forbid client-side scripts from reading the cookie which mitigates XSS attacks. Set the 'HttpOnly' flag by setting 'HttpOnly' to 'true' in the Cookie.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/util/cookie.go
            - https://golang.org/src/net/http/cookie.go
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-not-inside: |
            http.Cookie{
              ...,
              HttpOnly: true,
              ...,
            }
        - pattern: |
            http.Cookie{
              ...,
            }
      severity: WARNING
    - fix-regex:
        regex: (Secure\s*:\s+)false
        replacement: \1true
      id: go.lang.security.audit.net.cookie-missing-secure.cookie-missing-secure
      languages:
        - go
      message: A session cookie was detected without setting the 'Secure' flag. The 'secure' flag for cookies prevents the client from transmitting the cookie over insecure channels such as HTTP. Set the 'Secure' flag by setting 'Secure' to 'true' in the Options struct.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/util/cookie.go
            - https://golang.org/src/net/http/cookie.go
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-not-inside: |
            http.Cookie{
              ...,
              Secure: true,
              ...,
            }
        - pattern: |
            http.Cookie{
              ...,
            }
      severity: WARNING
    - id: go.lang.security.audit.net.dynamic-httptrace-clienttrace.dynamic-httptrace-clienttrace
      languages:
        - go
      message: Detected a potentially dynamic ClientTrace. This occurred because semgrep could not find a static definition for '$TRACE'. Dynamic ClientTraces are dangerous because they deserialize function code to run when certain Request events occur, which could lead to code being run without your knowledge. Ensure that your ClientTrace is statically defined.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/returntocorp/semgrep-rules/issues/518
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-not-inside: |
            package $PACKAGE
            ...
            &httptrace.ClientTrace { ... }
            ...
        - pattern: httptrace.WithClientTrace($ANY, $TRACE)
      severity: WARNING
    - id: go.lang.security.audit.net.formatted-template-string.formatted-template-string
      languages:
        - go
      message: Found a formatted template string passed to 'template.HTML()'. 'template.HTML()' does not escape contents. Be absolutely sure there is no user-controlled data in this template. If user data can reach this template, you may have a XSS vulnerability.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://golang.org/pkg/html/template/#HTML
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-not: template.HTML("..." + "...")
        - pattern-either:
            - pattern: template.HTML($T + $X, ...)
            - pattern: template.HTML(fmt.$P("...", ...), ...)
            - pattern: |
                $T = "..."
                ...
                $T = $FXN(..., $T, ...)
                ...
                template.HTML($T, ...)
            - pattern: |
                $T = fmt.$P("...", ...)
                ...
                template.HTML($T, ...)
            - pattern: |
                $T, $ERR = fmt.$P("...", ...)
                ...
                template.HTML($T, ...)
            - pattern: |
                $T = $X + $Y
                ...
                template.HTML($T, ...)
            - pattern: |-
                $T = "..."
                ...
                $OTHER, $ERR = fmt.$P(..., $T, ...)
                ...
                template.HTML($OTHER, ...)
      severity: WARNING
    - id: go.lang.security.audit.net.fs-directory-listing.fs-directory-listing
      languages:
        - go
      message: 'Detected usage of ''http.FileServer'' as handler: this allows directory listing and an attacker could navigate through directories looking for sensitive files. Be sure to disable directory listing or restrict access to specific directories/files.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-548: Exposure of Information Through Directory Listing'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A06:2017 - Security Misconfiguration
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/OWASP/Go-SCP
            - https://cwe.mitre.org/data/definitions/548.html
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $FS := http.FileServer(...)
                    ...
                - pattern-either:
                    - pattern: |
                        http.ListenAndServe(..., $FS)
                    - pattern: |
                        http.ListenAndServeTLS(..., $FS)
                    - pattern: |
                        http.Handle(..., $FS)
                    - pattern: |
                        http.HandleFunc(..., $FS)
            - patterns:
                - pattern: |
                    http.$FN(..., http.FileServer(...))
                - metavariable-regex:
                    metavariable: $FN
                    regex: (ListenAndServe|ListenAndServeTLS|Handle|HandleFunc)
      severity: WARNING
    - id: go.lang.security.audit.net.unescaped-data-in-js.unescaped-data-in-js
      languages:
        - go
      message: Found a formatted template string passed to 'template.JS()'. 'template.JS()' does not escape contents. Be absolutely sure there is no user-controlled data in this template.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://golang.org/pkg/html/template/#JS
        subcategory:
            - audit
        technology:
            - go
      pattern-either:
        - pattern: template.JS($T + $X, ...)
        - pattern: template.JS(fmt.$P("...", ...), ...)
        - pattern: |
            $T = "..."
            ...
            $T = $FXN(..., $T, ...)
            ...
            template.JS($T, ...)
        - pattern: |
            $T = fmt.$P("...", ...)
            ...
            template.JS($T, ...)
        - pattern: |
            $T, $ERR = fmt.$P("...", ...)
            ...
            template.JS($T, ...)
        - pattern: |
            $T = $X + $Y
            ...
            template.JS($T, ...)
        - pattern: |
            $T = "..."
            ...
            $OTHER, $ERR = fmt.$P(..., $T, ...)
            ...
            template.JS($OTHER, ...)
      severity: WARNING
    - id: go.lang.security.audit.net.unescaped-data-in-url.unescaped-data-in-url
      languages:
        - go
      message: Found a formatted template string passed to 'template.URL()'. 'template.URL()' does not escape contents, and this could result in XSS (cross-site scripting) and therefore confidential data being stolen. Sanitize data coming into this function or make sure that no user-controlled input is coming into the function.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://golang.org/pkg/html/template/#URL
        subcategory:
            - audit
        technology:
            - go
      pattern-either:
        - pattern: template.URL($T + $X, ...)
        - pattern: template.URL(fmt.$P("...", ...), ...)
        - pattern: |
            $T = "..."
            ...
            $T = $FXN(..., $T, ...)
            ...
            template.URL($T, ...)
        - pattern: |
            $T = fmt.$P("...", ...)
            ...
            template.URL($T, ...)
        - pattern: |
            $T, $ERR = fmt.$P("...", ...)
            ...
            template.URL($T, ...)
        - pattern: |
            $T = $X + $Y
            ...
            template.URL($T, ...)
        - pattern: |-
            $T = "..."
            ...
            $OTHER, $ERR = fmt.$P(..., $T, ...)
            ...
            template.URL($OTHER, ...)
      severity: WARNING
    - fix: http.ListenAndServeTLS($ADDR, certFile, keyFile, $HANDLER)
      id: go.lang.security.audit.net.use-tls.use-tls
      languages:
        - go
      message: Found an HTTP server without TLS. Use 'http.ListenAndServeTLS' instead. See https://golang.org/pkg/net/http/#ListenAndServeTLS for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://golang.org/pkg/net/http/#ListenAndServeTLS
        subcategory:
            - audit
        technology:
            - go
      pattern: http.ListenAndServe($ADDR, $HANDLER)
      severity: WARNING
    - id: go.lang.security.audit.net.wip-xss-using-responsewriter-and-printf.wip-xss-using-responsewriter-and-printf
      languages:
        - go
      message: Found data going from url query parameters into formatted data written to ResponseWriter. This could be XSS and should not be done. If you must do this, ensure your data is sanitized or escaped.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            func $FUNC(..., $W http.ResponseWriter, ...) {
              ...
              var $TEMPLATE = "..."
              ...
              $W.Write([]byte(fmt.$PRINTF($TEMPLATE, ...)), ...)
              ...
            }
        - pattern-either:
            - pattern: |
                $PARAMS = r.URL.Query()
                ...
                $DATA, $ERR := $PARAMS[...]
                ...
                $INTERM = $ANYTHING(..., $DATA, ...)
                ...
                $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))
            - pattern: |
                $PARAMS = r.URL.Query()
                ...
                $DATA, $ERR := $PARAMS[...]
                ...
                $INTERM = $DATA[...]
                ...
                $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))
            - pattern: |
                $DATA, $ERR := r.URL.Query()[...]
                ...
                $INTERM = $DATA[...]
                ...
                $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))
            - pattern: |
                $DATA, $ERR := r.URL.Query()[...]
                ...
                $INTERM = $ANYTHING(..., $DATA, ...)
                ...
                $W.Write([]byte(fmt.$PRINTF(..., $INTERM, ...)))
            - pattern: |
                $PARAMS = r.URL.Query()
                ...
                $DATA, $ERR := $PARAMS[...]
                ...
                $W.Write([]byte(fmt.$PRINTF(..., $DATA, ...)))
      severity: WARNING
    - id: go.lang.security.audit.reflect-makefunc.reflect-makefunc
      languages:
        - go
      message: '''reflect.MakeFunc'' detected. This will sidestep protections that are normally afforded by Go''s type system. Audit this call and be sure that user input cannot be used to affect the code generated by MakeFunc; otherwise, you will have a serious security vulnerability.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - audit
        technology:
            - go
      pattern: reflect.MakeFunc(...)
      severity: ERROR
    - id: go.lang.security.audit.sqli.gosql-sqli.gosql-sqli
      languages:
        - go
      message: Detected string concatenation with a non-literal variable in a "database/sql" Go SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use prepared statements with the 'Prepare' and 'PrepareContext' calls.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://golang.org/pkg/database/sql/
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $DB.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = fmt.Sprintf("...", $PARAM1, ...)
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
            - pattern: $DB.$METHOD(..., $X + $Y, ...)
            - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
        - pattern-either:
            - pattern-inside: |
                $DB, ... = sql.Open(...)
                ...
            - pattern-inside: |
                func $FUNCNAME(..., $DB *sql.DB, ...) {
                  ...
                }
        - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(Exec|ExecContent|Query|QueryContext|QueryRow|QueryRowContext)$
      severity: ERROR
    - id: go.lang.security.audit.sqli.pg-orm-sqli.pg-orm-sqli
      languages:
        - go
      message: Detected string concatenation with a non-literal variable in a go-pg ORM SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, do not use strings concatenated with user-controlled input. Instead, use parameterized statements.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://pg.uptrace.dev/queries/
        subcategory:
            - vuln
        technology:
            - go-pg
      patterns:
        - pattern-inside: |
            import (
              ...
              "$IMPORT"
            )
            ...
        - metavariable-regex:
            metavariable: $IMPORT
            regex: .*go-pg
        - pattern-either:
            - patterns:
                - pattern: $DB.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = fmt.Sprintf("...", $PARAM1, ...)
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
            - pattern: |
                $DB.$INTFUNC1(...).$METHOD(..., $X + $Y, ...).$INTFUNC2(...)
            - pattern: |
                $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
            - pattern-inside: |
                $DB = pg.Connect(...)
                ...
            - pattern-inside: |
                func $FUNCNAME(..., $DB *pg.DB, ...) {
                  ...
                }
        - pattern-not-inside: |
            $QUERY = fmt.Sprintf("...", ...,"...", ...)
            ...
        - pattern-not-inside: |
            $QUERY += "..."
            ...
        - pattern-not: $DB.$METHOD(...,"...",...)
        - pattern-not: |
            $DB.$INTFUNC1(...).$METHOD(..., "...", ...).$INTFUNC2(...)
        - pattern-not-inside: |
            $QUERY = "..." + "..."
        - pattern-not: |
            "..."
        - pattern-not: path.Join(...)
        - pattern-not: filepath.Join(...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(Where|WhereOr|Join|GroupExpr|OrderExpr|ColumnExpr)$
      severity: ERROR
    - id: go.lang.security.audit.sqli.pg-sqli.pg-sqli
      languages:
        - go
      message: 'Detected string concatenation with a non-literal variable in a go-pg SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries instead of string concatenation. You can use parameterized queries like so: ''(SELECT ? FROM table, data1)'''
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://pg.uptrace.dev/
            - https://pkg.go.dev/github.com/go-pg/pg/v10
        subcategory:
            - vuln
        technology:
            - go-pg
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    $DB.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = fmt.Sprintf("...", $PARAM1, ...)
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
            - pattern: $DB.$METHOD(..., $X + $Y, ...)
            - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
        - pattern-either:
            - pattern-inside: |
                $DB = pg.Connect(...)
                ...
            - pattern-inside: |
                func $FUNCNAME(..., $DB *pg.DB, ...) {
                  ...
                }
        - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(Exec|ExecContext|ExecOne|ExecOneContext|Query|QueryOne|QueryContext|QueryOneContext)$
      severity: ERROR
    - id: go.lang.security.audit.sqli.pgx-sqli.pgx-sqli
      languages:
        - go
      message: 'Detected string concatenation with a non-literal variable in a pgx Go SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries instead. You can use parameterized queries like so: (`SELECT $1 FROM table`, `data1)'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/jackc/pgx
            - https://pkg.go.dev/github.com/jackc/pgx/v4#hdr-Connection_Pool
        subcategory:
            - vuln
        technology:
            - pgx
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $DB.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = fmt.Sprintf("...", $PARAM1, ...)
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
            - pattern: $DB.$METHOD(..., $X + $Y, ...)
            - pattern: $DB.$METHOD(..., fmt.Sprintf("...", $PARAM1, ...), ...)
        - pattern-either:
            - pattern-inside: |
                $DB, ... = pgx.Connect(...)
                ...
            - pattern-inside: |
                $DB, ... = pgx.NewConnPool(...)
                ...
            - pattern-inside: |
                $DB, ... = pgx.ConnectConfig(...)
                ...
            - pattern-inside: |
                func $FUNCNAME(..., $DB *pgx.Conn, ...) {
                  ...
                }
        - pattern-not: $DB.$METHOD(..., "..." + "...", ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(Exec|ExecEx|Query|QueryEx|QueryRow|QueryRowEx)$
      severity: ERROR
    - id: go.lang.security.audit.unsafe-reflect-by-name.unsafe-reflect-by-name
      languages:
        - go
      message: If an attacker can supply values that the application then uses to determine which method or field to invoke, the potential exists for the attacker to create control flow paths through the application that were not intended by the application developers. This attack vector may allow the attacker to bypass authentication or access control checks or otherwise cause the application to behave in an unexpected manner.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code (''Unsafe Reflection'')'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern: |
                $SMTH.MethodByName($NAME,...)
            - pattern: |
                $SMTH.FieldByName($NAME,...)
        - pattern-not: |
            $SMTH.MethodByName("...",...)
        - pattern-not: |
            $SMTH.FieldByName("...",...)
        - pattern-inside: |
            import "reflect"
            ...
      severity: WARNING
    - id: go.lang.security.audit.unsafe.use-of-unsafe-block
      languages:
        - go
      message: Using the unsafe package in Go gives you low-level memory management and many of the strengths of the C language, but also steps around the type safety of Go and can lead to buffer overflows and possible arbitrary code execution by an attacker. Only use this package if you absolutely know what you're doing.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-242: Use of Inherently Dangerous Function'
        impact: LOW
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/242.html
        source_rule_url: https://github.com/securego/gosec/blob/master/rules/unsafe.go
        subcategory:
            - audit
        technology:
            - go
      pattern: unsafe.$FUNC(...)
      severity: WARNING
    - id: go.lang.security.audit.xss.no-direct-write-to-responsewriter.no-direct-write-to-responsewriter
      languages:
        - go
      message: Detected directly writing or similar in 'http.ResponseWriter.write()'. This bypasses HTML escaping that prevents cross-site scripting vulnerabilities. Instead, use the 'html/template' package and render data using 'template.Execute()'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern-inside: |
                func $HANDLER(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
            - pattern-inside: |
                func $HANDLER(..., $WRITER *http.ResponseWriter, ...) {
                  ...
                }
            - pattern-inside: |
                func(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
        - pattern-either:
            - pattern: $WRITER.Write(...)
            - pattern: (*$WRITER).Write(...)
        - pattern-not: $WRITER.Write([]byte("..."))
      severity: WARNING
    - id: go.lang.security.audit.xss.no-fprintf-to-responsewriter.no-fprintf-to-responsewriter
      languages:
        - go
      message: Detected 'Fprintf' or similar writing to 'http.ResponseWriter'. This bypasses HTML escaping that prevents cross-site scripting vulnerabilities. Instead, use the 'html/template' package to render data to users.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern-inside: |
                func $HANDLER(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
            - pattern-inside: |
                func(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
        - pattern-not: fmt.$PRINTF($WRITER, "...")
        - pattern: fmt.$PRINTF($WRITER, ...)
      severity: WARNING
    - id: go.lang.security.audit.xss.no-interpolation-js-template-string.no-interpolation-js-template-string
      languages:
        - generic
      message: Detected template variable interpolation in a JavaScript template string. This is potentially vulnerable to cross-site scripting (XSS) attacks because a malicious actor has control over JavaScript but without the need to use escaped characters. Instead, obtain this variable outside of the template string and ensure your template is properly escaped.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://github.com/golang/go/issues/9200#issuecomment-66100328
            - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
        subcategory:
            - audit
        technology:
            - generic
      paths:
        include:
            - '*.html'
            - '*.thtml'
            - '*.gohtml'
            - '*.tmpl'
            - '*.tpl'
      patterns:
        - pattern-inside: <script ...> ... ... ... ... ... </script>
        - pattern: '` ... {{ ... }} ...`'
      severity: WARNING
    - id: go.lang.security.audit.xss.no-printf-in-responsewriter.no-printf-in-responsewriter
      languages:
        - go
      message: Detected 'printf' or similar in 'http.ResponseWriter.write()'. This bypasses HTML escaping that prevents cross-site scripting vulnerabilities. Instead, use the 'html/template' package to render data to users.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-either:
            - pattern-inside: |
                func $HANDLER(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
            - pattern-inside: |
                func(..., $WRITER http.ResponseWriter, ...) {
                  ...
                }
        - pattern: |
            $WRITER.Write(<... fmt.$PRINTF(...) ...>, ...)
      severity: WARNING
    - id: go.lang.security.audit.xss.template-html-does-not-escape.unsafe-template-type
      languages:
        - go
      message: Semgrep could not determine that the argument to 'template.HTML()' is a constant. 'template.HTML()' and similar does not escape contents. Be absolutely sure there is no user-controlled data in this template. If user data can reach this template, you may have a XSS vulnerability. Instead, do not use this function and use 'template.Execute()'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://golang.org/pkg/html/template/#HTML
            - https://github.com/0c34/govwa/blob/139693e56406b5684d2a6ae22c0af90717e149b8/vulnerability/xss/xss.go#L33
        subcategory:
            - audit
        technology:
            - go
      patterns:
        - pattern-not: template.$ANY("..." + "...")
        - pattern-not: template.$ANY("...")
        - pattern-either:
            - pattern: template.HTML(...)
            - pattern: template.CSS(...)
            - pattern: template.HTMLAttr(...)
            - pattern: template.JS(...)
            - pattern: template.JSStr(...)
            - pattern: template.Srcset(...)
            - pattern: template.URL(...)
      severity: WARNING
    - fix: filepath.FromSlash(filepath.Clean("/"+strings.Trim($...INNER, "/")))
      id: go.lang.security.filepath-clean-misuse.filepath-clean-misuse
      languages:
        - go
      message: '`Clean` is not intended to sanitize against path traversal attacks. This function is for finding the shortest path name equivalent to the given input. Using `Clean` to sanitize file reads may expose this application to path traversal attacks, where an attacker could access arbitrary files on the server. To fix this easily, write this: `filepath.FromSlash(path.Clean("/"+strings.Trim(req.URL.Path, "/")))` However, a better solution is using the `SecureJoin` function in the package `filepath-securejoin`. See https://pkg.go.dev/github.com/cyphar/filepath-securejoin#section-readme.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://pkg.go.dev/path#Clean
            - http://technosophos.com/2016/03/31/go-quickly-cleaning-filepaths.html
            - https://labs.detectify.com/2021/12/15/zero-day-path-traversal-grafana/
            - https://dzx.cz/2021/04/02/go_path_traversal/
            - https://pkg.go.dev/github.com/cyphar/filepath-securejoin#section-readme
        subcategory:
            - vuln
        technology:
            - go
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: |
                "/" + ...
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: filepath.Clean($...INNER)
                - pattern: path.Clean($...INNER)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
      severity: ERROR
    - id: go.lang.security.injection.open-redirect.open-redirect
      languages:
        - go
      message: An HTTP redirect was found to be crafted from user-input `$REQUEST`. This can lead to open redirect vulnerabilities, potentially allowing attackers to redirect users to malicious web sites. It is recommend where possible to not allow user-input to craft the redirect URL. When user-input is necessary to craft the request, it is recommended to follow OWASP best practices to restrict the URL to domains in an allowlist.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        description: An HTTP redirect was found to be crafted from user-input leading to an open redirect vulnerability
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        references:
            - https://knowledge-base.secureflag.com/vulnerabilities/unvalidated_redirects___forwards/open_redirect_go_lang.html
        subcategory:
            - vuln
        technology:
            - go
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern: http.Redirect($W, $REQ, $URL, ...)
            - focus-metavariable: $URL
          requires: INPUT and not CLEAN
      pattern-sources:
        - label: INPUT
          patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
        - label: CLEAN
          patterns:
            - pattern-either:
                - pattern: |
                    "$URLSTR" + $INPUT
                - patterns:
                    - pattern-either:
                        - pattern: fmt.Fprintf($F, "$URLSTR", $INPUT, ...)
                        - pattern: fmt.Sprintf("$URLSTR", $INPUT, ...)
                        - pattern: fmt.Printf("$URLSTR", $INPUT, ...)
            - metavariable-regex:
                metavariable: $URLSTR
                regex: .*//[a-zA-Z0-10]+\..*
          requires: INPUT
      severity: WARNING
    - id: go.lang.security.injection.raw-html-format.raw-html-format
      languages:
        - go
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. Use the `html/template` package which will safely render HTML instead, or inspect that the HTML is rendered safely.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://blogtitle.github.io/robn-go-security-pearls-cross-site-scripting-xss/
        subcategory:
            - vuln
        technology:
            - go
      mode: taint
      pattern-sanitizers:
        - pattern: html.EscapeString(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: fmt.Printf("$HTMLSTR", ...)
                - pattern: fmt.Sprintf("$HTMLSTR", ...)
                - pattern: fmt.Fprintf($W, "$HTMLSTR", ...)
                - pattern: '"$HTMLSTR" + ...'
            - metavariable-pattern:
                language: generic
                metavariable: $HTMLSTR
                pattern: <$TAG ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
      severity: WARNING
    - id: go.lang.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - go
      message: User data flows into this manually-constructed SQL string. User data can be safely inserted into SQL strings using prepared statements or an object-relational mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL injection, which could let an attacker steal or manipulate data from the database. Instead, use prepared statements (`db.Query("SELECT * FROM t WHERE id = ?", id)`) or a safe library.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://golang.org/doc/database/sql-injection
            - https://www.stackhawk.com/blog/golang-sql-injection-guide-examples-and-prevention/
        subcategory:
            - vuln
        technology:
            - go
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: strconv.Atoi(...)
            - pattern: |
                ($X: bool)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: |
                            "$SQLSTR" + ...
                        - patterns:
                            - pattern-inside: |
                                $VAR = "$SQLSTR";
                                ...
                            - pattern: $VAR += ...
                        - patterns:
                            - pattern-inside: |
                                var $SB strings.Builder
                                ...
                            - pattern-inside: |
                                $SB.WriteString("$SQLSTR")
                                ...
                                $SB.String(...)
                            - pattern: |
                                $SB.WriteString(...)
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(select|delete|insert|create|update|alter|drop).*
                - patterns:
                    - pattern-either:
                        - pattern: fmt.Fprintf($F, "$SQLSTR", ...)
                        - pattern: fmt.Sprintf("$SQLSTR", ...)
                        - pattern: fmt.Printf("$SQLSTR", ...)
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*%(v|s|q).*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
      severity: ERROR
    - id: go.lang.security.injection.tainted-url-host.tainted-url-host
      languages:
        - go
      message: A request was found to be crafted from user-input `$REQUEST`. This can lead to Server-Side Request Forgery (SSRF) vulnerabilities, potentially exposing sensitive data. It is recommend where possible to not allow user-input to craft the base request, but to be treated as part of the path or query parameter. When user-input is necessary to craft the request, it is recommended to follow OWASP best practices to prevent abuse, including using an allowlist.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://goteleport.com/blog/ssrf-attacks/
        subcategory:
            - vuln
        technology:
            - go
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-inside: |
                                $CLIENT := &http.Client{...}
                                ...
                            - pattern: $CLIENT.$METHOD($URL, ...)
                        - pattern: http.$METHOD($URL, ...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(Get|Head|Post|PostForm)$
                - patterns:
                    - pattern: |
                        http.NewRequest("$METHOD", $URL, ...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(GET|HEAD|POST|POSTFORM)$
            - focus-metavariable: $URL
          requires: INPUT and not CLEAN
      pattern-sources:
        - label: INPUT
          patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$ANYTHING
                - pattern: |
                    ($REQUEST : http.Request).$ANYTHING
            - metavariable-regex:
                metavariable: $ANYTHING
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
        - label: CLEAN
          patterns:
            - pattern-either:
                - pattern: |
                    "$URLSTR" + $INPUT
                - patterns:
                    - pattern-either:
                        - pattern: fmt.Fprintf($F, "$URLSTR", $INPUT, ...)
                        - pattern: fmt.Sprintf("$URLSTR", $INPUT, ...)
                        - pattern: fmt.Printf("$URLSTR", $INPUT, ...)
            - metavariable-regex:
                metavariable: $URLSTR
                regex: .*//[a-zA-Z0-10]+\..*
          requires: INPUT
      severity: WARNING
    - id: go.lang.security.zip.path-traversal-inside-zip-extraction
      languages:
        - go
      message: File traversal when extracting zip archive
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source_rule_url: https://github.com/securego/gosec/issues/205
        subcategory:
            - audit
        technology:
            - go
      pattern: |
        reader, $ERR := zip.OpenReader($ARCHIVE)
        ...
        for _, $FILE := range reader.File {
          ...
          path := filepath.Join($TARGET, $FILE.Name)
          ...
        }
      severity: WARNING
    - id: go.otto.security.audit.dangerous-execution.dangerous-execution
      languages:
        - go
      message: Detected non-static script inside otto VM. Audit the input to 'VM.Run'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - otto
            - vm
      patterns:
        - pattern-inside: |
            $VM = otto.New(...)
            ...
        - pattern-not: $VM.Run("...", ...)
        - pattern: $VM.Run(...)
      severity: ERROR
    - id: go.template.security.ssti.go-ssti
      languages:
        - go
      message: A server-side template injection occurs when an attacker is able to use native template syntax to inject a malicious payload into a template, which is then executed server-side. When using "html/template" always check that user inputs are validated and sanitized before included within the template.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine'
        impact: HIGH
        likelihood: LOW
        references:
            - https://www.onsecurity.io/blog/go-ssti-method-research/
            - http://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html
        subcategory:
            - vuln
        technology:
            - go
      patterns:
        - pattern-inside: |
            import ("html/template")
            ...
        - pattern: $TEMPLATE = fmt.Sprintf("...", $ARG, ...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    func $FN(..., $REQ *http.Request, ...){
                    ...
                    }
                - pattern-inside: |
                    func $FN(..., $REQ http.Request, ...){
                    ...
                    }
                - pattern-inside: |
                    func(..., $REQ *http.Request, ...){
                    ...
                    }
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $ARG := $REQ.URL.Query().Get(...)
                    ...
                    $T, $ERR := $TMPL.Parse($TEMPLATE)
                - pattern-inside: |
                    $ARG := $REQ.Form.Get(...)
                    ...
                    $T, $ERR := $TMPL.Parse($TEMPLATE)
                - pattern-inside: |
                    $ARG := $REQ.PostForm.Get(...)
                    ...
                    $T, $ERR := $TMPL.Parse($TEMPLATE)
      severity: ERROR
    - id: java.android.security.exported_activity.exported_activity
      languages:
        - generic
      message: The application exports an activity. Any application on the device can launch the exported activity which may compromise the integrity of your application or its data.  Ensure that any exported activities do not have privileged access to your application's control plane.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-926: Improper Export of Android Application Components'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A5:2021 Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/926.html
        subcategory:
            - vuln
        technology:
            - Android
      paths:
        exclude:
            - sources/
            - classes3.dex
            - '*.so'
        include:
            - '*AndroidManifest.xml'
      patterns:
        - pattern-not-inside: <activity ... android:exported="false" ... />
        - pattern-inside: "<activity  ... /> \n"
        - pattern-either:
            - pattern: |
                <activity ... android:exported="true" ... />
            - pattern: |
                <activity ... <intent-filter> ... />
      severity: WARNING
    - id: java.aws-lambda.security.tainted-sql-string.tainted-sql-string
      languages:
        - java
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$SQLSTR" + ...
                - pattern: |
                    "$SQLSTR".concat(...)
                - patterns:
                    - pattern-inside: |
                        StringBuilder $SB = new StringBuilder("$SQLSTR");
                        ...
                    - pattern: $SB.append(...)
                - patterns:
                    - pattern-inside: |
                        $VAR = "$SQLSTR";
                        ...
                    - pattern: $VAR += ...
                - pattern: String.format("$SQLSTR", ...)
            - metavariable-regex:
                metavariable: $SQLSTR
                regex: (?i)(select|delete|insert|create|update|alter|drop)\b
            - pattern-not-inside: |
                System.out.$PRINTLN(...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $EVENT
            - pattern-either:
                - pattern: |
                    $HANDLERTYPE $HANDLER($TYPE $EVENT, com.amazonaws.services.lambda.runtime.Context $CONTEXT) {
                      ...
                    }
                - pattern: |
                    $HANDLERTYPE $HANDLER(InputStream $EVENT, OutputStream $OUT, com.amazonaws.services.lambda.runtime.Context $CONTEXT) {
                      ...
                    }
      severity: ERROR
    - id: java.aws-lambda.security.tainted-sqli.tainted-sqli
      languages:
        - java
      message: Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use parameterized SQL queries or properly sanitize user input instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - sql
            - java
            - aws-lambda
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: "(java.sql.CallableStatement $STMT) = ...; \n"
                - pattern: |
                    (java.sql.Statement $STMT) = ...;
                - pattern: |
                    (java.sql.PreparedStatement $STMT) = ...;
                - pattern: |
                    $VAR = $CONN.prepareStatement(...)
                - pattern: |
                    $PATH.queryForObject(...);
                - pattern: |
                    (java.util.Map<String, Object> $STMT) = $PATH.queryForMap(...);
                - pattern: |
                    (org.springframework.jdbc.support.rowset.SqlRowSet $STMT) = ...;
                - patterns:
                    - pattern-inside: |
                        (String $SQL) = "$SQLSTR" + ...;
                        ...
                    - pattern: $PATH.$SQLCMD(..., $SQL, ...);
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(^SELECT.* | ^INSERT.* | ^UPDATE.*)
                    - metavariable-regex:
                        metavariable: $SQLCMD
                        regex: (execute|query|executeUpdate|batchUpdate)
      pattern-sources:
        - patterns:
            - focus-metavariable: $EVENT
            - pattern-either:
                - pattern: |
                    $HANDLERTYPE $HANDLER($TYPE $EVENT, com.amazonaws.services.lambda.runtime.Context $CONTEXT) {
                      ...
                    }
                - pattern: |
                    $HANDLERTYPE $HANDLER(InputStream $EVENT, OutputStream $OUT, com.amazonaws.services.lambda.runtime.Context $CONTEXT) {
                      ...
                    }
      severity: WARNING
    - id: java.java-jwt.security.audit.jwt-decode-without-verify.java-jwt-decode-without-verify
      languages:
        - java
      message: Detected the decoding of a JWT token without a verify step. JWT tokens must be verified before use, otherwise the token's integrity is unknown. This means a malicious actor could forge a JWT token with any claims. Call '.verify()' before using the token.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      patterns:
        - pattern: |
            com.auth0.jwt.JWT.decode(...);
        - pattern-not-inside: |-
            class $CLASS {
              ...
              $RETURNTYPE $FUNC (...) {
                ...
                $VERIFIER.verify(...);
                ...
              }
            }
      severity: WARNING
    - id: java.java-jwt.security.jwt-hardcode.java-jwt-hardcoded-secret
      languages:
        - java
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - java
            - secrets
            - jwt
      patterns:
        - pattern-either:
            - pattern: |
                (Algorithm $ALG) = $ALGO.$HMAC("$Y");
            - pattern: |
                $SECRET = "$Y";
                ...
                (Algorithm $ALG) = $ALGO.$HMAC($SECRET);
            - pattern: |
                class $CLASS {
                  ...
                  $TYPE $SECRET = "$Y";
                  ...
                  $RETURNTYPE $FUNC (...) {
                    ...
                    (Algorithm $ALG) = $ALGO.$HMAC($SECRET);
                    ...
                  }
                  ...
                }
        - focus-metavariable: $Y
        - metavariable-regex:
            metavariable: $HMAC
            regex: (HMAC384|HMAC256|HMAC512)
      severity: WARNING
    - id: java.java-jwt.security.jwt-none-alg.java-jwt-none-alg
      languages:
        - java
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      pattern-either:
        - pattern: |
            $JWT.sign(com.auth0.jwt.algorithms.Algorithm.none());
        - pattern: |
            $NONE = com.auth0.jwt.algorithms.Algorithm.none();
            ...
            $JWT.sign($NONE);
        - pattern: |-
            class $CLASS {
              ...
              $TYPE $NONE = com.auth0.jwt.algorithms.Algorithm.none();
              ...
              $RETURNTYPE $FUNC (...) {
                ...
                $JWT.sign($NONE);
                ...
              }
              ...
            }
      severity: ERROR
    - id: java.jax-rs.security.insecure-resteasy.insecure-resteasy-deserialization
      languages:
        - java
      message: When a Restful webservice endpoint is configured to use wildcard mediaType {*/*} as a value for the @Consumes annotation, an attacker could abuse the SerializableProvider by sending a HTTP Request with a Content-Type of application/x-java-serialized-object. The body of that request would be processed by the SerializationProvider and could contain a malicious payload, which may lead to arbitrary code execution when calling the $Y.getObject method.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://access.redhat.com/blogs/766093/posts/3162112
        subcategory:
            - audit
        technology:
            - jax-rs
      pattern-either:
        - pattern: |
            @Consumes({"application/x-java-serialized-object"})
        - pattern: |
            @Consumes({"*/*"})
        - pattern: |
            @Consumes("*/*")
        - pattern: |
            @Consumes({MediaType.WILDCARD_TYPE})
      severity: WARNING
    - id: java.jax-rs.security.insecure-resteasy.default-resteasy-provider-abuse
      languages:
        - java
      message: When a Restful webservice endpoint isn't configured with a @Consumes annotation, an attacker could abuse the SerializableProvider by sending a HTTP Request with a Content-Type of application/x-java-serialized-object. The body of that request would be processed by the SerializationProvider and could contain a malicious payload, which may lead to arbitrary code execution. Instead, add a @Consumes annotation to the function or class.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://access.redhat.com/blogs/766093/posts/3162112
        subcategory:
            - audit
        technology:
            - jax-rs
      patterns:
        - pattern: |
            @Path("...")
            public $RETURNTYPE $METHOD(...) { ...}
        - pattern-not-inside: |
            @GET
            public $RETURNTYPE $METHOD(...) { ...}
        - pattern-not-inside: |
            @Path("...")
            @Consumes(...)
            public $RETURNTYPE $METHOD(...) { ...}
        - pattern-not-inside: |
            @Consumes(...)
            public class $CLASSNAME { ... }
      severity: WARNING
    - id: java.jax-rs.security.jax-rs-path-traversal.jax-rs-path-traversal
      languages:
        - java
      message: Detected a potential path traversal. A malicious actor could control the location of this file, to include going backwards in the directory with '../'. To address this, ensure that user-controlled variables in file paths are sanitized. You may also consider using a utility method such as org.apache.commons.io.FilenameUtils.getName(...) to only retrieve the file name from the path.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://www.owasp.org/index.php/Path_Traversal
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PATH_TRAVERSAL_IN
        subcategory:
            - vuln
        technology:
            - jax-rs
      pattern-either:
        - pattern: |
            $RETURNTYPE $FUNC (..., @PathParam(...) $TYPE $VAR, ...) {
              ...
              new File(..., $VAR, ...);
              ...
            }
        - pattern: |-
            $RETURNTYPE $FUNC (..., @javax.ws.rs.PathParam(...) $TYPE $VAR, ...) {
              ...
              new File(..., $VAR, ...);
              ...
            }
      severity: WARNING
    - id: java.jboss.security.session_sqli.find-sql-string-concatenation
      languages:
        - java
      message: In $METHOD, $X is used to construct a SQL query via string concatenation.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - jboss
      pattern-either:
        - pattern: |
            $RETURN $METHOD(...,String $X,...){
              ...
              Session $SESSION = ...;
              ...
              String $QUERY = ... + $X + ...;
              ...
              PreparedStatement $PS = $SESSION.connection().prepareStatement($QUERY);
              ...
              ResultSet $RESULT = $PS.executeQuery();
              ...
            }
        - pattern: |
            $RETURN $METHOD(...,String $X,...){
              ...
              String $QUERY = ... + $X + ...;
              ...
              Session $SESSION = ...;
              ...
              PreparedStatement $PS = $SESSION.connection().prepareStatement($QUERY);
              ...
              ResultSet $RESULT = $PS.executeQuery();
              ...
            }
      severity: ERROR
    - id: java.jjwt.security.jwt-none-alg.jjwt-none-alg
      languages:
        - java
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern: |
            io.jsonwebtoken.Jwts.builder();
        - pattern-not-inside: |-
            $RETURNTYPE $FUNC(...) {
              ...
              $JWTS.signWith(...);
              ...
            }
      severity: ERROR
    - id: java.lang.security.audit.blowfish-insufficient-key-size.blowfish-insufficient-key-size
      languages:
        - java
      message: Using less than 128 bits for Blowfish is considered insecure. Use 128 bits or more, or switch to use AES instead.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#BLOWFISH_KEY_SIZE
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern: |
            $KEYGEN = KeyGenerator.getInstance("Blowfish");
            ...
            $KEYGEN.init($SIZE);
        - metavariable-comparison:
            comparison: $SIZE < 128
            metavariable: $SIZE
      severity: WARNING
    - fix: |
        "AES/GCM/NoPadding"
      id: java.lang.security.audit.cbc-padding-oracle.cbc-padding-oracle
      languages:
        - java
      message: Using CBC with PKCS5Padding is susceptible to padding oracle attacks. A malicious actor could discern the difference between plaintext with valid or invalid padding. Further, CBC mode does not include any integrity checks. Use 'AES/GCM/NoPadding' instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://capec.mitre.org/data/definitions/463.html
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#cipher-modes
            - https://find-sec-bugs.github.io/bugs.htm#CIPHER_INTEGRITY
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PADDING_ORACLE
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-inside: Cipher.getInstance("=~/.*\/CBC\/PKCS5Padding/")
        - pattern: |
            "=~/.*\/CBC\/PKCS5Padding/"
      severity: WARNING
    - id: java.lang.security.audit.command-injection-formatted-runtime-call.command-injection-formatted-runtime-call
      languages:
        - java
      message: A formatted or concatenated string was detected as input to a java.lang.Runtime call. This is dangerous if a variable is controlled by user input and could result in a command injection. Ensure your variables are not controlled by users or sufficiently sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#COMMAND_INJECTION.
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - metavariable-pattern:
            metavariable: $RUNTIME
            patterns:
                - pattern-either:
                    - pattern: (java.lang.Runtime $R)
                    - pattern: java.lang.Runtime.getRuntime(...)
        - pattern-either:
            - pattern: $RUNTIME.exec($X + $Y);
            - pattern: $RUNTIME.exec(String.format(...));
            - pattern: $RUNTIME.loadLibrary($X + $Y);
            - pattern: $RUNTIME.loadLibrary(String.format(...));
            - patterns:
                - pattern-either:
                    - pattern: |
                        $RUNTIME.exec("=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $ARG,...)
                    - pattern: |
                        $RUNTIME.exec(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...),...)
                    - pattern: |
                        $RUNTIME.exec(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...},...)
                    - patterns:
                        - pattern-either:
                            - pattern: |
                                $RUNTIME.exec($CMD,"-c",$ARG,...)
                            - pattern: |
                                $RUNTIME.exec(Arrays.asList($CMD,"-c",$ARG,...),...)
                            - pattern: |
                                $RUNTIME.exec(new String[]{$CMD,"-c",$ARG,...},...)
                        - pattern-inside: |
                            $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";
                            ...
                    - patterns:
                        - pattern-either:
                            - pattern: |
                                $RUNTIME.exec($CMD, $EXECUTE, $ARG, ...)
                        - pattern-inside: |
                            $CMD = new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/", ...};
                            ...
                    - patterns:
                        - pattern-either:
                            - pattern: |
                                $RUNTIME.exec("=~/(sh|bash|ksh|csh|tcsh|zsh)/", $BASH, $ARG,...)
                            - pattern: |
                                $RUNTIME.exec(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/",$BASH,$ARG,...),...)
                            - pattern: |
                                $RUNTIME.exec(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/",$BASH,$ARG,...},...)
                        - pattern-inside: |
                            $BASH = new String[]{"=~/(-c)/", ...};
                            ...
                - pattern-not-inside: |
                    $ARG = "...";
                    ...
                - pattern-not: |
                    $RUNTIME.exec("...","...","...",...)
                - pattern-not: |
                    $RUNTIME.exec(new String[]{"...","...","...",...},...)
                - pattern-not: |
                    $RUNTIME.exec(Arrays.asList("...","...","...",...),...)
      severity: ERROR
    - id: java.lang.security.audit.command-injection-process-builder.command-injection-process-builder
      languages:
        - java
      message: A formatted or concatenated string was detected as input to a ProcessBuilder call. This is dangerous if a variable is controlled by user input and could result in a command injection. Ensure your variables are not controlled by users or sufficiently sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern: |
                new ProcessBuilder($CMD,...)
            - pattern-not-inside: |
                $CMD = "...";
                ...
            - pattern-not-inside: |
                $CMD = Arrays.asList("...",...);
                ...
            - pattern-not-inside: |
                $CMD = new String[]{"...",...};
                ...
            - pattern-not: |
                new ProcessBuilder("...",...)
            - pattern-not: |
                new ProcessBuilder(new String[]{"...",...},...)
            - pattern-not: |
                new ProcessBuilder(Arrays.asList("...",...),...)
        - patterns:
            - pattern: |
                $PB.command($CMD,...)
            - pattern-inside: |
                $TYPE $PB = new ProcessBuilder(...);
                ...
            - pattern-not-inside: |
                $CMD = "...";
                ...
            - pattern-not-inside: |
                $CMD = Arrays.asList("...",...);
                ...
            - pattern-not-inside: |
                $CMD = new String[]{"...",...};
                ...
            - pattern-not: |
                $PB.command("...",...)
            - pattern-not: |
                $PB.command(new String[]{"...",...},...)
            - pattern-not: |
                $PB.command(Arrays.asList("...",...),...)
        - patterns:
            - pattern-either:
                - pattern: |
                    new ProcessBuilder("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...)
                - pattern: |
                    new ProcessBuilder("cmd","/c",$ARG,...)
                - pattern: |
                    new ProcessBuilder(Arrays.asList("cmd","/c",$ARG,...),...)
                - pattern: |
                    new ProcessBuilder(new String[]{"cmd","/c",$ARG,...},...)
                - patterns:
                    - pattern-either:
                        - pattern: |
                            new ProcessBuilder($CMD,"/c",$ARG,...)
                        - pattern: |
                            new ProcessBuilder(Arrays.asList($CMD,"/c",$ARG,...),...)
                        - pattern: |
                            new ProcessBuilder(new String[]{$CMD,"/c",$ARG,...},...)
                    - pattern-inside: |
                        $CMD = "cmd";
                        ...
            - pattern-not-inside: |
                $ARG = "...";
                ...
            - pattern-not: |
                new ProcessBuilder("...","...","...",...)
            - pattern-not: |
                new ProcessBuilder(new String[]{"...","...","...",...},...)
            - pattern-not: |
                new ProcessBuilder(Arrays.asList("...","...","...",...),...)
        - patterns:
            - pattern-either:
                - pattern: |
                    $PB.command("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...)
                - pattern: |
                    $PB.command("cmd","/c",$ARG,...)
                - pattern: |
                    $PB.command(Arrays.asList("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...),...)
                - pattern: |
                    $PB.command(Arrays.asList("cmd","/c",$ARG,...),...)
                - pattern: |
                    $PB.command(new String[]{"=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$ARG,...},...)
                - pattern: |
                    $PB.command(new String[]{"cmd","/c",$ARG,...},...)
                - patterns:
                    - pattern-either:
                        - pattern: |
                            $PB.command($CMD,"-c",$ARG,...)
                        - pattern: |
                            $PB.command(Arrays.asList($CMD,"-c",$ARG,...),...)
                        - pattern: |
                            $PB.command(new String[]{$CMD,"-c",$ARG,...},...)
                    - pattern-inside: |
                        $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/";
                        ...
                - patterns:
                    - pattern-either:
                        - pattern: |
                            $PB.command($CMD,"/c",$ARG,...)
                        - pattern: |
                            $PB.command(Arrays.asList($CMD,"/c",$ARG,...),...)
                        - pattern: |
                            $PB.command(new String[]{$CMD,"/c",$ARG,...},...)
                    - pattern-inside: |
                        $CMD = "cmd";
                        ...
            - pattern-inside: |
                $TYPE $PB = new ProcessBuilder(...);
                ...
            - pattern-not-inside: |
                $ARG = "...";
                ...
            - pattern-not: |
                $PB.command("...","...","...",...)
            - pattern-not: |
                $PB.command(new String[]{"...","...","...",...},...)
            - pattern-not: |
                $PB.command(Arrays.asList("...","...","...",...),...)
      severity: ERROR
    - id: java.lang.security.audit.crlf-injection-logs.crlf-injection-logs
      languages:
        - java
      message: When data from an untrusted source is put into a logger and not neutralized correctly, an attacker could forge log entries or include malicious content.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-93: Improper Neutralization of CRLF Sequences (''CRLF Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#CRLF_INJECTION_LOGS
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    class $CLASS {
                      ...
                      Logger $LOG = ...;
                      ...
                    }
                - pattern-either:
                    - pattern-inside: |
                        $X $METHOD(...,HttpServletRequest $REQ,...) {
                          ...
                        }
                    - pattern-inside: |
                        $X $METHOD(...,ServletRequest $REQ,...) {
                          ...
                        }
                    - pattern-inside: |
                        $X $METHOD(...) {
                          ...
                          HttpServletRequest $REQ = ...;
                          ...
                        }
                    - pattern-inside: |
                        $X $METHOD(...) {
                          ...
                          ServletRequest $REQ = ...;
                          ...
                        }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  Logger $LOG = ...;
                  ...
                  HttpServletRequest $REQ = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  Logger $LOG = ...;
                  ...
                  ServletRequest $REQ = ...;
                  ...
                }
        - pattern-either:
            - pattern: |
                String $VAL = $REQ.getParameter(...);
                ...
                $LOG.$LEVEL(<... $VAL ...>);
            - pattern: |
                String $VAL = $REQ.getParameter(...);
                ...
                $LOG.log($LEVEL,<... $VAL ...>);
            - pattern: |
                $LOG.$LEVEL(<... $REQ.getParameter(...) ...>);
            - pattern: |
                $LOG.log($LEVEL,<... $REQ.getParameter(...) ...>);
      severity: WARNING
    - fix: |
        "AES/GCM/NoPadding"
      id: java.lang.security.audit.crypto.des-is-deprecated.des-is-deprecated
      languages:
        - java
        - kt
      message: DES is considered deprecated. AES is the recommended cipher. Upgrade to use AES. See https://www.nist.gov/news-events/news/2005/06/nist-withdraws-outdated-data-encryption-standard for more information.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::symmetric-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.nist.gov/news-events/news/2005/06/nist-withdraws-outdated-data-encryption-standard
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#DES_USAGE
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern-inside: $CIPHER.getInstance("=~/DES/.*/")
            - pattern-inside: $CIPHER.getInstance("DES")
        - pattern-either:
            - pattern: |
                "=~/DES/.*/"
            - pattern: |
                "DES"
      severity: WARNING
    - id: java.lang.security.audit.crypto.desede-is-deprecated.desede-is-deprecated
      languages:
        - java
        - kt
      message: Triple DES (3DES or DESede) is considered deprecated. AES is the recommended cipher. Upgrade to use AES.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::symmetric-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://csrc.nist.gov/News/2017/Update-to-Current-Use-and-Deprecation-of-TDEA
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#TDES_USAGE
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: |
                $CIPHER.getInstance("=~/DESede.*/")
            - pattern: |
                $CRYPTO.KeyGenerator.getInstance("DES")
      severity: WARNING
    - id: java.lang.security.audit.crypto.ecb-cipher.ecb-cipher
      languages:
        - java
      message: Cipher in ECB mode is detected. ECB mode produces the same output for the same input each time which allows an attacker to intercept and replay the data. Further, ECB mode does not provide any integrity checking. See https://find-sec-bugs.github.io/bugs.htm#CIPHER_INTEGRITY.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::mode::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#ECB_MODE
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern: |
            Cipher $VAR = $CIPHER.getInstance($MODE);
        - metavariable-regex:
            metavariable: $MODE
            regex: .*ECB.*
      severity: WARNING
    - id: java.lang.security.audit.crypto.gcm-detection.gcm-detection
      languages:
        - java
      message: GCM detected, please check that IV/nonce is not reused, an Initialization Vector (IV) is a nonce used to randomize the encryption, so that even if multiple messages with identical plaintext are encrypted, the generated corresponding ciphertexts are different. Unlike the Key, the IV usually does not need to be secret, rather it is important that it is random and unique. Certain encryption schemes the IV is exchanged in public as part of the ciphertext. Reusing same Initialization Vector with the same Key to encrypt multiple plaintext blocks allows an attacker to compare the ciphertexts and then, with some assumptions on the content of the messages, to gain important information about the data being encrypted.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-323: Reusing a Nonce, Key Pair in Encryption'
        functional-categories:
            - crypto::search::randomness::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/323.html
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: $METHOD.getInstance("AES/GCM/NoPadding",...);
            - pattern: new GCMParameterSpec(...);
      severity: INFO
    - id: java.lang.security.audit.crypto.gcm-nonce-reuse.gcm-nonce-reuse
      languages:
        - java
      message: 'GCM IV/nonce is reused: encryption can be totally useless'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-323: Reusing a Nonce, Key Pair in Encryption'
        functional-categories:
            - crypto::search::randomness::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://www.youtube.com/watch?v=r1awgAl90wM
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: new GCMParameterSpec(..., "...".getBytes(...), ...);
            - pattern: byte[] $NONCE = "...".getBytes(...); ... new GCMParameterSpec(..., $NONCE, ...);
      severity: ERROR
    - id: java.lang.security.audit.crypto.no-null-cipher.no-null-cipher
      languages:
        - java
      message: 'NullCipher was detected. This will not encrypt anything; the cipher text will be the same as the plain text. Use a valid, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#NULL_CIPHER
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: new NullCipher(...);
            - pattern: new javax.crypto.NullCipher(...);
      severity: WARNING
    - id: java.lang.security.audit.crypto.no-static-initialization-vector.no-static-initialization-vector
      languages:
        - java
      message: Initialization Vectors (IVs) for block ciphers should be randomly generated each time they are used. Using a static IV means the same plaintext encrypts to the same ciphertext every time, weakening the strength of the encryption.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-329: Generation of Predictable IV with CBC Mode'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/329.html
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#STATIC_IV
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: |
            byte[] $IV = {
                ...
            };
            ...
            new IvParameterSpec($IV, ...);
        - pattern: |
            class $CLASS {
                byte[] $IV = {
                    ...
                };
                ...
                $METHOD(...) {
                    ...
                    new IvParameterSpec($IV, ...);
                    ...
                }
            }
      severity: WARNING
    - id: java.lang.security.audit.crypto.rsa-no-padding.rsa-no-padding
      languages:
        - java
        - kt
      message: Using RSA without OAEP mode weakens the encryption.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::mode::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://rdist.root.org/2009/10/06/why-rsa-encryption-padding-is-critical/
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#RSA_NO_PADDING
        subcategory:
            - vuln
        technology:
            - java
            - kotlin
      pattern: $CIPHER.getInstance("=~/RSA/[Nn][Oo][Nn][Ee]/NoPadding/")
      severity: WARNING
    - id: java.lang.security.audit.crypto.ssl.avoid-implementing-custom-digests.avoid-implementing-custom-digests
      languages:
        - java
      message: 'Cryptographic algorithms are notoriously difficult to get right. By implementing a custom message digest, you risk introducing security issues into your program. Use one of the many sound message digests already available to you: MessageDigest sha256Digest = MessageDigest.getInstance("SHA256");'
      metadata:
        asvs:
            control_id: 6.2.2 Insecure Custom Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#custom-algorithms
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#CUSTOM_MESSAGE_DIGEST
        subcategory:
            - audit
        technology:
            - java
      pattern: |-
        class $CLASS extends MessageDigest {
          ...
        }
      severity: WARNING
    - id: java.lang.security.audit.crypto.ssl.insecure-hostname-verifier.insecure-hostname-verifier
      languages:
        - java
      message: Insecure HostnameVerifier implementation detected. This will accept any SSL certificate with any hostname, which creates the possibility for man-in-the-middle attacks.
      metadata:
        asvs:
            control_id: 9.2.1 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_HOSTNAME_VERIFIER
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - pattern: |
            class $CLASS implements HostnameVerifier {
              ...
              public boolean verify(...) { return true; }
            }
        - pattern: |-
            new HostnameVerifier(...){
              public boolean verify(...) {
                return true;
              }
            }
        - pattern: import org.apache.http.conn.ssl.NoopHostnameVerifier;
      severity: WARNING
    - id: java.lang.security.audit.crypto.ssl.insecure-trust-manager.insecure-trust-manager
      languages:
        - java
      message: Detected empty trust manager implementations. This is dangerous because it accepts any certificate, enabling man-in-the-middle attacks. Consider using a KeyStore and TrustManagerFactory instead. See https://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https for more information.
      metadata:
        asvs:
            control_id: 9.2.1 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_TRUST_MANAGER
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern-inside: |
                class $CLASS implements X509TrustManager {
                  ...
                }
            - pattern-inside: |
                new X509TrustManager() {
                  ...
                }
            - pattern-inside: |
                class $CLASS implements X509ExtendedTrustManager {
                  ...
                }
            - pattern-inside: |
                new X509ExtendedTrustManager() {
                  ...
                }
        - pattern-not: public void checkClientTrusted(...) { $SOMETHING; }
        - pattern-not: public void checkServerTrusted(...) { $SOMETHING; }
        - pattern-either:
            - pattern: public void checkClientTrusted(...) {}
            - pattern: public void checkServerTrusted(...) {}
            - pattern: public X509Certificate[] getAcceptedIssuers(...) { return null; }
      severity: WARNING
    - id: java.lang.security.audit.crypto.unencrypted-socket.unencrypted-socket
      languages:
        - java
      message: Detected use of a Java socket that is not encrypted. As a result, the traffic could be read by an attacker intercepting the network traffic. Use an SSLSocket created by 'SSLSocketFactory' or 'SSLServerSocketFactory' instead.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        functional-categories:
            - net::search::crypto-config::java.net
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNENCRYPTED_SOCKET
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: new ServerSocket(...)
        - pattern: new Socket(...)
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-aes-ecb.use-of-aes-ecb
      languages:
        - java
      message: 'Use of AES with ECB mode detected. ECB doesn''t provide message confidentiality and  is not semantically secure so should not be used. Instead, use a strong, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::mode::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        subcategory:
            - vuln
        technology:
            - java
      pattern: $CIPHER.getInstance("=~/AES/ECB.*/")
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-blowfish.use-of-blowfish
      languages:
        - java
      message: 'Use of Blowfish was detected. Blowfish uses a 64-bit block size that  makes it vulnerable to birthday attacks, and is therefore considered non-compliant.  Instead, use a strong, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        subcategory:
            - vuln
        technology:
            - java
      pattern: $CIPHER.getInstance("Blowfish")
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-default-aes.use-of-default-aes
      languages:
        - java
      message: 'Use of AES with no settings detected. By default, java.crypto.Cipher uses ECB mode. ECB doesn''t  provide message confidentiality and is not semantically secure so should not be used. Instead, use a strong, secure cipher: java.crypto.Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::mode::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import javax;
                    ...
            - pattern-either:
                - pattern: javax.crypto.Cipher.getInstance("AES")
                - pattern: (javax.crypto.Cipher $CIPHER).getInstance("AES")
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import javax.*;
                    ...
                - pattern-inside: |
                    import javax.crypto;
                    ...
            - pattern-either:
                - pattern: crypto.Cipher.getInstance("AES")
                - pattern: (crypto.Cipher $CIPHER).getInstance("AES")
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import javax.crypto.*;
                    ...
                - pattern-inside: |
                    import javax.crypto.Cipher;
                    ...
            - pattern-either:
                - pattern: Cipher.getInstance("AES")
                - pattern: (Cipher $CIPHER).getInstance("AES")
      severity: WARNING
    - fix: |
        getSha512Digest
      id: java.lang.security.audit.crypto.use-of-md5-digest-utils.use-of-md5-digest-utils
      languages:
        - java
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use HMAC instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-328: Use of Weak Hash'
        functional-categories:
            - crypto::search::hash-algorithm::org.apache.commons
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_MD5
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern: |
            $DU.$GET_ALGO().digest(...)
        - metavariable-pattern:
            metavariable: $GET_ALGO
            pattern: getMd5Digest
        - metavariable-pattern:
            metavariable: $DU
            pattern: DigestUtils
        - focus-metavariable: $GET_ALGO
      severity: WARNING
    - fix: |
        "SHA-512"
      id: java.lang.security.audit.crypto.use-of-md5.use-of-md5
      languages:
        - java
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use HMAC instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-328: Use of Weak Hash'
        functional-categories:
            - crypto::search::hash-algorithm::java.security
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_MD5
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern: |
            java.security.MessageDigest.getInstance($ALGO, ...);
        - metavariable-regex:
            metavariable: $ALGO
            regex: (.MD5.)
        - focus-metavariable: $ALGO
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-rc2.use-of-rc2
      languages:
        - java
      message: 'Use of RC2 was detected. RC2 is vulnerable to related-key attacks, and is therefore considered non-compliant. Instead, use a strong, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        subcategory:
            - vuln
        technology:
            - java
      pattern: $CIPHER.getInstance("RC2")
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-rc4.use-of-rc4
      languages:
        - java
      message: 'Use of RC4 was detected. RC4 is vulnerable to several attacks, including stream cipher attacks and bit flipping attacks. Instead, use a strong, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        subcategory:
            - vuln
        technology:
            - java
      pattern: $CIPHER.getInstance("RC4")
      severity: WARNING
    - id: java.lang.security.audit.crypto.use-of-sha1.use-of-sha1
      languages:
        - java
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Instead, use PBKDF2 for password hashing or SHA256 or SHA512 for other hash function applications.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-328: Use of Weak Hash'
        functional-categories:
            - crypto::search::hash-algorithm::javax.crypto
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_SHA1
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern: |
                java.security.MessageDigest.getInstance("$ALGO", ...);
            - metavariable-regex:
                metavariable: $ALGO
                regex: (SHA1|SHA-1)
        - pattern: |
            $DU.getSha1Digest().digest(...)
      severity: WARNING
    - id: java.lang.security.audit.crypto.weak-random.weak-random
      languages:
        - java
      message: Detected use of the functions `Math.random()` or `java.util.Random()`. These are both not cryptographically strong random number generators (RNGs). If you are using these RNGs to create passwords or secret tokens, use `java.security.SecureRandom` instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-330: Use of Insufficiently Random Values'
        functional-categories:
            - crypto::search::randomness::java.security
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - pattern: |
            new java.util.Random(...).$FUNC(...)
        - pattern: |
            java.lang.Math.random(...)
      severity: WARNING
    - id: java.lang.security.audit.crypto.weak-rsa.use-of-weak-rsa-key
      languages:
        - java
      message: RSA keys should be at least 2048 bits based on NIST recommendation.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::key-length::java.security
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#RSA_KEY_SIZE
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern: |
            KeyPairGenerator $KEY = $G.getInstance("RSA");
            ...
            $KEY.initialize($BITS);
        - metavariable-comparison:
            comparison: $BITS < 2048
            metavariable: $BITS
      severity: WARNING
    - id: java.lang.security.audit.dangerous-groovy-shell.dangerous-groovy-shell
      languages:
        - java
      message: A expression is built with a dynamic value. The source of the value(s) should be verified to avoid that unfiltered values fall into this risky code evaluation.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#GROOVY_SHELL
        subcategory:
            - audit
        technology:
            - groovy
      patterns:
        - pattern-either:
            - pattern: |
                $SHELL.parse(...)
            - pattern: |
                $SHELL.evaluate(...)
            - pattern: |
                $SHELL.parseClass(...)
        - pattern-either:
            - pattern-inside: |
                groovy.lang.GroovyShell $SHELL = ...;
                ...
            - pattern-inside: |
                groovy.lang.GroovyClassLoader $SHELL = ...;
                ...
        - pattern-not: |
            $SHELL.parse("...",...)
        - pattern-not: |
            $SHELL.evaluate("...",...)
        - pattern-not: |
            $SHELL.parseClass("...",...)
      severity: WARNING
    - id: java.lang.security.audit.el-injection.el-injection
      languages:
        - java
      message: An expression is built with a dynamic value. The source of the value(s) should be verified to avoid that unfiltered values fall into this risky code evaluation.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#EL_INJECTION
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: |
                class $CLASS {
                  ...
                  ExpressionFactory $EF;
                  ...
                  $X $METHOD(...) {
                    ...
                    $EF.createValueExpression($CTX,$INPUT,...);
                    ...
                  }
                  ...
                }
            - pattern: |
                class $CLASS {
                  ...
                  ExpressionFactory $EF = ...;
                  ...
                  $X $METHOD(...) {
                    ...
                    $EF.createValueExpression($CTX,$INPUT,...);
                    ...
                  }
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ExpressionFactory $EF = ...;
                  ...
                  $EF.createValueExpression($CTX,$INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ExpressionFactory $EF,...) {
                  ...
                  $EF.createValueExpression($CTX,$INPUT,...);
                  ...
                }
            - pattern: |
                class $CLASS {
                  ...
                  ExpressionFactory $EF;
                  ...
                  $X $METHOD(...) {
                    ...
                    $EF.createMethodExpression($CTX,$INPUT,...);
                    ...
                  }
                  ...
                }
            - pattern: |
                class $CLASS {
                  ...
                  ExpressionFactory $EF = ...;
                  ...
                  $X $METHOD(...) {
                    ...
                    $EF.createMethodExpression($CTX,$INPUT,...);
                    ...
                  }
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ExpressionFactory $EF = ...;
                  ...
                  $EF.createMethodExpression($CTX,$INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ExpressionFactory $EF,...) {
                  ...
                  $EF.createMethodExpression($CTX,$INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(String $INPUT, ...) {
                  ...
                  $OBJECT.buildConstraintViolationWithTemplate($INPUT, ...);
                  ...
                }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $EF.createValueExpression($CTX,"...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $EF.createValueExpression($CTX,$S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $EF.createMethodExpression($CTX,"...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $EF.createMethodExpression($CTX,$S,...);
              ...
            }
      severity: WARNING
    - id: java.lang.security.audit.formatted-sql-string.formatted-sql-string
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        asvs:
            control_id: 5.3.5 Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
            - https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html#create_ps
            - https://software-security.sans.org/developer-how-to/fix-sql-injection-in-java-using-prepared-callable-statement
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      options:
        taint_assume_safe_booleans: true
        taint_assume_safe_numbers: true
      pattern-propagators:
        - from: $X
          pattern: (StringBuffer $S).append($X)
          to: $S
        - from: $X
          pattern: (StringBuilder $S).append($X)
          to: $S
      pattern-sanitizers:
        - patterns:
            - pattern: (CriteriaBuilder $CB).$ANY(...)
      pattern-sinks:
        - patterns:
            - pattern-not: $S.$SQLFUNC(<... "=~/.*TABLE *$/" ...>)
            - pattern-not: $S.$SQLFUNC(<... "=~/.*TABLE %s$/" ...>)
            - pattern-either:
                - pattern: (Statement $S).$SQLFUNC(...)
                - pattern: (PreparedStatement $P).$SQLFUNC(...)
                - pattern: (Connection $C).createStatement(...).$SQLFUNC(...)
                - pattern: (Connection $C).prepareStatement(...).$SQLFUNC(...)
                - pattern: (EntityManager $EM).$SQLFUNC(...)
            - metavariable-regex:
                metavariable: $SQLFUNC
                regex: execute|executeQuery|createQuery|query|addBatch|nativeSQL|create|prepare
          requires: CONCAT
      pattern-sources:
        - label: INPUT
          patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
                - patterns:
                    - pattern-inside: |
                        $ANNOT $FUNC (..., $INPUT, ...) {
                          ...
                        }
                    - pattern: (String $INPUT)
            - focus-metavariable: $INPUT
        - label: CONCAT
          patterns:
            - pattern-either:
                - pattern: $X + $INPUT
                - pattern: $X += $INPUT
                - pattern: $STRB.append($INPUT)
                - pattern: String.format(..., $INPUT, ...)
                - pattern: String.join(..., $INPUT, ...)
                - pattern: (String $STR).concat($INPUT)
                - pattern: $INPUT.concat(...)
                - pattern: new $STRB(..., $INPUT, ...)
          requires: INPUT
      severity: ERROR
    - id: java.lang.security.audit.http-response-splitting.http-response-splitting
      languages:
        - java
      message: Older Java application servers are vulnerable to HTTP response splitting, which may occur if an HTTP request can be injected with CRLF characters. This finding is reported for completeness; it is recommended to ensure your environment is not affected by testing this yourself.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers (''HTTP Request/Response Splitting'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.owasp.org/index.php/HTTP_Response_Splitting
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#HTTP_RESPONSE_SPLITTING
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: |
            $VAR = $REQ.getParameter(...);
            ...
            $COOKIE = new Cookie(..., $VAR, ...);
            ...
            $RESP.addCookie($COOKIE, ...);
        - patterns:
            - pattern-inside: |
                $RETTYPE $FUNC(...,@PathVariable $TYPE $VAR, ...) {
                  ...
                }
            - pattern: |
                $COOKIE = new Cookie(..., $VAR, ...);
                ...
                $RESP.addCookie($COOKIE, ...);
      severity: INFO
    - id: java.lang.security.audit.insecure-smtp-connection.insecure-smtp-connection
      languages:
        - java
      message: Insecure SMTP connection detected. This connection will trust any SSL certificate. Enable certificate verification by setting 'email.setSSLCheckServerIdentity(true)'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-297: Improper Validation of Certificate with Host Mismatch'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#INSECURE_SMTP_SSL
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-not-inside: |
            $EMAIL.setSSLCheckServerIdentity(true);
            ...
        - pattern-inside: |
            $EMAIL = new SimpleEmail(...);
            ...
        - pattern: $EMAIL.send(...);
      severity: WARNING
    - id: java.lang.security.audit.java-reverse-shell.java-reverse-shell
      languages:
        - java
      message: Semgrep found potential reverse shell behavior
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: |
                Socket $S=new Socket(...);
                ...
                InputStream $SI = $S.getInputStream();
                ...
                while(!$S.isClosed())
                {
                  ...
                  while($SI.available()>0)$PO.write($SI.read());
                  ...
                  $SO.flush();
                  ...
                }
        - pattern-inside: |
            Process $P=new ProcessBuilder(...).redirectErrorStream(true).start();
            ...
            $P.destroy();
      severity: WARNING
    - id: java.lang.security.audit.jdbc-sql-formatted-string.jdbc-sql-formatted-string
      languages:
        - java
      message: 'Possible JDBC injection detected. Use the parameterized query feature available in queryForObject instead of concatenating or formatting strings: ''jdbc.queryForObject("select * from table where name = ?", Integer.class, parameterName);'''
      metadata:
        asvs:
            control_id: 5.3.5 Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION_SPRING_JDBC
        subcategory:
            - audit
        technology:
            - jdbc
      patterns:
        - pattern-inside: |
            $JDBC = new JdbcTemplate(...);
            ...
        - pattern-either:
            - pattern: $JDBC.queryForObject($STR + $VAR, ...);
            - pattern: $JDBC.queryForObject(String.format(...), ...);
            - pattern: |
                String $Q = $STR + $VAR;
                ...
                $JDBC.queryForObject($Q, ...);
            - pattern: |
                String $Q = String.format(...);
                ...
                $JDBC.queryForObject($Q, ...);
            - pattern: |
                StringBuilder $Q = new StringBuilder(...);
                ...
                $Q.append($STR + $VAR);
                ...
                $JDBC.queryForObject($Q, ...);
            - pattern: $JDBC.queryForList($STR + $VAR);
            - pattern: $JDBC.queryForList(String.format(...));
            - pattern: |
                String $Q = $STR + $VAR;
                ...
                $JDBC.queryForList($Q);
            - pattern: |
                String $Q = String.format(...);
                ...
                $JDBC.queryForList($Q);
            - pattern: |
                StringBuilder $Q = new StringBuilder(...);
                ...
                $Q.append($STR + $VAR);
                ...
                $JDBC.queryForList($Q, ...);
            - pattern: $JDBC.update($STR + $VAR);
            - pattern: $JDBC.update(String.format(...));
            - pattern: |
                String $Q = $STR + $VAR;
                ...
                $JDBC.update($Q);
            - pattern: |
                String $Q = String.format(...);
                ...
                $JDBC.update($Q);
            - pattern: |
                StringBuilder $Q = new StringBuilder(...);
                ...
                $Q.append($STR + $VAR);
                ...
                $JDBC.update($Q, ...);
            - pattern: $JDBC.execute($STR + $VAR);
            - pattern: $JDBC.execute(String.format(...));
            - pattern: |
                String $Q = $STR + $VAR;
                ...
                $JDBC.execute($Q);
            - pattern: |
                String $Q = String.format(...);
                ...
                $JDBC.execute($Q);
            - pattern: |
                StringBuilder $Q = new StringBuilder(...);
                ...
                $Q.append($STR + $VAR);
                ...
                $JDBC.execute($Q, ...);
            - pattern: $JDBC.insert($STR + $VAR);
            - pattern: $JDBC.insert(String.format(...));
            - pattern: |
                String $Q = $STR + $VAR;
                ...
                $JDBC.insert($Q);
            - pattern: |
                String $Q = String.format(...);
                ...
                $JDBC.insert($Q);
            - pattern: |
                StringBuilder $Q = new StringBuilder(...);
                ...
                $Q.append($STR + $VAR);
                ...
                $JDBC.insert($Q, ...);
      severity: WARNING
    - id: java.lang.security.audit.ldap-entry-poisoning.ldap-entry-poisoning
      languages:
        - java
      message: An object-returning LDAP search will allow attackers to control the LDAP response. This could lead to Remote Code Execution.
      metadata:
        asvs:
            control_id: 5.3.7 Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query (''LDAP Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf
            - https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - pattern: |
            new SearchControls($S, $CL, $TL, $AT, true, $DEREF)
        - pattern: |
            SearchControls $VAR = new SearchControls();
            ...
            $VAR.setReturningObjFlag(true);
      severity: WARNING
    - id: java.lang.security.audit.ldap-injection.ldap-injection
      languages:
        - java
      message: Detected non-constant data passed into an LDAP query. If this data can be controlled by an external user, this is an LDAP injection. Ensure data passed to an LDAP query is not controllable; or properly sanitize the data.
      metadata:
        asvs:
            control_id: 5.3.7 Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query (''LDAP Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_INJECTION
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  InitialDirContext $CTX = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  DirContext $CTX = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  InitialLdapContext $CTX = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  LdapContext $CTX = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  LdapCtx $CTX = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  EventDirContext $CTX = ...;
                  ...
                }
        - pattern: |
            $X $METHOD(...) {
              ...
              $CTX.search($Y,$INPUT,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $CTX.search($Y,"...",...);
              ...
            }
      severity: WARNING
    - id: java.lang.security.audit.md5-used-as-password.md5-used-as-password
      languages:
        - java
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Use a suitable password hashing function such as PBKDF2 or bcrypt. You can use `javax.crypto.SecretKeyFactory` with `SecretKeyFactory.getInstance("PBKDF2WithHmacSHA1")` or, if using Spring, `org.springframework.security.crypto.bcrypt`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
            - https://github.com/returntocorp/semgrep-rules/issues/1609
            - https://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html#SecretKeyFactory
            - https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html
        subcategory:
            - vuln
        technology:
            - java
            - md5
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $MODEL.$METHOD(...);
            - metavariable-regex:
                metavariable: $METHOD
                regex: (?i)(.*password.*)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $TYPE $MD = MessageDigest.getInstance("MD5");
                ...
            - pattern: $MD.digest(...);
      severity: WARNING
    - id: java.lang.security.audit.object-deserialization.object-deserialization
      languages:
        - java
      message: Found object deserialization using ObjectInputStream. Deserializing entire Java objects is dangerous because malicious actors can create Java object streams with unintended consequences. Ensure that the objects being deserialized are not user-controlled. If this must be done, consider using HMACs to sign the data stream to make sure it is not tampered with, or consider only transmitting object fields and populating a new object.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://www.owasp.org/index.php/Deserialization_of_untrusted_data
            - https://www.oracle.com/java/technologies/javase/seccodeguide.html#8
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#OBJECT_DESERIALIZATION
        subcategory:
            - audit
        technology:
            - java
      pattern: new ObjectInputStream(...);
      severity: WARNING
    - id: java.lang.security.audit.ognl-injection.ognl-injection
      languages:
        - java
      message: A expression is built with a dynamic value. The source of the value(s) should be verified to avoid that unfiltered values fall into this risky code evaluation.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#OGNL_INJECTION
        subcategory:
            - audit
        technology:
            - ognl
      patterns:
        - pattern-either:
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.getGetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.getSetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.getField($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlReflectionProvider $P,...) {
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.getGetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.getSetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.getField($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ReflectionProvider $P,...) {
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,TextParseUtil $P,...) {
                  ...
                  $P.translateVariables($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,TextParseUtil $P,...) {
                  ...
                  $P.translateVariablesCollection($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,TextParseUtil $P,...) {
                  ...
                  $P.shallBeIncluded($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,TextParseUtil $P,...) {
                  ...
                  $P.commaDelimitedStringToSet($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,TextParser $P,...) {
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlTextParser $P,...) {
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.callMethod($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlUtil $P,...) {
                  ...
                  $P.compile($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,VelocityStrutsUtil $P,...) {
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.isTrue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.findString($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.getText($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.translateVariables($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,StrutsUtil $P,...) {
                  ...
                  $P.makeSelectList($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,OgnlTool $P,...) {
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ValueStack $P,...) {
                  ...
                  $P.findString($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ValueStack $P,...) {
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ValueStack $P,...) {
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...,ValueStack $P,...) {
                  ...
                  $P.setParameter($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.getGetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.getSetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.getField($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlReflectionProvider $P = ...;
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.getGetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.getSetMethod($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.getField($T, $INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ReflectionProvider $P = ...;
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  TextParseUtil $P = ...;
                  ...
                  $P.translateVariables($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  TextParseUtil $P = ...;
                  ...
                  $P.translateVariablesCollection($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  TextParseUtil $P = ...;
                  ...
                  $P.shallBeIncluded($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  TextParseUtil $P = ...;
                  ...
                  $P.commaDelimitedStringToSet($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  TextParser $P = ...;
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlTextParser $P = ...;
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.setProperties($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.setProperty($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.getValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.callMethod($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlUtil $P = ...;
                  ...
                  $P.compile($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  VelocityStrutsUtil $P = ...;
                  ...
                  $P.evaluate($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.isTrue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.findString($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.getText($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.translateVariables($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  StrutsUtil $P = ...;
                  ...
                  $P.makeSelectList($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  OgnlTool $P = ...;
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ValueStack $P = ...;
                  ...
                  $P.findString($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ValueStack $P = ...;
                  ...
                  $P.findValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ValueStack $P = ...;
                  ...
                  $P.setValue($INPUT,...);
                  ...
                }
            - pattern: |
                $X $METHOD(...) {
                  ...
                  ValueStack $P = ...;
                  ...
                  $P.setParameter($INPUT,...);
                  ...
                }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.getGetMethod($T,"...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.getSetMethod($T,"...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.getField($T,"...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.setProperties("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.setProperty("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.getValue("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.setValue("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.translateVariables("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.translateVariablesCollection("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.shallBeIncluded("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.commaDelimitedStringToSet("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.evaluate("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.callMethod("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.compile("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.isTrue("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.findString("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.findValue("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.getText("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.makeSelectList("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $P.setParameter("...",...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.getGetMethod($T,$S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.getSetMethod($T,$S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.getField($T,$S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.setProperties($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.setProperty($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.getValue($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.setValue($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.translateVariables($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.translateVariablesCollection($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.shallBeIncluded($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.commaDelimitedStringToSet($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.evaluate($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.callMethod($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.compile($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.isTrue($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.findString($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.findValue($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.getText($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.makeSelectList($S,...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $P.setParameter($S,...);
              ...
            }
      severity: WARNING
    - id: java.lang.security.audit.permissive-cors.permissive-cors
      languages:
        - java
      message: https://find-sec-bugs.github.io/bugs.htm#PERMISSIVE_CORS Permissive CORS policy will allow a malicious application to communicate with the victim application in an inappropriate way, leading to spoofing, data theft, relay and other attacks.
      metadata:
        asvs:
            control_id: 14.4.8 Permissive CORS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x22-V14-Config.md#v144-http-security-headers-requirements
            section: 'V14: Configuration Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-183: Permissive List of Allowed Inputs'
        impact: LOW
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - pattern: |
            HttpServletResponse $RES = ...;
            ...
            $RES.addHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
        - pattern: |
            HttpServletResponse $RES = ...;
            ...
            $RES.setHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
        - pattern: |
            ServerHttpResponse $RES = ...;
            ...
            $RES.getHeaders().add("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
        - pattern: |
            HttpHeaders $HEADERS = ...;
            ...
            $HEADERS.set("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
        - pattern: |
            ServerWebExchange $SWE = ...;
            ...
            $SWE.getResponse().getHeaders().add("Access-Control-Allow-Origin", "*");
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...) {
              ...
              $RES.addHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...) {
              ...
              $RES.setHeader("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
              ...
            }
        - pattern: |
            $X $METHOD(...,ServerHttpResponse $RES,...) {
              ...
              $RES.getHeaders().add("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
              ...
            }
        - pattern: |
            $X $METHOD(...,ServerWebExchange $SWE,...) {
              ...
              $SWE.getResponse().getHeaders().add("=~/access-control-allow-origin/i", "=~/^\*|null$/i");
              ...
            }
        - pattern: ResponseEntity.$RES().header("=~/access-control-allow-origin/i", "=~/^\*|null$/i")
        - pattern: ServerResponse.$RES().header("=~/access-control-allow-origin/i", "=~/^\*|null$/i")
      severity: WARNING
    - id: java.lang.security.audit.script-engine-injection.script-engine-injection
      languages:
        - java
      message: Detected potential code injection using ScriptEngine. Ensure user-controlled data cannot enter '.eval()', otherwise, this is a code injection vulnerability.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SCRIPT_ENGINE_INJECTION
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern-inside: |
                class $CLASS {
                  ...
                  ScriptEngine $SE;
                  ...
                }
            - pattern-inside: |
                class $CLASS {
                  ...
                  ScriptEngine $SE = ...;
                  ...
                }
            - pattern-inside: |
                $X $METHOD(...) {
                  ...
                  ScriptEngine $SE = ...;
                  ...
                }
        - pattern: |
            $X $METHOD(...) {
              ...
              $SE.eval(...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              $SE.eval("...");
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              String $S = "...";
              ...
              $SE.eval($S);
              ...
            }
      severity: WARNING
    - id: java.lang.security.audit.sqli.hibernate-sqli.hibernate-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        asvs:
            control_id: 5.3.5 Insecure Custom Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: V5 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SQL_INJECTION_HIBERNATE
        subcategory:
            - audit
        technology:
            - hibernate
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    String $SQL = $X + $Y;
                    ...
                - pattern-inside: |
                    String $SQL = String.format(...);
                    ...
                - pattern-inside: |
                    $VAL $FUNC(...,String $SQL,...) {
                    ...
                    }
            - pattern-not-inside: |
                String $SQL = "..." + "...";
                ...
            - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($SQL,...)
        - pattern: org.hibernate.criterion.Restrictions.sqlRestriction(String.format(...),...)
        - patterns:
            - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($X + $Y,...)
            - pattern-not: org.hibernate.criterion.Restrictions.sqlRestriction("..." + "...",...)
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            String $SQL = $X + $Y;
                            ...
                        - pattern-inside: |
                            String $SQL = String.format(...);
                            ...
                        - pattern-inside: |
                            $TYPE $FUNC(...,String $SQL,...) {
                              ...
                            }
                    - pattern-not-inside: |
                        String $SQL = "..." + "...";
                        ...
                    - pattern: $SESSION.$METHOD($SQL,...)
                - pattern: |
                    $SESSION.$METHOD(String.format(...),...);
                - pattern: |
                    $SESSION.$METHOD($X + $Y,...);
            - pattern-either:
                - pattern-inside: |
                    org.hibernate.Session $SESSION = ...;
                    ...
                - pattern-inside: |
                    $TYPE $FUNC(...,org.hibernate.Session $SESSION,...) {
                      ...
                    }
            - pattern-not: |
                $SESSION.$METHOD("..." + "...",...);
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(createQuery|createSQLQuery)$
      severity: WARNING
    - id: java.lang.security.audit.sqli.jdbc-sqli.jdbc-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - jdbc
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        String $SQL = $X + $Y;
                        ...
                    - pattern-inside: |
                        String $SQL = String.format(...);
                        ...
                    - pattern-inside: |
                        $VAL $FUNC(...,String $SQL,...) {
                          ...
                        }
                - pattern-not-inside: |
                    String $SQL = "..." + "...";
                    ...
                - pattern: $S.$METHOD($SQL,...)
            - pattern: |
                $S.$METHOD(String.format(...),...);
            - pattern: |
                $S.$METHOD($X + $Y,...);
        - pattern-either:
            - pattern-inside: |
                java.sql.Statement $S = ...;
                ...
            - pattern-inside: |
                $TYPE $FUNC(...,java.sql.Statement $S,...) {
                  ...
                }
        - pattern-not: |
            $S.$METHOD("..." + "...",...);
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(executeQuery|execute|executeUpdate|executeLargeUpdate|addBatch|nativeSQL)$
      severity: WARNING
    - id: java.lang.security.audit.sqli.jdo-sqli.jdo-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            String $SQL = $X + $Y;
                            ...
                        - pattern-inside: |
                            String $SQL = String.format(...);
                            ...
                        - pattern-inside: |
                            $TYPE $FUNC(...,String $SQL,...) {
                              ...
                            }
                    - pattern-not-inside: |
                        String $SQL = "..." + "...";
                        ...
                    - pattern: $Q.$METHOD($SQL,...)
                - pattern: |
                    $Q.$METHOD(String.format(...),...);
                - pattern: |
                    $Q.$METHOD($X + $Y,...);
            - pattern-either:
                - pattern-inside: |
                    javax.jdo.Query $Q = ...;
                    ...
                - pattern-inside: |
                    $TYPE $FUNC(...,javax.jdo.Query $Q,...) {
                      ...
                    }
            - pattern-not: |
                $Q.$METHOD("..." + "...",...);
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(setFilter|setGrouping)$
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            String $SQL = $X + $Y;
                            ...
                        - pattern-inside: |
                            String $SQL = String.format(...);
                            ...
                        - pattern-inside: |
                            $VAL $FUNC(...,String $SQL,...) {
                              ...
                            }
                    - pattern-not-inside: |
                        String $SQL = "..." + "...";
                        ...
                    - pattern: $PM.newQuery(...,$SQL,...)
                - pattern: |
                    $PM.newQuery(...,String.format(...),...);
                - pattern: |
                    $PM.newQuery(...,$X + $Y,...);
            - pattern-either:
                - pattern-inside: |
                    javax.jdo.PersistenceManager $PM = ...;
                    ...
                - pattern-inside: |
                    $TYPE $FUNC(...,javax.jdo.PersistenceManager $PM,...) {
                      ...
                    }
            - pattern-not: |
                $PM.newQuery(...,"..." + "...",...);
      severity: WARNING
    - id: java.lang.security.audit.sqli.jpa-sqli.jpa-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - jpa
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        String $SQL = $X + $Y;
                        ...
                    - pattern-inside: |
                        String $SQL = String.format(...);
                        ...
                    - pattern-inside: |
                        $TYPE $FUNC(...,String $SQL,...) {
                          ...
                        }
                - pattern-not-inside: |
                    String $SQL = "..." + "...";
                    ...
                - pattern: $EM.$METHOD($SQL,...)
            - pattern: |
                $EM.$METHOD(String.format(...),...);
            - pattern: |
                $EM.$METHOD($X + $Y,...);
        - pattern-either:
            - pattern-inside: |
                EntityManager $EM = ...;
                ...
            - pattern-inside: |
                $TYPE $FUNC(...,EntityManager $EM,...) {
                  ...
                }
        - pattern-not: |
            $EM.$METHOD("..." + "...",...);
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(createQuery|createNativeQuery)$
      severity: WARNING
    - id: java.lang.security.audit.sqli.tainted-sql-from-http-request.tainted-sql-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into a SQL sink or statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use parameterized SQL queries or properly sanitize user input instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - sql
            - java
            - servlets
            - spring
      mode: taint
      options:
        taint_assume_safe_booleans: true
        taint_assume_safe_numbers: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: "(java.sql.CallableStatement $STMT) = ...; \n"
                - pattern: |
                    (java.sql.Statement $STMT) = ...;
                    ...
                    $OUTPUT = $STMT.$FUNC(...);
                - pattern: |
                    (java.sql.PreparedStatement $STMT) = ...;
                - pattern: |
                    $VAR = $CONN.prepareStatement(...)
                - pattern: |
                    $PATH.queryForObject(...);
                - pattern: |
                    (java.util.Map<String, Object> $STMT) = $PATH.queryForMap(...);
                - pattern: |
                    (org.springframework.jdbc.support.rowset.SqlRowSet $STMT) = ...;
                - pattern: |
                    (org.springframework.jdbc.core.JdbcTemplate $TEMPL).batchUpdate(...)
                - patterns:
                    - pattern-inside: |
                        (String $SQL) = "$SQLSTR" + ...;
                        ...
                    - pattern: $PATH.$SQLCMD(..., $SQL, ...);
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(^SELECT.* | ^INSERT.* | ^UPDATE.*)
                    - metavariable-regex:
                        metavariable: $SQLCMD
                        regex: (execute|query|executeUpdate|batchUpdate)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ).$REQFUNC(...)
                - pattern: "(ServletRequest $REQ).$REQFUNC(...) \n"
            - metavariable-regex:
                metavariable: $REQFUNC
                regex: (getInputStream|getParameter|getParameterMap|getParameterValues|getReader|getCookies|getHeader|getHeaderNames|getHeaders|getPart|getParts|getQueryString)
      severity: WARNING
    - id: java.lang.security.audit.sqli.turbine-sqli.turbine-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - turbine
      pattern-either:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            String $SQL = $X + $Y;
                            ...
                        - pattern-inside: |
                            String $SQL = String.format(...);
                            ...
                        - pattern-inside: |
                            $VAL $FUNC(...,String $SQL,...) {
                              ...
                            }
                    - pattern-not-inside: |
                        String $SQL = "..." + "...";
                        ...
                    - pattern: $PEER.executeQuery($SQL,...)
                - pattern: |
                    $PEER.executeQuery(String.format(...),...)
                - pattern: |
                    $PEER.executeQuery($X + $Y,...)
            - pattern-not: |
                $PEER.executeQuery("..." + "...",...)
            - metavariable-regex:
                metavariable: $PEER
                regex: (BasePeer|GroupPeer)
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            String $SQL = $X + $Y;
                            ...
                        - pattern-inside: |
                            String $SQL = String.format(...);
                            ...
                        - pattern-inside: |
                            $VAL $FUNC(...,String $SQL,...) {
                              ...
                            }
                    - pattern-not-inside: |
                        String $SQL = "..." + "...";
                        ...
                    - pattern: $P.executeQuery($SQL,...)
                - pattern: |
                    $P.executeQuery(String.format(...),...)
                - pattern: |
                    $P.executeQuery($X + $Y,...)
            - pattern-either:
                - pattern-inside: |
                    BasePeer $P = ...;
                    ...
                - pattern-inside: |
                    GroupPeer $P = ...;
                    ...
                - pattern-inside: |
                    $VAL $FUNC(...,GroupPeer $P,...) {
                      ...
                    }
                - pattern-inside: |
                    $VAL $FUNC(...,BasePeer $P,...) {
                      ...
                    }
            - pattern-not: |
                $P.executeQuery("..." + "...",...)
      severity: WARNING
    - id: java.lang.security.audit.sqli.vertx-sqli.vertx-sqli
      languages:
        - java
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - vertx
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        String $SQL = $X + $Y;
                        ...
                    - pattern-inside: |
                        String $SQL = String.format(...);
                        ...
                    - pattern-inside: |
                        $TYPE $FUNC(...,String $SQL,...) {
                          ...
                        }
                - pattern-not-inside: |
                    String $SQL = "..." + "...";
                    ...
                - pattern: $SC.$METHOD($SQL,...)
            - pattern: |
                $SC.$METHOD(String.format(...),...);
            - pattern: |
                $SC.$METHOD($X + $Y,...);
        - pattern-either:
            - pattern-inside: |
                SqlClient $SC = ...;
                ...
            - pattern-inside: |
                SqlConnection $SC = ...;
                ...
            - pattern-inside: |
                $TYPE $FUNC(...,SqlClient $SC,...) {
                  ...
                }
            - pattern-inside: |
                $TYPE $FUNC(...,SqlConnection $SC,...) {
                  ...
                }
        - pattern-not: |
            $SC.$METHOD("..." + "...",...);
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(query|preparedQuery|prepare)$
      severity: WARNING
    - id: java.lang.security.audit.tainted-cmd-from-http-request.tainted-cmd-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into a 'ProcessBuilder' or 'exec' command. This could lead to command injection if variables passed into the exec commands are not properly sanitized. Instead, avoid using these OS commands with user-supplied input, or, if you must use these commands, use a whitelist of specific values.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (ProcessBuilder $PB) = ...;
                - patterns:
                    - pattern: |
                        (Process $P) = ...;
                    - pattern-not: |
                        (Process $P) = (java.lang.Runtime $R).exec(...);
                - patterns:
                    - pattern: (java.lang.Runtime $R).exec($CMD, ...);
                    - focus-metavariable: $CMD
                - patterns:
                    - pattern-either:
                        - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(ProcessBuilder $PB) = ...;\n...\n$PB.command($ARGLIST);\n"
                        - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(ProcessBuilder $PB) = ...;\n"
                        - pattern-inside: "(java.util.List<$TYPE> $ARGLIST) = ...;  \n...\n(Process $P) = ...;\n"
                    - pattern: |
                        $ARGLIST.add(...);
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
                - patterns:
                    - pattern-inside: |
                        (javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest $REQ).getCookies(...);
                        ...
                        for (javax.servlet.http.Cookie $COOKIE: $COOKIES) {
                          ...
                        }
                    - pattern: |
                        $COOKIE.getValue(...)
      severity: ERROR
    - id: java.lang.security.audit.tainted-env-from-http-request.tainted-env-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into the environment variables of an 'exec' command.  Instead, call the command with user-supplied arguments by using the overloaded method with one String array as the argument. `exec({"command", "arg1", "arg2"})`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-454: External Initialization of Trusted Variables or Data Stores'
        cwe2021-top25: false
        cwe2022-top25: false
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: (java.lang.Runtime $R).exec($CMD, $ENV_ARGS, ...);
            - focus-metavariable: $ENV_ARGS
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
                - patterns:
                    - pattern-inside: |
                        (javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest $REQ).getCookies(...);
                        ...
                        for (javax.servlet.http.Cookie $COOKIE: $COOKIES) {
                          ...
                        }
                    - pattern: |
                        $COOKIE.getValue(...)
      severity: ERROR
    - id: java.lang.security.audit.tainted-ldapi-from-http-request.tainted-ldapi-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into an LDAP query. This could lead to LDAP injection if the input is not properly sanitized, which could result in attackers modifying objects in the LDAP tree structure. Ensure data passed to an LDAP query is not controllable or properly sanitize the data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query (''LDAP Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://sensei.securecodewarrior.com/recipes/scw%3Ajava%3ALDAP-injection
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (javax.naming.directory.InitialDirContext $IDC).search(...)
                - pattern: |
                    (javax.naming.directory.DirContext $CTX).search(...)
            - pattern-not: |
                (javax.naming.directory.InitialDirContext $IDC).search($Y, "...", ...)
            - pattern-not: |
                (javax.naming.directory.DirContext $CTX).search($Y, "...", ...)
      pattern-sources:
        - patterns:
            - pattern: (HttpServletRequest $REQ)
      severity: WARNING
    - id: java.lang.security.audit.tainted-session-from-http-request.tainted-session-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into a session command, like `setAttribute`. User input into such a command could lead to an attacker inputting malicious code into your session parameters, blurring the line between what's trusted and untrusted, and therefore leading to a trust boundary violation. This could lead to programmers trusting unvalidated data. Instead, thoroughly sanitize user input before passing it into such function calls.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-501: Trust Boundary Violation'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern: (HttpServletRequest $REQ).getSession().$FUNC($NAME, $VALUE);
            - metavariable-regex:
                metavariable: $FUNC
                regex: ^(putValue|setAttribute)$
            - focus-metavariable: $VALUE
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        (HttpServletRequest $REQ).$FUNC(...)
                    - pattern-not: |
                        (HttpServletRequest $REQ).getSession()
                - patterns:
                    - pattern-inside: |
                        (javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest $REQ).getCookies(...);
                        ...
                        for (javax.servlet.http.Cookie $COOKIE: $COOKIES) {
                          ...
                        }
                    - pattern: |
                        $COOKIE.getValue(...)
                - patterns:
                    - pattern-inside: |
                        $TYPE[] $VALS = (HttpServletRequest $REQ).$GETFUNC(... );
                        ...
                    - pattern: |
                        $PARAM = $VALS[$INDEX];
                - patterns:
                    - pattern-inside: |
                        $HEADERS = (HttpServletRequest $REQ).getHeaders(...);
                        ...
                        $PARAM = $HEADERS.$FUNC(...);
                        ...
                    - pattern: |
                        java.net.URLDecoder.decode($PARAM, ...)
      severity: WARNING
    - id: java.lang.security.audit.tainted-xpath-from-http-request.tainted-xpath-from-http-request
      languages:
        - java
      message: Detected input from a HTTPServletRequest going into a XPath evaluate or compile command. This could lead to xpath injection if variables passed into the evaluate or compile commands are not properly sanitized. Xpath injection could lead to unauthorized access to sensitive information in XML documents. Instead, thoroughly sanitize user input or use parameterized xpath queries if you can.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-643: Improper Neutralization of Data within XPath Expressions (''XPath Injection'')'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (javax.xml.xpath.XPath $XP).evaluate(...)
                - pattern: |
                    (javax.xml.xpath.XPath $XP).compile(...).evaluate(...)
      pattern-sources:
        - patterns:
            - pattern: |
                (HttpServletRequest $REQ).$FUNC(...)
      severity: WARNING
    - id: java.lang.security.audit.unsafe-reflection.unsafe-reflection
      languages:
        - java
      message: If an attacker can supply values that the application then uses to determine which class to instantiate or which method to invoke, the potential exists for the attacker to create control flow paths through the application that were not intended by the application developers. This attack vector may allow the attacker to bypass authentication or access control checks or otherwise cause the application to behave in an unexpected manner.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code (''Unsafe Reflection'')'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://owasp.org/www-community/vulnerabilities/Unsafe_use_of_Reflection
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern: |
            Class.forName($CLASS,...)
        - pattern-not: |
            Class.forName("...",...)
        - pattern-not-inside: |
            $CLASS = "...";
            ...
      severity: WARNING
    - id: java.lang.security.audit.unvalidated-redirect.unvalidated-redirect
      languages:
        - java
      message: Application redirects to a destination URL specified by a user-supplied parameter that is not validated. This could direct users to malicious locations. Consider using an allowlist to validate URLs.
      metadata:
        asvs:
            control_id: 5.1.5 Open Redirect
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNVALIDATED_REDIRECT
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...,String $URL,...) {
              ...
              $RES.sendRedirect($URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,String $URL,...,HttpServletResponse $RES,...) {
              ...
              $RES.sendRedirect($URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...) {
              ...
              String $URL = $REQ.getParameter(...);
              ...
              $RES.sendRedirect($URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...) {
              ...
              String $URL = $REQ.getParameter(...);
              ...
              $RES.sendRedirect($URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,String $URL,...) {
              ...
              HttpServletResponse $RES = ...;
              ...
              $RES.sendRedirect($URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...) {
              ...
              $RES.sendRedirect($REQ.getParameter(...));
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...) {
              ...
              $RES.sendRedirect($REQ.getParameter(...));
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...,String $URL,...) {
              ...
              $RES.addHeader("Location",$URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,String $URL,...,HttpServletResponse $RES,...) {
              ...
              $RES.addHeader("Location",$URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...) {
              ...
              String $URL = $REQ.getParameter(...);
              ...
              $RES.addHeader("Location",$URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...) {
              ...
              String $URL = $REQ.getParameter(...);
              ...
              $RES.addHeader("Location",$URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,String $URL,...) {
              ...
              HttpServletResponse $RES = ...;
              ...
              $RES.addHeader("Location",$URL);
              ...
            }
        - pattern: |
            $X $METHOD(...,HttpServletRequest $REQ,...,HttpServletResponse $RES,...) {
              ...
              $RES.addHeader("Location",$REQ.getParameter(...));
              ...
            }
        - pattern: |-
            $X $METHOD(...,HttpServletResponse $RES,...,HttpServletRequest $REQ,...) {
              ...
              $RES.addHeader("Location",$REQ.getParameter(...));
              ...
            }
      severity: WARNING
    - fix-regex:
        regex: (.*?)\.getInstance\(.*?\)
        replacement: \1.getInstance("TLSv1.2")
      id: java.lang.security.audit.weak-ssl-context.weak-ssl-context
      languages:
        - java
      message: An insecure SSL context was detected. TLS versions 1.0, 1.1, and all SSL versions are considered weak encryption and are deprecated. Use SSLContext.getInstance("TLSv1.2") for the best security.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc7568
            - https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html
        source_rule_url: https://find-sec-bugs.github.io/bugs.htm#SSL_CONTEXT
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-not: SSLContext.getInstance("TLSv1.3")
        - pattern-not: SSLContext.getInstance("TLSv1.2")
        - pattern: SSLContext.getInstance("...")
      severity: WARNING
    - id: java.lang.security.audit.xml-decoder.xml-decoder
      languages:
        - java
      message: XMLDecoder should not be used to parse untrusted data. Deserializing user input can lead to arbitrary code execution. Use an alternative and explicitly disable external entities. See https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html for alternatives and vulnerability prevention.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XML_DECODER
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern: |
            $X $METHOD(...) {
              ...
              new XMLDecoder(...);
              ...
            }
        - pattern-not: |
            $X $METHOD(...) {
              ...
              new XMLDecoder("...");
              ...
            }
        - pattern-not: |-
            $X $METHOD(...) {
              ...
              String $STR = "...";
              ...
              new XMLDecoder($STR);
              ...
            }
      severity: WARNING
    - id: java.lang.security.audit.xss.jsf.autoescape-disabled.autoescape-disabled
      languages:
        - regex
      message: Detected an element with disabled HTML escaping. If external data can reach this, this is a cross-site scripting (XSS) vulnerability. Ensure no external data can reach here, or remove 'escape=false' from this element.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-150: Improper Neutralization of Escape, Meta, or Control Sequences'
        impact: MEDIUM
        likelihood: LOW
        owasp: A07:2017 - Cross-Site Scripting (XSS)
        references:
            - https://stackoverflow.com/a/7442668
        subcategory:
            - audit
        technology:
            - jsf
      paths:
        include:
            - '*.html'
            - '*.xhtml'
      pattern-regex: .*escape.*?=.*?false.*
      severity: WARNING
    - id: java.lang.security.audit.xss.jsp.use-escapexml.use-escapexml
      languages:
        - regex
      message: Detected an Expression Language segment that does not escape output. This is dangerous because if any data in this expression can be controlled externally, it is a cross-site scripting vulnerability. Instead, use the 'escapeXml' function from the JSTL taglib. See https://www.tutorialspoint.com/jsp/jstl_function_escapexml.htm for more information.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-116: Improper Encoding or Escaping of Output'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.tutorialspoint.com/jsp/jstl_function_escapexml.htm
            - https://stackoverflow.com/a/4948856
            - https://stackoverflow.com/a/3180202
        subcategory:
            - audit
        technology:
            - jsp
      paths:
        include:
            - '*.jsp'
      pattern-regex: \$\{(?!.*escapeXml).*\}
      severity: WARNING
    - id: java.lang.security.audit.xss.jsp.use-jstl-escaping.use-jstl-escaping
      languages:
        - regex
      message: Detected an Expression Language segment in a tag that does not escape output. This is dangerous because if any data in this expression can be controlled externally, it is a cross-site scripting vulnerability. Instead, use the 'out' tag from the JSTL taglib to escape this expression. See https://www.tutorialspoint.com/jsp/jstl_core_out_tag.htm for more information.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-116: Improper Encoding or Escaping of Output'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.tutorialspoint.com/jsp/jstl_core_out_tag.htm
            - https://stackoverflow.com/a/4948856
            - https://stackoverflow.com/a/3180202
        subcategory:
            - audit
        technology:
            - jsp
      paths:
        include:
            - '*.jsp'
      pattern-regex: <(?![A-Za-z0-9]+:out).*?\$\{.*?\}.*>
      severity: WARNING
    - id: java.lang.security.audit.xss.no-direct-response-writer.no-direct-response-writer
      languages:
        - java
      message: Detected a request with potential user-input going into a OutputStream or Writer object. This bypasses any view or template environments, including HTML escaping, which may expose this application to cross-site scripting (XSS) vulnerabilities. Consider using a view technology such as JavaServer Faces (JSFs) which automatically escapes HTML views.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        license: proprietary license - copyright  Semgrep, Inc.
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaServerFaces.html
        subcategory:
            - vuln
        technology:
            - java
            - servlets
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: Encode.forHtml(...)
            - pattern: (PolicyFactory $POLICY).sanitize(...)
            - pattern: (AntiSamy $AS).scan(...)
            - pattern: JSoup.clean(...)
            - pattern: org.apache.commons.lang.StringEscapeUtils.escapeHtml(...)
            - pattern: org.springframework.web.util.HtmlUtils.htmlEscape(...)
            - pattern: org.owasp.esapi.ESAPI.encoder().encodeForHTML(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletResponse $RESPONSE).getWriter(...).$WRITE(...)
                - pattern: |
                    (HttpServletResponse $RESPONSE).getOutputStream(...).$WRITE(...)
                - pattern: |
                    (java.io.PrintWriter $WRITER).$WRITE(...)
                - pattern: |
                    (PrintWriter $WRITER).$WRITE(...)
                - pattern: |
                    (javax.servlet.ServletOutputStream $WRITER).$WRITE(...)
                - pattern: |
                    (ServletOutputStream $WRITER).$WRITE(...)
                - pattern: |
                    (java.io.OutputStream $WRITER).$WRITE(...)
                - pattern: |
                    (OutputStream $WRITER).$WRITE(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ).$REQFUNC(...)
                - pattern: "(ServletRequest $REQ).$REQFUNC(...) \n"
            - metavariable-regex:
                metavariable: $REQFUNC
                regex: (getInputStream|getParameter|getParameterMap|getParameterValues|getReader|getCookies|getHeader|getHeaderNames|getHeaders|getPart|getParts|getQueryString)
      severity: WARNING
    - id: java.lang.security.audit.xssrequestwrapper-is-insecure.xssrequestwrapper-is-insecure
      languages:
        - java
      message: It looks like you're using an implementation of XSSRequestWrapper from dzone. (https://www.javacodegeeks.com/2012/07/anti-cross-site-scripting-xss-filter.html) The XSS filtering in this code is not secure and can be bypassed by malicious actors. It is recommended to use a stack that automatically escapes in your view or templates instead of filtering yourself.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XSS_REQUEST_WRAPPER
        subcategory:
            - audit
        technology:
            - java
      pattern-either:
        - pattern: |
            class XSSRequestWrapper extends HttpServletRequestWrapper {
              ...
            }
        - pattern: |-
            $P = $X.compile("</script>", $X.CASE_INSENSITIVE);
            $V = $P.matcher(...).replaceAll("");
      severity: WARNING
    - id: java.lang.security.audit.xxe.documentbuilderfactory-disallow-doctype-decl-false.documentbuilderfactory-disallow-doctype-decl-false
      languages:
        - java
      message: DOCTYPE declarations are enabled for $DBFACTORY. Without prohibiting external entity declarations, this is vulnerable to XML external entity attacks. Disable this by setting the feature "http://apache.org/xml/features/disallow-doctype-decl" to true. Alternatively, allow DOCTYPE declarations and only prohibit external entities declarations. This can be done by setting the features "http://xml.org/sax/features/external-general-entities" and "http://xml.org/sax/features/external-parameter-entities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        subcategory:
            - vuln
        technology:
            - java
            - xml
      patterns:
        - pattern: $DBFACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", false);
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-general-entities", false);
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-general-entities", false);
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
              ...
            }
      severity: ERROR
    - fix: |
        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
        $FACTORY.newDocumentBuilder();
      id: java.lang.security.audit.xxe.documentbuilderfactory-disallow-doctype-decl-missing.documentbuilderfactory-disallow-doctype-decl-missing
      languages:
        - java
      message: DOCTYPE declarations are enabled for this DocumentBuilderFactory. This is vulnerable to XML external entity attacks. Disable this by setting the feature "http://apache.org/xml/features/disallow-doctype-decl" to true. Alternatively, allow DOCTYPE declarations and only prohibit external entities declarations. This can be done by setting the features "http://xml.org/sax/features/external-general-entities" and "http://xml.org/sax/features/external-parameter-entities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        subcategory:
            - vuln
        technology:
            - java
            - xml
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
                            true);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",false);
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: $FACTORY.newDocumentBuilder();
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    $FACTORY = DocumentBuilderFactory.newInstance();
                - patterns:
                    - pattern: $FACTORY
                    - pattern-inside: |
                        class $C {
                          ...
                          $V $FACTORY = DocumentBuilderFactory.newInstance();
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = DocumentBuilderFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = DocumentBuilderFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = DocumentBuilderFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
      severity: ERROR
    - fix: $DBFACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
      id: java.lang.security.audit.xxe.documentbuilderfactory-external-general-entities-true.documentbuilderfactory-external-general-entities-true
      languages:
        - java
      message: External entities are allowed for $DBFACTORY. This is vulnerable to XML external entity attacks. Disable this by setting the feature "http://xml.org/sax/features/external-general-entities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
        subcategory:
            - vuln
        technology:
            - java
            - xml
      pattern: $DBFACTORY.setFeature("http://xml.org/sax/features/external-general-entities", true);
      severity: ERROR
    - fix: $DBFACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
      id: java.lang.security.audit.xxe.documentbuilderfactory-external-parameter-entities-true.documentbuilderfactory-external-parameter-entities-true
      languages:
        - java
      message: External entities are allowed for $DBFACTORY. This is vulnerable to XML external entity attacks. Disable this by setting the feature "http://xml.org/sax/features/external-parameter-entities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
        subcategory:
            - vuln
        technology:
            - java
            - xml
      pattern: $DBFACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", true);
      severity: ERROR
    - fix: |
        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
        $FACTORY.newSAXParser();
      id: java.lang.security.audit.xxe.saxparserfactory-disallow-doctype-decl-missing.saxparserfactory-disallow-doctype-decl-missing
      languages:
        - java
      message: DOCTYPE declarations are enabled for this SAXParserFactory. This is vulnerable to XML external entity attacks. Disable this by setting the feature `http://apache.org/xml/features/disallow-doctype-decl` to true. Alternatively, allow DOCTYPE declarations and only prohibit external entities declarations. This can be done by setting the features `http://xml.org/sax/features/external-general-entities` and `http://xml.org/sax/features/external-parameter-entities` to false. NOTE - The previous links are not meant to be clicked. They are the literal config key values that are supposed to be used to disable these features. For more information, see https://semgrep.dev/docs/cheat-sheets/java-xxe/#3a-documentbuilderfactory.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        subcategory:
            - vuln
        technology:
            - java
            - xml
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
                            true);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",false);
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: $FACTORY.newSAXParser();
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    $FACTORY = SAXParserFactory.newInstance();
                - patterns:
                    - pattern: $FACTORY
                    - pattern-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
      severity: ERROR
    - fix: |
        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, ""); $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
        $FACTORY.newTransformer(...);
      id: java.lang.security.audit.xxe.transformerfactory-dtds-not-disabled.transformerfactory-dtds-not-disabled
      languages:
        - java
      message: DOCTYPE declarations are enabled for this TransformerFactory. This is vulnerable to XML external entity attacks. Disable this by setting the attributes "accessExternalDTD" and "accessExternalStylesheet" to "".
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        subcategory:
            - vuln
        technology:
            - java
            - xml
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, ""); ...
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                    - pattern: |
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                        ...
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                    - pattern: |
                        $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", ""); ...
                        $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                    - pattern: |
                        $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                        ...
                        $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: $FACTORY.newTransformer(...);
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    $FACTORY = TransformerFactory.newInstance();
                - patterns:
                    - pattern: $FACTORY
                    - pattern-inside: |
                        class $C {
                          ...
                          $V $FACTORY = TransformerFactory.newInstance();
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                          }
                          ...
                        }
      severity: ERROR
    - id: java.lang.security.httpservlet-path-traversal.httpservlet-path-traversal
      languages:
        - java
      message: Detected a potential path traversal. A malicious actor could control the location of this file, to include going backwards in the directory with '../'. To address this, ensure that user-controlled variables in file paths are sanitized. You may also consider using a utility method such as org.apache.commons.io.FilenameUtils.getName(...) to only retrieve the file name from the path.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://www.owasp.org/index.php/Path_Traversal
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PATH_TRAVERSAL_IN
        subcategory:
            - vuln
        technology:
            - java
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (java.io.File $FILE) = ...
                - pattern: |
                    (java.io.FileOutputStream $FOS) = ...
                - pattern: |
                    new java.io.FileInputStream(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
                - patterns:
                    - pattern-inside: |
                        (javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest $REQ).getCookies(...);
                        ...
                        for (javax.servlet.http.Cookie $COOKIE: $COOKIES) {
                          ...
                        }
                    - pattern: |
                        $COOKIE.getValue(...)
                - patterns:
                    - pattern-inside: |
                        $TYPE[] $VALS = (HttpServletRequest $REQ).$GETFUNC(...);
                        ...
                    - pattern: |
                        $PARAM = $VALS[$INDEX];
      severity: ERROR
    - id: java.lang.security.insecure-jms-deserialization.insecure-jms-deserialization
      languages:
        - java
      message: JMS Object messages depend on Java Serialization for marshalling/unmarshalling of the message payload when ObjectMessage.getObject() is called. Deserialization of untrusted data can lead to security flaws; a remote attacker could via a crafted JMS ObjectMessage to execute arbitrary code with the permissions of the application listening/consuming JMS Messages. In this case, the JMS MessageListener consume an ObjectMessage type received inside the onMessage method, which may lead to arbitrary code execution when calling the $Y.getObject method.
      metadata:
        asvs:
            control_id: 5.5.3 Insecue Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities-wp.pdf
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-inside: |
            public class $JMS_LISTENER implements MessageListener {
              ...
              public void onMessage(Message $JMS_MSG) {
                  ...
              }
            }
        - pattern-either:
            - pattern-inside: $X = $Y.getObject(...);
            - pattern-inside: $X = ($Z) $Y.getObject(...);
      severity: WARNING
    - id: java.lang.security.jackson-unsafe-deserialization.jackson-unsafe-deserialization
      languages:
        - java
      message: When using Jackson to marshall/unmarshall JSON to Java objects, enabling default typing is dangerous and can lead to RCE. If an attacker can control `$JSON` it might be possible to provide a malicious JSON which can be used to exploit unsecure deserialization. In order to prevent this issue, avoid to enable default typing (globally or by using "Per-class" annotations) and avoid using `Object` and other dangerous types for member variable declaration which creating classes for Jackson based deserialization.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A8:2017 Insecure Deserialization
            - A8:2021 Software and Data Integrity Failures
        references:
            - https://swapneildash.medium.com/understanding-insecure-implementation-of-jackson-deserialization-7b3d409d2038
            - https://cowtowncoder.medium.com/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062
            - https://adamcaudill.com/2017/10/04/exploiting-jackson-rce-cve-2017-7525/
        subcategory:
            - audit
        technology:
            - jackson
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    ObjectMapper $OM = new ObjectMapper(...);
                    ...
                - pattern-inside: |
                    $OM.enableDefaultTyping();
                    ...
                - pattern: $OM.readValue($JSON, ...);
            - patterns:
                - pattern-inside: |
                    class $CLASS {
                      ...
                      @JsonTypeInfo(use = Id.CLASS,...)
                      $TYPE $VAR;
                      ...
                    }
                - metavariable-regex:
                    metavariable: $TYPE
                    regex: (Object|Serializable|Comparable)
                - pattern: $OM.readValue($JSON, $CLASS.class);
            - patterns:
                - pattern-inside: |
                    class $CLASS {
                      ...
                      ObjectMapper $OM;
                      ...
                      $INITMETHODTYPE $INITMETHOD(...) {
                        ...
                        $OM = new ObjectMapper();
                        ...
                        $OM.enableDefaultTyping();
                        ...
                      }
                      ...
                    }
                - pattern-inside: "$METHODTYPE $METHOD(...) {\n  ...  \n}\n"
                - pattern: $OM.readValue($JSON, ...);
      severity: WARNING
    - id: java.lang.security.servletresponse-writer-xss.servletresponse-writer-xss
      languages:
        - java
      message: 'Cross-site scripting detected in HttpServletResponse writer with variable ''$VAR''. User input was detected going directly from the HttpServletRequest into output. Ensure your data is properly encoded using org.owasp.encoder.Encode.forHtml: ''Encode.forHtml($VAR)''.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XSS_SERVLET
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-inside: $TYPE $FUNC(..., HttpServletResponse $RESP, ...) { ... }
        - pattern-inside: $VAR = $REQ.getParameter(...); ...
        - pattern-either:
            - pattern: $RESP.getWriter(...).write(..., $VAR, ...);
            - pattern: |
                $WRITER = $RESP.getWriter(...);
                ...
                $WRITER.write(..., $VAR, ...);
      severity: ERROR
    - id: java.lang.security.use-snakeyaml-constructor.use-snakeyaml-constructor
      languages:
        - java
      message: Used SnakeYAML org.yaml.snakeyaml.Yaml() constructor with no arguments, which is vulnerable to deserialization attacks. Use the one-argument Yaml(...) constructor instead, with SafeConstructor or a custom Constructor as the argument.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://securitylab.github.com/research/swagger-yaml-parser-vulnerability/#snakeyaml-deserialization-vulnerability
        subcategory:
            - audit
        technology:
            - snakeyaml
      patterns:
        - pattern: |
            $Y = new org.yaml.snakeyaml.Yaml();
            ...
            $Y.load(...);
      severity: WARNING
    - id: java.lang.security.xmlinputfactory-external-entities-enabled.xmlinputfactory-external-entities-enabled
      languages:
        - java
      message: XML external entities are enabled for this XMLInputFactory. This is vulnerable to XML external entity attacks. Disable external entities by setting "javax.xml.stream.isSupportingExternalEntities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://www.blackhat.com/docs/us-15/materials/us-15-Wang-FileCry-The-New-Age-Of-XXE-java-wp.pdf
        subcategory:
            - audit
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty("javax.xml.stream.isSupportingExternalEntities", true);
            - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty(javax.xml.stream.XMLInputFactory.SUPPORT_DTD, true);
            - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty("javax.xml.stream.isSupportingExternalEntities", Boolean.TRUE);
            - pattern: (javax.xml.stream.XMLInputFactory $XMLFACTORY).setProperty(javax.xml.stream.XMLInputFactory.SUPPORT_DTD, Boolean.TRUE);
      severity: ERROR
    - id: java.lang.security.xmlinputfactory-possible-xxe.xmlinputfactory-possible-xxe
      languages:
        - java
      message: XML external entities are not explicitly disabled for this XMLInputFactory. This could be vulnerable to XML external entity vulnerabilities. Explicitly disable external entities by setting "javax.xml.stream.isSupportingExternalEntities" to false.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://www.blackhat.com/docs/us-15/materials/us-15-Wang-FileCry-The-New-Age-Of-XXE-java-wp.pdf
            - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#xmlinputfactory-a-stax-parser
        subcategory:
            - vuln
        technology:
            - java
      patterns:
        - pattern-not-inside: |
            $METHOD(...) {
              ...
              $XMLFACTORY.setProperty("javax.xml.stream.isSupportingExternalEntities", false);
              ...
            }
        - pattern-not-inside: |
            $METHOD(...) {
              ...
              $XMLFACTORY.setProperty(javax.xml.stream.XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false);
              ...
            }
        - pattern-not-inside: |
            $METHOD(...) {
              ...
              $XMLFACTORY.setProperty("javax.xml.stream.isSupportingExternalEntities", Boolean.FALSE);
              ...
            }
        - pattern-not-inside: |
            $METHOD(...) {
              ...
              $XMLFACTORY.setProperty(javax.xml.stream.XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);
              ...
            }
        - pattern-either:
            - pattern: javax.xml.stream.XMLInputFactory.newFactory(...)
            - pattern: new XMLInputFactory(...)
      severity: WARNING
    - id: java.mongodb.security.injection.audit.mongodb-nosqli.mongodb-nosqli
      languages:
        - java
      message: Detected non-constant data passed into a NoSQL query using the 'where' evaluation operator. If this data can be controlled by an external user, this is a NoSQL injection. Ensure data passed to the NoSQL query is not user controllable, or properly sanitize the data. Ideally, avoid using the 'where' operator at all and instead use the helper methods provided by com.mongodb.client.model.Filters with comparative operators such as eq, ne, lt, gt, etc.
      metadata:
        asvs:
            control_id: 5.3.4 Injection Prevention
            control_url: https://github.com/OWASP/ASVS/blob/master/5.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "5"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
            - https://www.mongodb.com/docs/manual/tutorial/query-documents/
            - https://www.mongodb.com/docs/manual/reference/operator/query/where/
        subcategory:
            - audit
        technology:
            - nosql
            - mongodb
      patterns:
        - pattern-either:
            - pattern: (com.mongodb.BasicDBObject $QUERY).put("$where", $INPUT);
            - pattern: |
                (HashMap<String, String> $MAP).put("$where", $INPUT);
                ...
                (com.mongodb.BasicDBObject $QUERY).putAll($MAP);
            - pattern: (com.mongodb.BasicDBObject $QUERY).append("$where", $INPUT);
            - pattern: new com.mongodb.BasicDBObject("$where", $INPUT);
            - pattern: |
                (HashMap<String, String> $MAP).put("$where", $INPUT);
                ...
                new com.mongodb.BasicDBObject($MAP);
            - pattern: |
                (HashMap<String, String> $MAP).put("$where", $INPUT);
                ...
                String json = new JSONObject($MAP).toString();
                ...
                (com.mongodb.BasicDBObject $QUERY).parse((String $JSON));
            - pattern: com.mongodb.BasicDBObjectBuilder.start().add("$where", $INPUT);
            - pattern: com.mongodb.BasicDBObjectBuilder.start().append("$where", $INPUT);
            - pattern: com.mongodb.BasicDBObjectBuilder.start("$where", $INPUT);
            - pattern: |
                (HashMap<String, String> $MAP).put("$where", $INPUT);
                ...
                com.mongodb.BasicDBObjectBuilder.start($MAP);
        - metavariable-pattern:
            metavariable: $INPUT
            patterns:
                - pattern: |
                    ...
                - pattern-not: |
                    "..."
      severity: WARNING
    - id: java.rmi.security.server-dangerous-class-deserialization.server-dangerous-class-deserialization
      languages:
        - java
      message: Using a non-primitive class with Java RMI may be an insecure deserialization vulnerability. Depending on the underlying implementation. This object could be manipulated by a malicious actor allowing them to execute code on your system. Instead, use an integer ID to look up your object, or consider alternative serialization schemes such as JSON.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://mogwailabs.de/blog/2019/03/attacking-java-rmi-services-after-jep-290/
        subcategory:
            - audit
        technology:
            - rmi
      patterns:
        - pattern: |
            interface $INTERFACE extends Remote {
              $RETURNTYPE $METHOD($CLASS $PARAM) throws RemoteException;
            }
        - metavariable-regex:
            metavariable: $CLASS
            regex: (?!int|boolean|short|long|byte|char|float|double)
      severity: WARNING
    - id: java.rmi.security.server-dangerous-object-deserialization.server-dangerous-object-deserialization
      languages:
        - java
      message: Using an arbitrary object ('$PARAMTYPE $PARAM') with Java RMI is an insecure deserialization vulnerability. This object can be manipulated by a malicious actor allowing them to execute code on your system. Instead, use an integer ID to look up your object, or consider alternative serialization schemes such as JSON.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://frohoff.github.io/appseccali-marshalling-pickles/
            - https://book.hacktricks.xyz/network-services-pentesting/1099-pentesting-java-rmi
            - https://youtu.be/t_aw1mDNhzI
            - https://github.com/qtc-de/remote-method-guesser
            - https://github.com/openjdk/jdk/blob/master/src/java.rmi/share/classes/sun/rmi/server/UnicastRef.java#L303C4-L331
        subcategory:
            - audit
        technology:
            - rmi
      patterns:
        - pattern: |
            interface $INTERFACE extends Remote {
              $RETURNTYPE $METHOD($PARAMTYPE $PARAM) throws RemoteException;
            }
        - metavariable-pattern:
            language: generic
            metavariable: $PARAMTYPE
            patterns:
                - pattern-not: String
                - pattern-not: java.lang.String
                - pattern-not: boolean
                - pattern-not: Boolean
                - pattern-not: java.lang.Boolean
                - pattern-not: byte
                - pattern-not: Byte
                - pattern-not: java.lang.Byte
                - pattern-not: char
                - pattern-not: Character
                - pattern-not: java.lang.Character
                - pattern-not: double
                - pattern-not: Double
                - pattern-not: java.lang.Double
                - pattern-not: float
                - pattern-not: Float
                - pattern-not: java.lang.Float
                - pattern-not: int
                - pattern-not: Integer
                - pattern-not: java.lang.Integer
                - pattern-not: long
                - pattern-not: Long
                - pattern-not: java.lang.Long
                - pattern-not: short
                - pattern-not: Short
                - pattern-not: java.lang.Short
      severity: ERROR
    - id: java.spring.security.audit.spring-actuator-fully-enabled-yaml.spring-actuator-fully-enabled-yaml
      languages:
        - yaml
      message: Spring Boot Actuator is fully enabled. This exposes sensitive endpoints such as /actuator/env, /actuator/logfile, /actuator/heapdump and others. Unless you have Spring Security enabled or another means to protect these endpoints, this functionality is available without authentication, causing a severe security risk.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints
            - https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785
            - https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators
        subcategory:
            - vuln
        technology:
            - spring
      patterns:
        - pattern-inside: |
            management:
              ...
              endpoints:
                ...
                web:
                  ...
                  exposure:
                    ...
        - pattern: |
            include: "*"
      severity: WARNING
    - id: java.spring.security.audit.spring-actuator-fully-enabled.spring-actuator-fully-enabled
      languages:
        - generic
      message: Spring Boot Actuator is fully enabled. This exposes sensitive endpoints such as /actuator/env, /actuator/logfile, /actuator/heapdump and others. Unless you have Spring Security enabled or another means to protect these endpoints, this functionality is available without authentication, causing a significant security risk.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints
            - https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785
            - https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators
        subcategory:
            - vuln
        technology:
            - spring
      paths:
        include:
            - '*properties'
      pattern: management.endpoints.web.exposure.include=*
      severity: ERROR
    - id: java.spring.security.audit.spring-actuator-non-health-enabled-yaml.spring-actuator-dangerous-endpoints-enabled-yaml
      languages:
        - yaml
      message: Spring Boot Actuator "$ACTUATOR" is enabled. Depending on the actuator, this can pose a significant security risk. Please double-check if the actuator is needed and properly secured.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints
            - https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785
            - https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators
        subcategory:
            - vuln
        technology:
            - spring
      patterns:
        - pattern-inside: |
            management:
              ...
              endpoints:
                ...
                web:
                  ...
                  exposure:
                    ...
                    include:
                      ...
        - pattern: |
            include: [..., $ACTUATOR, ...]
        - metavariable-comparison:
            comparison: not str($ACTUATOR) in ["health","*"]
            metavariable: $ACTUATOR
      severity: WARNING
    - id: java.spring.security.audit.spring-actuator-non-health-enabled.spring-actuator-dangerous-endpoints-enabled
      languages:
        - generic
      message: Spring Boot Actuators "$...ACTUATORS" are enabled. Depending on the actuators, this can pose a significant security risk. Please double-check if the actuators are needed and properly secured.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints
            - https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785
            - https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators
        subcategory:
            - vuln
        technology:
            - spring
      options:
        generic_ellipsis_max_span: 0
      patterns:
        - pattern: management.endpoints.web.exposure.include=$...ACTUATORS
        - metavariable-comparison:
            comparison: not str($...ACTUATORS) in ["health","*"]
            metavariable: $...ACTUATORS
      severity: WARNING
    - id: java.spring.security.audit.spring-csrf-disabled.spring-csrf-disabled
      languages:
        - java
      message: CSRF protection is disabled for this configuration. This is a security risk.
      metadata:
        asvs:
            control_id: 4.2.2 CSRF
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V4-Access-Control.md#v42-operation-level-access-control
            section: V4 Access Control
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SPRING_CSRF_PROTECTION_DISABLED
        subcategory:
            - audit
        technology:
            - spring
      pattern: $OBJ.csrf(...).disable(...)
      severity: WARNING
    - id: java.spring.security.audit.spring-sqli.spring-sqli
      languages:
        - java
      message: Detected a string argument from a public method contract in a raw SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Use a prepared statements (java.sql.PreparedStatement) instead. You can obtain a PreparedStatement using 'connection.prepareStatement'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - spring
      mode: taint
      options:
        taint_assume_safe_booleans: true
        taint_assume_safe_numbers: true
      pattern-sanitizers:
        - not_conflicting: true
          pattern-either:
            - patterns:
                - focus-metavariable: $A
                - pattern-inside: |
                    new $TYPE(...,$A,...);
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - focus-metavariable: $A
                    - pattern: |
                        new PreparedStatementCreatorFactory($A,...);
                - patterns:
                    - focus-metavariable: $A
                    - pattern: |
                        (JdbcTemplate $T).$M($A,...)
                - patterns:
                    - pattern: (String $A)
                    - pattern-inside: |
                        (JdbcTemplate $T).batchUpdate(...)
                - patterns:
                    - focus-metavariable: $A
                    - pattern: |
                        NamedParameterBatchUpdateUtils.$M($A,...)
                - patterns:
                    - focus-metavariable: $A
                    - pattern: |
                        BatchUpdateUtils.$M($A,...)
      pattern-sources:
        - patterns:
            - pattern: $ARG
            - pattern-inside: |
                public $T $M (..., String $ARG,...){...}
      severity: WARNING
    - id: java.spring.security.audit.spring-unvalidated-redirect.spring-unvalidated-redirect
      languages:
        - java
      message: Application redirects a user to a destination URL specified by a user supplied parameter that is not validated.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNVALIDATED_REDIRECT
        subcategory:
            - vuln
        technology:
            - spring
      pattern-either:
        - pattern: |
            $X $METHOD(...,String $URL,...) {
              return "redirect:" + $URL;
            }
        - pattern: |
            $X $METHOD(...,String $URL,...) {
              ...
              String $REDIR = "redirect:" + $URL;
              ...
              return $REDIR;
              ...
            }
        - pattern: |
            $X $METHOD(...,String $URL,...) {
              ...
              new ModelAndView("redirect:" + $URL);
              ...
            }
        - pattern: |-
            $X $METHOD(...,String $URL,...) {
              ...
              String $REDIR = "redirect:" + $URL;
              ...
              new ModelAndView($REDIR);
              ...
            }
      severity: WARNING
    - id: java.spring.security.injection.tainted-file-path.tainted-file-path
      languages:
        - java
      message: Detected user input controlling a file path. An attacker could control the location of this file, to include going backwards in the directory with '../'. To address this, ensure that user-controlled variables in file paths are sanitized. You may also consider using a utility method such as org.apache.commons.io.FilenameUtils.getName(...) to only retrieve the file name from the path.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-23: Relative Path Traversal'
        impact: HIGH
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - vuln
        technology:
            - java
            - spring
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: new File(...)
                - pattern: new java.io.File(...)
                - pattern: new FileReader(...)
                - pattern: new java.io.FileReader(...)
                - pattern: new FileInputStream(...)
                - pattern: new java.io.FileInputStream(...)
                - pattern: (Paths $PATHS).get(...)
                - patterns:
                    - pattern: |
                        $CLASS.$FUNC(...)
                    - metavariable-regex:
                        metavariable: $FUNC
                        regex: ^(getResourceAsStream|getResource)$
                - patterns:
                    - pattern-either:
                        - pattern: new ClassPathResource($FILE, ...)
                        - pattern: ResourceUtils.getFile($FILE, ...)
                        - pattern: new FileOutputStream($FILE, ...)
                        - pattern: new java.io.FileOutputStream($FILE, ...)
                        - pattern: new StreamSource($FILE, ...)
                        - pattern: new javax.xml.transform.StreamSource($FILE, ...)
                        - pattern: FileUtils.openOutputStream($FILE, ...)
                    - focus-metavariable: $FILE
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
      severity: ERROR
    - id: java.spring.security.injection.tainted-html-string.tainted-html-string
      languages:
        - java
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. To be sure this is safe, check that the HTML is rendered safely. You can use the OWASP ESAPI encoder if you must render user data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - java
            - spring
      mode: taint
      pattern-propagators:
        - from: $...TAINTED
          pattern: (StringBuilder $SB).append($...TAINTED)
          to: $SB
        - from: $...TAINTED
          pattern: $VAR += $...TAINTED
          to: $VAR
      pattern-sanitizers:
        - pattern-either:
            - pattern: Encode.forHtml(...)
            - pattern: (PolicyFactory $POLICY).sanitize(...)
            - pattern: (AntiSamy $AS).scan(...)
            - pattern: JSoup.clean(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: new ResponseEntity<>($PAYLOAD, ...)
                - pattern: new ResponseEntity<$ERROR>($PAYLOAD, ...)
                - pattern: ResponseEntity. ... .body($PAYLOAD)
                - patterns:
                    - pattern: |
                        ResponseEntity.$RESPFUNC($PAYLOAD). ...
                    - metavariable-regex:
                        metavariable: $RESPFUNC
                        regex: ^(ok|of)$
            - focus-metavariable: $PAYLOAD
          requires: CONCAT
      pattern-sources:
        - label: INPUT
          patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
        - by-side-effect: true
          label: CONCAT
          patterns:
            - pattern-either:
                - pattern: |
                    "$HTMLSTR" + ...
                - pattern: |
                    "$HTMLSTR".concat(...)
                - patterns:
                    - pattern-inside: |
                        StringBuilder $SB = new StringBuilder("$HTMLSTR");
                        ...
                    - pattern: $SB.append(...)
                - patterns:
                    - pattern-inside: |
                        $VAR = "$HTMLSTR";
                        ...
                    - pattern: $VAR += ...
                - pattern: String.format("$HTMLSTR", ...)
                - patterns:
                    - pattern-inside: |
                        String $VAR = "$HTMLSTR";
                        ...
                    - pattern: String.format($VAR, ...)
            - metavariable-regex:
                metavariable: $HTMLSTR
                regex: ^<\w+
          requires: INPUT
      severity: ERROR
    - id: java.spring.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - java
      message: User data flows into this manually-constructed SQL string. User data can be safely inserted into SQL strings using prepared statements or an object-relational mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL injection, which could let an attacker steal or manipulate data from the database. Instead, use prepared statements (`connection.PreparedStatement`) or a safe library.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html
        subcategory:
            - vuln
        technology:
            - spring
      mode: taint
      options:
        interfile: true
        taint_assume_safe_booleans: true
        taint_assume_safe_numbers: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$SQLSTR" + ...
                - pattern: |
                    "$SQLSTR".concat(...)
                - patterns:
                    - pattern-inside: |
                        StringBuilder $SB = new StringBuilder("$SQLSTR");
                        ...
                    - pattern: $SB.append(...)
                - patterns:
                    - pattern-inside: |
                        $VAR = "$SQLSTR";
                        ...
                    - pattern: $VAR += ...
                - pattern: String.format("$SQLSTR", ...)
                - patterns:
                    - pattern-inside: |
                        String $VAR = "$SQLSTR";
                        ...
                    - pattern: String.format($VAR, ...)
            - pattern-not-inside: System.out.println(...)
            - pattern-not-inside: $LOG.info(...)
            - pattern-not-inside: $LOG.warn(...)
            - pattern-not-inside: $LOG.warning(...)
            - pattern-not-inside: $LOG.debug(...)
            - pattern-not-inside: $LOG.debugging(...)
            - pattern-not-inside: $LOG.error(...)
            - pattern-not-inside: new Exception(...)
            - pattern-not-inside: throw ...;
            - metavariable-regex:
                metavariable: $SQLSTR
                regex: (?i)(select|delete|insert|create|update|alter|drop)\b
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue)
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - focus-metavariable: $SOURCE
      severity: ERROR
    - id: java.spring.security.injection.tainted-system-command.tainted-system-command
      languages:
        - java
      message: 'Detected user input entering a method which executes a system command. This could result in a command injection vulnerability, which allows an attacker to inject an arbitrary system command onto the server. The attacker could download malware onto or steal data from the server. Instead, use ProcessBuilder, separating the command into individual arguments, like this: `new ProcessBuilder("ls", "-al", targetDirectory)`. Further, make sure you hardcode or allowlist the actual command so that attackers can''t run arbitrary commands.'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.stackhawk.com/blog/command-injection-java/
            - https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
            - https://github.com/github/codeql/blob/main/java/ql/src/Security/CWE/CWE-078/ExecUnescaped.java
        subcategory:
            - vuln
        technology:
            - java
            - spring
      mode: taint
      pattern-propagators:
        - from: $INPUT
          label: CONCAT
          pattern: (StringBuilder $STRB).append($INPUT)
          requires: INPUT
          to: $STRB
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (Process $P) = new Process(...);
                - pattern: |
                    (ProcessBuilder $PB).command(...);
                - patterns:
                    - pattern-either:
                        - pattern: |
                            (Runtime $R).$EXEC(...);
                        - pattern: |
                            Runtime.getRuntime(...).$EXEC(...);
                    - metavariable-regex:
                        metavariable: $EXEC
                        regex: (exec|loadLibrary|load)
                - patterns:
                    - pattern: |
                        (ProcessBuilder $PB).command(...).$ADD(...);
                    - metavariable-regex:
                        metavariable: $ADD
                        regex: (add|addAll)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-inside: |
                                $BUILDER = new ProcessBuilder(...);
                                ...
                            - pattern: $BUILDER.start(...)
                        - pattern: |
                            new ProcessBuilder(...). ... .start(...);
          requires: CONCAT
      pattern-sources:
        - label: INPUT
          patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
        - label: CONCAT
          patterns:
            - pattern-either:
                - pattern: $X + $SOURCE
                - pattern: $SOURCE + $Y
                - pattern: String.format("...", ..., $SOURCE, ...)
                - pattern: String.join("...", ..., $SOURCE, ...)
                - pattern: (String $STR).concat($SOURCE)
                - pattern: $SOURCE.concat(...)
                - pattern: $X += $SOURCE
                - pattern: $SOURCE += $X
          requires: INPUT
      severity: ERROR
    - id: java.spring.security.injection.tainted-url-host.tainted-url-host
      languages:
        - java
      message: User data flows into the host portion of this manually-constructed URL. This could allow an attacker to send data to their own server, potentially exposing sensitive data such as cookies or authorization information sent with this request. They could also probe internal servers or other resources that the server running this code can access. (This is called server-side request forgery, or SSRF.) Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, hardcode the correct host, or ensure that the user data can only affect the path or parameters.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - java
            - spring
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - pattern-either:
            - pattern: new URL($ONEARG)
            - patterns:
                - pattern-either:
                    - pattern: |
                        "$URLSTR" + ...
                    - pattern: |
                        "$URLSTR".concat(...)
                    - patterns:
                        - pattern-inside: |
                            StringBuilder $SB = new StringBuilder("$URLSTR");
                            ...
                        - pattern: $SB.append(...)
                    - patterns:
                        - pattern-inside: |
                            $VAR = "$URLSTR";
                            ...
                        - pattern: $VAR += ...
                    - patterns:
                        - pattern: String.format("$URLSTR", ...)
                        - pattern-not: String.format("$URLSTR", "...", ...)
                    - patterns:
                        - pattern-inside: |
                            String $VAR = "$URLSTR";
                            ...
                        - pattern: String.format($VAR, ...)
                - metavariable-regex:
                    metavariable: $URLSTR
                    regex: http(s?)://%(v|s|q).*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
      severity: ERROR
    - id: javascript.angular.security.detect-angular-element-taint.detect-angular-element-taint
      languages:
        - javascript
        - typescript
      message: Use of angular.element can lead to XSS if user-input is treated as part of the HTML element within `$SINK`. It is recommended to contextually output encode user-input, before inserting into `$SINK`. If the HTML needs to be preserved it is recommended to sanitize the input using $sce.getTrustedHTML or $sanitize.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.angularjs.org/api/ng/function/angular.element
            - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
        subcategory:
            - vuln
        technology:
            - angularjs
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: $sce.getTrustedHtml(...)
                - pattern: $sanitize(...)
                - pattern: DOMPurify.sanitize(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    angular.element(...). ... .$SINK($QUERY)
                - pattern-inside: |
                    $ANGULAR = angular.element(...)
                    ...
                    $ANGULAR. ... .$SINK($QUERY)
            - metavariable-regex:
                metavariable: $SINK
                regex: ^(after|append|html|prepend|replaceWith|wrap)$
            - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: window.location.search
                - pattern: window.document.location.search
                - pattern: document.location.search
                - pattern: location.search
                - pattern: $location.search(...)
        - patterns:
            - pattern-either:
                - pattern: $DECODE(<... location.hash ...>)
                - pattern: $DECODE(<... window.location.hash ...>)
                - pattern: $DECODE(<... document.location.hash ...>)
                - pattern: $DECODE(<... location.href ...>)
                - pattern: $DECODE(<... window.location.href ...>)
                - pattern: $DECODE(<... document.location.href ...>)
                - pattern: $DECODE(<... document.URL ...>)
                - pattern: $DECODE(<... window.document.URL ...>)
                - pattern: $DECODE(<... document.location.href ...>)
                - pattern: $DECODE(<... document.location.href ...>)
                - pattern: $DECODE(<... $location.absUrl() ...>)
                - pattern: $DECODE(<... $location.url() ...>)
                - pattern: $DECODE(<... $location.hash() ...>)
            - metavariable-regex:
                metavariable: $DECODE
                regex: ^(unescape|decodeURI|decodeURIComponent)$
        - patterns:
            - pattern-inside: $http.$METHOD(...).$CONTINUE(function $FUNC($RES) {...})
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|delete|head|jsonp|post|put|patch)
            - pattern: $RES.data
      severity: WARNING
    - id: javascript.angular.security.detect-angular-sce-disabled.detect-angular-sce-disabled
      languages:
        - javascript
        - typescript
      message: $sceProvider is set to false. Disabling Strict Contextual escaping (SCE) in an AngularJS application could provide additional attack surface for XSS vulnerabilities.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.angularjs.org/api/ng/service/$sce
            - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
        subcategory:
            - vuln
        technology:
            - angular
      pattern: |
        $sceProvider.enabled(false);
      severity: ERROR
    - id: javascript.angular.security.detect-angular-trust-as-method.detect-angular-trust-as-method
      languages:
        - javascript
        - typescript
      message: The use of $sce.trustAs can be dangerous if unsanitized user input flows through this API.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.angularjs.org/api/ng/service/$sce
            - https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170727_AngularJS.pdf
        subcategory:
            - vuln
        technology:
            - angular
      mode: taint
      pattern-sinks:
        - pattern: $sce.trustAs(...)
        - pattern: $sce.trustAsHtml(...)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                app.controller(..., function($scope,$sce) {
                ...
                });
            - pattern: $scope.$X
      severity: WARNING
    - id: javascript.apollo.security.apollo-axios-ssrf.apollo-axios-ssrf
      languages:
        - javascript
      message: User-controllable argument $DATAVAL to $METHOD passed to Axios via internal handler $INNERFUNC. This could be a server-side request forgery. A user could call a restricted API or leak internal headers to an unauthorized party. Validate your user arguments against an allowlist of known URLs, or consider refactoring so that user-controlled data is not necessary.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://www.cvedetails.com/cve/CVE-2020-28168/
            - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
        subcategory:
            - audit
        technology:
            - apollo
            - axios
      patterns:
        - pattern: const $RESPONSE = await axios.request($INNERARG,...)
        - pattern-inside: |
            Query: {
              $METHOD(parent, args, context, info) {
                ...
                $DATA = args.$DATAVAL
                ...
                async function $INNERFUNC(...,$INNERARG,...){
                  ...
                }
                ...
                return $INNERFUNC(...,$DATA,...)
                }
              }
      severity: WARNING
    - id: javascript.argon2.security.unsafe-argon2-config.unsafe-argon2-config
      languages:
        - javascript
        - typescript
      message: Prefer Argon2id where possible. Per RFC9016, section 4 IETF recommends selecting Argon2id unless you can guarantee an adversary has no direct access to the computing environment.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-916: Use of Password Hash With Insufficient Computational Effort'
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
            - https://eprint.iacr.org/2016/759.pdf
            - https://www.cs.tau.ac.il/~tromer/papers/cache-joc-20090619.pdf
            - https://datatracker.ietf.org/doc/html/rfc9106#section-4
        subcategory:
            - vuln
        technology:
            - argon2
            - cryptography
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                {type: $ARGON.argon2id}
                ...
      pattern-sinks:
        - patterns:
            - pattern: |
                $Y
            - pattern-inside: |
                $ARGON.hash(...,$Y)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $ARGON = require('argon2');
                ...
            - pattern: |
                {type: ...}
      severity: WARNING
    - id: javascript.aws-lambda.security.detect-child-process.detect-child-process
      languages:
        - javascript
        - typescript
      message: Allowing spawning arbitrary programs or running shell processes with arbitrary arguments may end up in a command injection vulnerability. Try to avoid non-literal values for the command string. If it is not possible, then do not let running arbitrary commands, use a white list for inputs.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - javascript
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - pattern: exec($CMD,...)
                - pattern: execSync($CMD,...)
                - pattern: spawn($CMD,...)
                - pattern: spawnSync($CMD,...)
                - pattern: $CP.exec($CMD,...)
                - pattern: $CP.execSync($CMD,...)
                - pattern: $CP.spawn($CMD,...)
                - pattern: $CP.spawnSync($CMD,...)
            - pattern-either:
                - pattern-inside: |
                    require('child_process')
                    ...
                - pattern-inside: |
                    import 'child_process'
                    ...
      pattern-sources:
        - patterns:
            - pattern: $EVENT
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
      severity: ERROR
    - id: javascript.aws-lambda.security.dynamodb-request-object.dynamodb-request-object
      languages:
        - javascript
        - typescript
      message: Detected DynamoDB query params that are tainted by `$EVENT` object. This could lead to NoSQL injection if the variable is user-controlled and not properly sanitized. Explicitly assign query params instead of passing data from `$EVENT` directly to DynamoDB client.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - javascript
            - aws-lambda
            - dynamodb
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                {...}
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern: |
                $DC.$METHOD($SINK, ...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (query|send|scan|delete|put|transactWrite|update|batchExecuteStatement|executeStatement|executeTransaction|transactWriteItems)
            - pattern-either:
                - pattern-inside: |
                    $DC = new $AWS.DocumentClient(...);
                    ...
                - pattern-inside: |
                    $DC = new $AWS.DynamoDB(...);
                    ...
                - pattern-inside: |
                    $DC = new DynamoDBClient(...);
                    ...
                - pattern-inside: |
                    $DC = DynamoDBDocumentClient.from(...);
                    ...
      pattern-sources:
        - patterns:
            - pattern: $EVENT
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
      severity: ERROR
    - id: javascript.aws-lambda.security.knex-sqli.knex-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `knex.raw(''SELECT $1 from table'', [userinput])`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://knexjs.org/#Builder-fromRaw
            - https://knexjs.org/#Builder-whereRaw
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - knex
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $KNEX.fromRaw($QUERY, ...)
                - pattern: $KNEX.whereRaw($QUERY, ...)
                - pattern: $KNEX.raw($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    require('knex')
                    ...
                - pattern-inside: |
                    import 'knex'
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.mysql-sqli.mysql-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `connection.query(''SELECT $1 from table'', [userinput])`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.npmjs.com/package/mysql2
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - mysql
            - mysql2
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $POOL.query($QUERY, ...)
                - pattern: $POOL.execute($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    require('mysql')
                    ...
                - pattern-inside: |
                    require('mysql2')
                    ...
                - pattern-inside: |
                    require('mysql2/promise')
                    ...
                - pattern-inside: |
                    import 'mysql'
                    ...
                - pattern-inside: |
                    import 'mysql2'
                    ...
                - pattern-inside: |
                    import 'mysql2/promise'
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.pg-sqli.pg-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `connection.query(''SELECT $1 from table'', [userinput])`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://node-postgres.com/features/queries
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - postgres
            - pg
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $DB.query($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    require('pg')
                    ...
                - pattern-inside: |
                    import 'pg'
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.sequelize-sqli.sequelize-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected SQL statement that is tainted by `$EVENT` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `sequelize.query(''SELECT * FROM projects WHERE status = ?'', { replacements: [''active''], type: QueryTypes.SELECT });`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://sequelize.org/master/manual/raw-queries.html
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - sequelize
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $DB.query($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    require('sequelize')
                    ...
                - pattern-inside: |
                    import 'sequelize'
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.tainted-eval.tainted-eval
      languages:
        - javascript
        - typescript
      message: The `eval()` function evaluates JavaScript code represented as a string. Executing JavaScript from a string is an enormous security risk. It is far too easy for a bad actor to run arbitrary code when you use `eval()`. Ensure evaluated content is not definable by external sources.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - javascript
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CODE
            - pattern-either:
                - pattern: eval($CODE)
                - pattern: Function(...,$CODE)
                - pattern: new Function(...,$CODE)
      pattern-sources:
        - patterns:
            - pattern: $EVENT
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
      severity: WARNING
    - id: javascript.aws-lambda.security.tainted-html-response.tainted-html-response
      languages:
        - javascript
        - typescript
      message: Detected user input flowing into an HTML response. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $BODY
            - pattern-inside: |
                {..., headers: {..., 'Content-Type': 'text/html', ...}, body: $BODY, ... }
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.tainted-html-string.tainted-html-string
      languages:
        - javascript
        - typescript
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. To be sure this is safe, check that the HTML is rendered safely. Otherwise, use templates which will safely render HTML instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: |
                            "$HTMLSTR" + $EXPR
                        - pattern: |
                            "$HTMLSTR".concat(...)
                        - pattern: $UTIL.format($HTMLSTR, ...)
                        - pattern: format($HTMLSTR, ...)
                    - metavariable-pattern:
                        language: generic
                        metavariable: $HTMLSTR
                        pattern: <$TAG ...
                - patterns:
                    - pattern: |
                        `...${...}...`
                    - pattern-regex: |
                        .*<\w+.*
            - pattern-not-inside: |
                console.$LOG(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: WARNING
    - id: javascript.aws-lambda.security.tainted-sql-string.tainted-sql-string
      languages:
        - javascript
        - typescript
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: |
                            "$SQLSTR" + $EXPR
                        - pattern: |
                            "$SQLSTR".concat(...)
                        - pattern: util.format($SQLSTR, ...)
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
                - patterns:
                    - pattern: |
                        `...${...}...`
                    - pattern-regex: |
                        .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
            - pattern-not-inside: |
                console.$LOG(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
            - pattern: $EVENT
      severity: ERROR
    - id: javascript.aws-lambda.security.vm-runincontext-injection.vm-runincontext-injection
      languages:
        - javascript
        - typescript
      message: The `vm` module enables compiling and running code within V8 Virtual Machine contexts. The `vm` module is not a security mechanism. Do not use it to run untrusted code. If code passed to `vm` functions is controlled by user input it could result in command injection. Do not let user input in `vm` functions.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - javascript
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('vm');
                    ...
                - pattern-inside: |
                    import 'vm'
                    ...
            - pattern-either:
                - pattern: $VM.runInContext($X,...)
                - pattern: $VM.runInNewContext($X,...)
                - pattern: $VM.runInThisContext($X,...)
                - pattern: $VM.compileFunction($X,...)
                - pattern: new $VM.Script($X,...)
                - pattern: new $VM.SourceTextModule($X,...)
                - pattern: runInContext($X,...)
                - pattern: runInNewContext($X,...)
                - pattern: runInThisContext($X,...)
                - pattern: compileFunction($X,...)
                - pattern: new Script($X,...)
                - pattern: new SourceTextModule($X,...)
      pattern-sources:
        - patterns:
            - pattern: $EVENT
            - pattern-either:
                - pattern-inside: |
                    exports.handler = function ($EVENT, ...) {
                      ...
                    }
                - pattern-inside: |
                    function $FUNC ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
                - pattern-inside: |
                    $FUNC = function ($EVENT, ...) {...}
                    ...
                    exports.handler = $FUNC
      severity: ERROR
    - id: javascript.bluebird.security.audit.tofastproperties-code-execution.tofastproperties-code-execution
      languages:
        - javascript
        - typescript
      message: Potential arbitrary code execution, whatever is provided to `toFastProperties` is sent straight to eval()
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - http://bluebirdjs.com/docs/getting-started.html
        subcategory:
            - vuln
        technology:
            - bluebird
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $UTIL.toFastProperties($SINK,...)
                - pattern: toFastProperties($SINK,...)
            - pattern-either:
                - pattern-inside: |
                    $BB = require('bluebird');
                    ...
                - pattern-inside: |
                    import 'bluebird';
                    ...
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-inside: function ... (..., $ARG,...) {...}
            - focus-metavariable: $ARG
      severity: WARNING
    - id: javascript.browser.security.dom-based-xss.dom-based-xss
      languages:
        - javascript
        - typescript
      message: 'Detected possible DOM-based XSS. This occurs because a portion of the URL is being used to construct an element added directly to the page. For example, a malicious actor could send someone a link like this: http://www.some.site/page.html?default=<script>alert(document.cookie)</script> which would add the script to the page. Consider allowlisting appropriate values or using an approach which does not involve the URL.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/DOM_Based_XSS
        subcategory:
            - audit
        technology:
            - browser
      pattern-either:
        - pattern: document.write(<... document.location.$W ...>)
        - pattern: document.write(<... location.$W ...>)
      severity: ERROR
    - id: javascript.browser.security.eval-detected.eval-detected
      languages:
        - javascript
        - typescript
      message: Detected the use of eval(). eval() can be dangerous if used to evaluate dynamic content. If this content can be input from outside the program, this may be a code injection vulnerability. Ensure evaluated content is not definable by external sources.
      metadata:
        asvs:
            control_id: 5.2.4 Dynamic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - browser
      patterns:
        - pattern-not: eval("...")
        - pattern: eval(...)
      severity: WARNING
    - id: javascript.browser.security.insecure-document-method.insecure-document-method
      languages:
        - javascript
        - typescript
      message: User controlled data in methods like `innerHTML`, `outerHTML` or `document.write` is an anti-pattern that can lead to XSS vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - browser
      patterns:
        - pattern-either:
            - pattern: |
                $EL.innerHTML = $HTML;
            - pattern: |
                $EL.outerHTML = $HTML;
            - pattern: document.write(...)
        - pattern-not: |
            $EL.innerHTML = "...";
        - pattern-not: |
            $EL.outerHTML = "...";
        - pattern-not: document.write("...")
      severity: ERROR
    - id: javascript.browser.security.insecure-innerhtml.insecure-innerhtml
      languages:
        - javascript
        - typescript
      message: User controlled data in a `$EL.innerHTML` is an anti-pattern that can lead to XSS vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - browser
      patterns:
        - pattern: |
            $EL.innerHTML = $HTML;
        - pattern-not: |
            $EL.innerHTML = "...";
      severity: ERROR
    - id: javascript.browser.security.insufficient-postmessage-origin-validation.insufficient-postmessage-origin-validation
      languages:
        - javascript
        - typescript
      message: No validation of origin is done by the addEventListener API. It may be possible to exploit this flaw to perform Cross Origin attacks such as Cross-Site Scripting(XSS).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        subcategory:
            - audit
        technology:
            - browser
      pattern-either:
        - patterns:
            - pattern: |
                window.addEventListener('message', $FUNC, ...)
            - metavariable-pattern:
                metavariable: $FUNC
                patterns:
                    - pattern: |
                        function($OBJ) { ... }
                    - pattern-not: |
                        function($OBJ) { ... if (<... $OBJ.origin ...>) { ... } ... }
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    function $FNAME($OBJ) { $CONTEXT }
                    ...
                - pattern-inside: |
                    $FNAME = (...) => { $CONTEXT }
                    ...
            - pattern: |
                window.addEventListener('message', $FNAME,...)
            - metavariable-pattern:
                metavariable: $CONTEXT
                patterns:
                    - pattern-not: |
                        ... if (<... $OBJ.origin ...>) { ... } ...
      severity: WARNING
    - id: javascript.browser.security.open-redirect-from-function.js-open-redirect-from-function
      languages:
        - javascript
        - typescript
      message: The application accepts potentially user-controlled input `$PROP` which can control the location of the current window context. This can lead two types of vulnerabilities open-redirection and Cross-Site-Scripting (XSS) with JavaScript URIs. It is recommended to validate user-controllable input before allowing it to control the redirection.
      metadata:
        asvs:
            control_id: 5.5.1 Insecue Redirect
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - browser
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: location.href = $SINK
                - pattern: window.location.href = $SINK
                - pattern: this.window.location.href = $SINK
                - pattern: this.location.href = $SINK
                - pattern: location.replace($SINK)
                - pattern: window.location.replace($SINK)
                - pattern: this.window.location.replace($SINK)
                - pattern: this.location.replace($SINK)
            - focus-metavariable: $SINK
            - metavariable-pattern:
                metavariable: $SINK
                patterns:
                    - pattern-not: |
                        "..." + $VALUE
                    - pattern-not: |
                        `...${$VALUE}`
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (..., $PROP, ...) { ... }
            - focus-metavariable: $PROP
      severity: INFO
    - id: javascript.browser.security.open-redirect.js-open-redirect
      languages:
        - javascript
        - typescript
      message: The application accepts potentially user-controlled input `$PROP` which can control the location of the current window context. This can lead two types of vulnerabilities open-redirection and Cross-Site-Scripting (XSS) with JavaScript URIs. It is recommended to validate user-controllable input before allowing it to control the redirection.
      metadata:
        asvs:
            control_id: 5.5.1 Insecue Redirect
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v51-input-validation
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - browser
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: location.href = $SINK
                - pattern: $THIS. ... .location.href = $SINK
                - pattern: location.replace($SINK)
                - pattern: $THIS. ... .location.replace($SINK)
                - pattern: location = $SINK
                - pattern: $WINDOW. ... .location = $SINK
            - focus-metavariable: $SINK
            - metavariable-pattern:
                metavariable: $SINK
                patterns:
                    - pattern-not: |
                        "..." + $VALUE
                    - pattern-not: |
                        `...${$VALUE}`
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROP = new URLSearchParams($WINDOW. ... .location.search).get('...')
                    ...
                - pattern-inside: |
                    $PROP = new URLSearchParams(location.search).get('...')
                    ...
                - pattern-inside: |
                    $PROP = new URLSearchParams($WINDOW. ... .location.hash.substring(1)).get('...')
                    ...
                - pattern-inside: |
                    $PROP = new URLSearchParams(location.hash.substring(1)).get('...')
                    ...
            - pattern: $PROP
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROPS = new URLSearchParams($WINDOW. ... .location.search)
                    ...
                - pattern-inside: |
                    $PROPS = new URLSearchParams(location.search)
                    ...
                - pattern-inside: |
                    $PROPS = new URLSearchParams($WINDOW. ... .location.hash.substring(1))
                    ...
                - pattern-inside: |
                    $PROPS = new URLSearchParams(location.hash.substring(1))
                    ...
            - pattern: $PROPS.get('...')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROPS = new URL($WINDOW. ... .location.href)
                    ...
                - pattern-inside: |
                    $PROPS = new URL(location.href)
                    ...
            - pattern: $PROPS.searchParams.get('...')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROPS = new URL($WINDOW. ... .location.href).searchParams.get('...')
                    ...
                - pattern-inside: |
                    $PROPS = new URL(location.href).searchParams.get('...')
                    ...
            - pattern: $PROPS
      severity: WARNING
    - id: javascript.browser.security.raw-html-concat.raw-html-concat
      languages:
        - javascript
        - typescript
      message: User controlled data in a HTML string may result in XSS
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/xss/
        subcategory:
            - vuln
        technology:
            - browser
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $S = new Remarkable()
                    ...
            - pattern: $S.render(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $STRING + $EXPR
                    - pattern-not: $STRING + "..."
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: <$TAG ...
                            - pattern-not: <$TAG ...>...</$TAG>...
                - patterns:
                    - pattern: $EXPR + $STRING
                    - pattern-not: '"..." + $STRING'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: '... </$TAG'
                - patterns:
                    - pattern: '[..., $STRING, ...].join(...)'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: <$TAG ...
                - patterns:
                    - pattern: '[..., $STRING, ...].join(...)'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: '... </$TAG'
                - patterns:
                    - pattern: $VAR += $STRING
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: <$TAG ...
                - patterns:
                    - pattern: $VAR += $STRING
                    - metavariable-pattern:
                        language: generic
                        metavariable: $STRING
                        patterns:
                            - pattern: '... </$TAG'
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: location.href
                - pattern: location.hash
                - pattern: location.search
                - pattern: $WINDOW. ... .location.href
                - pattern: $WINDOW. ... .location.hash
                - pattern: $WINDOW. ... .location.search
      severity: WARNING
    - id: javascript.browser.security.raw-html-join.raw-html-join
      languages:
        - javascript
        - typescript
      message: User controlled data in a HTML string may result in XSS
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/xss/
        subcategory:
            - audit
        technology:
            - browser
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    [..., $STRING, ...].join(...)
                - metavariable-pattern:
                    language: generic
                    metavariable: $STRING
                    patterns:
                        - pattern-either:
                            - pattern: |
                                ... </$TAG
                            - pattern: |
                                <$TAG ...
                - pattern-not: |
                    [..., "$HARDCODED", ...].join("...")
      severity: WARNING
    - id: javascript.browser.security.wildcard-postmessage-configuration.wildcard-postmessage-configuration
      languages:
        - javascript
        - typescript
      message: The target origin of the window.postMessage() API is set to "*". This could allow for information disclosure due to the possibility of any origin allowed to receive the message.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        subcategory:
            - audit
        technology:
            - browser
      pattern: $OBJECT.postMessage(...,'*')
      severity: WARNING
    - id: javascript.chrome-remote-interface.security.audit.chrome-remote-interface-compilescript-injection.chrome-remote-interface-compilescript-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `compileScript` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://github.com/cyrus-and/chrome-remote-interface
        subcategory:
            - vuln
        technology:
            - chrome-remote-interface
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('chrome-remote-interface');
                    ...
                - pattern-inside: |
                    import 'chrome-remote-interface';
                    ...
            - pattern-either:
                - pattern: |
                    $RUNTIME.compileScript({expression: $SINK},...)
                - pattern: |
                    $RUNTIME.evaluate({expression: $SINK},...)
                - pattern: |
                    $PAGE.navigate({url: $SINK},...)
                - pattern: |
                    $RUNTIME.printToPDF({headerTemplate: $SINK},...)
                - pattern: |
                    $RUNTIME.printToPDF({footerTemplate: $SINK},...)
                - pattern: |
                    $PAGE.setDocumentContent({html: $SINK},...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-inside: function ... (..., $ARG,...) {...}
            - focus-metavariable: $ARG
      severity: WARNING
    - id: javascript.deno.security.audit.deno-dangerous-run.deno-dangerous-run
      languages:
        - javascript
        - typescript
      message: Detected non-literal calls to Deno.run(). This could lead to a command injection vulnerability.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://deno.land/manual/examples/subprocess#simple-example
        subcategory:
            - vuln
        technology:
            - deno
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    Deno.run({cmd: [$INPUT,...]},...)
                - pattern: |
                    Deno.run({cmd: ["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",$INPUT,...]},...)
                - patterns:
                    - pattern: |
                        Deno.run({cmd: [$CMD,"-c",$INPUT,...]},...)
                    - pattern-inside: |
                        $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"
                        ...
            - focus-metavariable: $INPUT
      pattern-sources:
        - patterns:
            - pattern-inside: function ... (..., $ARG,...) {...}
            - focus-metavariable: $ARG
      severity: ERROR
    - id: javascript.express.security.audit.express-check-directory-listing.express-check-directory-listing
      languages:
        - javascript
        - typescript
      message: Directory listing/indexing is enabled, which may lead to disclosure of sensitive directories and files. It is recommended to disable directory listing unless it is a public resource. If you need directory listing, ensure that sensitive files are inaccessible when querying the resource.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-548: Exposure of Information Through Directory Listing'
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A06:2017 - Security Misconfiguration
            - A01:2021 - Broken Access Control
        references:
            - https://www.npmjs.com/package/serve-index
            - https://www.acunetix.com/blog/articles/directory-listing-information-disclosure/
        subcategory:
            - vuln
        technology:
            - express
      options:
        interfile: true
      patterns:
        - pattern-either:
            - pattern: |
                $APP.use(require('serve-index')(...))
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $SERVEINDEX = require('serve-index')
                        ...
                    - pattern-inside: |
                        import $SERVEINDEX from 'serve-index'
                        ...
                    - pattern-inside: |
                        import * as $SERVEINDEX from 'serve-index'
                        ...
                - pattern-either:
                    - patterns:
                        - pattern-inside: |
                            $VALUE = $SERVEINDEX(...)
                            ...
                        - pattern: |
                            $VALUE(...)
                    - pattern: |
                        $APP.use(..., $SERVEINDEX(...), ...)
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-default-name
      languages:
        - javascript
        - typescript
      message: 'Dont use the default session cookie name Using the default session cookie name can open your app to attacks. The security issue posed is similar to X-Powered-By: a potential attacker can use it to fingerprint the server and target attacks accordingly.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {name:...} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {name:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.name = ...;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-no-secure
      languages:
        - javascript
        - typescript
      message: 'Default session middleware settings: `secure` not set. It ensures the browser only sends the cookie over HTTPS.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {cookie:{secure:true}} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {cookie:{secure:true}} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE = <... {secure:true} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie = <... {secure:true} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE.secure = true;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie.secure = true;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-no-httponly
      languages:
        - javascript
        - typescript
      message: 'Default session middleware settings: `httpOnly` not set. It ensures the cookie is sent only over HTTP(S), not client JavaScript, helping to protect against cross-site scripting attacks.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {cookie:{httpOnly:true}} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {cookie:{httpOnly:true}} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE = <... {httpOnly:true} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie = <... {httpOnly:true} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE.httpOnly = true;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie.httpOnly = true;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-no-domain
      languages:
        - javascript
        - typescript
      message: 'Default session middleware settings: `domain` not set. It indicates the domain of the cookie; use it to compare against the domain of the server in which the URL is being requested. If they match, then check the path attribute next.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {cookie:{domain:...}} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {cookie:{domain:...}} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE = <... {domain:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie = <... {domain:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE.domain = ...;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie.domain = ...;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-no-path
      languages:
        - javascript
        - typescript
      message: 'Default session middleware settings: `path` not set. It indicates the path of the cookie; use it to compare against the request path. If this and domain match, then send the cookie in the request.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {cookie:{path:...}} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {cookie:{path:...}} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE = <... {path:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie = <... {path:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE.path = ...;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie.path = ...;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-cookie-settings.express-cookie-session-no-expires
      languages:
        - javascript
        - typescript
      message: 'Default session middleware settings: `expires` not set. Use it to set expiration date for persistent cookies.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://expressjs.com/en/advanced/best-practice-security.html
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('cookie-session');
                ...
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
        - pattern: $SESSION(...)
        - pattern-not-inside: $SESSION(<... {cookie:{expires:...}} ...>,...)
        - pattern-not-inside: |
            $OPTS = <... {cookie:{expires:...}} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE = <... {expires:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $OPTS.cookie = <... {expires:...} ...>;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |
            $OPTS = ...;
            ...
            $COOKIE.expires = ...;
            ...
            $SESSION($OPTS,...);
        - pattern-not-inside: |-
            $OPTS = ...;
            ...
            $OPTS.cookie.expires = ...;
            ...
            $SESSION($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-jwt-not-revoked.express-jwt-not-revoked
      languages:
        - javascript
        - typescript
      message: No token revoking configured for `express-jwt`. A leaked token could still be used and unable to be revoked. Consider using function as the `isRevoked` option.
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://github.com/goldbergyoni/nodebestpractices/blob/master/sections/security/expirejwt.md
        subcategory:
            - vuln
        technology:
            - express
      patterns:
        - pattern-inside: |
            $JWT = require('express-jwt');
            ...
        - pattern: $JWT(...)
        - pattern-not-inside: $JWT(<... {isRevoked:...} ...>,...)
        - pattern-not-inside: |-
            $OPTS = <... {isRevoked:...} ...>;
            ...
            $JWT($OPTS,...);
      severity: WARNING
    - id: javascript.express.security.audit.express-libxml-noent.express-libxml-noent
      languages:
        - javascript
        - typescript
      message: The libxml library processes user-input with the `noent` attribute is set to `true` which can lead to being vulnerable to XML External Entities (XXE) type attacks. It is recommended to set `noent` to `false` when using this feature to ensure you are protected.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        likelihood: HIGH
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $XML = require('$IMPORT')
                        ...
                    - pattern-inside: |
                        import $XML from '$IMPORT'
                          ...
                    - pattern-inside: |
                        import * as $XML from '$IMPORT'
                        ...
                - metavariable-regex:
                    metavariable: $IMPORT
                    regex: ^(libxmljs|libxmljs2)$
                - pattern-inside: $XML.$FUNC($QUERY, {...,noent:true,...})
                - metavariable-regex:
                    metavariable: $FUNC
                    regex: ^(parseXmlString|parseXml)$
                - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
                - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
                - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
                - pattern: files.$ANYTHING.data.toString('utf8')
                - pattern: files.$ANYTHING['data'].toString('utf8')
      severity: ERROR
    - id: javascript.express.security.audit.express-libxml-vm-noent.express-libxml-vm-noent
      languages:
        - javascript
        - typescript
      message: Detected use of parseXml() function with the `noent` field set to `true`. This can lead to an XML External Entities (XXE) attack if untrusted data is passed into it.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - express
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $VM.runInContext("$CMD", ...)
                    - pattern: $VM.runInNewContext("$CMD", ...)
                    - pattern: $VM.runInThisContext("$CMD", ...)
                    - pattern: $VM.compileFunction("$CMD", ...)
                - metavariable-pattern:
                    language: typescript
                    metavariable: $CMD
                    pattern-either:
                        - pattern: |
                            $LIBXML.parseXml($DATA, {..., noent: true, ...}, ...)
                        - patterns:
                            - pattern-inside: |
                                $OPTS = {..., noent: true, ...}
                                ...
                            - pattern: $LIBXML.parseXml( $DATA, $OPTS )
            - pattern: |
                $LIBXML.parseXml($DATA, {..., noent: true, ...}, ...)
            - patterns:
                - pattern-inside: |
                    $OPTS = {..., noent: true, ...}
                    ...
                - pattern: $LIBXML.parseXml( $DATA, $OPTS )
      severity: WARNING
    - id: javascript.express.security.audit.express-open-redirect.express-open-redirect
      languages:
        - javascript
        - typescript
      message: The application redirects to a URL specified by user-supplied input `$REQ` that is not validated. This could redirect users to malicious locations. Consider using an allow-list approach to validate URLs, or warn users they are being redirected to a third-party website.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        symbolic_propagation: true
        taint_unify_mvars: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $RES.redirect("$HTTP"+$REQ. ... .$VALUE)
                - pattern: $RES.redirect("$HTTP"+$REQ. ... .$VALUE + $...A)
                - pattern: $RES.redirect(`$HTTP${$REQ. ... .$VALUE}...`)
                - pattern: $RES.redirect("$HTTP"+$REQ.$VALUE[...])
                - pattern: $RES.redirect("$HTTP"+$REQ.$VALUE[...] + $...A)
                - pattern: $RES.redirect(`$HTTP${$REQ.$VALUE[...]}...`)
            - metavariable-regex:
                metavariable: $HTTP
                regex: ^https?:\/\/$
            - pattern-either:
                - pattern: $REQ. ... .$VALUE
        - patterns:
            - pattern-either:
                - pattern: $RES.redirect($REQ. ... .$VALUE)
                - pattern: $RES.redirect($REQ. ... .$VALUE + $...A)
                - pattern: $RES.redirect(`${$REQ. ... .$VALUE}...`)
            - pattern: $REQ. ... .$VALUE
        - patterns:
            - pattern-either:
                - pattern: $RES.redirect($REQ.$VALUE['...'])
                - pattern: $RES.redirect($REQ.$VALUE['...'] + $...A)
                - pattern: $RES.redirect(`${$REQ.$VALUE['...']}...`)
            - pattern: $REQ.$VALUE
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $ASSIGN = $REQ. ... .$VALUE
                    ...
                - pattern-inside: |
                    $ASSIGN = $REQ.$VALUE['...']
                    ...
                - pattern-inside: |
                    $ASSIGN = $REQ. ... .$VALUE + $...A
                    ...
                - pattern-inside: "$ASSIGN = $REQ.$VALUE['...'] + $...A\n...     \n"
                - pattern-inside: |
                    $ASSIGN = `${$REQ. ... .$VALUE}...`
                    ...
                - pattern-inside: "$ASSIGN = `${$REQ.$VALUE['...']}...`\n...                    \n"
            - pattern-either:
                - pattern: $RES.redirect($ASSIGN)
                - pattern: $RES.redirect($ASSIGN + $...FOO)
                - pattern: $RES.redirect(`${$ASSIGN}...`)
            - focus-metavariable: $ASSIGN
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.audit.express-path-join-resolve-traversal.express-path-join-resolve-traversal
      languages:
        - javascript
        - typescript
      message: Possible writing outside of the destination, make sure that the target path is nested in the intended destination
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - vuln
        technology:
            - express
            - node.js
      mode: taint
      pattern-sanitizers:
        - pattern: $Y.replace(...)
        - pattern: $Y.indexOf(...)
        - pattern: |
            function ... (...) {
                ...
                <... $Y.indexOf(...) ...>
                ...
            }
        - patterns:
            - pattern: $FUNC(...)
            - metavariable-regex:
                metavariable: $FUNC
                regex: sanitize
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern-either:
                - pattern-inside: |
                    $PATH = require('path');
                    ...
                - pattern-inside: |
                    import $PATH from 'path';
                    ...
            - pattern-either:
                - pattern: $PATH.join(...,$SINK,...)
                - pattern: $PATH.resolve(...,$SINK,...)
        - patterns:
            - focus-metavariable: $SINK
            - pattern-inside: |
                import 'path';
                ...
            - pattern-either:
                - pattern: path.join(...,$SINK,...)
                - pattern: path.resolve(...,$SINK,...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.audit.express-res-sendfile.express-res-sendfile
      languages:
        - javascript
        - typescript
      message: The application processes user-input, this is passed to res.sendFile which can allow an attacker to arbitrarily read files on the system through path traversal. It is recommended to perform input validation in addition to canonicalizing the path. This allows you to validate the path against the intended directory it should be accessing.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-73: External Control of File Name or Path'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $RES.$METH($QUERY,...)
            - pattern-not-inside: $RES.$METH($QUERY,$OPTIONS)
            - metavariable-regex:
                metavariable: $METH
                regex: ^(sendfile|sendFile)$
            - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            function ... (...,$REQ: $TYPE, ...) {...}
                    - metavariable-regex:
                        metavariable: $TYPE
                        regex: ^(string|String)
      severity: WARNING
    - id: javascript.express.security.audit.express-session-hardcoded-secret.express-session-hardcoded-secret
      languages:
        - javascript
        - typescript
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
            - secrets
      options:
        interfile: true
      patterns:
        - pattern-either:
            - pattern-inside: |
                $SESSION = require('express-session');
                ...
            - pattern-inside: |
                import $SESSION from 'express-session'
                ...
            - pattern-inside: |
                import {..., $SESSION, ...} from 'express-session'
                ...
            - pattern-inside: |
                import * as $SESSION from 'express-session'
                ...
        - patterns:
            - pattern-either:
                - pattern-inside: $APP.use($SESSION({...}))
                - pattern: |
                    $SECRET = $VALUE
                    ...
                    $APP.use($SESSION($SECRET))
            - pattern: |
                secret: '$Y'
      severity: WARNING
    - id: javascript.express.security.audit.express-ssrf.express-ssrf
      languages:
        - javascript
        - typescript
      message: 'The following request $REQUEST.$METHOD() was found to be crafted from user-input `$REQ` which can lead to Server-Side Request Forgery (SSRF) vulnerabilities. It is recommended where possible to not allow user-input to craft the base request, but to be treated as part of the path or query parameter. When user-input is necessary to craft the request, it is recommeneded to follow OWASP best practices to prevent abuse. '
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        taint_unify_mvars: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $REQUEST = require('request')
                    ...
                - pattern-inside: |
                    import * as $REQUEST from 'request'
                    ...
                - pattern-inside: |
                    import $REQUEST from 'request'
                    ...
            - pattern-either:
                - pattern: $REQUEST.$METHOD("$HTTP"+$REQ. ... .$VALUE)
                - pattern: $REQUEST.$METHOD("$HTTP"+$REQ. ... .$VALUE + $...A)
                - pattern: $REQUEST.$METHOD(`$HTTP${$REQ. ... .$VALUE}...`)
                - pattern: $REQUEST.$METHOD("$HTTP"+$REQ.$VALUE[...])
                - pattern: $REQUEST.$METHOD("$HTTP"+$REQ.$VALUE[...] + $...A)
                - pattern: $REQUEST.$METHOD(`$HTTP${$REQ.$VALUE[...]}...`)
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|post|put|patch|del|head|delete)$
            - metavariable-regex:
                metavariable: $HTTP
                regex: ^(https?:\/\/|//)$
            - pattern-either:
                - pattern: $REQ. ... .$VALUE
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $REQUEST = require('request')
                    ...
                - pattern-inside: |
                    import * as $REQUEST from 'request'
                    ...
                - pattern-inside: |
                    import $REQUEST from 'request'
                    ...
            - pattern-either:
                - pattern: $REQUEST.$METHOD($REQ. ... .$VALUE,...)
                - pattern: $REQUEST.$METHOD($REQ. ... .$VALUE + $...A,...)
                - pattern: $REQUEST.$METHOD(`${$REQ. ... .$VALUE}...`,...)
            - pattern: $REQ. ... .$VALUE
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|post|put|patch|del|head|delete)$
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $REQUEST = require('request')
                    ...
                - pattern-inside: |
                    import * as $REQUEST from 'request'
                    ...
                - pattern-inside: |
                    import $REQUEST from 'request'
                    ...
            - pattern-either:
                - pattern: $REQUEST.$METHOD($REQ.$VALUE['...'],...)
                - pattern: $REQUEST.$METHOD($REQ.$VALUE['...'] + $...A,...)
                - pattern: $REQUEST.$METHOD(`${$REQ.$VALUE['...']}...`,...)
            - pattern: $REQ.$VALUE
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|post|put|patch|del|head|delete)$
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $REQUEST = require('request')
                    ...
                - pattern-inside: |
                    import * as $REQUEST from 'request'
                    ...
                - pattern-inside: |
                    import $REQUEST from 'request'
                    ...
            - pattern-either:
                - pattern-inside: |
                    $ASSIGN = $REQ. ... .$VALUE
                    ...
                - pattern-inside: |
                    $ASSIGN = $REQ. ... .$VALUE['...']
                    ...
                - pattern-inside: |
                    $ASSIGN = $REQ. ... .$VALUE + $...A
                    ...
                - pattern-inside: "$ASSIGN = $REQ. ... .$VALUE['...'] + $...A\n...     \n"
                - pattern-inside: |
                    $ASSIGN = `${$REQ. ... .$VALUE}...`
                    ...
                - pattern-inside: "$ASSIGN = `${$REQ. ... .$VALUE['...']}...`\n... \n"
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            $ASSIGN = "$HTTP"+ $REQ. ... .$VALUE
                            ...
                        - pattern-inside: |
                            $ASSIGN = "$HTTP"+$REQ. ... .$VALUE + $...A
                            ...
                        - pattern-inside: |
                            $ASSIGN = "$HTTP"+$REQ.$VALUE[...]
                            ...
                        - pattern-inside: |
                            $ASSIGN = "$HTTP"+$REQ.$VALUE[...] + $...A
                            ...
                        - pattern-inside: |
                            $ASSIGN = `$HTTP${$REQ.$VALUE[...]}...`
                            ...
                    - metavariable-regex:
                        metavariable: $HTTP
                        regex: ^(https?:\/\/|//)$
            - pattern-either:
                - pattern: $REQUEST.$METHOD($ASSIGN,...)
                - pattern: $REQUEST.$METHOD($ASSIGN + $...FOO,...)
                - pattern: $REQUEST.$METHOD(`${$ASSIGN}...`,...)
                - patterns:
                    - pattern-either:
                        - pattern: $REQUEST.$METHOD("$HTTP"+$ASSIGN,...)
                        - pattern: $REQUEST.$METHOD("$HTTP"+$ASSIGN + $...A,...)
                        - pattern: $REQUEST.$METHOD(`$HTTP${$ASSIGN}...`,...)
                    - metavariable-regex:
                        metavariable: $HTTP
                        regex: ^(https?:\/\/|//)$
            - pattern: $ASSIGN
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|post|put|patch|del|head|delete)$
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, ...) {...}
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,...) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: $EXPRESS.Request,...) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.audit.express-third-party-object-deserialization.express-third-party-object-deserialization
      languages:
        - javascript
        - typescript
      message: The following function call $SER.$FUNC accepts user controlled data which can result in Remote Code Execution (RCE) through Object Deserialization. It is recommended to use secure data processing alternatives such as JSON.parse() and Buffer.from().
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        likelihood: HIGH
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
        source_rule_url:
            - https://github.com/ajinabraham/njsscan/blob/75bfbeb9c8d72999e4d527dfa2548f7f0f3cc48a/njsscan/rules/semantic_grep/eval/eval_deserialize.yaml
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $SER = require('$IMPORT')
                        ...
                    - pattern-inside: |
                        import $SER from '$IMPORT'
                         ...
                    - pattern-inside: |
                        import * as $SER from '$IMPORT'
                        ...
                - metavariable-regex:
                    metavariable: $IMPORT
                    regex: ^(node-serialize|serialize-to-js)$
                - pattern: $SER.$FUNC(...)
                - metavariable-regex:
                    metavariable: $FUNC
                    regex: ^(unserialize|deserialize)$
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
                - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
                - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
                - pattern: files.$ANYTHING.data.toString('utf8')
                - pattern: files.$ANYTHING['data'].toString('utf8')
      severity: WARNING
    - id: javascript.express.security.audit.express-xml2json-xxe-event.express-xml2json-xxe-event
      languages:
        - javascript
        - typescript
      message: Xml Parser is used inside Request Event. Make sure that unverified user data can not reach the XML Parser, as it can result in XML External or Internal Entity (XXE) Processing vulnerabilities
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.npmjs.com/package/xml2json
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('xml2json');
                    ...
                - pattern-inside: |
                    import 'xml2json';
                    ...
            - pattern: $REQ.on('...', function(...) { ... $EXPAT.toJson($INPUT,...); ... })
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) => {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.audit.res-render-injection.res-render-injection
      languages:
        - javascript
        - typescript
      message: User controllable data `$REQ` enters `$RES.render(...)` this can lead to the loading of other HTML/templating pages that they may not be authorized to render. An attacker may attempt to use directory traversal techniques e.g. `../folder/index` to access other HTML pages on the file system. Where possible, do not allow users to define what should be  loaded in $RES.render or use an allow list for the existing application.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-706: Use of Incorrectly-Resolved Name or Reference'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - http://expressjs.com/en/4x/api.html#res.render
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $RES.render($SINK, ...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.audit.xss.direct-response-write.direct-response-write
      languages:
        - javascript
        - typescript
      message: Detected directly writing to a Response object from user-defined input. This bypasses any HTML escaping and may expose your application to a Cross-Site-scripting (XSS) vulnerability. Instead, use 'resp.render()' to render safely escaped HTML.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
        vulnerability_class:
            - Cross-Site-Scripting (XSS)
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $S = new Remarkable()
                    ...
            - pattern: $S.render(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'express-xss-sanitizer';
                    ...
                - pattern-inside: |
                    import * as $S from "express-xss-sanitizer";
                    ...
                - pattern-inside: |
                    const { ..., $S, ... } = require('express-xss-sanitizer');
                    ...
                - pattern-inside: |
                    var { ..., $S, ... } = require('express-xss-sanitizer');
                    ...
                - pattern-inside: |
                    let { ...,$S,... } = require('express-xss-sanitizer');
                    ...
                - pattern-inside: |
                    $S = require("express-xss-sanitizer")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern: $RES. ... .type('$F'). ... .send(...)
            - metavariable-regex:
                metavariable: $F
                regex: (?!.*text/html)
        - patterns:
            - pattern-inside: |
                $X = [...];
                ...
            - pattern: |
                if(<... !$X.includes($SOURCE)...>) {
                    ...
                    return ...
                }
                ...
            - pattern: $SOURCE
      pattern-sinks:
        - patterns:
            - pattern-inside: function ... (..., $RES,...) {...}
            - pattern-either:
                - pattern: $RES.write($ARG)
                - pattern: $RES.send($ARG)
            - pattern-not: $RES. ... .set('...'). ... .send($ARG)
            - pattern-not: $RES. ... .type('...'). ... .send($ARG)
            - pattern-not-inside: $RES.$METHOD({ ... })
            - focus-metavariable: $ARG
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)
            - pattern-not-inside: |
                function ... ($REQ, $RES) {
                    ...
                    $RES.$SET('Content-Type', '$TYPE')
                }
            - pattern-not-inside: |
                $APP.$METHOD(..., function $FUNC($REQ, $RES) {
                    ...
                    $RES.$SET('Content-Type', '$TYPE')
                })
            - pattern-not-inside: |
                function ... ($REQ, $RES, $NEXT) {
                    ...
                    $RES.$SET('Content-Type', '$TYPE')
                }
            - pattern-not-inside: |
                function ... ($REQ, $RES) {
                    ...
                    $RES.set('$TYPE')
                }
            - pattern-not-inside: |
                $APP.$METHOD(..., function $FUNC($REQ, $RES) {
                    ...
                    $RES.set('$TYPE')
                })
            - pattern-not-inside: |
                function ... ($REQ, $RES, $NEXT) {
                    ...
                    $RES.set('$TYPE')
                }
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - pattern-not-inside: |
                ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                {
                    ...
                    $RES.$SET('Content-Type', '$TYPE')
                }
            - pattern-not-inside: |
                ({ $REQ }: Request,$RES: Response) => {
                    ...
                    $RES.$SET('Content-Type', '$TYPE')
                }
            - pattern-not-inside: |
                ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                {
                    ...
                    $RES.set('$TYPE')
                }
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: body
      severity: WARNING
    - fix-regex:
        regex: <%-(.*?)%>
        replacement: <%=\1%>
      id: javascript.express.security.audit.xss.ejs.explicit-unescape.template-explicit-unescape
      languages:
        - regex
      message: Detected an explicit unescape in an EJS template, using '<%- ... %>' If external data can reach these locations, your application is exposed to a cross-site scripting (XSS) vulnerability. Use '<%= ... %>' to escape this data. If you need escaping, ensure no external data can reach this location.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - http://www.managerjs.com/blog/2015/05/will-ejs-escape-save-me-from-xss-sorta/
        subcategory:
            - audit
        technology:
            - express
      paths:
        include:
            - '*.ejs'
            - '*.html'
      pattern-regex: <%-((?!include).)*?%>
      severity: WARNING
    - id: javascript.express.security.audit.xss.mustache.explicit-unescape.template-explicit-unescape
      languages:
        - regex
      message: Detected an explicit unescape in a Mustache template, using triple braces '{{{...}}}' or ampersand '&'. If external data can reach these locations, your application is exposed to a cross-site scripting (XSS) vulnerability. If you must do this, ensure no external data can reach this location.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://github.com/janl/mustache.js/#variables
            - https://ractive.js.org/v0.x/0.7/mustaches#variables
        subcategory:
            - audit
        technology:
            - express
      paths:
        include:
            - '*.mustache'
            - '*.hbs'
            - '*.html'
      pattern-either:
        - pattern-regex: '{{{((?!include).)*?}}}'
        - pattern-regex: '{{[\\s]*&.*}}'
      severity: WARNING
    - id: javascript.express.security.audit.xss.pug.and-attributes.template-and-attributes
      languages:
        - regex
      message: Detected a unescaped variables using '&attributes'. If external data can reach these locations, your application is exposed to a cross-site scripting (XSS) vulnerability. If you must do this, ensure no external data can reach this location.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://pugjs.org/language/attributes.html#attributes
        subcategory:
            - audit
        technology:
            - express
      paths:
        include:
            - '*.pug'
      pattern-regex: .*&attributes.*
      severity: WARNING
    - id: javascript.express.security.audit.xss.pug.explicit-unescape.template-explicit-unescape
      languages:
        - regex
      message: Detected an explicit unescape in a Pug template, using either '!=' or '!{...}'. If external data can reach these locations, your application is exposed to a cross-site scripting (XSS) vulnerability. If you must do this, ensure no external data can reach this location.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://pugjs.org/language/code.html#unescaped-buffered-code
            - https://pugjs.org/language/attributes.html#unescaped-attributes
        subcategory:
            - audit
        technology:
            - express
      paths:
        include:
            - '*.pug'
      pattern-either:
        - pattern-regex: \w.*(!=)[^=].*
        - pattern-regex: '!{.*?}'
      severity: WARNING
    - id: javascript.express.security.cors-misconfiguration.cors-misconfiguration
      languages:
        - javascript
        - typescript
      message: By letting user input control CORS parameters, there is a risk that software does not properly verify that the source of data or communication is valid. Use literal values for CORS settings.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-346: Origin Validation Error'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $RES.set($HEADER, $X)
                - pattern: $RES.header($HEADER, $X)
                - pattern: $RES.setHeader($HEADER, $X)
                - pattern: |
                    $RES.set({$HEADER: $X}, ...)
                - pattern: |
                    $RES.writeHead($STATUS, {$HEADER: $X}, ...)
            - focus-metavariable: $X
            - metavariable-regex:
                metavariable: $HEADER
                regex: .*(Access-Control-Allow-Origin|access-control-allow-origin).*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.express-expat-xxe.express-expat-xxe
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach the XML Parser, as it can result in XML External or Internal Entity (XXE) Processing vulnerabilities.
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://github.com/astro/node-expat
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $XML = require('node-expat')
                    ...
                - pattern-inside: |
                    import $XML from 'node-expat'
                    ...
                - pattern-inside: |
                    import * as $XML from 'node-expat'
                    ...
            - pattern-either:
                - pattern-inside: |
                    $PARSER = new $XML.Parser(...);
                    ...
            - pattern-either:
                - pattern: $PARSER.parse($QUERY)
                - pattern: $PARSER.write($QUERY)
            - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-insecure-template-usage.express-insecure-template-usage
      languages:
        - javascript
        - typescript
      message: User data from `$REQ` is being compiled into the template, which can lead to a Server Side Template Injection (SSTI) vulnerability.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
            - A01:2017 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html
        source_rule_url:
            - https://github.com/github/codeql/blob/2ba2642c7ab29b9eedef33bcc2b8cd1d203d0c10/javascript/ql/test/query-tests/Security/CWE-094/CodeInjection/template-sinks.js
        subcategory:
            - vuln
        technology:
            - javascript
            - typescript
            - express
            - pug
            - jade
            - dot
            - ejs
            - nunjucks
            - lodash
            - handlbars
            - mustache
            - hogan.js
            - eta
            - squirrelly
      mode: taint
      options:
        interfile: true
      pattern-propagators:
        - from: $E
          pattern: $MODEL.$FIND($E).then((...,$S,...)=>{...})
          to: $S
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('pug')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'pug'
                        ...
                    - pattern-inside: |
                        $PUG = require('jade')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'jade'
                        ...
                - pattern-either:
                    - pattern: $PUG.compile(...)
                    - pattern: $PUG.compileClient(...)
                    - pattern: $PUG.compileClientWithDependenciesTracked(...)
                    - pattern: $PUG.render(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('dot')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'dot'
                        ...
                - pattern-either:
                    - pattern: $PUG.template(...)
                    - pattern: $PUG.compile(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('ejs')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'ejs'
                        ...
                - pattern-either:
                    - pattern: $PUG.render(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('nunjucks')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'nunjucks'
                        ...
                - pattern-either:
                    - pattern: $PUG.renderString(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('lodash')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'lodash'
                        ...
                - pattern-either:
                    - pattern: $PUG.template(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('mustache')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'mustache'
                        ...
                    - pattern-inside: |
                        $PUG = require('eta')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'eta'
                        ...
                    - pattern-inside: |
                        $PUG = require('squirrelly')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'squirrelly'
                        ...
                - pattern-either:
                    - pattern: $PUG.render(...)
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $PUG = require('hogan.js')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'hogan.js'
                        ...
                    - pattern-inside: |
                        $PUG = require('handlebars')
                        ...
                    - pattern-inside: |
                        import * as $PUG from 'handlebars'
                        ...
                - pattern-either:
                    - pattern: $PUG.compile(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.express-jwt-hardcoded-secret.express-jwt-hardcoded-secret
      languages:
        - javascript
        - typescript
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - express
            - secrets
      options:
        interfile: true
      patterns:
        - pattern-either:
            - pattern-inside: |
                $JWT = require('express-jwt');
                ...
            - pattern-inside: |
                import $JWT from 'express-jwt';
                ...
            - pattern-inside: |
                import * as $JWT from 'express-jwt';
                ...
            - pattern-inside: |
                import { ..., $JWT, ... } from 'express-jwt';
                ...
        - pattern-either:
            - pattern: |
                $JWT({...,secret: "$Y",...},...)
            - pattern: |
                $OPTS = "$Y";
                ...
                $JWT({...,secret: $OPTS},...);
        - focus-metavariable: $Y
      severity: WARNING
    - id: javascript.express.security.express-phantom-injection.express-phantom-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `phantom` methods it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://phantomjs.org/page-automation.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('phantom');
                    ...
                - pattern-inside: |
                    import 'phantom';
                    ...
            - pattern-either:
                - pattern: $PAGE.open($SINK,...)
                - pattern: $PAGE.setContent($SINK,...)
                - pattern: $PAGE.openUrl($SINK,...)
                - pattern: $PAGE.evaluateJavaScript($SINK,...)
                - pattern: $PAGE.property("content",$SINK,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-puppeteer-injection.express-puppeteer-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `puppeteer` methods it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://pptr.dev/api/puppeteer.page
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('puppeteer');
                    ...
                - pattern-inside: |
                    import 'puppeteer';
                    ...
            - pattern-either:
                - pattern: $PAGE.goto($SINK,...)
                - pattern: $PAGE.setContent($SINK,...)
                - pattern: $PAGE.evaluate($SINK,...)
                - pattern: $PAGE.evaluate($CODE,$SINK,...)
                - pattern: $PAGE.evaluateHandle($SINK,...)
                - pattern: $PAGE.evaluateHandle($CODE,$SINK,...)
                - pattern: $PAGE.evaluateOnNewDocument($SINK,...)
                - pattern: $PAGE.evaluateOnNewDocument($CODE,$SINK,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-sandbox-injection.express-sandbox-code-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `sandbox`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $SANDBOX = require('sandbox');
                ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $S = new $SANDBOX(...);
                        ...
                    - pattern: |
                        $S.run(...)
                - pattern: |
                    new $SANDBOX($OPTS).run(...)
                - pattern: new $SANDBOX().run(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-vm-injection.express-vm-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `$VM`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $VM = require('vm');
                ...
            - pattern-either:
                - pattern: |
                    $VM.runInContext(...)
                - pattern: |
                    $VM.runInNewContext(...)
                - pattern: |
                    $VM.compileFunction(...)
                - pattern: |
                    $VM.runInThisContext(...)
                - pattern: new $VM.Script(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-vm2-injection.express-vm2-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `vm2`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                require('vm2')
                ...
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            $VM = new VM(...)
                            ...
                        - pattern-inside: |
                            $VM = new NodeVM(...)
                            ...
                    - pattern: |
                        $VM.run(...)
                - pattern: |
                    new VM(...).run(...)
                - pattern: |
                    new NodeVM(...).run(...)
                - pattern: |
                    new VMScript(...)
                - pattern: |
                    new VM(...)
                - pattern: new NodeVM(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.express.security.express-wkhtml-injection.express-wkhtmltoimage-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `phantom` methods it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://www.npmjs.com/package/wkhtmltopdf
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $WK.generate($SINK,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-wkhtml-injection.express-wkhtmltopdf-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `wkhtmltopdf` methods it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://www.npmjs.com/package/wkhtmltopdf
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $WK = require('wkhtmltopdf');
                ...
            - pattern: $WK($SINK,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.express-xml2json-xxe.express-xml2json-xxe
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach the XML Parser, as it can result in XML External or Internal Entity (XXE) Processing vulnerabilities
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.npmjs.com/package/xml2json
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('xml2json');
                    ...
                - pattern-inside: |
                    import 'xml2json';
                    ...
            - pattern: $EXPAT.toJson($SINK,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
                - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
                - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
                - pattern: files.$ANYTHING.data.toString('utf8')
                - pattern: files.$ANYTHING['data'].toString('utf8')
      severity: ERROR
    - id: javascript.express.security.injection.raw-html-format.raw-html-format
      languages:
        - javascript
        - typescript
      message: User data flows into the host portion of this manually-constructed HTML. This can introduce a Cross-Site-Scripting (XSS) vulnerability if this comes from user-provided input. Consider using a sanitization library such as DOMPurify to sanitize the HTML within.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: '"$HTMLSTR" + $EXPR'
                        - pattern: '"$HTMLSTR".concat(...)'
                        - pattern: util.format($HTMLSTR, ...)
                    - metavariable-pattern:
                        language: generic
                        metavariable: $HTMLSTR
                        pattern: <$TAG ...
                - patterns:
                    - pattern: |
                        `...`
                    - pattern-regex: |
                        .*<\w+.*
          requires: (EXPRESS and not CLEAN) or (EXPRESSTS and not CLEAN)
      pattern-sources:
        - label: EXPRESS
          patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - label: EXPRESSTS
          patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
        - by-side-effect: true
          label: CLEAN
          patterns:
            - pattern-either:
                - pattern: $A($SOURCE)
                - pattern: $SANITIZE. ... .$A($SOURCE)
                - pattern: $A. ... .$SANITIZE($SOURCE)
            - focus-metavariable: $SOURCE
            - metavariable-regex:
                metavariable: $A
                regex: (?i)(.*valid|.*sanitiz)
      severity: WARNING
    - id: javascript.express.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - javascript
        - typescript
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            "$SQLSTR" + $EXPR
                        - pattern-inside: |
                            "$SQLSTR".concat($EXPR)
                        - pattern: util.format($SQLSTR, $EXPR)
                        - pattern: |
                            `$SQLSTR${$EXPR}...`
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: .*\b(?i)(select|delete|insert|create|update\s+.+\sset|alter|drop)\b.*
            - focus-metavariable: $EXPR
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... (...,$REQ, ...) {...}
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    (...,{ $REQ }: Request,...) => {...}
                - pattern-inside: |
                    (...,{ $REQ }: $EXPRESS.Request,...) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.require-request.require-request
      languages:
        - javascript
        - typescript
      message: If an attacker controls the x in require(x) then they can cause code to load that was not intended to run on the server.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-706: Use of Incorrectly-Resolved Name or Reference'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/google/node-sec-roadmap/blob/master/chapter-2/dynamism.md#dynamism-when-you-need-it
        source-rule-url: https://nodesecroadmap.fyi/chapter-1/threat-UIR.html
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern: require($SINK)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: ERROR
    - id: javascript.express.security.x-frame-options-misconfiguration.x-frame-options-misconfiguration
      languages:
        - javascript
        - typescript
      message: By letting user input control `X-Frame-Options` header, there is a risk that software does not properly verify whether or not a browser should be allowed to render a page in an `iframe`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-451: User Interface (UI) Misrepresentation of Critical Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $RES.set($HEADER, ...)
                - pattern: $RES.header($HEADER, ...)
                - pattern: $RES.setHeader($HEADER, ...)
                - pattern: |
                    $RES.set({$HEADER: ...}, ...)
                - pattern: |
                    $RES.writeHead($STATUS, {$HEADER: ...}, ...)
            - metavariable-regex:
                metavariable: $HEADER
                regex: .*(X-Frame-Options|x-frame-options).*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
      severity: WARNING
    - id: javascript.fbjs.security.audit.insecure-createnodesfrommarkup.insecure-createnodesfrommarkup
      languages:
        - javascript
        - typescript
      message: User controlled data in a `createNodesFromMarkup` is an anti-pattern that can lead to XSS vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - fbjs
      patterns:
        - pattern-either:
            - pattern: createNodesFromMarkup(...)
            - pattern: $X.createNodesFromMarkup(...)
        - pattern-not: createNodesFromMarkup("...",...)
        - pattern-not: $X.createNodesFromMarkup("...",...)
      severity: WARNING
    - id: javascript.grpc.security.grpc-nodejs-insecure-connection.grpc-nodejs-insecure-connection
      languages:
        - javascript
        - typescript
      message: Found an insecure gRPC connection. This creates a connection without encryption to a gRPC client/server. A malicious attacker could tamper with the gRPC message, which could compromise the machine.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://blog.gopheracademy.com/advent-2017/go-grpc-beyond-basics/#:~:text=disables%20transport%20security
        subcategory:
            - audit
        technology:
            - grpc
      pattern-either:
        - pattern: |
            require('grpc');
            ...
            $GRPC($ADDR,...,$CREDENTIALS.createInsecure(),...);
        - pattern: |
            require('grpc');
            ...
            new $GRPC($ADDR,...,$CREDENTIALS.createInsecure(),...);
        - pattern: |-
            require('grpc');
            ...
            $CREDS = <... $CREDENTIALS.createInsecure() ...>;
            ...
            $GRPC($ADDR,...,$CREDS,...);
        - pattern: |-
            require('grpc');
            ...
            $CREDS = <... $CREDENTIALS.createInsecure() ...>;
            ...
            new $GRPC($ADDR,...,$CREDS,...);
      severity: ERROR
    - id: javascript.intercom.security.audit.intercom-settings-user-identifier-without-user-hash.intercom-settings-user-identifier-without-user-hash
      languages:
        - js
      message: Found an initialization of the Intercom Messenger that identifies a User, but does not specify a `user_hash`.This configuration allows users to impersonate one another. See the Intercom Identity Verification docs for more context https://www.intercom.com/help/en/articles/183-set-up-identity-verification-for-web-and-mobile
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-287: Improper Authentication'
        impact: HIGH
        likelihood: MEDIUM
        references:
            - https://www.intercom.com/help/en/articles/183-set-up-identity-verification-for-web-and-mobile
        subcategory:
            - guardrail
        technology:
            - intercom
      patterns:
        - pattern-either:
            - pattern: |
                window.intercomSettings = {..., email: $EMAIL, ...};
            - pattern: |
                window.intercomSettings = {..., user_id: $USER_ID, ...};
            - pattern: |
                Intercom('boot', {..., email: $EMAIL, ...});
            - pattern: |
                Intercom('boot', {..., user_id: $USER_ID, ...});
            - pattern: |
                $VAR = {..., email: $EMAIL, ...};
                ...
                Intercom('boot', $VAR);
            - pattern: |
                $VAR = {..., user_id: $EMAIL, ...};
                ...
                Intercom('boot', $VAR);
        - pattern-not: |
            window.intercomSettings = {..., user_hash: $USER_HASH, ...};
        - pattern-not: |
            Intercom('boot', {..., user_hash: $USER_HASH, ...});
        - pattern-not: |
            $VAR = {..., user_hash: $USER_HASH, ...};
            ...
            Intercom('boot', $VAR);
      severity: WARNING
    - id: javascript.jose.security.jwt-hardcode.hardcoded-jwt-secret
      languages:
        - javascript
        - typescript
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        asvs:
            control_id: 3.5.2 Static API keys or secret
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - jose
            - jwt
            - secrets
      options:
        interfile: true
        symbolic_propagation: true
      patterns:
        - pattern-inside: |
            $JOSE = require("jose");
            ...
        - pattern-either:
            - pattern-inside: |
                var {JWT} = $JOSE;
                ...
            - pattern-inside: |
                var {JWK, JWT} = $JOSE;
                ...
            - pattern-inside: |
                const {JWT} = $JOSE;
                ...
            - pattern-inside: |
                const {JWK, JWT} = $JOSE;
                ...
            - pattern-inside: |
                let {JWT} = $JOSE;
                ...
            - pattern-inside: |
                let {JWK, JWT} = $JOSE;
                ...
        - pattern-either:
            - pattern: |
                JWT.verify($P, "...", ...);
            - pattern: |
                JWT.sign($P, "...", ...);
            - pattern: "JWT.verify($P, JWK.asKey(\"...\"), ...);     \n"
            - pattern: |
                $JWT.sign($P, JWK.asKey("..."), ...);
      severity: WARNING
    - id: javascript.jose.security.jwt-none-alg.jwt-none-alg
      languages:
        - javascript
        - typescript
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jose
            - jwt
      pattern-either:
        - pattern: |
            var $JOSE = require("jose");
            ...
            var { JWK, JWT } = $JOSE;
            ...
            var $T = JWT.verify($P, JWK.None,...);
        - pattern: |
            var $JOSE = require("jose");
            ...
            var { JWK, JWT } = $JOSE;
            ...
            $T = JWT.verify($P, JWK.None,...);
        - pattern: |
            var $JOSE = require("jose");
            ...
            var { JWK, JWT } = $JOSE;
            ...
            JWT.verify($P, JWK.None,...);
      severity: ERROR
    - id: javascript.jsonwebtoken.security.audit.jwt-decode-without-verify.jwt-decode-without-verify
      languages:
        - javascript
        - typescript
      message: Detected the decoding of a JWT token without a verify step. JWT tokens must be verified before use, otherwise the token's integrity is unknown. This means a malicious actor could forge a JWT token with any claims. Call '.verify()' before using the token.
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            $JWT = require('jsonwebtoken');
            ...
        - pattern-not-inside: |
            ...
            $JWT.verify($TOKEN, ...)
            ...
        - pattern-not-inside: |
            ...
            if (<... $JWT.verify($TOKEN, ...) ...>) { ... }
            ...
        - pattern: $JWT.decode($TOKEN, ...)
      severity: WARNING
    - id: javascript.jsonwebtoken.security.jwt-hardcode.hardcoded-jwt-secret
      languages:
        - javascript
        - typescript
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        asvs:
            control_id: 3.5.2 Static API keys or secret
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - jwt
            - javascript
            - secrets
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $JWT = require("jsonwebtoken")
                    ...
                - pattern-inside: |
                    import $JWT from "jsonwebtoken"
                    ...
                - pattern-inside: |
                    import * as $JWT from "jsonwebtoken"
                    ...
                - pattern-inside: |
                    import {...,$JWT,...} from "jsonwebtoken"
                    ...
            - pattern-either:
                - pattern-inside: |
                    $JWT.sign($DATA,$VALUE,...);
                - pattern-inside: |
                    $JWT.verify($DATA,$VALUE,...);
            - focus-metavariable: $VALUE
      pattern-sources:
        - patterns:
            - pattern: "$X = '...' \n"
            - pattern: "$X = '$Y' \n"
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $JWT.sign($DATA,"...",...);
                - pattern-inside: |
                    $JWT.verify($DATA,"...",...);
      severity: WARNING
    - id: javascript.jsonwebtoken.security.jwt-none-alg.jwt-none-alg
      languages:
        - javascript
        - typescript
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            $JWT = require("jsonwebtoken");
            ...
        - pattern: $JWT.verify($P, $X, {algorithms:[...,'none',...]},...)
      severity: ERROR
    - id: javascript.jwt-simple.security.jwt-simple-noverify.jwt-simple-noverify
      languages:
        - javascript
        - typescript
      message: Detected the decoding of a JWT token without a verify step. JWT tokens must be verified before use, otherwise the token's integrity is unknown. This means a malicious actor could forge a JWT token with any claims. Set 'verify' to `true` before using the token.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-287: Improper Authentication'
            - 'CWE-345: Insufficient Verification of Data Authenticity'
            - 'CWE-347: Improper Verification of Cryptographic Signature'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://www.npmjs.com/package/jwt-simple
            - https://cwe.mitre.org/data/definitions/287
            - https://cwe.mitre.org/data/definitions/345
            - https://cwe.mitre.org/data/definitions/347
        subcategory:
            - vuln
        technology:
            - jwt-simple
            - jwt
      patterns:
        - pattern-inside: |
            $JWT = require('jwt-simple');
            ...
        - pattern: $JWT.decode($TOKEN, $SECRET, $NOVERIFY, ...)
        - metavariable-pattern:
            metavariable: $NOVERIFY
            patterns:
                - pattern-either:
                    - pattern: |
                        true
                    - pattern: |
                        "..."
      severity: ERROR
    - id: javascript.lang.security.audit.code-string-concat.code-string-concat
      languages:
        - javascript
        - typescript
      message: Found data from an Express or Next web request flowing to `eval`. If this data is user-controllable this can lead to execution of arbitrary system commands in the context of your application process. Avoid `eval` whenever possible.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        interfile: true
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval
            - https://nodejs.org/api/child_process.html#child_processexeccommand-options-callback
            - https://www.stackhawk.com/blog/nodejs-command-injection-examples-and-prevention/
            - https://ckarande.gitbooks.io/owasp-nodegoat-tutorial/content/tutorial/a1_-_server_side_js_injection.html
        subcategory:
            - vuln
        technology:
            - node.js
            - Express
            - Next.js
      mode: taint
      options:
        interfile: true
      pattern-sinks:
        - patterns:
            - pattern: |
                eval(...)
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: function ... ($REQ, $RES) {...}
                    - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                    - patterns:
                        - pattern-either:
                            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                        - metavariable-regex:
                            metavariable: $METHOD
                            regex: ^(get|post|put|head|delete|options)$
                - pattern-either:
                    - pattern: $REQ.query
                    - pattern: $REQ.body
                    - pattern: $REQ.params
                    - pattern: $REQ.cookies
                    - pattern: $REQ.headers
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        import { ...,$IMPORT,... } from 'next/router'
                        ...
                    - pattern-inside: |
                        import $IMPORT from 'next/router';
                        ...
                - pattern-either:
                    - patterns:
                        - pattern-inside: |
                            $ROUTER = $IMPORT()
                            ...
                        - pattern-either:
                            - pattern-inside: |
                                const { ...,$PROPS,... } = $ROUTER.query
                                ...
                            - pattern-inside: |
                                var { ...,$PROPS,... } = $ROUTER.query
                                ...
                            - pattern-inside: |
                                let { ...,$PROPS,... } = $ROUTER.query
                                ...
                        - focus-metavariable: $PROPS
                    - patterns:
                        - pattern-inside: |
                            $ROUTER = $IMPORT()
                            ...
                        - pattern: "$ROUTER.query.$VALUE \n"
                    - patterns:
                        - pattern: $IMPORT().query.$VALUE
      severity: ERROR
    - id: javascript.lang.security.audit.dangerous-spawn-shell.dangerous-spawn-shell
      languages:
        - javascript
        - typescript
      message: Detected non-literal calls to $EXEC(). This could lead to a command injection vulnerability.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html#do-not-use-dangerous-functions
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-child-process.js
        subcategory:
            - vuln
        technology:
            - javascript
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('child_process')
                    ...
                - pattern-inside: |
                    import 'child_process'
                    ...
            - pattern-either:
                - pattern: spawn(...)
                - pattern: spawnSync(...)
                - pattern: $CP.spawn(...)
                - pattern: $CP.spawnSync(...)
            - pattern-either:
                - pattern: |
                    $EXEC("=~/(sh|bash|ksh|csh|tcsh|zsh)/",["-c", $ARG, ...],...)
                - patterns:
                    - pattern: $EXEC($CMD,["-c", $ARG, ...],...)
                    - pattern-inside: |
                        $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"
                        ...
                - pattern: |
                    $EXEC("=~/(sh|bash|ksh|csh|tcsh|zsh)/",[$ARG, ...],...)
                - patterns:
                    - pattern: $EXEC($CMD,[$ARG, ...],...)
                    - pattern-inside: |
                        $CMD = "=~/(sh|bash|ksh|csh|tcsh|zsh)/"
                        ...
            - focus-metavariable: $ARG
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (...,$FUNC,...) {
                  ...
                }
            - focus-metavariable: $FUNC
      severity: ERROR
    - id: javascript.lang.security.audit.detect-non-literal-require.detect-non-literal-require
      languages:
        - javascript
        - typescript
      message: Detected the use of require(variable). Calling require with a non-literal argument might allow an attacker to load and run arbitrary code, or access arbitrary files.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-require.js
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-require.js
        subcategory:
            - vuln
        technology:
            - javascript
      mode: taint
      pattern-sinks:
        - pattern: require(...)
      pattern-sources:
        - patterns:
            - pattern-inside: function ... (..., $ARG,...) {...}
            - focus-metavariable: $ARG
      severity: WARNING
    - id: javascript.lang.security.audit.md5-used-as-password.md5-used-as-password
      languages:
        - javascript
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Use a suitable password hashing function such as bcrypt. You can use the `bcrypt` node.js package.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
            - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
            - https://github.com/returntocorp/semgrep-rules/issues/1609
            - https://www.npmjs.com/package/bcrypt
        subcategory:
            - vuln
        technology:
            - crypto
            - md5
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $FUNCTION(...);
            - metavariable-regex:
                metavariable: $FUNCTION
                regex: (?i)(.*password.*)
      pattern-sources:
        - pattern: $CRYPTO.createHash("md5")
      severity: WARNING
    - id: javascript.lang.security.audit.path-traversal.path-join-resolve-traversal.path-join-resolve-traversal
      languages:
        - javascript
        - typescript
      message: Detected possible user input going into a `path.join` or `path.resolve` function. This could possibly lead to a path traversal vulnerability,  where the attacker can access arbitrary files stored in the file system. Instead, be sure to sanitize or validate user input first.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - vuln
        technology:
            - javascript
            - node.js
      mode: taint
      pattern-sanitizers:
        - pattern: $Y.replace(...)
        - pattern: $Y.indexOf(...)
        - pattern: |
            function ... (...) {
                ...
                <... $Y.indexOf(...) ...>
                ...
            }
        - patterns:
            - pattern: $FUNC(...)
            - metavariable-regex:
                metavariable: $FUNC
                regex: sanitize
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern-either:
                - pattern-inside: |
                    $PATH = require('path');
                    ...
                - pattern-inside: |
                    import $PATH from 'path';
                    ...
            - pattern-either:
                - pattern: $PATH.join(...,$SINK,...)
                - pattern: $PATH.resolve(...,$SINK,...)
        - patterns:
            - focus-metavariable: $SINK
            - pattern-inside: |
                import 'path';
                ...
            - pattern-either:
                - pattern-inside: path.join(...,$SINK,...)
                - pattern-inside: path.resolve(...,$SINK,...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $X
            - pattern-either:
                - pattern-inside: |
                    function ... (...,$X,...) {...}
                - pattern-inside: |
                    function ... (...,{...,$X,...},...) {...}
      severity: WARNING
    - id: javascript.lang.security.audit.prototype-pollution.prototype-pollution-assignment.prototype-pollution-assignment
      languages:
        - javascript
        - typescript
      message: 'Possibility of prototype polluting assignment detected. By adding or modifying attributes of an object prototype, it is possible to create attributes that exist on every object, or replace critical attributes with malicious ones. This can be problematic if the software depends on existence or non-existence of certain attributes, or uses pre-defined attributes of object prototype (such as hasOwnProperty, toString or valueOf). Possible mitigations might be: freezing the object prototype, using an object without prototypes (via Object.create(null) ), blocking modifications of attributes that resolve to object prototype, using Map instead of object.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf
        subcategory:
            - audit
        technology:
            - javascript
      patterns:
        - pattern: |
            $X[$B] = ...
        - pattern-not: |
            $X[$B] = '...'
        - pattern-inside: |
            $X = $SMTH[$A]
            ...
        - pattern-not-inside: |
            if (<...'constructor' ...>) {
              ...
            }
            ...
        - pattern-not-inside: |
            if (<...'__proto__' ...>) {
              ...
            }
            ...
        - pattern-not-inside: |
            for(var $B = $S; ...; ...) {...}
        - pattern-not-inside: |
            for($B = $S; ...; ...) {...}
        - pattern-not-inside: |
            $X.forEach(function $NAME($OBJ, $B,...) {...})
        - metavariable-pattern:
            metavariable: $A
            patterns:
                - pattern-not: '"..."'
                - pattern-not: |
                    `...${...}...`
                - pattern-not: |
                    ($A: float)
        - metavariable-pattern:
            metavariable: $B
            patterns:
                - pattern-not: '"..."'
                - pattern-not: |
                    `...${...}...`
                - pattern-not: |
                    ($B: float)
      severity: WARNING
    - id: javascript.lang.security.audit.prototype-pollution.prototype-pollution-loop.prototype-pollution-loop
      languages:
        - typescript
        - javascript
      message: 'Possibility of prototype polluting function detected. By adding or modifying attributes of an object prototype, it is possible to create attributes that exist on every object, or replace critical attributes with malicious ones. This can be problematic if the software depends on existence or non-existence of certain attributes, or uses pre-defined attributes of object prototype (such as hasOwnProperty, toString or valueOf). Possible mitigations might be: freezing the object prototype, using an object without prototypes (via Object.create(null) ), blocking modifications of attributes that resolve to object prototype, using Map instead of object.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf
        subcategory:
            - audit
        technology:
            - typescript
      patterns:
        - pattern-either:
            - pattern: |
                $SMTH = $SMTH[$A]
            - pattern: |
                $SMTH = $SMTH[$A] = ...
            - pattern: |
                $SMTH = $SMTH[$A] && $Z
            - pattern: |
                $SMTH = $SMTH[$A] || $Z
        - pattern-either:
            - pattern-inside: |
                for(...) {
                  ...
                }
            - pattern-inside: |
                while(...) {
                  ...
                }
            - pattern-inside: |
                $X.forEach(function $NAME(...) {
                  ...
                })
        - pattern-not-inside: |
            for(var $A = $S; ...; ...) {...}
        - pattern-not-inside: |
            for($A = $S; ...; ...) {...}
        - pattern-not-inside: |
            $X.forEach(function $NAME($OBJ, $A,...) {...})
        - metavariable-pattern:
            metavariable: $A
            patterns:
                - pattern-not: '"..."'
                - pattern-not: |
                    `...${...}...`
                - pattern-not: |
                    ($A: float)
      severity: WARNING
    - id: javascript.lang.security.audit.spawn-shell-true.spawn-shell-true
      languages:
        - javascript
        - typescript
      message: 'Found ''$SPAWN'' with ''{shell: $SHELL}''. This is dangerous because this call will spawn the command using a shell process. Doing so propagates current shell settings and variables, which makes it much easier for a malicious actor to execute commands. Use ''{shell: false}'' instead.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - javascript
      patterns:
        - pattern-either:
            - pattern: |
                spawn(...,{shell: $SHELL})
            - pattern: |
                spawnSync(...,{shell: $SHELL})
            - pattern: |
                $CP.spawn(...,{shell: $SHELL})
            - pattern: |
                $CP.spawnSync(...,{shell: $SHELL})
        - pattern-not: |
            spawn(...,{shell: false})
        - pattern-not: |
            spawnSync(...,{shell: false})
        - pattern-not: |
            $CP.spawn(...,{shell: false})
        - pattern-not: |
            $CP.spawnSync(...,{shell: false})
      severity: ERROR
    - id: javascript.lang.security.audit.sqli.node-knex-sqli.node-knex-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected SQL statement that is tainted by `$REQ` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, it is recommended to use parameterized queries or prepared statements. An example of parameterized queries like so: `knex.raw(''SELECT $1 from table'', [userinput])` can help prevent SQLi.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://knexjs.org/#Builder-fromRaw
            - https://knexjs.org/#Builder-whereRaw
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - express
            - nodejs
            - knex
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: parseInt(...)
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern-inside: $KNEX.fromRaw($QUERY, ...)
                - pattern-inside: $KNEX.whereRaw($QUERY, ...)
                - pattern-inside: $KNEX.raw($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    require('knex')
                    ...
                - pattern-inside: |
                    import 'knex'
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
                - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
                - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
                - pattern: files.$ANYTHING.data.toString('utf8')
                - pattern: files.$ANYTHING['data'].toString('utf8')
      severity: WARNING
    - id: javascript.lang.security.audit.sqli.node-mssql-sqli.node-mssql-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected string concatenation with a non-literal variable in a `mssql` JS SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `$REQ.input(''USER_ID'', mssql.Int, id);`'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.npmjs.com/package/mssql
        subcategory:
            - vuln
        technology:
            - mssql
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    require('mssql');
                    ...
                - pattern-inside: |
                    import 'mssql';
                    ...
            - pattern-inside: |
                $REQ = $POOL.request(...)
                ...
            - pattern: |
                $REQ.query($QUERY,...)
            - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (...,$FUNC,...) {
                  ...
                }
            - focus-metavariable: $FUNC
      severity: WARNING
    - id: javascript.lang.security.audit.sqli.node-mysql-sqli.node-mysql-sqli
      languages:
        - javascript
        - typescript
      message: Detected a `$IMPORT` SQL statement that comes from a function argument. This could lead to SQL injection if the variable is user-controlled and is not properly sanitized. In order to prevent SQL injection, it is recommended to use parameterized queries or prepared statements.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.npmjs.com/package/mysql2
            - https://www.npmjs.com/package/mysql
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - mysql
            - mysql2
            - javascript
            - nodejs
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: parseInt(...)
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern-inside: $POOL.query($QUERY, ...)
                - pattern-inside: $POOL.execute($QUERY, ...)
            - pattern-either:
                - pattern-inside: |
                    import $S from "$IMPORT"
                    ...
                - pattern-inside: |
                    import { ... } from "$IMPORT"
                    ...
                - pattern-inside: |
                    import * as $S from "$IMPORT"
                    ...
                - pattern-inside: |
                    require("$IMPORT")
                    ...
            - metavariable-regex:
                metavariable: $IMPORT
                regex: (mysql|mysql2)
      pattern-sources:
        - patterns:
            - pattern-inside: function ... (..., $Y,...) {...}
            - pattern: $Y
            - pattern-not-inside: |
                function ... (..., $Y: number,...) {...}
            - pattern-not-inside: $Y.query
            - pattern-not-inside: $Y.body
            - pattern-not-inside: $Y.params
            - pattern-not-inside: $Y.cookies
            - pattern-not-inside: $Y.headers
      severity: WARNING
    - id: javascript.lang.security.audit.sqli.node-postgres-sqli.node-postgres-sqli
      languages:
        - javascript
        - typescript
      message: 'Detected string concatenation with a non-literal variable in a node-postgres JS SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `client.query(''SELECT $1 from table'', [userinput])`'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://node-postgres.com/features/queries
        subcategory:
            - vuln
        technology:
            - node-postgres
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    const { $CLIENT } = require('pg')
                     ...
                - pattern-inside: |
                    var { $CLIENT } = require('pg')
                     ...
                - pattern-inside: |
                    let { $CLIENT } = require('pg')
                     ...
            - pattern-either:
                - pattern-inside: |
                    $DB = new $CLIENT(...)
                    ...
                - pattern-inside: |
                    $NEWPOOL = new $CLIENT(...)
                    ...
                    $NEWPOOL.connect((..., $DB, ...) => {
                        ...
                    })
            - pattern: $DB.query($QUERY,...)
            - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (...,$FUNC,...) {
                  ...
                }
            - focus-metavariable: $FUNC
            - pattern-not-inside: |
                $F. ... .$SOURCE(...)
      severity: WARNING
    - id: javascript.lang.security.audit.unsafe-dynamic-method.unsafe-dynamic-method
      languages:
        - javascript
        - typescript
      message: Using non-static data to retrieve and run functions from the object is dangerous. If the data is user-controlled, it may allow executing arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - javascript
      patterns:
        - pattern-either:
            - pattern: $OBJ[$X](...)
            - pattern: |
                $Y = $OBJ[$X]
                ...
                $Y(...)
        - metavariable-pattern:
            metavariable: $X
            patterns:
                - pattern-not: |
                    "..."
                - pattern-not: |
                    ($X: float)
        - pattern-not-inside: |
            for (...) {...}
        - pattern-not-inside: |
            $SMTH.forEach(...)
        - pattern-not-inside: |
            $SMTH.map(...)
        - pattern-not-inside: |
            $SMTH.reduce(...)
        - pattern-not-inside: |
            $SMTH.reduceRight(...)
        - pattern-not-inside: |
            if (<... $OBJ.hasOwnProperty(...) ...>) {
              ...
            }
            ...
      severity: WARNING
    - id: javascript.lang.security.detect-child-process.detect-child-process
      languages:
        - javascript
        - typescript
      message: 'Detected calls to child_process from a function argument `$FUNC`. This could lead to a command injection if the input is user controllable. Try to avoid calls to child_process, and if it is needed ensure user input is correctly sanitized or sandboxed. '
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html#do-not-use-dangerous-functions
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-child-process.js
        subcategory:
            - audit
        technology:
            - javascript
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $CP = require('child_process')
                    ...
                - pattern-inside: |
                    import * as $CP from 'child_process'
                    ...
                - pattern-inside: |
                    import $CP from 'child_process'
                    ...
            - pattern-either:
                - pattern: $CP.exec($CMD,...)
                - pattern: $CP.execSync($CMD,...)
                - pattern: $CP.spawn($CMD,...)
                - pattern: $CP.spawnSync($CMD,...)
            - pattern-not-inside: $CP.$EXEC("...",...)
            - pattern-not-inside: $CP.$EXEC(["...",...],...)
            - pattern-not-inside: |
                $CMD = "..."
                ...
            - pattern-not-inside: |
                $CMD = ["...",...]
                ...
            - focus-metavariable: $CMD
        - patterns:
            - pattern-either:
                - pattern: child_process.exec($CMD,...)
                - pattern: child_process.execSync($CMD,...)
                - pattern: child_process.spawn($CMD,...)
                - pattern: child_process.spawnSync($CMD,...)
            - pattern-not-inside: child_process.$EXEC("...",...)
            - pattern-not-inside: child_process.$EXEC(["...",...],...)
            - pattern-not-inside: |
                $CMD = "..."
                ...
            - pattern-not-inside: |
                $CMD = ["...",...]
                ...
            - focus-metavariable: $CMD
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (...,$FUNC,...) {
                  ...
                }
            - focus-metavariable: $FUNC
      severity: ERROR
    - id: javascript.lang.security.detect-eval-with-expression.detect-eval-with-expression
      languages:
        - javascript
        - typescript
      message: Detected use of dynamic execution of JavaScript which may come from user-input, which can lead to Cross-Site-Scripting (XSS). Where possible avoid including user-input in functions which dynamically execute user-input.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#never_use_eval!
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-eval-with-expression.js
        subcategory:
            - vuln
        technology:
            - javascript
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: location.href = $FUNC(...)
                - pattern: location.hash = $FUNC(...)
                - pattern: location.search = $FUNC(...)
                - pattern: $WINDOW. ... .location.href = $FUNC(...)
                - pattern: $WINDOW. ... .location.hash = $FUNC(...)
                - pattern: $WINDOW. ... .location.search = $FUNC(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: eval(<... $SINK ...>)
                - pattern: window.eval(<... $SINK ...>)
                - pattern: new Function(<... $SINK ...>)
                - pattern: new Function(<... $SINK ...>)(...)
                - pattern: setTimeout(<... $SINK ...>,...)
                - pattern: setInterval(<... $SINK ...>,...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROP = new URLSearchParams($WINDOW. ... .location.search).get('...')
                      ...
                - pattern-inside: |
                    $PROP = new URLSearchParams(location.search).get('...')
                      ...
                - pattern-inside: |
                    $PROP = new URLSearchParams($WINDOW. ... .location.hash.substring(1)).get('...')
                      ...
                - pattern-inside: |
                    $PROP = new URLSearchParams(location.hash.substring(1)).get('...')
                      ...
            - focus-metavariable: $PROP
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $PROPS = new URLSearchParams($WINDOW. ... .location.search)
                      ...
                - pattern-inside: |
                    $PROPS = new URLSearchParams(location.search)
                      ...
                - pattern-inside: |
                    $PROPS = new
                    URLSearchParams($WINDOW. ... .location.hash.substring(1))
                      ...
                - pattern-inside: |
                    $PROPS = new URLSearchParams(location.hash.substring(1))
                    ...
            - pattern: $PROPS.get('...')
            - focus-metavariable: $PROPS
        - patterns:
            - pattern-either:
                - pattern: location.href
                - pattern: location.hash
                - pattern: location.search
                - pattern: $WINDOW. ... .location.href
                - pattern: $WINDOW. ... .location.hash
                - pattern: $WINDOW. ... .location.search
      severity: WARNING
    - id: javascript.lang.security.spawn-git-clone.spawn-git-clone
      languages:
        - javascript
        - typescript
      message: Git allows shell commands to be specified in ext URLs for remote repositories. For example, git clone 'ext::sh -c whoami% >&2' will execute the whoami command to try to connect to a remote repository. Make sure that the URL is not controlled by external input.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - git
      patterns:
        - pattern-either:
            - pattern: spawn('git', ['clone',...,$F])
            - pattern: $X.spawn('git', ['clone',...,$F])
            - pattern: spawn('git', ['clone',...,$P,$F])
            - pattern: $X.spawn('git', ['clone',...,$P,$F])
        - pattern-not: spawn('git', ['clone',...,"..."])
        - pattern-not: $X.spawn('git', ['clone',...,"..."])
        - pattern-not: spawn('git', ['clone',...,"...","..."])
        - pattern-not: $X.spawn('git', ['clone',...,"...","..."])
      severity: ERROR
    - id: javascript.monaco-editor.security.audit.monaco-hover-htmlsupport.monaco-hover-htmlsupport
      languages:
        - typescript
        - javascript
      message: If user input reaches `HoverProvider` while `supportHml` is set to `true` it may introduce an XSS vulnerability. Do not produce HTML for hovers with dynamically generated input.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://github.com/microsoft/monaco-editor/issues/801
        subcategory:
            - audit
        technology:
            - monaco
            - monaco-editor
      patterns:
        - pattern-either:
            - pattern-inside: |
                import "monaco-editor"
                ...
            - pattern-inside: |
                require("monaco-editor")
                ...
        - pattern-either:
            - pattern: |
                {value: $VAL, supportHtml: true}
            - pattern: |
                {value: $VAL, isTrusted: true}
        - pattern-inside: |
            {range: $R, contents: [...]}
        - pattern-not: |
            {..., value: "...", ...}
      severity: WARNING
    - id: javascript.node-expat.security.audit.expat-xxe.expat-xxe
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the XML Parser it can result in XML External or Internal Entity (XXE) Processing vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - audit
        technology:
            - node-expat
      patterns:
        - pattern-either:
            - pattern: |
                var $EXPAT = require('node-expat');
                ...
                new $EXPAT.Parser(...);
                ...
                $PARSER.parse(...);
            - pattern: |
                var $EXPAT = require('node-expat');
                ...
                new $EXPAT.Parser(...);
                ...
                $PARSER.write(...);
            - pattern: |
                require('node-expat');
                ...
                new Parser(...);
                ...
                $PARSER.parse(...);
            - pattern: |
                require('node-expat');
                ...
                new Parser(...);
                ...
                $PARSER.write(...);
        - pattern-not: |
            var $EXPAT = require('node-expat');
            ...
            new $EXPAT.Parser(...);
            ...
            $PARSER.parse("...");
        - pattern-not: |
            var $EXPAT = require('node-expat');
            ...
            new $EXPAT.Parser(...);
            ...
            $PARSER.write("...");
        - pattern-not: |
            require('node-expat');
            ...
            new Parser(...);
            ...
            $PARSER.parse("...");
        - pattern-not: |
            require('node-expat');
            ...
            new Parser(...);
            ...
            $PARSER.write("...");
        - pattern-not: |
            $X = "...";
            ...
            $PARSER.parse($X);
        - pattern-not: |-
            $X = "...";
            ...
            $PARSER.write($X);
      severity: WARNING
    - id: javascript.passport-jwt.security.passport-hardcode.hardcoded-passport-secret
      languages:
        - javascript
        - typescript
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        asvs:
            control_id: 3.5.2 Static API keys or secret
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - jwt
            - nodejs
            - secrets
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $F = require("$I").Strategy
                    ...
                - pattern-inside: |
                    $F = require("$I")
                    ...
                - pattern-inside: |
                    import { $STRAT as $F } from '$I'
                    ...
                - pattern-inside: |
                    import $F from '$I'
                    ...
            - metavariable-regex:
                metavariable: $I
                regex: (passport-.*)
            - pattern-inside: |
                new $F($VALUE,...)
            - focus-metavariable: $VALUE
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    {..., clientSecret: "...", ...}
                - pattern: |
                    {..., secretOrKey: "...", ...}
                - pattern: |
                    {..., consumerSecret: "...", ...}
                - patterns:
                    - pattern-inside: |
                        $OBJ = {}
                        ...
                    - pattern-either:
                        - pattern: |
                            $OBJ.clientSecret = "..."
                        - pattern: |
                            $OBJ.secretOrKey = "..."
                        - pattern: |
                            $OBJ.consumerSecret = "..."
                    - pattern: $OBJ
                - patterns:
                    - pattern-inside: |
                        $SECRET = '...'
                        ...
                    - pattern-either:
                        - pattern: |
                            {..., clientSecret: $SECRET, ...}
                        - pattern: |
                            {..., secretOrKey: $SECRET, ...}
                        - pattern: |
                            {..., consumerSecret: $SECRET, ...}
                - patterns:
                    - pattern-inside: |
                        $SECRET = '...'
                        ...
                    - pattern-either:
                        - pattern-inside: |
                            $VALUE = {..., clientSecret: $SECRET, ...}
                            ...
                        - pattern-inside: |
                            $VALUE = {..., secretOrKey: $SECRET, ...}
                            ...
                        - pattern-inside: |
                            $VALUE = {..., consumerSecret: $SECRET, ...}
                            ...
                    - pattern: $VALUE
      severity: WARNING
    - id: javascript.phantom.security.audit.phantom-injection.phantom-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `phantom` page methods it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - phantom
      patterns:
        - pattern-inside: |
            $PHANTOM = require('phantom');
            ...
        - pattern-either:
            - pattern: $PAGE.open($INPUT,...)
            - pattern: $PAGE.property("content",$INPUT,...)
            - pattern: $PAGE.setContent($INPUT,...)
            - pattern: $PAGE.openUrl($INPUT,...)
            - pattern: $PAGE.evaluateJavaScript($INPUT,...)
        - pattern-not: $PAGE.open("...",...)
        - pattern-not: $PAGE.property("content","...",...)
        - pattern-not: $PAGE.setContent("...",...)
        - pattern-not: $PAGE.openUrl("...",...)
        - pattern-not: $PAGE.evaluateJavaScript("...",...)
      severity: WARNING
    - id: javascript.playwright.security.audit.playwright-addinitscript-code-injection.playwright-addinitscript-code-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `addInitScript` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - playwright
      patterns:
        - pattern-inside: |
            require('playwright');
            ...
        - pattern-not-inside: |
            var $INPUT = function $FNAME(...){...};
            ...
        - pattern: $CONTEXT.addInitScript($INPUT,...)
        - pattern-not: $CONTEXT.addInitScript("...",...)
        - pattern-not: $CONTEXT.addInitScript(function(...){...},...)
      severity: WARNING
    - id: javascript.playwright.security.audit.playwright-goto-injection.playwright-goto-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `goto` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - playwright
      patterns:
        - pattern-inside: |
            require('playwright');
            ...
        - pattern-not-inside: |
            require('playwright');
            ...
            var $INPUT = "...";
            ...
            $PAGE.goto($INPUT,...)
        - pattern: $PAGE.goto($INPUT,...)
        - pattern-not: $PAGE.goto("...",...)
      severity: WARNING
    - id: javascript.puppeteer.security.audit.puppeteer-evaluate-code-injection.puppeteer-evaluate-code-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `evaluate` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - puppeteer
      patterns:
        - pattern-inside: |
            require('puppeteer');
            ...
        - pattern-not-inside: |
            var $INPUT = function $FNAME(...){...};
            ...
        - pattern-either:
            - pattern: $PAGE.evaluate($INPUT,...)
            - pattern: $PAGE.evaluateHandle($INPUT,...)
            - pattern: $PAGE.evaluateOnNewDocument($INPUT,...)
        - pattern-not: $PAGE.evaluate("...",...)
        - pattern-not: $PAGE.evaluate(function(...){...},...)
        - pattern-not: $PAGE.evaluateHandle("...",...)
        - pattern-not: $PAGE.evaluateHandle(function(...){...},...)
        - pattern-not: $PAGE.evaluateOnNewDocument("...",...)
        - pattern-not: $PAGE.evaluateOnNewDocument(function(...){...},...)
      severity: WARNING
    - id: javascript.puppeteer.security.audit.puppeteer-goto-injection.puppeteer-goto-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `goto` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - puppeteer
      patterns:
        - pattern-inside: |
            require('puppeteer');
            ...
        - pattern-not-inside: |
            require('puppeteer');
            ...
            var $INPUT = "...";
            ...
            $PAGE.goto($INPUT,...)
        - pattern: $PAGE.goto($INPUT,...)
        - pattern-not: $PAGE.goto("...",...)
      severity: WARNING
    - id: javascript.puppeteer.security.audit.puppeteer-setcontent-injection.puppeteer-setcontent-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `setContent` method it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - puppeteer
      patterns:
        - pattern-inside: |
            require('puppeteer');
            ...
        - pattern-not-inside: |
            require('puppeteer');
            ...
            var $INPUT = "...";
            ...
        - pattern: $PAGE.setContent($INPUT,...)
        - pattern-not: $PAGE.setContent("...",...)
      severity: WARNING
    - id: javascript.sandbox.security.audit.sandbox-code-injection.sandbox-code-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `sandbox`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - sandbox
      patterns:
        - pattern-inside: |
            $SANDBOX = require('sandbox');
            ...
        - pattern-not-inside: |
            $CODE = "...";
            ...
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $S = new $SANDBOX(...);
                    ...
                - pattern: $S.run($CODE,...);
            - pattern: |
                new $SANDBOX(...).run($CODE,...);
        - pattern-not-inside: |
            $S = new $SANDBOX(...);
            ...
            $S.run("...",...);
        - pattern-not-inside: new $SANDBOX(...).run("...",...);
      severity: WARNING
    - id: javascript.sequelize.security.audit.sequelize-injection-express.express-sequelize-injection
      languages:
        - javascript
        - typescript
      message: Detected a sequelize statement that is tainted by user-input. This could lead to SQL injection if the variable is user-controlled and is not properly sanitized. In order to prevent SQL injection, it is recommended to use parameterized queries or prepared statements.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://sequelize.org/docs/v6/core-concepts/raw-queries/#replacements
        subcategory:
            - vuln
        technology:
            - express
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern-either:
            - pattern: parseInt(...)
            - pattern: $FUNC. ... .hash(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: sequelize.query($QUERY,...)
                    - pattern: $DB.sequelize.query($QUERY,...)
                - focus-metavariable: $QUERY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: function ... ($REQ, $RES) {...}
                - pattern-inside: function ... ($REQ, $RES, $NEXT) {...}
                - patterns:
                    - pattern-either:
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES) {...})
                        - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, $NEXT) {...})
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: ^(get|post|put|head|delete|options)$
            - pattern-either:
                - pattern: $REQ.query
                - pattern: $REQ.body
                - pattern: $REQ.params
                - pattern: $REQ.cookies
                - pattern: $REQ.headers
                - pattern: $REQ.files.$ANYTHING.data.toString('utf8')
                - pattern: $REQ.files.$ANYTHING['data'].toString('utf8')
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response, $NEXT: NextFunction) =>
                    {...}
                - pattern-inside: |
                    ({ $REQ }: Request,$RES: Response) => {...}
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern: params
                - pattern: query
                - pattern: cookies
                - pattern: headers
                - pattern: body
                - pattern: files.$ANYTHING.data.toString('utf8')
                - pattern: files.$ANYTHING['data'].toString('utf8')
      severity: ERROR
    - id: javascript.sequelize.security.audit.sequelize-raw-query.sequelize-raw-query
      languages:
        - javascript
        - typescript
      message: 'Avoiding SQL string concatenation: untrusted input concatenated with raw SQL query can result in SQL Injection. Data replacement or data binding should be used. See https://sequelize.org/master/manual/raw-queries.html'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://sequelize.org/master/manual/raw-queries.html
        subcategory:
            - audit
        technology:
            - sequelize
      pattern-either:
        - pattern: |
            $DATABASE.sequelize.query(`...${...}...`, ...)
        - pattern: |
            $QUERY = `...${...}...`
            ...
            $DATABASE.sequelize.query($QUERY, ...)
        - pattern: |
            $DATABASE.sequelize.query($SQL + $VALUE, ...)
        - pattern: |
            $QUERY = $SQL + $VALUE
            ...
            $DATABASE.sequelize.query($QUERY, ...)
      severity: WARNING
    - id: javascript.sequelize.security.audit.sequelize-tls-disabled-cert-validation.sequelize-tls-disabled-cert-validation
      languages:
        - javascript
        - typescript
      message: Set "rejectUnauthorized" to false is a convenient way to resolve certificate error. But this method is unsafe because it disables the server certificate verification, making the Node app open to MITM attack. "rejectUnauthorized" option must be alway set to True (default value). With self -signed certificate or custom CA, use "ca" option to define Root Certificate. This rule checks TLS configuration only for Postgresql, MariaDB and MySQL. SQLite is not really concerned by TLS configuration. This rule could be extended for MSSQL, but the dialectOptions is specific for Tedious.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://node-postgres.com/features/ssl
            - https://nodejs.org/api/tls.html#tls_class_tls_tlssocket
            - https://nodejs.org/api/tls.html#tls_tls_createsecurecontext_options
        subcategory:
            - audit
        technology:
            - sequelize
      patterns:
        - pattern: |
            {
              host: $HOST,
              database: $DATABASE,
              dialect: $DIALECT,
              dialectOptions: {
                ssl: {
                  rejectUnauthorized: false
                }
              }
             }
        - metavariable-regex:
            metavariable: $DIALECT
            regex: '[''"](mariadb|mysql|postgres)[''"]'
      severity: ERROR
    - id: javascript.shelljs.security.shelljs-exec-injection.shelljs-exec-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `exec` method it can result in Remote Code Execution
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - shelljs
      patterns:
        - pattern-inside: |
            require('shelljs');
            ...
        - pattern-not-inside: |
            require('shelljs');
            ...
            var $INPUT = "...";
            ...
        - pattern: $SHELL.exec($INPUT,...)
        - pattern-not: $SHELL.exec("...",...)
      severity: ERROR
    - id: javascript.thenify.security.audit.multiargs-code-execution.multiargs-code-execution
      languages:
        - javascript
        - typescript
      message: Potential arbitrary code execution, piped to eval
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - thenify
      patterns:
        - pattern-either:
            - pattern: |
                $THENIFY($FN, {multiArgs: ...},...)
            - pattern: |
                $OPTS = {multiArgs: ...};
                ...
                $THENIFY($FN,$OPTS,...);
        - pattern-not: |
            $THENIFY($FN, {multiArgs: false},...)
        - pattern-not: |
            $OPTS = {multiArgs: false};
            ...
            $THENIFY($FN,$OPTS,...)
        - pattern-either:
            - pattern-inside: |
                $THENIFY = require('thenify');
                ...
            - pattern-inside: |
                import 'thenify';
                ...
      severity: WARNING
    - id: javascript.vm2.security.audit.vm2-code-injection.vm2-code-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `vm2`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - vm2
      patterns:
        - pattern-inside: |
            require('vm2');
            ...
        - pattern-not-inside: |
            $CODE = "...";
            ...
        - pattern-not-inside: |
            require('vm2');
            ...
            $CODE = new VMScript(...);
            ...
        - pattern-either:
            - pattern: |
                $VM = new VM(...);
                ...
                $VM.run($CODE,...);
            - pattern: |
                new VM(...).run($CODE,...);
            - pattern: |
                $VM = new NodeVM(...);
                ...
                $VM.run($CODE,...);
            - pattern: |
                new NodeVM(...).run($CODE,...);
            - pattern: |
                new VMScript($CODE,...);
        - pattern-not: |
            $VM = new VM(...);
            ...
            $VM.run("...",...);
        - pattern-not: |
            $VM = new NodeVM(...);
            ...
            $VM.run("...",...);
        - pattern-not: |
            (new VM(...)).run("...",...);
        - pattern-not: |
            (new NodeVM(...)).run("...",...);
        - pattern-not: new VMScript("...",...);
      severity: WARNING
    - id: javascript.vm2.security.audit.vm2-context-injection.vm2-context-injection
      languages:
        - javascript
        - typescript
      message: Make sure that unverified user data can not reach `vm2`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - vm2
      patterns:
        - pattern-inside: |
            $VM = require('vm2');
            ...
        - pattern-either:
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  new VM({sandbox: <... $INPUT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... {$NAME:$INPUT} ...>;
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $OPTS = {sandbox: <... $INPUT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  new VM({sandbox: <... $INPUT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... {$NAME:$INPUT} ...>;
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  new VM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $OPTS = {sandbox: <... $INPUT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new VM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  new NodeVM({sandbox: <... $INPUT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... {$NAME:$INPUT} ...>;
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $OPTS = {sandbox: <... $INPUT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function (...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  new NodeVM({sandbox: <... $INPUT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... {$NAME:$INPUT} ...>;
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  new NodeVM({sandbox: <... $CONTEXT ...>},...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $OPTS = {sandbox: <... $INPUT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = <... $INPUT ...>;
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |
                function $F(...,$INPUT,...) {
                  ...
                  $CONTEXT = {$NAME: <... $INPUT ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
            - pattern: |-
                function $F(...,$INPUT,...) {
                  ...
                  $VAR = <... $INPUT ...>;
                  ...
                  $CONTEXT = {$NAME: <... $VAR ...>};
                  ...
                  $OPTS = {sandbox: <... $CONTEXT ...>};
                  ...
                  new NodeVM($OPTS,...);
                  ...
                }
      severity: WARNING
    - id: javascript.vue.security.audit.xss.templates.avoid-v-html.avoid-v-html
      languages:
        - regex
      message: Dynamically rendering arbitrary HTML on your website can be very dangerous because it can easily lead to XSS vulnerabilities. Only use HTML interpolation on trusted content and never on user-provided content.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://vuejs.org/v2/guide/syntax.html#Raw-HTML
        subcategory:
            - audit
        technology:
            - vue
      paths:
        include:
            - '*.vue'
      pattern-regex: <[^<>]*v-html=
      severity: WARNING
    - id: javascript.wkhtmltoimage.security.audit.wkhtmltoimage-injection.wkhtmltoimage-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `wkhtmltoimage` it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - wkhtmltoimage
      patterns:
        - pattern-inside: |
            $WK = require('wkhtmltoimage');
            ...
        - pattern-not-inside: |
            var $INPUT = "...";
            ...
        - pattern: $WK.generate($INPUT,...)
        - pattern-not: $WK.generate("...",...)
      severity: WARNING
    - id: javascript.wkhtmltopdf.security.audit.wkhtmltopdf-injection.wkhtmltopdf-injection
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the `wkhtmltopdf` it can result in Server-Side Request Forgery vulnerabilities
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - audit
        technology:
            - wkhtmltopdf
      patterns:
        - pattern-inside: |
            $WK = require('wkhtmltopdf');
            ...
        - pattern-not-inside: |
            var $INPUT = "...";
            ...
        - pattern: $WK($INPUT,...)
        - pattern-not: $WK("...",...)
      severity: WARNING
    - id: javascript.xml2json.security.audit.xml2json-xxe.xml2json-xxe
      languages:
        - javascript
        - typescript
      message: If unverified user data can reach the XML Parser it can result in XML External or Internal Entity (XXE) Processing vulnerabilities
      metadata:
        asvs:
            control_id: 5.5.2 Insecue XML Deserialization
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v55-deserialization-prevention
            section: V5 Validation, Sanitization and Encoding
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - audit
        technology:
            - xml2json
      patterns:
        - pattern: |
            var $XML = require('xml2json');
            ...
            $XML.toJson(...);
        - pattern-not: |
            var $XML = require('xml2json');
            ...
            $XML.toJson("...",...);
        - pattern-not: |-
            var $XML = require('xml2json');
            ...
            var $S = "...";
            ...
            $XML.toJson($S,...);
      severity: WARNING
    - id: json.aws.security.public-s3-bucket.public-s3-bucket
      languages:
        - json
      message: Detected public S3 bucket. This policy allows anyone to have some kind of access to the bucket. The exact level of access and types of actions allowed will depend on the configuration of bucket policy and ACLs. Please review the bucket configuration to make sure they are set with intended values.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-264: CWE CATEGORY: Permissions, Privileges, and Access Controls'
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html
        subcategory:
            - vuln
        technology:
            - aws
      patterns:
        - pattern-inside: |
            $BUCKETNAME: {
              "Type": "AWS::S3::Bucket",
              "Properties": {
              ...,
              },
              ...,
            }
        - pattern-either:
            - pattern: |
                "PublicAccessBlockConfiguration": {
                     ...,
                     "RestrictPublicBuckets": false,
                     ...,
                   },
            - pattern: |
                "PublicAccessBlockConfiguration": {
                     ...,
                     "IgnorePublicAcls": false,
                     ...,
                   },
            - pattern: |
                "PublicAccessBlockConfiguration": {
                     ...,
                     "BlockPublicAcls": false,
                     ...,
                   },
            - pattern: |
                "PublicAccessBlockConfiguration": {
                     ...,
                     "BlockPublicPolicy": false,
                     ...,
                   },
      severity: WARNING
    - id: json.aws.security.public-s3-policy-statement.public-s3-policy-statement
      languages:
        - json
      message: Detected public S3 bucket policy. This policy allows anyone to access certain properties of or items in the bucket. Do not do this unless you will never have sensitive data inside the bucket.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-264: CWE CATEGORY: Permissions, Privileges, and Access Controls'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteAccessPermissionsReqd.html
        subcategory:
            - vuln
        technology:
            - aws
      pattern: |
        {
          "Effect": "Allow",
          "Principal": "*",
          "Resource": [
            ..., "=~/arn:aws:s3.*/", ...
          ],
          ...
        }
      severity: WARNING
    - id: json.aws.security.wildcard-assume-role.wildcard-assume-role
      languages:
        - json
      message: 'Detected wildcard access granted to sts:AssumeRole. This means anyone with your AWS account ID and the name of the role can assume the role. Instead, limit to a specific identity in your account, like this: `arn:aws:iam::<account_id>:root`.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A06:2017 - Security Misconfiguration
            - A05:2021 - Security Misconfiguration
        references:
            - https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/
        subcategory:
            - vuln
        technology:
            - aws
      patterns:
        - pattern-inside: |
            "Statement": [...]
        - pattern-inside: |
            {..., "Effect": "Allow", ..., "Action": "sts:AssumeRole", ...}
        - pattern: |
            "Principal": {..., "AWS": "*", ...}
      severity: ERROR
    - id: kotlin.lang.security.anonymous-ldap-bind.anonymous-ldap-bind
      languages:
        - kt
      message: Detected anonymous LDAP bind. This permits anonymous users to execute LDAP statements. Consider enforcing authentication for LDAP. See https://docs.oracle.com/javase/tutorial/jndi/ldap/auth_mechs.html for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-287: Improper Authentication'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A02:2017 - Broken Authentication
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#LDAP_ANONYMOUS
        subcategory:
            - vuln
        technology:
            - kotlin
      pattern: |
        $ENV.put($CTX.SECURITY_AUTHENTICATION, "none")
        ...
        $DCTX = InitialDirContext($ENV, ...)
      severity: WARNING
    - id: kotlin.lang.security.command-injection-formatted-runtime-call.command-injection-formatted-runtime-call
      languages:
        - kt
      message: A formatted or concatenated string was detected as input to a java.lang.Runtime call. This is dangerous if a variable is controlled by user input and could result in a command injection. Ensure your variables are not controlled by users or sufficiently sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#COMMAND_INJECTION.
        subcategory:
            - audit
        technology:
            - kt
      pattern-either:
        - pattern: $RUNTIME.exec($X + $Y)
        - pattern: $RUNTIME.exec(String.format(...))
        - pattern: $RUNTIME.loadLibrary($X + $Y)
        - pattern: $RUNTIME.loadLibrary(String.format(...))
      severity: ERROR
    - id: kotlin.lang.security.ecb-cipher.ecb-cipher
      languages:
        - kt
      message: Cipher in ECB mode is detected. ECB mode produces the same output for the same input each time which allows an attacker to intercept and replay the data. Further, ECB mode does not provide any integrity checking. See https://find-sec-bugs.github.io/bugs.htm#CIPHER_INTEGRITY.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#ECB_MODE
        subcategory:
            - vuln
        technology:
            - kotlin
      patterns:
        - pattern-either:
            - pattern: |
                val $VAR : Cipher = $CIPHER.getInstance($MODE)
            - pattern: |
                var $VAR : Cipher = $CIPHER.getInstance($MODE)
            - pattern: |
                val $VAR = $CIPHER.getInstance($MODE)
            - pattern: |
                var $VAR = $CIPHER.getInstance($MODE)
        - metavariable-regex:
            metavariable: $MODE
            regex: .*ECB.*
      severity: WARNING
    - id: kotlin.lang.security.gcm-detection.gcm-detection
      languages:
        - kt
      message: GCM detected, please check that IV/nonce is not reused, an Initialization Vector (IV) is a nonce used to randomize the encryption, so that even if multiple messages with identical plaintext are encrypted, the generated corresponding ciphertexts are different.Unlike the Key, the IV usually does not need to be secret, rather it is important that it is random and unique. Certain encryption schemes the IV is exchanged in public as part of the ciphertext. Reusing same Initialization Vector with the same Key to encrypt multiple plaintext blocks allows an attacker to compare the ciphertexts and then, with some assumptions on the content of the messages, to gain important information about the data being encrypted.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-323: Reusing a Nonce, Key Pair in Encryption'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/323.html
        subcategory:
            - audit
        technology:
            - kotlin
      patterns:
        - pattern-either:
            - pattern: $METHOD.getInstance("AES/GCM/NoPadding",...)
            - pattern: GCMParameterSpec(...)
      severity: INFO
    - id: kotlin.lang.security.no-null-cipher.no-null-cipher
      languages:
        - kt
        - scala
      message: 'NullCipher was detected. This will not encrypt anything; the cipher text will be the same as the plain text. Use a valid, secure cipher: Cipher.getInstance("AES/CBC/PKCS7PADDING"). See https://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions for more information.'
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#NULL_CIPHER
        subcategory:
            - vuln
        technology:
            - kotlin
      pattern: NullCipher(...)
      severity: WARNING
    - id: kotlin.lang.security.unencrypted-socket.unencrypted-socket
      languages:
        - kt
      message: This socket is not encrypted. The traffic could be read by an attacker intercepting the network traffic. Use an SSLSocket created by 'SSLSocketFactory' or 'SSLServerSocketFactory' instead
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#UNENCRYPTED_SOCKET
        subcategory:
            - audit
        technology:
            - kotlin
      pattern-either:
        - pattern: ServerSocket(...)
        - pattern: Socket(...)
      severity: WARNING
    - id: kotlin.lang.security.use-of-md5.use-of-md5
      languages:
        - kt
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_MD5
        subcategory:
            - vuln
        technology:
            - kotlin
      pattern-either:
        - pattern: |
            $VAR = $MD.getInstance("MD5")
        - pattern: |
            $DU.getMd5Digest().digest(...)
      severity: WARNING
    - id: kotlin.lang.security.use-of-sha1.use-of-sha1
      languages:
        - kt
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#WEAK_MESSAGE_DIGEST_SHA1
        subcategory:
            - vuln
        technology:
            - kotlin
      pattern-either:
        - patterns:
            - pattern: |
                $VAR = $MD.getInstance("$ALGO")
            - metavariable-regex:
                metavariable: $ALGO
                regex: (SHA1|SHA-1)
        - pattern: |
            $DU.getSha1Digest().digest(...)
      severity: WARNING
    - id: kotlin.lang.security.weak-rsa.use-of-weak-rsa-key
      languages:
        - kt
      message: RSA keys should be at least 2048 bits based on NIST recommendation.
      metadata:
        asvs:
            control_id: 6.2.5 Insecure Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#RSA_KEY_SIZE
        subcategory:
            - audit
        technology:
            - kotlin
      patterns:
        - pattern-either:
            - pattern: |
                $KEY = $G.getInstance("RSA")
                ...
                $KEY.initialize($BITS)
        - metavariable-comparison:
            comparison: $BITS < 2048
            metavariable: $BITS
      severity: WARNING
    - id: php.doctrine.security.audit.doctrine-dbal-dangerous-query.doctrine-dbal-dangerous-query
      languages:
        - php
      message: Detected string concatenation with a non-literal variable in a Doctrine DBAL query method. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.doctrine-project.org/projects/doctrine-dbal/en/current/reference/security.html
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - doctrine
      patterns:
        - pattern-either:
            - pattern: $CONNECTION->prepare($QUERY,...)
            - pattern: $CONNECTION->createQuery($QUERY,...)
            - pattern: $CONNECTION->executeQuery($QUERY,...)
        - pattern-either:
            - pattern-inside: |
                use Doctrine\DBAL\Connection;
                ...
            - pattern-inside: |
                $CONNECTION = $SMTH->getConnection(...);
                ...
        - pattern-not: $CONNECTION->prepare("...",...)
        - pattern-not: $CONNECTION->createQuery("...",...)
        - pattern-not: $CONNECTION->executeQuery("...",...)
      severity: WARNING
    - id: php.doctrine.security.audit.doctrine-orm-dangerous-query.doctrine-orm-dangerous-query
      languages:
        - php
      message: '`$QUERY` Detected string concatenation with a non-literal variable in a Doctrine QueryBuilder method. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.doctrine-project.org/projects/doctrine-dbal/en/current/reference/query-builder.html#security-safely-preventing-sql-injection
            - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - doctrine
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern-either:
                - pattern: $QUERY->add(...,$SINK,...)
                - pattern: $QUERY->select(...,$SINK,...)
                - pattern: $QUERY->addSelect(...,$SINK,...)
                - pattern: $QUERY->delete(...,$SINK,...)
                - pattern: $QUERY->update(...,$SINK,...)
                - pattern: $QUERY->insert(...,$SINK,...)
                - pattern: $QUERY->from(...,$SINK,...)
                - pattern: $QUERY->join(...,$SINK,...)
                - pattern: $QUERY->innerJoin(...,$SINK,...)
                - pattern: $QUERY->leftJoin(...,$SINK,...)
                - pattern: $QUERY->rightJoin(...,$SINK,...)
                - pattern: $QUERY->where(...,$SINK,...)
                - pattern: $QUERY->andWhere(...,$SINK,...)
                - pattern: $QUERY->orWhere(...,$SINK,...)
                - pattern: $QUERY->groupBy(...,$SINK,...)
                - pattern: $QUERY->addGroupBy(...,$SINK,...)
                - pattern: $QUERY->having(...,$SINK,...)
                - pattern: $QUERY->andHaving(...,$SINK,...)
                - pattern: $QUERY->orHaving(...,$SINK,...)
                - pattern: $QUERY->orderBy(...,$SINK,...)
                - pattern: $QUERY->addOrderBy(...,$SINK,...)
                - pattern: $QUERY->set($SINK,...)
                - pattern: $QUERY->setValue($SINK,...)
            - pattern-either:
                - pattern-inside: |
                    $Q = $X->createQueryBuilder();
                    ...
                - pattern-inside: |
                    $Q = new QueryBuilder(...);
                    ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: sprintf(...)
                - pattern: |
                    "...".$SMTH
      severity: WARNING
    - id: php.lang.security.assert-use.assert-use
      languages:
        - php
      message: Calling assert with user input is equivalent to eval'ing.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.assert
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/AssertsSniff.php
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: assert($SINK, ...);
            - pattern-not: assert("...", ...);
            - pattern: $SINK
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $_GET
                    - pattern: $_POST
                    - pattern: $_COOKIE
                    - pattern: $_REQUEST
                    - pattern: $_SERVER
            - patterns:
                - pattern: |
                    Route::$METHOD($ROUTENAME, function(..., $ARG, ...) { ... })
                - focus-metavariable: $ARG
      severity: ERROR
    - id: php.lang.security.audit.assert-use-audit.assert-use-audit
      languages:
        - php
      message: Calling assert with user input is equivalent to eval'ing.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.assert
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/AssertsSniff.php
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern: assert($ASSERT, ...);
        - pattern-not: assert("...", ...);
        - metavariable-regex:
            metavariable: $ASSERT
            regex: \A\$[A-Za-z\[\]\-_'"\$]+(\-\>\w+)?\Z
      severity: ERROR
    - id: php.lang.security.backticks-use.backticks-use
      languages:
        - php
      message: Backticks use may lead to command injection vulnerabilities.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/language.operators.execution.php
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/BackticksSniff.php
        subcategory:
            - audit
        technology:
            - php
      pattern: '`...`;'
      severity: ERROR
    - id: php.lang.security.base-convert-loses-precision.base-convert-loses-precision
      languages:
        - php
      message: The function base_convert uses 64-bit numbers internally, and does not correctly convert large numbers. It is not suitable for random tokens such as those used for session tokens or CSRF tokens.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-190: Integer Overflow or Wraparound'
        impact: LOW
        likelihood: LOW
        references:
            - https://www.php.net/base_convert
            - https://www.sjoerdlangkemper.nl/2017/03/15/dont-use-base-convert-on-random-tokens/
        subcategory:
            - audit
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: substr(..., $LENGTH)
            - metavariable-comparison:
                comparison: $LENGTH <= 7
                metavariable: $LENGTH
      pattern-sinks:
        - pattern: base_convert(...)
      pattern-sources:
        - pattern: hash(...)
        - pattern: hash_hmac(...)
        - pattern: sha1(...)
        - pattern: md5(...)
        - patterns:
            - pattern: random_bytes($N)
            - metavariable-comparison:
                comparison: $N > 7
                metavariable: $N
        - patterns:
            - pattern: openssl_random_pseudo_bytes($N)
            - metavariable-comparison:
                comparison: $N > 7
                metavariable: $N
        - patterns:
            - pattern: $OBJ->get_random_bytes($N)
            - metavariable-comparison:
                comparison: $N > 7
                metavariable: $N
      severity: WARNING
    - id: php.lang.security.curl-ssl-verifypeer-off.curl-ssl-verifypeer-off
      languages:
        - php
      message: SSL verification is disabled but should not be (currently CURLOPT_SSL_VERIFYPEER= $IS_VERIFIED)
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.saotn.org/dont-turn-off-curlopt_ssl_verifypeer-fix-php-configuration/
        subcategory:
            - vuln
        technology:
            - php
      patterns:
        - pattern-either:
            - pattern: |
                $ARG = $IS_VERIFIED;
                ...
                curl_setopt(..., CURLOPT_SSL_VERIFYPEER, $ARG);
            - pattern: curl_setopt(..., CURLOPT_SSL_VERIFYPEER, $IS_VERIFIED)
        - metavariable-regex:
            metavariable: $IS_VERIFIED
            regex: 0|false|null
      severity: ERROR
    - id: php.lang.security.deserialization.extract-user-data
      languages:
        - php
      message: Do not call 'extract()' on user-controllable data. If you must, then you must also provide the EXTR_SKIP flag to prevent overwriting existing variables.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://www.php.net/manual/en/function.extract.php#refsect1-function.extract-notes
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - pattern: extract($VAR, EXTR_SKIP,...)
      pattern-sinks:
        - pattern: extract(...)
      pattern-sources:
        - pattern-either:
            - pattern: $_GET[...]
            - pattern: $_FILES[...]
            - pattern: $_POST[...]
      severity: ERROR
    - id: php.lang.security.eval-use.eval-use
      languages:
        - php
      message: Evaluating non-constant commands. This can lead to command injection.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.eval
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/NoEvalsSniff.php
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern: eval(...);
        - pattern-not: eval('...');
      severity: ERROR
    - id: php.lang.security.exec-use.exec-use
      languages:
        - php
      message: Executing non-constant commands. This can lead to command injection.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/SystemExecFunctionsSniff.php
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern: $FUNC(...);
        - pattern-not: $FUNC('...', ...);
        - metavariable-regex:
            metavariable: $FUNC
            regex: exec|passthru|proc_open|popen|shell_exec|system|pcntl_exec
      severity: ERROR
    - id: php.lang.security.file-inclusion.file-inclusion
      languages:
        - php
      message: Detected non-constant file inclusion. This can lead to local file inclusion (LFI) or remote file inclusion (RFI) if user input reaches this statement. LFI and RFI could lead to sensitive files being obtained by attackers. Instead, explicitly specify what to include. If that is not a viable solution, validate user input thoroughly.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program (''PHP Remote File Inclusion'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.include.php
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/EasyRFISniff.php
            - https://en.wikipedia.org/wiki/File_inclusion_vulnerability#Types_of_Inclusion
        subcategory:
            - audit
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: basename($PATH, ...)
                - pattern-inside: linkinfo($PATH, ...)
                - pattern-inside: readlink($PATH, ...)
                - pattern-inside: realpath($PATH, ...)
                - pattern-inside: include_safe(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: $FUNC(...);
            - pattern: $VAR
            - metavariable-regex:
                metavariable: $FUNC
                regex: \b(include|include_once|require|require_once)\b
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
                - pattern: $_SERVER
      severity: ERROR
    - fix: echo htmlentities($...VARS);
      id: php.lang.security.injection.echoed-request.echoed-request
      languages:
        - php
      message: '`Echo`ing user input risks cross-site scripting vulnerability. You should use `htmlentities()` when showing data to users.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.htmlentities.php
            - https://www.php.net/manual/en/reserved.variables.request.php
            - https://www.php.net/manual/en/reserved.variables.post.php
            - https://www.php.net/manual/en/reserved.variables.get.php
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - pattern: htmlentities(...)
        - pattern: htmlspecialchars(...)
        - pattern: strip_tags(...)
        - pattern: isset(...)
        - pattern: empty(...)
        - pattern: esc_html(...)
        - pattern: esc_attr(...)
        - pattern: wp_kses(...)
        - pattern: e(...)
        - pattern: twig_escape_filter(...)
        - pattern: xss_clean(...)
        - pattern: html_escape(...)
        - pattern: Html::escape(...)
        - pattern: Xss::filter(...)
        - pattern: escapeHtml(...)
        - pattern: escapeHtml(...)
        - pattern: escapeHtmlAttr(...)
      pattern-sinks:
        - pattern: echo $...VARS;
      pattern-sources:
        - pattern: $_REQUEST
        - pattern: $_GET
        - pattern: $_POST
      severity: ERROR
    - fix: print(htmlentities($...VARS));
      id: php.lang.security.injection.printed-request.printed-request
      languages:
        - php
      message: '`Printing user input risks cross-site scripting vulnerability. You should use `htmlentities()` when showing data to users.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.htmlentities.php
            - https://www.php.net/manual/en/reserved.variables.request.php
            - https://www.php.net/manual/en/reserved.variables.post.php
            - https://www.php.net/manual/en/reserved.variables.get.php
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - pattern: htmlentities(...)
        - pattern: htmlspecialchars(...)
        - pattern: strip_tags(...)
        - pattern: isset(...)
        - pattern: empty(...)
        - pattern: esc_html(...)
        - pattern: esc_attr(...)
        - pattern: wp_kses(...)
        - pattern: e(...)
        - pattern: twig_escape_filter(...)
        - pattern: xss_clean(...)
        - pattern: html_escape(...)
        - pattern: Html::escape(...)
        - pattern: Xss::filter(...)
        - pattern: escapeHtml(...)
        - pattern: escapeHtml(...)
        - pattern: escapeHtmlAttr(...)
      pattern-sinks:
        - pattern: print($...VARS);
      pattern-sources:
        - pattern: $_REQUEST
        - pattern: $_GET
        - pattern: $_POST
      severity: ERROR
    - id: php.lang.security.injection.tainted-filename.tainted-filename
      languages:
        - php
      message: File name based on user input risks server-side request forgery.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: basename($PATH, ...)
                - pattern-inside: linkinfo($PATH, ...)
                - pattern-inside: readlink($PATH, ...)
                - pattern-inside: realpath($PATH, ...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: opcache_compile_file($FILENAME, ...)
                - pattern-inside: opcache_invalidate($FILENAME, ...)
                - pattern-inside: opcache_is_script_cached($FILENAME, ...)
                - pattern-inside: runkit7_import($FILENAME, ...)
                - pattern-inside: readline_read_history($FILENAME, ...)
                - pattern-inside: readline_write_history($FILENAME, ...)
                - pattern-inside: rar_open($FILENAME, ...)
                - pattern-inside: zip_open($FILENAME, ...)
                - pattern-inside: gzfile($FILENAME, ...)
                - pattern-inside: gzopen($FILENAME, ...)
                - pattern-inside: readgzfile($FILENAME, ...)
                - pattern-inside: hash_file($ALGO, $FILENAME, ...)
                - pattern-inside: hash_update_file($CONTEXT, $FILENAME, ...)
                - pattern-inside: pg_trace($FILENAME, ...)
                - pattern-inside: dio_open($FILENAME, ...)
                - pattern-inside: finfo_file($FINFO, $FILENAME, ...)
                - pattern-inside: mime_content_type($FILENAME, ...)
                - pattern-inside: chgrp($FILENAME, ...)
                - pattern-inside: chmod($FILENAME, ...)
                - pattern-inside: chown($FILENAME, ...)
                - pattern-inside: clearstatcache($CLEAR_REALPATH_CACHE, $FILENAME, ...)
                - pattern-inside: file_exists($FILENAME, ...)
                - pattern-inside: file_get_contents($FILENAME, ...)
                - pattern-inside: file_put_contents($FILENAME, ...)
                - pattern-inside: file($FILENAME, ...)
                - pattern-inside: fileatime($FILENAME, ...)
                - pattern-inside: filectime($FILENAME, ...)
                - pattern-inside: filegroup($FILENAME, ...)
                - pattern-inside: fileinode($FILENAME, ...)
                - pattern-inside: filemtime($FILENAME, ...)
                - pattern-inside: fileowner($FILENAME, ...)
                - pattern-inside: fileperms($FILENAME, ...)
                - pattern-inside: filesize($FILENAME, ...)
                - pattern-inside: filetype($FILENAME, ...)
                - pattern-inside: fnmatch($PATTERN, $FILENAME, ...)
                - pattern-inside: fopen($FILENAME, ...)
                - pattern-inside: is_dir($FILENAME, ...)
                - pattern-inside: is_executable($FILENAME, ...)
                - pattern-inside: is_file($FILENAME, ...)
                - pattern-inside: is_link($FILENAME, ...)
                - pattern-inside: is_readable($FILENAME, ...)
                - pattern-inside: is_uploaded_file($FILENAME, ...)
                - pattern-inside: is_writable($FILENAME, ...)
                - pattern-inside: lchgrp($FILENAME, ...)
                - pattern-inside: lchown($FILENAME, ...)
                - pattern-inside: lstat($FILENAME, ...)
                - pattern-inside: parse_ini_file($FILENAME, ...)
                - pattern-inside: readfile($FILENAME, ...)
                - pattern-inside: stat($FILENAME, ...)
                - pattern-inside: touch($FILENAME, ...)
                - pattern-inside: unlink($FILENAME, ...)
                - pattern-inside: xattr_get($FILENAME, ...)
                - pattern-inside: xattr_list($FILENAME, ...)
                - pattern-inside: xattr_remove($FILENAME, ...)
                - pattern-inside: xattr_set($FILENAME, ...)
                - pattern-inside: xattr_supported($FILENAME, ...)
                - pattern-inside: enchant_broker_request_pwl_dict($BROKER, $FILENAME, ...)
                - pattern-inside: pspell_config_personal($CONFIG, $FILENAME, ...)
                - pattern-inside: pspell_config_repl($CONFIG, $FILENAME, ...)
                - pattern-inside: pspell_new_personal($FILENAME, ...)
                - pattern-inside: exif_imagetype($FILENAME, ...)
                - pattern-inside: getimagesize($FILENAME, ...)
                - pattern-inside: image2wbmp($IMAGE, $FILENAME, ...)
                - pattern-inside: imagecreatefromavif($FILENAME, ...)
                - pattern-inside: imagecreatefrombmp($FILENAME, ...)
                - pattern-inside: imagecreatefromgd2($FILENAME, ...)
                - pattern-inside: imagecreatefromgd2part($FILENAME, ...)
                - pattern-inside: imagecreatefromgd($FILENAME, ...)
                - pattern-inside: imagecreatefromgif($FILENAME, ...)
                - pattern-inside: imagecreatefromjpeg($FILENAME, ...)
                - pattern-inside: imagecreatefrompng($FILENAME, ...)
                - pattern-inside: imagecreatefromtga($FILENAME, ...)
                - pattern-inside: imagecreatefromwbmp($FILENAME, ...)
                - pattern-inside: imagecreatefromwebp($FILENAME, ...)
                - pattern-inside: imagecreatefromxbm($FILENAME, ...)
                - pattern-inside: imagecreatefromxpm($FILENAME, ...)
                - pattern-inside: imageloadfont($FILENAME, ...)
                - pattern-inside: imagexbm($IMAGE, $FILENAME, ...)
                - pattern-inside: iptcembed($IPTC_DATA, $FILENAME, ...)
                - pattern-inside: mailparse_msg_extract_part_file($MIMEMAIL, $FILENAME, ...)
                - pattern-inside: mailparse_msg_extract_whole_part_file($MIMEMAIL, $FILENAME, ...)
                - pattern-inside: mailparse_msg_parse_file($FILENAME, ...)
                - pattern-inside: fdf_add_template($FDF_DOCUMENT, $NEWPAGE, $FILENAME, ...)
                - pattern-inside: fdf_get_ap($FDF_DOCUMENT, $FIELD, $FACE, $FILENAME, ...)
                - pattern-inside: fdf_open($FILENAME, ...)
                - pattern-inside: fdf_save($FDF_DOCUMENT, $FILENAME, ...)
                - pattern-inside: fdf_set_ap($FDF_DOCUMENT, $FIELD_NAME, $FACE, $FILENAME, ...)
                - pattern-inside: ps_add_launchlink($PSDOC, $LLX, $LLY, $URX, $URY, $FILENAME, ...)
                - pattern-inside: ps_add_pdflink($PSDOC, $LLX, $LLY, $URX, $URY, $FILENAME, ...)
                - pattern-inside: ps_open_file($PSDOC, $FILENAME, ...)
                - pattern-inside: ps_open_image_file($PSDOC, $TYPE, $FILENAME, ...)
                - pattern-inside: posix_access($FILENAME, ...)
                - pattern-inside: posix_mkfifo($FILENAME, ...)
                - pattern-inside: posix_mknod($FILENAME, ...)
                - pattern-inside: ftok($FILENAME, ...)
                - pattern-inside: fann_cascadetrain_on_file($ANN, $FILENAME, ...)
                - pattern-inside: fann_read_train_from_file($FILENAME, ...)
                - pattern-inside: fann_train_on_file($ANN, $FILENAME, ...)
                - pattern-inside: highlight_file($FILENAME, ...)
                - pattern-inside: php_strip_whitespace($FILENAME, ...)
                - pattern-inside: stream_resolve_include_path($FILENAME, ...)
                - pattern-inside: swoole_async_read($FILENAME, ...)
                - pattern-inside: swoole_async_readfile($FILENAME, ...)
                - pattern-inside: swoole_async_write($FILENAME, ...)
                - pattern-inside: swoole_async_writefile($FILENAME, ...)
                - pattern-inside: swoole_load_module($FILENAME, ...)
                - pattern-inside: tidy_parse_file($FILENAME, ...)
                - pattern-inside: tidy_repair_file($FILENAME, ...)
                - pattern-inside: get_meta_tags($FILENAME, ...)
                - pattern-inside: yaml_emit_file($FILENAME, ...)
                - pattern-inside: yaml_parse_file($FILENAME, ...)
                - pattern-inside: curl_file_create($FILENAME, ...)
                - pattern-inside: ftp_chmod($FTP, $PERMISSIONS, $FILENAME, ...)
                - pattern-inside: ftp_delete($FTP, $FILENAME, ...)
                - pattern-inside: ftp_mdtm($FTP, $FILENAME, ...)
                - pattern-inside: ftp_size($FTP, $FILENAME, ...)
                - pattern-inside: rrd_create($FILENAME, ...)
                - pattern-inside: rrd_fetch($FILENAME, ...)
                - pattern-inside: rrd_graph($FILENAME, ...)
                - pattern-inside: rrd_info($FILENAME, ...)
                - pattern-inside: rrd_last($FILENAME, ...)
                - pattern-inside: rrd_lastupdate($FILENAME, ...)
                - pattern-inside: rrd_tune($FILENAME, ...)
                - pattern-inside: rrd_update($FILENAME, ...)
                - pattern-inside: snmp_read_mib($FILENAME, ...)
                - pattern-inside: ssh2_sftp_chmod($SFTP, $FILENAME, ...)
                - pattern-inside: ssh2_sftp_realpath($SFTP, $FILENAME, ...)
                - pattern-inside: ssh2_sftp_unlink($SFTP, $FILENAME, ...)
                - pattern-inside: apache_lookup_uri($FILENAME, ...)
                - pattern-inside: md5_file($FILENAME, ...)
                - pattern-inside: sha1_file($FILENAME, ...)
                - pattern-inside: simplexml_load_file($FILENAME, ...)
            - pattern: $FILENAME
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
                - pattern: $_SERVER
      severity: WARNING
    - id: php.lang.security.injection.tainted-object-instantiation.tainted-object-instantiation
      languages:
        - php
      message: <- A new object is created where the class name is based on user input. This could lead to remote code execution, as it allows to instantiate any class in the application.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code (''Unsafe Reflection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: new $SINK(...)
            - pattern: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
                - pattern: $_SERVER
      severity: WARNING
    - id: php.lang.security.injection.tainted-session.tainted-session
      languages:
        - php
      message: Session key based on user input risks session poisoning. The user can determine the key used for the session, and thus write any session variable. Session variables are typically trusted to be set only by the application, and manipulating the session can result in access control issues.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://en.wikipedia.org/wiki/Session_poisoning
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: $A . $B
                - pattern: bin2hex(...)
                - pattern: crc32(...)
                - pattern: crypt(...)
                - pattern: filter_input(...)
                - pattern: filter_var(...)
                - pattern: hash(...)
                - pattern: md5(...)
                - pattern: preg_filter(...)
                - pattern: preg_grep(...)
                - pattern: preg_match_all(...)
                - pattern: sha1(...)
                - pattern: sprintf(...)
                - pattern: str_contains(...)
                - pattern: str_ends_with(...)
                - pattern: str_starts_with(...)
                - pattern: strcasecmp(...)
                - pattern: strchr(...)
                - pattern: stripos(...)
                - pattern: stristr(...)
                - pattern: strnatcasecmp(...)
                - pattern: strnatcmp(...)
                - pattern: strncmp(...)
                - pattern: strpbrk(...)
                - pattern: strpos(...)
                - pattern: strripos(...)
                - pattern: strrpos(...)
                - pattern: strspn(...)
                - pattern: strstr(...)
                - pattern: strtok(...)
                - pattern: substr_compare(...)
                - pattern: substr_count(...)
                - pattern: vsprintf(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: $_SESSION[$KEY] = $VAL;
            - pattern: $KEY
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
      severity: WARNING
    - id: php.lang.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - php
      message: User data flows into this manually-constructed SQL string. User data can be safely inserted into SQL strings using prepared statements or an object-relational mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL injection, which could let an attacker steal or manipulate data from the database. Instead, use prepared statements (`$mysqli->prepare("INSERT INTO test(id, label) VALUES (?, ?)");`) or a safe library.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - pattern: mysqli_real_escape_string(...)
            - pattern: real_escape_string(...)
            - pattern: $MYSQLI->real_escape_string(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: |
                    sprintf($SQLSTR, ...)
                - metavariable-regex:
                    metavariable: $SQLSTR
                    regex: .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
            - patterns:
                - pattern: |
                    "...$EXPR..."
                - metavariable-regex:
                    metavariable: $EXPR
                    regex: .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
            - patterns:
                - pattern: |
                    "$SQLSTR".$EXPR
                - metavariable-regex:
                    metavariable: $SQLSTR
                    regex: .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
      severity: ERROR
    - id: php.lang.security.injection.tainted-url-host.tainted-url-host
      languages:
        - php
      message: User data flows into the host portion of this manually-constructed URL. This could allow an attacker to send data to their own server, potentially exposing sensitive data such as cookies or authorization information sent with this request. They could also probe internal servers or other resources that the server running this code can access. (This is called server-side request forgery, or SSRF.) Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: |
                    sprintf($URLSTR, ...)
                - metavariable-pattern:
                    language: generic
                    metavariable: $URLSTR
                    pattern: $SCHEME://%s
            - patterns:
                - pattern: |
                    "...{$EXPR}..."
                - pattern-regex: |
                    .*://\{.*
            - patterns:
                - pattern: |
                    "...$EXPR..."
                - pattern-regex: |
                    .*://\$.*
            - patterns:
                - pattern: |
                    "...".$EXPR
                - pattern-regex: |
                    .*://["'].*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
      severity: WARNING
    - id: php.lang.security.mb-ereg-replace-eval.mb-ereg-replace-eval
      languages:
        - php
      message: Calling mb_ereg_replace with user input in the options can lead to arbitrary code execution. The eval modifier (`e`) evaluates the replacement argument as code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.php.net/manual/en/function.mb-ereg-replace.php
            - https://www.php.net/manual/en/function.mb-regex-set-options.php
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern: mb_ereg_replace($PATTERN, $REPL, $STR, $OPTIONS);
        - pattern-not: mb_ereg_replace($PATTERN, $REPL, $STR, "...");
      severity: ERROR
    - id: php.lang.security.md5-used-as-password.md5-used-as-password
      languages:
        - php
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Use a suitable password hashing function such as bcrypt. You can use `password_hash($PASSWORD, PASSWORD_BCRYPT, $OPTIONS);`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc6151
            - https://crypto.stackexchange.com/questions/44151/how-does-the-flame-malware-take-advantage-of-md5-collision
            - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
            - https://github.com/returntocorp/semgrep-rules/issues/1609
            - https://www.php.net/password_hash
        subcategory:
            - vuln
        technology:
            - md5
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $FUNCTION(...)
            - metavariable-regex:
                metavariable: $FUNCTION
                regex: (?i)(.*password.*)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: md5(...)
                - pattern: hash('md5', ...)
      severity: WARNING
    - id: php.lang.security.openssl-cbc-static-iv.openssl-cbc-static-iv
      languages:
        - php
      message: Static IV used with AES in CBC mode. Static IVs enable chosen-plaintext attacks against encrypted data.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-329: Generation of Predictable IV with CBC Mode'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://csrc.nist.gov/publications/detail/sp/800-38a/final
        subcategory:
            - vuln
        technology:
            - php
            - openssl
      patterns:
        - pattern-either:
            - pattern: openssl_encrypt($D, $M, $K, $FLAGS, "...",...);
            - pattern: openssl_decrypt($D, $M, $K, $FLAGS, "...",...);
        - metavariable-comparison:
            comparison: re.match(".*-CBC",$M)
            metavariable: $M
      severity: ERROR
    - id: php.lang.security.php-ssrf.php-ssrf
      languages:
        - php
      message: The web server receives a URL or similar request from an upstream component and retrieves the contents of this URL, but it does not sufficiently ensure that the request is being sent to the expected destination. Dangerous function $FUNCS with payload $DATA
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern-either:
            - pattern: |
                $VAR=$DATA;
                ...
                $FUNCS(...,$VAR, ...);
            - pattern: $FUNCS(...,$DATA, ...);
        - metavariable-pattern:
            metavariable: $DATA
            patterns:
                - pattern-either:
                    - pattern: $_GET
                    - pattern: $_POST
                    - pattern: $_COOKIE
                    - pattern: $_REQUEST
        - metavariable-pattern:
            metavariable: $FUNCS
            patterns:
                - pattern-either:
                    - pattern: curl_setopt
                    - pattern: fopen
                    - pattern: file_get_contents
                    - pattern: curl_init
                    - pattern: readfile
      severity: ERROR
    - id: php.lang.security.phpinfo-use.phpinfo-use
      languages:
        - php
      message: The 'phpinfo' function may reveal sensitive information about your environment.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://www.php.net/manual/en/function.phpinfo
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/PhpinfosSniff.php
        subcategory:
            - vuln
        technology:
            - php
      pattern: phpinfo(...);
      severity: ERROR
    - id: php.lang.security.redirect-to-request-uri.redirect-to-request-uri
      languages:
        - php
      message: Redirecting to the current request URL may redirect to another domain, if the current path starts with two slashes.  E.g. in https://www.example.com//attacker.com, the value of REQUEST_URI is //attacker.com, and redirecting to it will redirect to that domain.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://www.php.net/manual/en/reserved.variables.server.php
            - https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html
        subcategory:
            - vuln
        technology:
            - php
      patterns:
        - pattern-either:
            - pattern: |
                header('$LOCATION' . $_SERVER['REQUEST_URI']);
            - pattern: |
                header('$LOCATION' . $_SERVER['REQUEST_URI'] . $MORE);
        - metavariable-regex:
            metavariable: $LOCATION
            regex: ^(?i)location:\s*$
      severity: WARNING
    - id: php.lang.security.tainted-exec.tainted-exec
      languages:
        - php
      message: Executing non-constant commands. This can lead to command injection. You should use `escapeshellarg()` when using command.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.stackhawk.com/blog/php-command-injection/
            - https://brightsec.com/blog/code-injection-php/
            - https://www.acunetix.com/websitesecurity/php-security-2/
        subcategory:
            - vuln
        technology:
            - php
      mode: taint
      pattern-sanitizers:
        - pattern: escapeshellarg(...)
      pattern-sinks:
        - pattern: exec(...)
        - pattern: system(...)
        - pattern: popen(...)
        - pattern: passthru(...)
        - pattern: shell_exec(...)
        - pattern: pcntl_exec(...)
        - pattern: proc_open(...)
      pattern-sources:
        - pattern: $_REQUEST
        - pattern: $_GET
        - pattern: $_POST
        - pattern: $_COOKIE
      severity: ERROR
    - id: php.lang.security.unserialize-use.unserialize-use
      languages:
        - php
      message: Calling `unserialize()` with user input in the pattern can lead to arbitrary code execution. Consider using JSON or structured data approaches (e.g. Google Protocol Buffers).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://www.php.net/manual/en/function.unserialize.php
            - https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization.html
        subcategory:
            - audit
        technology:
            - php
      patterns:
        - pattern: unserialize(...)
        - pattern-not: unserialize("...",...)
      severity: WARNING
    - id: php.laravel.security.laravel-api-route-sql-injection.laravel-api-route-sql-injection
      languages:
        - php
      message: HTTP method [$METHOD] to Laravel route $ROUTE_NAME is vulnerable to SQL injection via string concatenation or unsafe interpolation.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Laravel_Cheat_Sheet.md
        subcategory:
            - vuln
        technology:
            - php
            - laravel
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                DB::raw("...",[...])
      pattern-sinks:
        - patterns:
            - pattern: |
                DB::raw(...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $ARG
            - pattern-inside: |
                Route::$METHOD($ROUTE_NAME, function(...,$ARG,...){...})
      severity: WARNING
    - id: php.laravel.security.laravel-blade-form-missing-csrf.laravel-blade-form-missing-csrf
      languages:
        - generic
      message: Detected a form executing a state-changing HTTP method `$METHOD` to route definition `$...ROUTE` without a Laravel CSRF decorator or explicit CSRF token implementation. If this form modifies sensitive state this will open your application to Cross-Site Request Forgery (CSRF) attacks.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://laravel.com/docs/9.x/csrf
        subcategory:
            - audit
        technology:
            - php
            - laravel
            - blade
      paths:
        include:
            - '*.blade.php'
      patterns:
        - pattern: |
            action="$...ROUTE"
        - pattern-inside: |
            <form ... method="$METHOD" ... >
            ...
        - pattern-not-inside: |
            <!-- ... ... ... ... ... ... ... -->
        - metavariable-pattern:
            language: generic
            metavariable: $...ROUTE
            patterns:
                - pattern-not-regex: \A\s*\Z
                - pattern-not: '#'
        - metavariable-regex:
            metavariable: $METHOD
            regex: (?i)(post|put|patch|delete)
        - pattern-not-inside: |
            <form ...>
            ...
            ...
            ...
            @csrf
        - pattern-not-inside: |
            <form ...>
            ...
            ...
            ...
            csrf_field()
        - pattern-not-inside: |
            <form ...>
            ...
            ...
            ...
            csrf_token()
      severity: WARNING
    - id: php.laravel.security.laravel-sql-injection.laravel-sql-injection
      languages:
        - php
      message: Detected a SQL query based on user input. This could lead to SQL injection, which could potentially result in sensitive data being exfiltrated by attackers. Instead, use parameterized queries and prepared statements.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://laravel.com/docs/8.x/queries
        subcategory:
            - vuln
        technology:
            - laravel
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $SQL
                    - pattern-either:
                        - pattern-inside: DB::table(...)->whereRaw($SQL, ...)
                        - pattern-inside: DB::table(...)->orWhereRaw($SQL, ...)
                        - pattern-inside: DB::table(...)->groupByRaw($SQL, ...)
                        - pattern-inside: DB::table(...)->havingRaw($SQL, ...)
                        - pattern-inside: DB::table(...)->orHavingRaw($SQL, ...)
                        - pattern-inside: DB::table(...)->orderByRaw($SQL, ...)
                - patterns:
                    - pattern: $EXPRESSION
                    - pattern-either:
                        - pattern-inside: DB::table(...)->selectRaw($EXPRESSION, ...)
                        - pattern-inside: DB::table(...)->fromRaw($EXPRESSION, ...)
                - patterns:
                    - pattern: $COLUMNS
                    - pattern-either:
                        - pattern-inside: DB::table(...)->whereNull($COLUMNS, ...)
                        - pattern-inside: DB::table(...)->orWhereNull($COLUMN)
                        - pattern-inside: DB::table(...)->whereNotNull($COLUMNS, ...)
                        - pattern-inside: DB::table(...)->whereRowValues($COLUMNS, ...)
                        - pattern-inside: DB::table(...)->orWhereRowValues($COLUMNS, ...)
                        - pattern-inside: DB::table(...)->find($ID, $COLUMNS)
                        - pattern-inside: DB::table(...)->paginate($PERPAGE, $COLUMNS, ...)
                        - pattern-inside: DB::table(...)->simplePaginate($PERPAGE, $COLUMNS, ...)
                        - pattern-inside: DB::table(...)->cursorPaginate($PERPAGE, $COLUMNS, ...)
                        - pattern-inside: DB::table(...)->getCountForPagination($COLUMNS)
                        - pattern-inside: DB::table(...)->aggregate($FUNCTION, $COLUMNS)
                        - pattern-inside: DB::table(...)->numericAggregate($FUNCTION, $COLUMNS)
                        - pattern-inside: DB::table(...)->insertUsing($COLUMNS, ...)
                        - pattern-inside: DB::table(...)->select($COLUMNS)
                        - pattern-inside: DB::table(...)->get($COLUMNS)
                        - pattern-inside: DB::table(...)->count($COLUMNS)
                - patterns:
                    - pattern: $COLUMN
                    - pattern-either:
                        - pattern-inside: DB::table(...)->whereIn($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereIn($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereNotIn($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereNotIn($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereIntegerInRaw($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereIntegerInRaw($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereIntegerNotInRaw($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereIntegerNotInRaw($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereBetweenColumns($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereBetween($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereBetweenColumns($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereNotBetween($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereNotBetweenColumns($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereNotBetween($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereNotBetweenColumns($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereNotNull($COLUMN)
                        - pattern-inside: DB::table(...)->whereDate($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereDate($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereTime($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereTime($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereDay($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereDay($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereMonth($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereMonth($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereYear($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereYear($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereJsonContains($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereJsonContains($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereJsonDoesntContain($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereJsonDoesntContain($COLUMN, ...)
                        - pattern-inside: DB::table(...)->whereJsonLength($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhereJsonLength($COLUMN, ...)
                        - pattern-inside: DB::table(...)->having($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orHaving($COLUMN, ...)
                        - pattern-inside: DB::table(...)->havingBetween($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orderBy($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orderByDesc($COLUMN)
                        - pattern-inside: DB::table(...)->latest($COLUMN)
                        - pattern-inside: DB::table(...)->oldest($COLUMN)
                        - pattern-inside: DB::table(...)->forPageBeforeId($PERPAGE, $LASTID, $COLUMN)
                        - pattern-inside: DB::table(...)->forPageAfterId($PERPAGE, $LASTID, $COLUMN)
                        - pattern-inside: DB::table(...)->value($COLUMN)
                        - pattern-inside: DB::table(...)->pluck($COLUMN, ...)
                        - pattern-inside: DB::table(...)->implode($COLUMN, ...)
                        - pattern-inside: DB::table(...)->min($COLUMN)
                        - pattern-inside: DB::table(...)->max($COLUMN)
                        - pattern-inside: DB::table(...)->sum($COLUMN)
                        - pattern-inside: DB::table(...)->avg($COLUMN)
                        - pattern-inside: DB::table(...)->average($COLUMN)
                        - pattern-inside: DB::table(...)->increment($COLUMN, ...)
                        - pattern-inside: DB::table(...)->decrement($COLUMN, ...)
                        - pattern-inside: DB::table(...)->where($COLUMN, ...)
                        - pattern-inside: DB::table(...)->orWhere($COLUMN, ...)
                        - pattern-inside: DB::table(...)->addSelect($COLUMN)
                - patterns:
                    - pattern: $QUERY
                    - pattern-inside: DB::unprepared($QUERY)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
                - pattern: $_SERVER
      severity: WARNING
    - id: php.laravel.security.laravel-unsafe-validator.laravel-unsafe-validator
      languages:
        - php
      message: Found a request argument passed to an `ignore()` definition in a Rule constraint. This can lead to SQL injection.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://laravel.com/docs/9.x/validation#rule-unique
        subcategory:
            - vuln
        technology:
            - php
            - laravel
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                Illuminate\Validation\Rule::unique(...)->ignore(...,$IGNORE,...)
            - focus-metavariable: $IGNORE
      pattern-sources:
        - patterns:
            - pattern: |
                public function $F(...,Request $R,...){...}
            - focus-metavariable: $R
        - patterns:
            - pattern-either:
                - pattern: |
                    $this->$PROPERTY
                - pattern: |
                    $this->$PROPERTY->$GET
            - metavariable-pattern:
                metavariable: $PROPERTY
                patterns:
                    - pattern-either:
                        - pattern: query
                        - pattern: request
                        - pattern: headers
                        - pattern: cookies
                        - pattern: cookie
                        - pattern: files
                        - pattern: file
                        - pattern: allFiles
                        - pattern: input
                        - pattern: all
                        - pattern: post
                        - pattern: json
            - pattern-either:
                - pattern-inside: |
                    class $CL extends Illuminate\Http\Request {...}
                - pattern-inside: |
                    class $CL extends Illuminate\Foundation\Http\FormRequest {...}
      severity: ERROR
    - id: php.symfony.security.audit.symfony-csrf-protection-disabled.symfony-csrf-protection-disabled
      languages:
        - php
      message: CSRF protection is disabled for this configuration. This is a security risk. Make sure that it is safe or consider setting `csrf_protection` property to `true`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://symfony.com/doc/current/security/csrf.html
        subcategory:
            - audit
        technology:
            - symfony
      patterns:
        - pattern-either:
            - pattern: $X->createForm($TYPE, $TASK, [..., 'csrf_protection' => false, ...], ...)
            - pattern: $X->prependExtensionConfig('framework', [..., 'csrf_protection' => false, ...], ...)
            - pattern: $X->loadFromExtension('framework', [..., 'csrf_protection' => false, ...], ...)
            - pattern: $X->setDefaults([..., 'csrf_protection' => false, ...], ...)
            - patterns:
                - pattern-either:
                    - pattern: $X->createForm($TYPE, $TASK, [..., 'csrf_protection' => $VAL, ...], ...)
                    - pattern: $X->prependExtensionConfig('framework', [..., 'csrf_protection' => $VAL, ...], ...)
                    - pattern: $X->loadFromExtension('framework', [..., 'csrf_protection' => $VAL, ...], ...)
                    - pattern: $X->setDefaults([..., 'csrf_protection' => $VAL, ...], ...)
                - pattern-inside: |
                    $VAL = false;
                    ...
      severity: WARNING
    - id: php.wordpress-plugins.security.audit.wp-code-execution-audit.wp-code-execution-audit
      languages:
        - php
      message: These functions can lead to code injection if the data inside them is user-controlled. Don't use the input directly or validate the data properly before passing it to these functions.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/wpscanteam/wpscan/wiki/WordPress-Plugin-Security-Testing-Cheat-Sheet#php-code-execution
        subcategory:
            - audit
        technology:
            - Wordpress Plugins
      paths:
        include:
            - wp-content/plugins/**/*.php
      patterns:
        - pattern-either:
            - pattern: eval(...)
            - pattern: assert(...)
            - pattern: call_user_func(...)
      severity: WARNING
    - id: php.wordpress-plugins.security.audit.wp-command-execution-audit.wp-command-execution-audit
      languages:
        - php
      message: These functions can lead to command execution if the data inside them is user-controlled. Don't use the input directly or validate the data properly before passing it to these functions.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/wpscanteam/wpscan/wiki/WordPress-Plugin-Security-Testing-Cheat-Sheet#command-execution
        subcategory:
            - audit
        technology:
            - Wordpress Plugins
      paths:
        include:
            - wp-content/plugins/**/*.php
      patterns:
        - pattern-either:
            - pattern: system(...)
            - pattern: exec(...)
            - pattern: passthru(...)
            - pattern: shell_exec(...)
      severity: WARNING
    - id: php.wordpress-plugins.security.audit.wp-file-inclusion-audit.wp-file-inclusion-audit
      languages:
        - php
      message: These functions can lead to Local File Inclusion (LFI) or Remote File Inclusion (RFI) if the data inside is user-controlled. Validate the data properly before passing it to these functions.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
            - 'CWE-73: The software allows user input to control or influence paths of file names that are used in filesystem operations.'
            - 'CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program (''PHP Remote File Inclusion'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/wpscanteam/wpscan/wiki/WordPress-Plugin-Security-Testing-Cheat-Sheet#file-inclusion
        subcategory:
            - audit
        technology:
            - Wordpress Plugins
      paths:
        include:
            - wp-content/plugins/**/*.php
      patterns:
        - pattern-either:
            - pattern: include(...)
            - pattern: require(...)
            - pattern: include_once(...)
            - pattern: require_once(...)
            - pattern: fread(...)
      severity: WARNING
    - id: php.wordpress-plugins.security.audit.wp-php-object-injection-audit.wp-php-object-injection-audit
      languages:
        - php
      message: If the data used inside the patterns are directly used without proper sanitization, then this could lead to PHP Object Injection. Do not use these function with user-supplied input, use JSON functions instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/wpscanteam/wpscan/wiki/WordPress-Plugin-Security-Testing-Cheat-Sheet#php-object-injection
            - https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection
        subcategory:
            - audit
        technology:
            - Wordpress Plugins
      paths:
        include:
            - wp-content/plugins/**/*.php
      patterns:
        - pattern-either:
            - pattern: unserialize(...)
            - pattern: maybe_unserialize(...)
      severity: WARNING
    - id: php.wordpress-plugins.security.audit.wp-sql-injection-audit.wp-sql-injection-audit
      languages:
        - php
      message: Detected unsafe API methods. This could lead to SQL Injection if the used variable in the functions are user controlled and not properly escaped or sanitized. In order to prevent SQL Injection, use safe api methods like "$wpdb->prepare" properly or escape/sanitize the data properly.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/wpscanteam/wpscan/wiki/WordPress-Plugin-Security-Testing-Cheat-Sheet#sql-injection
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - audit
        technology:
            - Wordpress Plugins
      paths:
        include:
            - wp-content/plugins/**/*.php
      patterns:
        - pattern-either:
            - pattern: $wpdb->query(...)
            - pattern: $wpdb->get_var(...)
            - pattern: $wpdb->get_row(...)
            - pattern: $wpdb->get_col(...)
            - pattern: $wpdb->get_results(...)
            - pattern: $wpdb->replace(...)
        - pattern-not: $wpdb->prepare(...)
        - pattern-not: $wpdb->delete(...)
        - pattern-not: $wpdb->update(...)
        - pattern-not: $wpdb->insert(...)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.bypass-tls-verification.bypass-tls-verification
      languages:
        - go
      message: Checks for disabling of TLS/SSL certificate verification. This should only be used for debugging purposes because it leads to vulnerability to MTM attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://stackoverflow.com/questions/12122159/how-to-do-a-https-request-with-bad-certificate
        subcategory:
            - vuln
        technology:
            - go
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            tls.Config{..., InsecureSkipVerify: true, ...}
        - pattern: |
            $CONFIG = &tls.Config{...}
            ...
            $CONFIG.InsecureSkipVerify = true
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.disallow-old-tls-versions.disallow-old-tls-versions
      languages:
        - go
      message: Detects creations of tls configuration objects with an insecure MinVersion of TLS. These protocols are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://stackoverflow.com/questions/26429751/java-http-clients-and-poodle
        subcategory:
            - vuln
        technology:
            - go
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern: |
                tls.Config{..., MinVersion: $TLS.$VERSION, ...}
            - pattern: |
                $CONFIG = &tls.Config{...}
                ...
                $CONFIG.MinVersion = $TLS.$VERSION
        - metavariable-regex:
            metavariable: $VERSION
            regex: (VersionTLS10|VersionTLS11|VersionSSL30)
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[fF][tT][pP]://'
        replacement: sftp://
      id: problem-based-packs.insecure-transport.go-stdlib.ftp-request.ftp-request
      languages:
        - go
      message: Checks for outgoing connections to ftp servers with the ftp package. FTP does not encrypt traffic, possibly leading to PII being sent plaintext over the network. Instead, connect via the SFTP protocol.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://godoc.org/github.com/jlaffaye/ftp#Dial
            - https://github.com/jlaffaye/ftp
        subcategory:
            - vuln
        technology:
            - ftp
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            ftp.Dial("=~/^[fF][tT][pP]://.*/", ...)
        - pattern: |
            ftp.DialTimeout("=~/^[fF][tT][pP]://.*/", ...)
        - pattern: |
            ftp.Connect("=~/^[fF][tT][pP]://.*/")
        - pattern: |
            $URL = "=~/^[fF][tT][pP]://.*/"
            ...
            ftp.Dial($URL, ...)
        - pattern: |
            $URL = "=~/^[fF][tT][pP]://.*/"
            ...
            ftp.DialTimeout($URL, ...)
        - pattern: |
            $URL = "=~/^[fF][tT][pP]://.*/"
            ...
            ftp.Connect($URL)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.gorequest-http-request.gorequest-http-request
      languages:
        - go
      message: Checks for requests to http (unencrypted) sites using gorequest, a popular HTTP client library. This is dangerous because it could result in plaintext PII being passed around the network.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://github.com/parnurzeal/gorequest
        subcategory:
            - vuln
        technology:
            - gorequest
        vulnerability: Insecure Transport
      pattern-either:
        - patterns:
            - pattern-inside: |
                $REQ = gorequest.New()
                ...
                $RES = ...
            - pattern: |
                $REQ.$FUNC("=~/[hH][tT][tT][pP]://.*/")
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Patch)
        - patterns:
            - pattern: gorequest.New().$FUNC("=~/[hH][tT][tT][pP]://.*/")
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Patch)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.grequests-http-request.grequests-http-request
      languages:
        - go
      message: Checks for requests to http (unencrypted) sites using grequests, a popular HTTP client library. This is dangerous because it could result in plaintext PII being passed around the network.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://godoc.org/github.com/levigross/grequests#DoRegularRequest
            - https://github.com/levigross/grequests
        subcategory:
            - vuln
        technology:
            - grequests
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern: |
                grequests.$FUNC(...,"=~/[hH][tT][tT][pP]://.*/", ...)
            - pattern: |
                $FUNC(...,"=~/[hH][tT][tT][pP]://.*/", ...)
        - metavariable-regex:
            metavariable: $FUNC
            regex: (Get|Head|Post|Put|Delete|Patch|Options|Req|DoRegularRequest)
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.go-stdlib.http-customized-request.http-customized-request
      languages:
        - go
      message: Checks for requests sent via http.NewRequest to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://golang.org/pkg/net/http/#NewRequest
        subcategory:
            - vuln
        technology:
            - go
        vulnerability: Insecure Transport
      pattern: |
        http.NewRequest(..., "=~/[hH][tT][tT][pP]://.*/", ...)
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.go-stdlib.http-request.http-request
      languages:
        - go
      message: Checks for requests sent via http.$FUNC to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://golang.org/pkg/net/http/#Get
        subcategory:
            - vuln
        technology:
            - go
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern: |
                http.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...)
            - patterns:
                - pattern-inside: |
                    $CLIENT := &http.Client{...}
                    ...
                - pattern: |
                    client.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...)
        - pattern-not: http.$FUNC("=~/[hH][tT][tT][pP]://127.0.0.1.*/", ...)
        - pattern-not: client.$FUNC("=~/[hH][tT][tT][pP]://127.0.0.1.*/", ...)
        - pattern-not: http.$FUNC("=~/[hH][tT][tT][pP]://localhost.*/", ...)
        - pattern-not: client.$FUNC("=~/[hH][tT][tT][pP]://localhost.*/", ...)
        - metavariable-regex:
            metavariable: $FUNC
            regex: (Get|Post|Head|PostForm)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.sling-http-request.sling-http-request
      languages:
        - go
      message: Checks for requests to http (unencrypted) sites using gorequest, a popular HTTP client library. This is dangerous because it could result in plaintext PII being passed around the network.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://godoc.org/github.com/dghubble/sling#Sling.Add
            - https://github.com/dghubble/sling
        subcategory:
            - vuln
        technology:
            - sling
        vulnerability: Insecure Transport
      pattern-either:
        - patterns:
            - pattern-inside: |
                $REQ = sling.New()
                ...
                $RES = ...
            - pattern: |
                $REQ.$FUNC("=~/[hH][tT][tT][pP]://.*/")
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
        - patterns:
            - pattern: sling.New().$FUNC("=~/[hH][tT][tT][pP]://.*/")
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
        - patterns:
            - pattern-inside: |
                $REQ = sling.New()
                ...
                $URL = "=~/[hH][tT][tT][pP]://.*/"
                ...
                $RES = ...
            - pattern: |
                $REQ.$FUNC($URL)
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
        - patterns:
            - pattern-inside: |
                $URL = "=~/[hH][tT][tT][pP]://.*/"
                ...
                $RES = ...
            - pattern: |
                sling.New().$FUNC($URL)
            - metavariable-regex:
                metavariable: $FUNC
                regex: (Get|Post|Delete|Head|Put|Options|Patch|Base|Connect)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.go-stdlib.telnet-request.telnet-request
      languages:
        - go
      message: Checks for attempts to connect to an insecure telnet server using the package telnet. This is bad because it can lead to man in the middle attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://godoc.org/github.com/reiver/go-telnet
        subcategory:
            - vuln
        technology:
            - go-telnet
        vulnerability: Insecure Transport
      pattern: |
        telnet.DialToAndCall(...)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-spring.bypass-tls-verification.bypass-tls-verification
      languages:
        - java
      message: Checks for redefinitions of functions that check TLS/SSL certificate verification. This can lead to vulnerabilities, as simple errors in the code can result in lack of proper certificate validation. This should only be used for debugging purposes because it leads to vulnerability to MTM attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://stackoverflow.com/questions/4072585/disabling-ssl-certificate-validation-in-spring-resttemplate
            - https://stackoverflow.com/questions/35530558/how-to-fix-unsafe-implementation-of-x509trustmanager-in-android-app?rq=1
        subcategory:
            - vuln
        technology:
            - spring
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            new HostnameVerifier() {
              ...
              public boolean verify(String hostname, SSLSession session) {
                ...
              }
              ...
            };
        - pattern: |
            public RestTemplate restTemplate() throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
              ...
              TrustStrategy $FUNCNAME = (X509Certificate[] chain, String authType) -> ...;
              ...
            }
        - pattern: |
            TrustStrategy $FUNCNAME= new TrustStrategy() {
              ...
              public boolean isTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
                ...
              }
              ...
            };
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[fF][tT][pP]://'
        replacement: sftp://
      id: problem-based-packs.insecure-transport.java-spring.spring-ftp-request.spring-ftp-request
      languages:
        - java
      message: Checks for outgoing connections to ftp servers via Spring plugin ftpSessionFactory. FTP does not encrypt traffic, possibly leading to PII being sent plaintext over the network.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.spring.io/spring-integration/api/org/springframework/integration/ftp/session/AbstractFtpSessionFactory.html#setClientMode-int-
        subcategory:
            - vuln
        technology:
            - spring
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            $SF = new DefaultFtpSessionFactory(...);
            ...
            $SF.setHost("=~/^[fF][tT][pP]://.*/");
            ...
            $SF.$FUNC(...);
        - pattern: |
            $SF = new DefaultFtpSessionFactory(...);
            ...
            String $URL = "=~/^[fF][tT][pP]://.*/";
            ...
            $SF.setHost($URL);
            ...
            $SF.$FUNC(...);
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-spring.spring-http-request.spring-http-request
      languages:
        - java
      message: Checks for requests sent via Java Spring RestTemplate API to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#delete-java.lang.String-java.util.Map-
            - https://www.baeldung.com/rest-template
        subcategory:
            - vuln
        technology:
            - spring
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern: |
                $RESTTEMP = new RestTemplate(...);
                ...
                $RESTTEMP.$FUNC("=~/[hH][tT][tT][pP]://.*/", ...);
            - pattern: |
                $RESTTEMP = new RestTemplate(...);
                ...
                String $URL = "=~/[hH][tT][tT][pP]://.*/";
                ...
                $RESTTEMP.$FUNC($URL, ...);
            - pattern: |
                $RESTTEMP = new RestTemplate(...);
                ...
                $URL = new URI(..., "=~/[hH][tT][tT][pP]://.*/", ...);
                ...
                $RESTTEMP.$FUNC($URL, ...);
        - metavariable-regex:
            metavariable: $FUNC
            regex: (delete|doExecute|exchange|getForEntity|getForObject|headForHeaders|optionsForAllow|patchForObject|postForEntity|postForLocation|postForObject|put)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-stdlib.bypass-tls-verification.bypass-tls-verification
      languages:
        - java
      message: Checks for redefinitions of the checkServerTrusted function in the X509TrustManager class that disables TLS/SSL certificate verification. This should only be used for debugging purposes because it leads to vulnerability to MTM attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://riptutorial.com/java/example/16517/temporarily-disable-ssl-verification--for-testing-purposes-
            - https://stackoverflow.com/questions/35530558/how-to-fix-unsafe-implementation-of-x509trustmanager-in-android-app?rq=1
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      patterns:
        - pattern: |
            new X509TrustManager() {
              ...
              public void checkClientTrusted(X509Certificate[] certs, String authType) {...}
              ...
            }
        - pattern-not: |
            new X509TrustManager() {
              ...
              public void checkServerTrusted(X509Certificate[] certs, String authType) {
                ...
                throw new CertificateException(...);
                ...
              }
              ...
            }
        - pattern-not: |
            new X509TrustManager() {
              ...
              public void checkServerTrusted(X509Certificate[] certs, String authType) {
                ...
                throw new IllegalArgumentException(...);
                ...
              }
              ...
            }
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-stdlib.disallow-old-tls-versions1.disallow-old-tls-versions1
      languages:
        - java
      message: Detects direct creations of SSLConnectionSocketFactories that don't disallow SSL v2, SSL v3, and TLS v1. SSLSocketFactory can be used to validate the identity of the HTTPS server against a list of trusted certificates. These protocols are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://stackoverflow.com/questions/26429751/java-http-clients-and-poodle
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      patterns:
        - pattern: |
            new SSLConnectionSocketFactory(...);
        - pattern-not: |
            new SSLConnectionSocketFactory(..., new String[] {"TLSv1.2", "TLSv1.3"}, ...);
        - pattern-not: |
            new SSLConnectionSocketFactory(..., new String[] {"TLSv1.3", "TLSv1.2"}, ...);
        - pattern-not: |
            new SSLConnectionSocketFactory(..., new String[] {"TLSv1.3"}, ...);
        - pattern-not: |
            new SSLConnectionSocketFactory(..., new String[] {"TLSv1.2"}, ...);
        - pattern-not-inside: |
            (SSLConnectionSocketFactory $SF) = new SSLConnectionSocketFactory(...); ... (TlsConfig $TLSCONFIG) = TlsConfig.custom(). ... .setSupportedProtocols(TLS.V_1_2). ... .build(); ... HttpClientConnectionManager cm = $CM.create(). ... .setSSLSocketFactory($SF). ... .setDefaultTlsConfig($TLSCONFIG). ... .build();
        - pattern-not-inside: |
            (SSLConnectionSocketFactory $SF) = new SSLConnectionSocketFactory(...); ... (TlsConfig $TLSCONFIG) = TlsConfig.custom(). ... .setSupportedProtocols(TLS.V_1_3). ... .build(); ... HttpClientConnectionManager cm = $CM.create(). ... .setSSLSocketFactory($SF). ... .setDefaultTlsConfig($TLSCONFIG). ... .build();
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-stdlib.disallow-old-tls-versions2.disallow-old-tls-versions2
      languages:
        - java
      message: Detects setting client protocols to insecure versions of TLS and SSL. These protocols are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://stackoverflow.com/questions/26504653/is-it-possible-to-disable-sslv3-for-all-java-applications
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      patterns:
        - pattern: $VALUE. ... .setProperty("jdk.tls.client.protocols", "$PATTERNS");
        - metavariable-pattern:
            language: generic
            metavariable: $PATTERNS
            patterns:
                - pattern-either:
                    - pattern: TLS1
                    - pattern-regex: ^(.*TLSv1|.*SSLv.*)$
                    - pattern-regex: ^(.*TLSv1,.*)
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[fF][tT][pP]://'
        replacement: sftp://
      id: problem-based-packs.insecure-transport.java-stdlib.ftp-request.ftp-request
      languages:
        - java
      message: Checks for outgoing connections to ftp servers. FTP does not encrypt traffic, possibly leading to PII being sent plaintext over the network.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://www.codejava.net/java-se/ftp/connect-and-login-to-a-ftp-server
            - https://commons.apache.org/proper/commons-net/apidocs/org/apache/commons/net/ftp/FTPClient.html
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            FTPClient $FTPCLIENT = new FTPClient();
            ...
            $FTPCLIENT.connect(...);
        - pattern: |
            URL $URL = new URL("=~/^[fF][tT][pP]://.*/");
            ...
            URLConnection $CONN = $URL.openConnection(...);
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-stdlib.http-components-request.http-components-request
      languages:
        - java
      message: Checks for requests sent via Apache HTTP Components to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://hc.apache.org/httpcomponents-client-ga/quickstart.html
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            $HTTPCLIENT = HttpClients.$CREATE(...);
            ...
            $HTTPREQ = new $HTTPFUNC("=~/[hH][tT][tT][pP]://.*/");
            ...
            $RESPONSE = $HTTPCLIENT.execute($HTTPREQ);
        - pattern: |
            $HTTPCLIENT = HttpClients.$CREATE(...);
            ...
            $RESPONSE = $HTTPCLIENT.execute(new $HTTPFUNC("=~/[hH][tT][tT][pP]://.*/"));
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-stdlib.httpclient-http-request.httpclient-http-request
      languages:
        - java
      message: Checks for requests sent via HttpClient to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://openjdk.java.net/groups/net/httpclient/intro.html
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      pattern-either:
        - patterns:
            - pattern: |
                URI.create("=~/[hH][tT][tT][pP]://.*/", ...)
            - pattern-inside: |
                HttpClient $CLIENT = ...;
                ...
                HttpRequest $REQ = ...;
                ...
                $CLIENT.sendAsync(...);
        - patterns:
            - pattern: |
                URI.create("=~/[hH][tT][tT][pP]://.*/", ...)
            - pattern-inside: |
                HttpClient $CLIENT = ...;
                ...
                HttpRequest $REQ = ...;
                ...
                $CLIENT.send(...);
        - patterns:
            - pattern: |
                URI.create($URI)
            - pattern-inside: |
                String $URI = "=~/[hH][tT][tT][pP]://.*/";
                ...
                HttpClient $CLIENT = ...;
                ...
                HttpRequest $REQ = ...;
                ...
                $CLIENT.send(...);
        - patterns:
            - pattern: |
                URI.create($URI)
            - pattern-inside: |
                String $URI = "=~/[hH][tT][tT][pP]://.*/";
                ...
                HttpClient $CLIENT = ...;
                ...
                HttpRequest $REQ = ...;
                ...
                $CLIENT.sendAsync(...);
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-stdlib.httpget-http-request.httpget-http-request
      languages:
        - java
      message: Detected an HTTP request sent via HttpGet. This could lead to sensitive information being sent  over an insecure channel. Instead, it is recommended to send requests over HTTPS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      patterns:
        - pattern: |
            "=~/[Hh][Tt][Tt][Pp]://.*/"
        - pattern-inside: |
            $R = new HttpGet("=~/[Hh][Tt][Tt][Pp]://.*/");
            ...
            $CLIENT. ... .execute($R, ...);
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-stdlib.httpurlconnection-http-request.httpurlconnection-http-request
      languages:
        - java
      message: Detected an HTTP request sent via HttpURLConnection. This could lead to sensitive information being sent over an insecure channel. Instead, it is recommended to send requests over HTTPS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      patterns:
        - pattern: |
            "=~/[Hh][Tt][Tt][Pp]://.*/"
        - pattern-either:
            - pattern-inside: |
                URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);
                ...
                $CON = (HttpURLConnection) $URL.openConnection(...);
                ...
                $CON.$FUNC(...);
            - pattern-inside: |
                URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);
                ...
                $CON = $URL.openConnection(...);
                ...
                $CON.$FUNC(...);
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-stdlib.telnet-request.telnet-request
      languages:
        - java
      message: Checks for attempts to connect through telnet. This is insecure as the telnet protocol supports no encryption, and data passes through unencrypted.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://commons.apache.org/proper/commons-net/javadocs/api-3.6/org/apache/commons/net/telnet/TelnetClient.html
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      pattern: |
        $TELNETCLIENT = new TelnetClient(...);
        ...
        $TELNETCLIENT.connect(...);
      severity: WARNING
    - id: problem-based-packs.insecure-transport.java-stdlib.tls-renegotiation.tls-renegotiation
      languages:
        - java
      message: Checks for cases where java applications are allowing unsafe renegotiation. This leaves the application vulnerable to a man-in-the-middle attack where chosen plain text is injected as prefix to a TLS connection.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: LOW
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://www.oracle.com/java/technologies/javase/tlsreadme.html
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
      pattern: |
        java.lang.System.setProperty("sun.security.ssl.allowUnsafeRenegotiation", true);
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: problem-based-packs.insecure-transport.java-stdlib.unirest-http-request.unirest-http-request
      languages:
        - java
      message: Checks for requests sent via Unirest to http:// URLS. This is dangerous because the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, send requests only to https:// URLS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://kong.github.io/unirest-java/#requests
        subcategory:
            - vuln
        technology:
            - unirest
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            Unirest.get("=~/[hH][tT][tT][pP]://.*/")
        - pattern: |
            Unirest.post("=~/[hH][tT][tT][pP]://.*/")
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.bypass-tls-verification.bypass-tls-verification
      languages:
        - javascript
        - typescript
      message: Checks for setting the environment variable NODE_TLS_REJECT_UNAUTHORIZED to 0, which disables TLS verification. This should only be used for debugging purposes. Setting the option rejectUnauthorized to false bypasses verification against the list of trusted CAs, which also leads to insecure transport. These options lead to vulnerability to MTM attacks, and should not be used.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://nodejs.org/api/https.html#https_https_request_options_callback
            - https://stackoverflow.com/questions/20433287/node-js-request-cert-has-expired#answer-29397100
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = 0;
        - pattern: |
            {rejectUnauthorized:false}
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.disallow-old-tls-versions1.disallow-old-tls-versions1
      languages:
        - javascript
        - typescript
      message: Detects direct creations of $HTTPS servers that don't disallow SSL v2, SSL v3, and TLS v1. These protocols are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://us-cert.cisa.gov/ncas/alerts/TA14-290A
            - https://stackoverflow.com/questions/40434934/how-to-disable-the-ssl-3-0-and-tls-1-0-in-nodejs
            - https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern-inside: |
                $CONST = require('crypto');
                ...
            - pattern-inside: |
                $CONST = require('constants');
                ...
        - pattern-inside: |
            $HTTPS = require('https');
            ...
        - pattern: |
            $HTTPS.createServer(...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2 }, ...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_SSLv3 }, ...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_SSLv3 |$CONST.SSL_OP_NO_TLSv1 }, ...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions: $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3}, ...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions:$CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2 |$CONST.SSL_OP_NO_TLSv1}, ...).$FUNC(...);
        - pattern-not: |
            $HTTPS.createServer({secureOptions:$CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_TLSv1| $CONST.SSL_OP_NO_SSLv2}, ...).$FUNC(...);
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.disallow-old-tls-versions2.disallow-old-tls-versions2
      languages:
        - javascript
        - typescript
      message: Detects creations of $HTTPS servers from option objects that don't disallow SSL v2, SSL v3, and TLS v1. These protocols are deprecated due to POODLE, man in the middle attacks, and other vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://us-cert.cisa.gov/ncas/alerts/TA14-290A
            - https://stackoverflow.com/questions/40434934/how-to-disable-the-ssl-3-0-and-tls-1-0-in-nodejs
            - https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern-inside: |
                $CONST = require('crypto');
                ...
            - pattern-inside: |
                $CONST = require('constants');
                ...
        - pattern-inside: |
            $HTTPS = require('https');
            ...
        - pattern: |
            $OPTIONS = {};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv2 | $CONST.SSL_OP_NO_SSLv3};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv2  | $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv3};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv2 | $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_TLSv1};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_SSLv2 | $CONST.SSL_OP_NO_TLSv1};
            ...
            $HTTPS.createServer($OPTIONS, ...);
        - pattern-not: |
            $OPTIONS = {secureOptions: $CONST.SSL_OP_NO_SSLv3 | $CONST.SSL_OP_NO_TLSv1 | $CONST.SSL_OP_NO_SSLv2};
            ...
            $HTTPS.createServer($OPTIONS, ...);
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.ftp-request.ftp-request
      languages:
        - javascript
        - typescript
      message: 'Checks for lack of usage of the "secure: true" option when sending ftp requests through the nodejs ftp module. This leads to unencrypted traffic being sent to the ftp server. There are other options such as "implicit" that still does not encrypt all traffic. ftp is the most utilized npm ftp module.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://www.npmjs.com/package/ftp
            - https://openbase.io/js/ftp
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-inside: |
            $X = require('ftp');
            ...
            $C = new $X();
            ...
        - pattern-not-inside: |
            $OPTIONS = {secure: true};
            ...
        - pattern: |
            $C.connect($OPTIONS,...);
        - pattern-not: |
            $C.connect({...,secure: true});
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.http-request.http-request
      languages:
        - javascript
      message: Checks for requests sent to http:// URLs. This is dangerous as the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, only send requests to https:// URLs.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://nodejs.org/api/http.html#http_http_request_options_callback
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-inside: |
            $HTTP = require('http');
            ...
        - pattern-either:
            - pattern: |
                $HTTP.request("=~/http://.*/",...);
            - pattern: |
                $HTTP.get("=~/http://.*/", ...)
            - pattern: |
                $VAR = new URL("=~/http://.*/");
                ...
                $HTTP.request($VAR, ...);
            - pattern: |
                $VAR = {...,hostname: "..."};
                ...
                $HTTP.request(..., $VAR, ...);
            - pattern: |
                $HTTP.request(..., {...,hostname: "..."}, ...);
        - pattern-not: |
            $VAR = {...,protocol: "https"};
            ...
            $HTTP.request(..., $VAR, ...);
        - pattern-not: |
            $HTTP.request(..., {...,protocol: "https"}, ...);
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.rest-http-client-support.rest-http-client-support
      languages:
        - javascript
      message: Checks for requests to http (unencrypted) sites using some of node js's most popular REST/HTTP libraries, including node-rest-client, axios, and got.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://www.npmjs.com/package/axios
            - https://www.npmjs.com/package/got
            - https://www.npmjs.com/package/node-rest-client
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern-inside: |
                $CLIENT = require('node-rest-client').Client;
                ...
                $C = new $CLIENT();
                ...
            - pattern-inside: |
                $C = require('axios');
                ...
            - pattern-inside: |
                $C = require('got');
                ...
        - pattern-either:
            - pattern: |
                $C.$REQ("=~/http://.*/", ...)
            - pattern: |
                $C("=~/http://.*/", ...)
            - pattern: |
                $C({...,url: "=~/http://.*/"})
            - pattern: |
                $C.$REQ({...,url: "=~/http://.*/"})
      severity: WARNING
    - id: problem-based-packs.insecure-transport.js-node.telnet-request.telnet-request
      languages:
        - javascript
      message: Checks for creation of telnet servers or attempts to connect through telnet. This is insecure as the telnet protocol supports no encryption, and data passes through unencrypted.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://www.npmjs.com/package/telnet
            - https://www.npmjs.com/package/telnet-client
        subcategory:
            - vuln
        technology:
            - node.js
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern-inside: |
                $TEL = require('telnet-client');
                ...
                $SERVER = new $TEL();
                ...
            - pattern-inside: |
                $SERVER = require('telnet');
                ...
        - pattern-either:
            - pattern: |
                $SERVER.on(...)
            - pattern: |
                $SERVER.connect(...)
            - pattern: |
                $SERVER.createServer(...)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.ruby-stdlib.http-client-requests.http-client-requests
      languages:
        - ruby
      message: Checks for requests to http (unencrypted) sites using some of ruby's most popular REST/HTTP libraries, including httparty and restclient.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://github.com/rest-client/rest-client
            - https://github.com/jnunemaker/httparty/tree/master/docs
        subcategory:
            - vuln
        technology:
            - httparty
            - rest-client
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            HTTParty.$PARTYVERB("=~/[hH][tT][tT][pP]://.*/", ...)
        - pattern: |
            $STRING = "=~/[hH][tT][tT][pP]://.*/"
            ...
            HTTParty.$PARTYVERB($STRING, ...)
        - pattern: |
            RestClient.$RESTVERB "=~/[hH][tT][tT][pP]://.*/", ...
        - pattern: |
            RestClient::Request.execute(..., url: "=~/[hH][tT][tT][pP]://.*/", ...)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.ruby-stdlib.net-ftp-request.net-ftp-request
      languages:
        - ruby
      message: Checks for outgoing connections to ftp servers with the 'net/ftp' package. FTP does not encrypt traffic, possibly leading to PII being sent plaintext over the network. Instead, connect via the SFTP protocol.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.ruby-lang.org/en/2.0.0/Net/FTP.html
        subcategory:
            - vuln
        technology:
            - ruby
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            $FTP = Net::FTP.new('...')
            ...
            $FTP.login
        - pattern: |
            Net::FTP.open('...') do |ftp|
              ...
              ftp.login
            end
      severity: WARNING
    - id: problem-based-packs.insecure-transport.ruby-stdlib.net-http-request.net-http-request
      languages:
        - ruby
      message: Checks for requests sent to http:// URLs. This is dangerous as the server is attempting to connect to a website that does not encrypt traffic with TLS. Instead, only send requests to https:// URLs.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://ruby-doc.org/stdlib-2.6.5/libdoc/net/http/rdoc/Net/
        subcategory:
            - vuln
        technology:
            - ruby
        vulnerability: Insecure Transport
      patterns:
        - pattern-either:
            - pattern: |
                $URI = URI('=~/[hH][tT][tT][pP]://.*/')
                ...
                Net::HTTP::$FUNC.new $URI
            - pattern: |
                $URI = URI('=~/[hH][tT][tT][pP]://.*/')
                ...
                Net::HTTP.$FUNC($URI, ...)
            - pattern: |
                Net::HTTP.$FUNC(URI('=~/[hH][tT][tT][pP]://.*/'), ...)
        - metavariable-regex:
            metavariable: $FUNC
            regex: ([gG]et|post_form|[pP]ost|get_response|get_print|Head|Patch|Put|Proppatch|Lock|Unlock|Options|Propfind|Delete|Move|Copy|Trace|Mkcol)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.ruby-stdlib.net-telnet-request.net-telnet-request
      languages:
        - ruby
      message: Checks for creation of telnet servers or attempts to connect through telnet. This is insecure as the telnet protocol supports no encryption, and data passes through unencrypted.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://docs.ruby-lang.org/en/2.2.0/Net/Telnet.html
            - https://www.rubydoc.info/gems/net-ssh-telnet2/0.1.0/Net/SSH/Telnet
        subcategory:
            - vuln
        technology:
            - ruby
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            Net::Telnet::new(...)
        - pattern: |
            Net::SSH::Telnet.new(...)
      severity: WARNING
    - id: problem-based-packs.insecure-transport.ruby-stdlib.openuri-request.openuri-request
      languages:
        - ruby
      message: Checks for requests to http and ftp (unencrypted) sites using OpenURI.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A03:2017 - Sensitive Data Exposure
        references:
            - https://ruby-doc.org/stdlib-2.6.3/libdoc/open-uri/rdoc/OpenURI.html
        subcategory:
            - vuln
        technology:
            - open-uri
        vulnerability: Insecure Transport
      pattern-either:
        - pattern: |
            URI.open('=~/[hH][tT][tT][pP]://.*/', ...)
        - pattern: |
            $URI = URI.parse('=~/[hH][tT][tT][pP]://.*/', ...)
            ...
            $URI.open
        - pattern: |
            URI.open('=~/^[fF][tT][pP]://.*/', ...)
        - pattern: |
            $URI = URI.parse('=~/^[fF][tT][pP]://.*/', ...)
            ...
            $URI.open
      severity: WARNING
    - id: python.aws-lambda.security.dangerous-asyncio-create-exec.dangerous-asyncio-create-exec
      languages:
        - python
      message: Detected 'create_subprocess_exec' function with argument tainted by `event` object. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html#asyncio.create_subprocess_exec
            - https://docs.python.org/3/library/shlex.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - pattern: asyncio.create_subprocess_exec($PROG, $CMD, ...)
                - pattern: asyncio.create_subprocess_exec($PROG, [$CMD, ...], ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, $CMD, ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, [$CMD, ...], ...)
                - pattern: asyncio.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...)
                - pattern: asyncio.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...], ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...], ...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dangerous-asyncio-exec.dangerous-asyncio-exec
      languages:
        - python
      message: Detected subprocess function '$LOOP.subprocess_exec' with argument tainted by `event` object. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.subprocess_exec
            - https://docs.python.org/3/library/shlex.html
        subcategory:
            - vuln
        technology:
            - python
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - pattern: $LOOP.subprocess_exec($PROTOCOL, $CMD, ...)
                - pattern: $LOOP.subprocess_exec($PROTOCOL, [$CMD, ...], ...)
                - pattern: $LOOP.subprocess_exec($PROTOCOL, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...)
                - pattern: $LOOP.subprocess_exec($PROTOCOL, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", $CMD, ...], ...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dangerous-asyncio-shell.dangerous-asyncio-shell
      languages:
        - python
      message: Detected asyncio subprocess function with argument tainted by `event` object. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html
            - https://docs.python.org/3/library/shlex.html
        subcategory:
            - vuln
        technology:
            - python
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - pattern: $LOOP.subprocess_shell($PROTOCOL, $CMD)
                - pattern: asyncio.subprocess.create_subprocess_shell($CMD, ...)
                - pattern: asyncio.create_subprocess_shell($CMD, ...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dangerous-spawn-process.dangerous-spawn-process
      languages:
        - python
      message: Detected `os` function with argument tainted by `event` object. This is dangerous if external data can reach this function call because it allows a malicious actor to execute commands. Ensure no external data reaches here.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - patterns:
                    - pattern: os.$METHOD($MODE, $CMD, ...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe|spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp|startfile)
                - patterns:
                    - pattern-inside: os.$METHOD($MODE, $BASH, ["-c", $CMD,...],...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
                - patterns:
                    - pattern-inside: os.$METHOD($MODE, $BASH, "-c", $CMD,...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dangerous-subprocess-use.dangerous-subprocess-use
      languages:
        - python
      message: Detected subprocess function with argument tainted by an `event` object.  If this data can be controlled by a malicious actor, it may be an instance of command injection. The default option for `shell` is False, and this is secure by default. Consider removing the `shell=True` or setting it to False explicitely. Using `shell=False` means you have to split the command string into an array of strings for the command and its arguments. You may consider using 'shlex.split()' for this purpose.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/subprocess.html
            - https://docs.python.org/3/library/shlex.html
        subcategory:
            - vuln
        technology:
            - python
            - aws-lambda
      mode: taint
      pattern-sanitizers:
        - pattern: shlex.split(...)
        - pattern: pipes.quote(...)
        - pattern: shlex.quote(...)
      pattern-sinks:
        - patterns:
            - pattern: subprocess.$FUNC(..., shell=True, ...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dangerous-system-call.dangerous-system-call
      languages:
        - python
      message: Detected `os` function with argument tainted by `event` object. This is dangerous if external data can reach this function call because it allows a malicious actor to execute commands. Use the 'subprocess' module instead, which is easier to use without accidentally exposing a command injection vulnerability.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $CMD
            - pattern-either:
                - pattern: os.system($CMD,...)
                - pattern: os.popen($CMD,...)
                - pattern: os.popen2($CMD,...)
                - pattern: os.popen3($CMD,...)
                - pattern: os.popen4($CMD,...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.dynamodb-filter-injection.dynamodb-filter-injection
      languages:
        - python
      message: Detected DynamoDB query filter that is tainted by `$EVENT` object. This could lead to NoSQL injection if the variable is user-controlled and not properly sanitized. Explicitly assign query params instead of passing data from `$EVENT` directly to DynamoDB client.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
        references:
            - https://medium.com/appsecengineer/dynamodb-injection-1db99c2454ac
        subcategory:
            - vuln
        technology:
            - python
            - boto3
            - aws-lambda
            - dynamodb
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                {...}
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern-either:
                - pattern: $TABLE.scan(..., ScanFilter = $SINK, ...)
                - pattern: $TABLE.query(..., QueryFilter = $SINK, ...)
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $TABLE = $DB.Table(...)
                        ...
                    - pattern-inside: |
                        $DB = boto3.resource('dynamodb', ...)
                        ...
                - pattern-inside: |
                    $TABLE = boto3.client('dynamodb', ...)
                    ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.aws-lambda.security.mysql-sqli.mysql-sqli
      languages:
        - python
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `cursor.execute(''SELECT * FROM projects WHERE status = %s'', (''active''))`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursor-execute.html
            - https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursor-executemany.html
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - mysql
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $CURSOR.execute($QUERY,...)
                - pattern: $CURSOR.executemany($QUERY,...)
            - pattern-either:
                - pattern-inside: |
                    import mysql
                    ...
                - pattern-inside: |
                    import mysql.cursors
                    ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.psycopg-sqli.psycopg-sqli
      languages:
        - python
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `cursor.execute(''SELECT * FROM projects WHERE status = %s'', ''active'')`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.psycopg.org/docs/cursor.html#cursor.execute
            - https://www.psycopg.org/docs/cursor.html#cursor.executemany
            - https://www.psycopg.org/docs/cursor.html#cursor.mogrify
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - psycopg
            - psycopg2
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern-either:
                - pattern: $CURSOR.execute($QUERY,...)
                - pattern: $CURSOR.executemany($QUERY,...)
                - pattern: $CURSOR.mogrify($QUERY,...)
            - pattern-inside: |
                import psycopg2
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.pymssql-sqli.pymssql-sqli
      languages:
        - python
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `cursor.execute(''SELECT * FROM projects WHERE status = %s'', ''active'')`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://pypi.org/project/pymssql/
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - pymssql
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern: $CURSOR.execute($QUERY,...)
            - pattern-inside: |
                import pymssql
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.pymysql-sqli.pymysql-sqli
      languages:
        - python
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `cursor.execute(''SELECT * FROM projects WHERE status = %s'', (''active''))`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://pypi.org/project/PyMySQL/#id4
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - pymysql
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern: $CURSOR.execute($QUERY,...)
            - pattern-either:
                - pattern-inside: |
                    import pymysql
                    ...
                - pattern-inside: |
                    import pymysql.cursors
                    ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.sqlalchemy-sqli.sqlalchemy-sqli
      languages:
        - python
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `cursor.execute(''SELECT * FROM projects WHERE status = ?'', ''active'')`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection.execute
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - sqlalchemy
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $QUERY
            - pattern: $CURSOR.execute($QUERY,...)
            - pattern-inside: |
                import sqlalchemy
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.tainted-code-exec.tainted-code-exec
      languages:
        - python
      message: Detected the use of `exec/eval`.This can be dangerous if used to evaluate dynamic content. If this content can be input from outside the program, this may be a code injection vulnerability. Ensure evaluated content is not definable by external sources.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: eval($CODE, ...)
                - pattern: exec($CODE, ...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.tainted-html-response.tainted-html-response
      languages:
        - python
      message: Detected user input flowing into an HTML response. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $BODY
            - pattern-inside: |
                {..., "headers": {..., "Content-Type": "text/html", ...}, "body": $BODY, ... }
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.tainted-html-string.tainted-html-string
      languages:
        - python
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. To be sure this is safe, check that the HTML is rendered safely. Otherwise, use templates which will safely render HTML instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: '"$HTMLSTR" % ...'
                        - pattern: '"$HTMLSTR".format(...)'
                        - pattern: '"$HTMLSTR" + ...'
                        - pattern: f"$HTMLSTR{...}..."
                - patterns:
                    - pattern-inside: |
                        $HTML = "$HTMLSTR"
                        ...
                    - pattern-either:
                        - pattern: $HTML % ...
                        - pattern: $HTML.format(...)
                        - pattern: $HTML + ...
            - metavariable-pattern:
                language: generic
                metavariable: $HTMLSTR
                pattern: <$TAG ...
            - pattern-not-inside: |
                print(...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.tainted-pickle-deserialization.tainted-pickle-deserialization
      languages:
        - python
      message: Avoid using `pickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data as JSON or a similar text-based serialization format.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
            - https://davidhamann.de/2020/04/05/exploiting-python-pickle/
        subcategory:
            - vuln
        technology:
            - python
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - focus-metavariable: $SINK
            - pattern-either:
                - pattern: pickle.load($SINK,...)
                - pattern: pickle.loads($SINK,...)
                - pattern: _pickle.load($SINK,...)
                - pattern: _pickle.loads($SINK,...)
                - pattern: cPickle.load($SINK,...)
                - pattern: cPickle.loads($SINK,...)
                - pattern: dill.load($SINK,...)
                - pattern: dill.loads($SINK,...)
                - pattern: shelve.open($SINK,...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: WARNING
    - id: python.aws-lambda.security.tainted-sql-string.tainted-sql-string
      languages:
        - python
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$SQLSTR" + ...
                - pattern: |
                    "$SQLSTR" % ...
                - pattern: |
                    "$SQLSTR".format(...)
                - pattern: |
                    f"$SQLSTR{...}..."
            - metavariable-regex:
                metavariable: $SQLSTR
                regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*=
            - pattern-not-inside: |
                print(...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context):
                  ...
      severity: ERROR
    - id: python.boto3.security.hardcoded-token.hardcoded-token
      languages:
        - python
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
            - https://bento.dev/checks/boto3/hardcoded-access-token/
            - https://aws.amazon.com/blogs/security/what-to-do-if-you-inadvertently-expose-an-aws-access-key/
        subcategory:
            - vuln
        technology:
            - boto3
            - secrets
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $W(...,$TOKEN="$VALUE",...)
                - pattern: $BOTO. ... .$W(...,$TOKEN="$VALUE",...)
            - metavariable-regex:
                metavariable: $TOKEN
                regex: (aws_session_token|aws_access_key_id|aws_secret_access_key)
            - metavariable-pattern:
                language: generic
                metavariable: $VALUE
                patterns:
                    - pattern-either:
                        - pattern-regex: ^AKI
                        - pattern-regex: ^[A-Za-z0-9/+=]+$
            - metavariable-analysis:
                analyzer: entropy
                metavariable: $VALUE
      pattern-sources:
        - pattern: |
            "..."
      severity: WARNING
    - id: python.cryptography.security.empty-aes-key.empty-aes-key
      languages:
        - python
      message: Potential empty AES encryption key. Using an empty key in AES encryption can result in weak encryption and may allow attackers to easily decrypt sensitive data. Ensure that a strong, non-empty key is used for AES encryption.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
            - 'CWE-310: Cryptographic Issues'
        functional-categories:
            - crypto::search::key-length::pycrypto
            - crypto::search::key-length::pycryptodome
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp: A6:2017 misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/327.html
            - https://cwe.mitre.org/data/definitions/310.html
        subcategory:
            - vuln
        technology:
            - python
            - pycrypto
            - pycryptodome
      patterns:
        - pattern: AES.new("",...)
      severity: WARNING
    - fix: AES
      id: python.cryptography.security.insecure-cipher-algorithms-arc4.insecure-cipher-algorithm-arc4
      languages:
        - python
      message: ARC4 (Alleged RC4) is a stream cipher with serious weaknesses in its initial stream output.  Its use is strongly discouraged. ARC4 does not use mode constructions. Use a strong symmetric cipher such as EAS instead. With the `cryptography` package it is recommended to use the `Fernet` which is a secure implementation of AES in CBC mode with a 128-bit key.  Alternatively, keep using the `Cipher` class from the hazmat primitives but use the AES algorithm instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/symmetric-encryption/#weak-ciphers
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L98
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern: cryptography.hazmat.primitives.ciphers.algorithms.$ARC4($KEY)
        - pattern-inside: cryptography.hazmat.primitives.ciphers.Cipher(...)
        - metavariable-regex:
            metavariable: $ARC4
            regex: ^(ARC4)$
        - focus-metavariable: $ARC4
      severity: WARNING
    - fix: AES
      id: python.cryptography.security.insecure-cipher-algorithms-blowfish.insecure-cipher-algorithm-blowfish
      languages:
        - python
      message: Blowfish is a block cipher developed by Bruce Schneier. It is known to be susceptible to attacks when using weak keys.  The author has recommended that users of Blowfish move to newer algorithms such as AES. With the `cryptography` package it is recommended to use `Fernet` which is a secure implementation of AES in CBC mode with a 128-bit key.  Alternatively, keep using the `Cipher` class from the hazmat primitives but use the AES algorithm instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/symmetric-encryption/#weak-ciphers
            - https://tools.ietf.org/html/rfc5469
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L98
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern: cryptography.hazmat.primitives.ciphers.algorithms.$BLOWFISH($KEY)
        - metavariable-regex:
            metavariable: $BLOWFISH
            regex: ^(Blowfish)$
        - focus-metavariable: $BLOWFISH
      severity: WARNING
    - fix: AES
      id: python.cryptography.security.insecure-cipher-algorithms.insecure-cipher-algorithm-idea
      languages:
        - python
      message: IDEA (International Data Encryption Algorithm) is a block cipher created in 1991.  It is an optional component of the OpenPGP standard. This cipher is susceptible to attacks when using weak keys.  It is recommended that you do not use this cipher for new applications. Use a strong symmetric cipher such as EAS instead. With the `cryptography` package it is recommended to use `Fernet` which is a secure implementation of AES in CBC mode with a 128-bit key.  Alternatively, keep using the `Cipher` class from the hazmat primitives but use the AES algorithm instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc5469
            - https://cryptography.io/en/latest/hazmat/primitives/symmetric-encryption/#cryptography.hazmat.primitives.ciphers.algorithms.IDEA
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L98
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern: cryptography.hazmat.primitives.ciphers.algorithms.$IDEA($KEY)
        - metavariable-regex:
            metavariable: $IDEA
            regex: ^(IDEA)$
        - focus-metavariable: $IDEA
      severity: WARNING
    - fix: cryptography.hazmat.primitives.ciphers.modes.GCM($IV)
      id: python.cryptography.security.insecure-cipher-mode-ecb.insecure-cipher-mode-ecb
      languages:
        - python
      message: ECB (Electronic Code Book) is the simplest mode of operation for block ciphers.  Each block of data is encrypted in the same way.  This means identical plaintext blocks will always result in identical ciphertext blocks, which can leave significant patterns in the output. Use a different, cryptographically strong mode instead, such as GCM.
      metadata:
        bandit-code: B305
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::mode::cryptography
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/symmetric-encryption/#insecure-modes
            - https://crypto.stackexchange.com/questions/20941/why-shouldnt-i-use-ecb-encryption
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L101
        subcategory:
            - audit
        technology:
            - cryptography
      pattern: cryptography.hazmat.primitives.ciphers.modes.ECB($IV)
      severity: WARNING
    - fix: SHA256
      id: python.cryptography.security.insecure-hash-algorithms-md5.insecure-hash-algorithm-md5
      languages:
        - python
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        bandit-code: B303
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::cryptography
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/cryptographic-hashes/#md5
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern: cryptography.hazmat.primitives.hashes.$MD5()
        - metavariable-regex:
            metavariable: $MD5
            regex: ^(MD5)$
        - focus-metavariable: $MD5
      severity: WARNING
    - fix: |
        SHA256
      id: python.cryptography.security.insecure-hash-algorithms.insecure-hash-algorithm-sha1
      languages:
        - python
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        bandit-code: B303
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        functional-categories:
            - crypto::search::symmetric-algorithm::cryptography
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/cryptographic-hashes/#sha-1
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern: cryptography.hazmat.primitives.hashes.$SHA(...)
        - metavariable-pattern:
            metavariable: $SHA
            pattern: |
                SHA1
        - focus-metavariable: $SHA
      severity: WARNING
    - fix: |
        2048
      id: python.cryptography.security.insufficient-dsa-key-size.insufficient-dsa-key-size
      languages:
        - python
      message: Detected an insufficient key size for DSA. NIST recommends a key size of 2048 or higher.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::key-length::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.cosic.esat.kuleuven.be/ecrypt/ecrypt2/documents/D.SPA.20.pdf
            - https://cryptography.io/en/latest/hazmat/primitives/asymmetric/dsa/
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/weak_cryptographic_key.py
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern-either:
            - pattern: cryptography.hazmat.primitives.asymmetric.dsa.generate_private_key(..., key_size=$SIZE, ...)
            - pattern: cryptography.hazmat.primitives.asymmetric.dsa.generate_private_key($SIZE, ...)
        - metavariable-comparison:
            comparison: $SIZE < 2048
            metavariable: $SIZE
        - focus-metavariable: $SIZE
      severity: WARNING
    - fix: |
        SECP256R1
      id: python.cryptography.security.insufficient-ec-key-size.insufficient-ec-key-size
      languages:
        - python
      message: Detected an insufficient curve size for EC. NIST recommends a key size of 224 or higher. For example, use 'ec.SECP256R1'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::key-length::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
            - https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ec/#elliptic-curves
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/weak_cryptographic_key.py
        subcategory:
            - audit
        technology:
            - cryptography
      patterns:
        - pattern-inside: cryptography.hazmat.primitives.asymmetric.ec.generate_private_key(...)
        - pattern: cryptography.hazmat.primitives.asymmetric.ec.$SIZE
        - metavariable-pattern:
            metavariable: $SIZE
            pattern-either:
                - pattern: SECP192R1
                - pattern: SECT163K1
                - pattern: SECT163R2
        - focus-metavariable: $SIZE
      severity: WARNING
    - fix: |
        2048
      id: python.cryptography.security.insufficient-rsa-key-size.insufficient-rsa-key-size
      languages:
        - python
      message: Detected an insufficient key size for RSA. NIST recommends a key size of 2048 or higher.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        functional-categories:
            - crypto::search::key-length::cryptography
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cryptography.io/en/latest/hazmat/primitives/asymmetric/rsa/
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/weak_cryptographic_key.py
        subcategory:
            - audit
        technology:
            - cryptography
      patterns:
        - pattern-either:
            - pattern: cryptography.hazmat.primitives.asymmetric.rsa.generate_private_key(..., key_size=$SIZE, ...)
            - pattern: cryptography.hazmat.primitives.asymmetric.rsa.generate_private_key($EXP, $SIZE, ...)
        - metavariable-comparison:
            comparison: $SIZE < 2048
            metavariable: $SIZE
        - focus-metavariable: $SIZE
      severity: WARNING
    - id: python.cryptography.security.mode-without-authentication.crypto-mode-without-authentication
      languages:
        - python
      message: 'An encryption mode of operation is being used without proper message authentication. This can potentially result in the encrypted content to be decrypted by an attacker. Consider instead use an AEAD mode of operation like GCM. '
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - cryptography
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    Cipher(..., $HAZMAT_MODE(...),...)
                - pattern-not-inside: |
                    Cipher(..., $HAZMAT_MODE(...),...)
                    ...
                    HMAC(...)
                - pattern-not-inside: |
                    Cipher(..., $HAZMAT_MODE(...),...)
                    ...
                    hmac.HMAC(...)
        - metavariable-pattern:
            metavariable: $HAZMAT_MODE
            patterns:
                - pattern-either:
                    - pattern: modes.CTR
                    - pattern: modes.CBC
                    - pattern: modes.CFB
                    - pattern: modes.OFB
      severity: ERROR
    - fix: |
        True
      id: python.distributed.security.require-encryption
      languages:
        - python
      message: Initializing a security context for Dask (`distributed`) without "require_encryption" keyword argument may silently fail to provide security.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://distributed.dask.org/en/latest/tls.html?highlight=require_encryption#parameters
        subcategory:
            - vuln
        technology:
            - distributed
      patterns:
        - pattern: |
            distributed.security.Security(..., require_encryption=$VAL, ...)
        - metavariable-pattern:
            metavariable: $VAL
            pattern: |
                False
        - focus-metavariable: $VAL
      severity: WARNING
    - id: python.django.security.audit.avoid-insecure-deserialization.avoid-insecure-deserialization
      languages:
        - python
      message: Avoid using insecure deserialization library, backed by `pickle`, `_pickle`, `cpickle`, `dill`, `shelve`, or `yaml`, which are known to lead to remote code execution vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - vuln
        technology:
            - django
      mode: taint
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        pickle.$PICKLEFUNC(...)
                    - pattern: |
                        _pickle.$PICKLEFUNC(...)
                    - pattern: |
                        cPickle.$PICKLEFUNC(...)
                    - pattern: |
                        shelve.$PICKLEFUNC(...)
                - metavariable-regex:
                    metavariable: $PICKLEFUNC
                    regex: dumps|dump|load|loads
            - patterns:
                - pattern: dill.$DILLFUNC(...)
                - metavariable-regex:
                    metavariable: $DILLFUNC
                    regex: dump|dump_session|dumps|load|load_session|loads
            - patterns:
                - pattern: yaml.$YAMLFUNC(...)
                - pattern-not: yaml.$YAMLFUNC(..., Dumper=SafeDumper, ...)
                - pattern-not: yaml.$YAMLFUNC(..., Dumper=yaml.SafeDumper, ...)
                - pattern-not: yaml.$YAMLFUNC(..., Loader=SafeLoader, ...)
                - pattern-not: yaml.$YAMLFUNC(..., Loader=yaml.SafeLoader, ...)
                - metavariable-regex:
                    metavariable: $YAMLFUNC
                    regex: dump|dump_all|load|load_all
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    def $INSIDE(..., $PARAM, ...):
                      ...
                - pattern-either:
                    - pattern: request.$REQFUNC(...)
                    - pattern: request.$REQFUNC.get(...)
                    - pattern: request.$REQFUNC[...]
      severity: ERROR
    - id: python.django.security.audit.csrf-exempt.no-csrf-exempt
      languages:
        - python
      message: Detected usage of @csrf_exempt, which indicates that there is no CSRF token set for this route. This could lead to an attacker manipulating the user's account and exfiltration of private data. Instead, create a function without this decorator.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - django
      pattern: |
        @django.views.decorators.csrf.csrf_exempt
        def $R(...):
          ...
      severity: WARNING
    - id: python.django.security.audit.custom-expression-as-sql.custom-expression-as-sql
      languages:
        - python
      message: Detected a Custom Expression ''$EXPRESSION'' calling ''as_sql(...).'' This could lead to SQL injection, which can result in attackers exfiltrating sensitive data. Instead, ensure no user input enters this function or that user input is properly sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/expressions/#django.db.models.Func.as_sql
            - https://semgrep.dev/blog/2020/preventing-sql-injection-a-django-authors-perspective/
        subcategory:
            - audit
        technology:
            - django
      pattern: $EXPRESSION.as_sql(...)
      severity: WARNING
    - id: python.django.security.audit.extends-custom-expression.extends-custom-expression
      languages:
        - python
      message: 'Found extension of custom expression: $CLASS. Extending expressions in this way could inadvertently lead to a SQL injection vulnerability, which can result in attackers exfiltrating sensitive data. Instead, ensure no user input enters this function or that user input is properly sanitized.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/expressions/#avoiding-sql-injection
            - https://semgrep.dev/blog/2020/preventing-sql-injection-a-django-authors-perspective/
        subcategory:
            - audit
        technology:
            - django
      pattern-either:
        - pattern: |
            class $CLASS(..., django.db.models.Func, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Func, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Expression, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Expression, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Value, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Value, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.DurationValue, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.DurationValue, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.RawSQL, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.RawSQL, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Star, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Star, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Random, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Random, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Col, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Col, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Ref, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Ref, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.ExpressionList, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.ExpressionList, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.ExpressionWrapper, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.ExpressionWrapper, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.When, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.When, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Case, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Case, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Subquery, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Subquery, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Exists, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Exists, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.Window, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.Window, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.WindowFrame, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.WindowFrame, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.RowRange, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.RowRange, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.ValueRange, ...):
                ...
        - pattern: |
            class $CLASS(..., django.db.models.expressions.ValueRange, ...):
                ...
      severity: WARNING
    - id: python.django.security.audit.query-set-extra.avoid-query-set-extra
      languages:
        - python
      message: QuerySet.extra' does not provide safeguards against SQL injection and requires very careful use. SQL injection can lead to critical data being stolen by attackers. Instead of using '.extra', use the Django ORM and parameterized queries such as `People.objects.get(name='Bob')`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/querysets/#django.db.models.query.QuerySet.extra
            - https://semgrep.dev/blog/2020/preventing-sql-injection-a-django-authors-perspective/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b610_django_extra_used.html
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern: $MODEL.extra(...)
        - pattern-not-inside: '$MODEL.extra(select = {$KEY: "..."})'
      severity: WARNING
    - id: python.django.security.audit.raw-query.avoid-raw-sql
      languages:
        - python
      message: 'Detected the use of ''RawSQL'' or ''raw'' indicating the execution of a non-parameterized SQL query. This could lead to a SQL injection and therefore protected information could be leaked. Instead, use Django ORM and parameterized queries before raw SQL. An example of using the Django ORM is: `People.objects.get(name=''Bob'')`'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/expressions/#raw-sql-expressions
            - https://semgrep.dev/blog/2020/preventing-sql-injection-a-django-authors-perspective/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b611_django_rawsql_used.html
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern-either:
            - pattern: $MODEL.objects.raw($QUERY, ...)
            - pattern: django.db.models.expressions.RawSQL(...)
        - pattern-not: $MODEL.objects.raw("...")
        - pattern-not: django.db.models.expressions.RawSQL("...")
      severity: WARNING
    - id: python.django.security.audit.xss.class-extends-safestring.class-extends-safestring
      languages:
        - python
      message: Found a class extending 'SafeString', 'SafeText' or 'SafeData'. These classes are for bypassing the escaping engine built in to Django and should not be used directly. Improper use of this class exposes your application to cross-site scripting (XSS) vulnerabilities. If you need this functionality, use 'mark_safe' instead and ensure no user data can reach it.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.1/howto/custom-template-tags/#filters-and-auto-escaping
            - https://github.com/django/django/blob/f138e75910b1e541686c4dce3d8f467f6fc234cb/django/utils/safestring.py#L11
        subcategory:
            - audit
        technology:
            - django
      pattern-either:
        - pattern: |
            class $CLASS(django.utils.safestring.SafeString):
              ...
        - pattern: |
            class $CLASS(django.utils.safestring.SafeText):
              ...
        - pattern: |-
            class $CLASS(django.utils.safestring.SafeData):
              ...
      severity: WARNING
    - fix: |
        True
      id: python.django.security.audit.xss.context-autoescape-off.context-autoescape-off
      languages:
        - python
      message: 'Detected a Context with autoescape disabled. If you are rendering any web pages, this exposes your application to cross-site scripting (XSS) vulnerabilities. Remove ''autoescape: False'' or set it to ''True''.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.1/ref/settings/#templates
            - https://docs.djangoproject.com/en/3.1/topics/templates/#django.template.backends.django.DjangoTemplates
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern-either:
            - pattern: |
                {..., "autoescape": $FALSE, ...}
            - pattern: |
                $D["autoescape"] = $FALSE
        - metavariable-pattern:
            metavariable: $FALSE
            pattern: |
                False
        - focus-metavariable: $FALSE
      severity: WARNING
    - id: python.django.security.audit.xss.direct-use-of-httpresponse.direct-use-of-httpresponse
      languages:
        - python
      message: Detected data rendered directly to the end user via 'HttpResponse' or a similar object. This bypasses Django's built-in cross-site scripting (XSS) defenses and could result in an XSS vulnerability. Use Django's template engine to safely render HTML.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.1/intro/tutorial03/#a-shortcut-render
            - https://docs.djangoproject.com/en/3.1/topics/http/shortcuts/#render
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern-not: django.http.$ANY("...", ...)
        - pattern-not: django.http.$ANY()
        - pattern-not: django.http.$ANY(..., content=None, ...)
        - pattern-not: django.http.$ANY(status=...)
        - pattern-not: django.http.HttpResponseNotAllowed([...])
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: django.http.HttpResponse(...)
                    - pattern: django.http.HttpResponseBadRequest(...)
                    - pattern: django.http.HttpResponseNotFound(...)
                    - pattern: django.http.HttpResponseForbidden(...)
                    - pattern: django.http.HttpResponseNotAllowed(...)
                    - pattern: django.http.HttpResponseGone(...)
                    - pattern: django.http.HttpResponseServerError(...)
                - pattern-not: django.http.$ANY(...,content_type=$TYPE,...)
            - patterns:
                - pattern-either:
                    - pattern: django.http.HttpResponse(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseBadRequest(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseNotFound(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseForbidden(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseNotAllowed(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseGone(...,content_type=$TYPE,...)
                    - pattern: django.http.HttpResponseServerError(...,content_type=$TYPE,...)
                - metavariable-regex:
                    metavariable: $TYPE
                    regex: .*[tT][eE][xX][tT]/[hH][tT][mM][lL].*
      severity: WARNING
    - fix: |
        True
      id: python.django.security.audit.xss.global-autoescape-off.global-autoescape-off
      languages:
        - python
      message: 'Autoescape is globally disbaled for this Django application. If you are rendering any web pages, this exposes your application to cross-site scripting (XSS) vulnerabilities. Remove ''autoescape: False'' or set it to ''True''.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.1/ref/settings/#templates
            - https://docs.djangoproject.com/en/3.1/topics/templates/#django.template.backends.django.DjangoTemplates
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern: |
            {..., 'BACKEND': ..., 'OPTIONS': {..., 'autoescape': $FALSE, ...}, ...}
        - metavariable-pattern:
            metavariable: $FALSE
            pattern: |
                False
        - focus-metavariable: $FALSE
      severity: WARNING
    - id: python.django.security.audit.xss.template-href-var.template-href-var
      languages:
        - generic
      message: Detected a template variable used in an anchor tag with the 'href' attribute. This allows a malicious actor to input the 'javascript:' URI and is subject to cross- site scripting (XSS) attacks. Use the 'url' template tag to safely generate a URL. You may also consider setting the Content Security Policy (CSP) header.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss
            - https://docs.djangoproject.com/en/3.1/ref/templates/builtins/#url
            - https://content-security-policy.com/
        subcategory:
            - audit
        technology:
            - django
      paths:
        include:
            - '*.html'
      patterns:
        - pattern-inside: <a ...>
        - pattern-either:
            - pattern: href = '{{...}}'
            - pattern: href = "{{...}}"
            - pattern: href = {{...}}
      severity: WARNING
    - id: python.django.security.django-no-csrf-token.django-no-csrf-token
      languages:
        - generic
      message: Manually-created forms in django templates should specify a csrf_token to prevent CSRF attacks
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-352: Cross-Site Request Forgery (CSRF)'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://docs.djangoproject.com/en/4.2/howto/csrf/
        subcategory:
            - guardrail
        technology:
            - django
      paths:
        include:
            - '*.html'
      patterns:
        - pattern: <form...>...</form>
        - pattern-either:
            - pattern: |
                <form ... method="$METHOD" ...>...</form>
            - pattern: |
                <form ... method='$METHOD' ...>...</form>
            - pattern: |
                <form ... method=$METHOD ...>...</form>
        - metavariable-regex:
            metavariable: $METHOD
            regex: (?i)(post|put|delete|patch)
        - pattern-not-inside: <form...>...{% csrf_token %}...</form>
        - pattern-not-inside: <form...>...{{ $VAR.csrf_token }}...</form>
      severity: WARNING
    - id: python.django.security.django-using-request-post-after-is-valid.django-using-request-post-after-is-valid
      languages:
        - python
      message: Use $FORM.cleaned_data[] instead of request.POST[] after form.is_valid() has been executed to only access sanitized data
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-20: Improper Input Validation'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://docs.djangoproject.com/en/4.2/ref/forms/api/#accessing-clean-data
        subcategory:
            - guardrail
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(request, ...):
              ...
        - pattern-inside: |
            if $FORM.is_valid():
              ...
        - pattern-either:
            - pattern: request.POST[...]
            - pattern: request.POST.get(...)
      severity: WARNING
    - id: python.django.security.globals-as-template-context.globals-as-template-context
      languages:
        - python
      message: 'Using ''globals()'' as a context to ''render(...)'' is extremely dangerous. This exposes Python functions to the template that were not meant to be exposed. An attacker could use these functions to execute code that was not intended to run and could compromise the application. (This is server-side template injection (SSTI)). Do not use ''globals()''. Instead, specify each variable in a dictionary or ''django.template.Context'' object, like ''{"var1": "hello"}'' and use that instead.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.2/ref/settings/#templates
            - https://docs.djangoproject.com/en/3.2/topics/templates/#django.template.backends.django.DjangoTemplates
            - https://docs.djangoproject.com/en/3.2/ref/templates/api/#rendering-a-context
        subcategory:
            - audit
        technology:
            - django
      pattern-either:
        - pattern: django.shortcuts.render(..., globals(...), ...)
        - pattern: django.template.Template.render(..., globals(...), ...)
        - patterns:
            - pattern-inside: |
                $CONTEXT = globals(...)
                ...
            - pattern-either:
                - pattern: django.shortcuts.render(..., $CONTEXT, ...)
                - pattern: django.template.Template.render(..., $CONTEXT, ...)
      severity: ERROR
    - id: python.django.security.hashids-with-django-secret.hashids-with-django-secret
      languages:
        - python
      message: The Django secret key is used as salt in HashIDs. The HashID mechanism is not secure. By observing sufficient HashIDs, the salt used to construct them can be recovered. This means the Django secret key can be obtained by attackers, through the HashIDs.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A02:2021  Cryptographic Failures
        references:
            - https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-SECRET_KEY
            - http://carnage.github.io/2015/08/cryptanalysis-of-hashids
        subcategory:
            - vuln
        technology:
            - django
      pattern-either:
        - pattern: hashids.Hashids(..., salt=django.conf.settings.SECRET_KEY, ...)
        - pattern: hashids.Hashids(django.conf.settings.SECRET_KEY, ...)
      severity: ERROR
    - id: python.django.security.injection.code.globals-misuse-code-execution.globals-misuse-code-execution
      languages:
        - python
      message: Found request data as an index to 'globals()'. This is extremely dangerous because it allows an attacker to execute arbitrary code on the system. Refactor your code not to use 'globals()'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/mpirnat/lets-be-bad-guys/blob/d92768fb3ade32956abd53bd6bb06e19d634a084/badguys/vulnerable/views.py#L181-L186
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals().get($DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals().get("..." % $DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals().get(f"...{$DATA}...", ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals().get("...".format(..., $DATA, ...), ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals()[$DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals()["..." % $DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals()[f"...{$DATA}..."]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = globals()["...".format(..., $DATA, ...)]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals().get($DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals().get("..." % $DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals().get(f"...{$DATA}...", ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals().get("...".format(..., $DATA, ...), ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals()[$DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals()["..." % $DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals()[f"...{$DATA}..."]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = globals()["...".format(..., $DATA, ...)]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals().get($DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals().get("..." % $DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals().get(f"...{$DATA}...", ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals().get("...".format(..., $DATA, ...), ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals()[$DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals()["..." % $DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals()[f"...{$DATA}..."]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = globals()["...".format(..., $DATA, ...)]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals().get($DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals().get("..." % $DATA, ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals().get(f"...{$DATA}...", ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals().get("...".format(..., $DATA, ...), ...)
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals()[$DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals()["..." % $DATA]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals()[f"...{$DATA}..."]
                ...
                $INTERM(...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = globals()["...".format(..., $DATA, ...)]
                ...
                $INTERM(...)
      severity: WARNING
    - id: python.django.security.injection.code.user-eval-format-string.user-eval-format-string
      languages:
        - python
      message: Found user data in a call to 'eval'. This is extremely dangerous because it can enable an attacker to execute remote code. See https://owasp.org/www-community/attacks/Code_Injection for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-either:
            - pattern: eval(..., $STR % request.$W.get(...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                eval(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = $STR % $V
                ...
                eval(..., $S, ...)
            - pattern: eval(..., "..." % request.$W(...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                eval(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = $STR % $V
                ...
                eval(..., $S, ...)
            - pattern: eval(..., $STR % request.$W[...], ...)
            - pattern: |
                $V = request.$W[...]
                ...
                eval(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = $STR % $V
                ...
                eval(..., $S, ...)
            - pattern: eval(..., $STR.format(..., request.$W.get(...), ...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                eval(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = $STR.format(..., $V, ...)
                ...
                eval(..., $S, ...)
            - pattern: eval(..., $STR.format(..., request.$W(...), ...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                eval(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = $STR.format(..., $V, ...)
                ...
                eval(..., $S, ...)
            - pattern: eval(..., $STR.format(..., request.$W[...], ...), ...)
            - pattern: |
                $V = request.$W[...]
                ...
                eval(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = $STR.format(..., $V, ...)
                ...
                eval(..., $S, ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                eval(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = f"...{$V}..."
                ...
                eval(..., $S, ...)
            - pattern: |
                $V = request.$W(...)
                ...
                eval(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = f"...{$V}..."
                ...
                eval(..., $S, ...)
            - pattern: |
                $V = request.$W[...]
                ...
                eval(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = f"...{$V}..."
                ...
                eval(..., $S, ...)
      severity: WARNING
    - id: python.django.security.injection.code.user-eval.user-eval
      languages:
        - python
      message: Found user data in a call to 'eval'. This is extremely dangerous because it can enable an attacker to execute arbitrary remote code on the system. Instead, refactor your code to not use 'eval' and instead use a safe library for the specific functionality you need.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html
            - https://owasp.org/www-community/attacks/Code_Injection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-either:
            - pattern: eval(..., request.$W.get(...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                eval(..., $V, ...)
            - pattern: eval(..., request.$W(...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                eval(..., $V, ...)
            - pattern: eval(..., request.$W[...], ...)
            - pattern: |
                $V = request.$W[...]
                ...
                eval(..., $V, ...)
      severity: WARNING
    - id: python.django.security.injection.code.user-exec-format-string.user-exec-format-string
      languages:
        - python
      message: Found user data in a call to 'exec'. This is extremely dangerous because it can enable an attacker to execute arbitrary remote code on the system. Instead, refactor your code to not use 'eval' and instead use a safe library for the specific functionality you need.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/Code_Injection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-either:
            - pattern: exec(..., $STR % request.$W.get(...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                exec(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = $STR % $V
                ...
                exec(..., $S, ...)
            - pattern: exec(..., "..." % request.$W(...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                exec(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = $STR % $V
                ...
                exec(..., $S, ...)
            - pattern: exec(..., $STR % request.$W[...], ...)
            - pattern: |
                $V = request.$W[...]
                ...
                exec(..., $STR % $V, ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = $STR % $V
                ...
                exec(..., $S, ...)
            - pattern: exec(..., $STR.format(..., request.$W.get(...), ...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                exec(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = $STR.format(..., $V, ...)
                ...
                exec(..., $S, ...)
            - pattern: exec(..., $STR.format(..., request.$W(...), ...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                exec(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = $STR.format(..., $V, ...)
                ...
                exec(..., $S, ...)
            - pattern: exec(..., $STR.format(..., request.$W[...], ...), ...)
            - pattern: |
                $V = request.$W[...]
                ...
                exec(..., $STR.format(..., $V, ...), ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = $STR.format(..., $V, ...)
                ...
                exec(..., $S, ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                exec(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                $S = f"...{$V}..."
                ...
                exec(..., $S, ...)
            - pattern: |
                $V = request.$W(...)
                ...
                exec(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W(...)
                ...
                $S = f"...{$V}..."
                ...
                exec(..., $S, ...)
            - pattern: |
                $V = request.$W[...]
                ...
                exec(..., f"...{$V}...", ...)
            - pattern: |
                $V = request.$W[...]
                ...
                $S = f"...{$V}..."
                ...
                exec(..., $S, ...)
            - pattern: exec(..., base64.decodestring($S.format(..., request.$W.get(...), ...), ...), ...)
            - pattern: exec(..., base64.decodestring($S % request.$W.get(...), ...), ...)
            - pattern: exec(..., base64.decodestring(f"...{request.$W.get(...)}...", ...), ...)
            - pattern: exec(..., base64.decodestring(request.$W.get(...), ...), ...)
            - pattern: exec(..., base64.decodestring(bytes($S.format(..., request.$W.get(...), ...), ...), ...), ...)
            - pattern: exec(..., base64.decodestring(bytes($S % request.$W.get(...), ...), ...), ...)
            - pattern: exec(..., base64.decodestring(bytes(f"...{request.$W.get(...)}...", ...), ...), ...)
            - pattern: exec(..., base64.decodestring(bytes(request.$W.get(...), ...), ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                exec(..., base64.decodestring($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = base64.decodestring($DATA, ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                exec(..., base64.decodestring(bytes($DATA, ...), ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = base64.decodestring(bytes($DATA, ...), ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                exec(..., base64.decodestring($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = base64.decodestring($DATA, ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                exec(..., base64.decodestring(bytes($DATA, ...), ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = base64.decodestring(bytes($DATA, ...), ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                exec(..., base64.decodestring($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = base64.decodestring($DATA, ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                exec(..., base64.decodestring(bytes($DATA, ...), ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = base64.decodestring(bytes($DATA, ...), ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                exec(..., base64.decodestring($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = base64.decodestring($DATA, ...)
                ...
                exec(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                exec(..., base64.decodestring(bytes($DATA, ...), ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = base64.decodestring(bytes($DATA, ...), ...)
                ...
                exec(..., $INTERM, ...)
      severity: WARNING
    - id: python.django.security.injection.code.user-exec.user-exec
      languages:
        - python
      message: Found user data in a call to 'exec'. This is extremely dangerous because it can enable an attacker to execute arbitrary remote code on the system. Instead, refactor your code to not use 'eval' and instead use a safe library for the specific functionality you need.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/Code_Injection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-either:
            - pattern: exec(..., request.$W.get(...), ...)
            - pattern: |
                $V = request.$W.get(...)
                ...
                exec(..., $V, ...)
            - pattern: exec(..., request.$W(...), ...)
            - pattern: |
                $V = request.$W(...)
                ...
                exec(..., $V, ...)
            - pattern: exec(..., request.$W[...], ...)
            - pattern: |
                $V = request.$W[...]
                ...
                exec(..., $V, ...)
            - pattern: |
                loop = asyncio.get_running_loop()
                ...
                await loop.run_in_executor(None, exec, request.$W[...])
            - pattern: |
                $V = request.$W[...]
                ...
                loop = asyncio.get_running_loop()
                ...
                await loop.run_in_executor(None, exec, $V)
            - pattern: |
                loop = asyncio.get_running_loop()
                ...
                await loop.run_in_executor(None, exec, request.$W.get(...))
            - pattern: |
                $V = request.$W.get(...)
                ...
                loop = asyncio.get_running_loop()
                ...
                await loop.run_in_executor(None, exec, $V)
      severity: WARNING
    - id: python.django.security.injection.command.command-injection-os-system.command-injection-os-system
      languages:
        - python
      message: Request data detected in os.system. This could be vulnerable to a command injection and should be avoided. If this must be done, use the 'subprocess' module instead and pass the arguments as a list. See https://owasp.org/www-community/attacks/Command_Injection for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/Command_Injection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: os.system(..., request.$W.get(...), ...)
            - pattern: os.system(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: os.system(..., $S % request.$W.get(...), ...)
            - pattern: os.system(..., f"...{request.$W.get(...)}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                os.system(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                os.system(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                os.system(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                os.system(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                os.system(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: $A = os.system(..., request.$W.get(...), ...)
            - pattern: $A = os.system(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $A = os.system(..., $S % request.$W.get(...), ...)
            - pattern: $A = os.system(..., f"...{request.$W.get(...)}...", ...)
            - pattern: return os.system(..., request.$W.get(...), ...)
            - pattern: return os.system(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: return os.system(..., $S % request.$W.get(...), ...)
            - pattern: return os.system(..., f"...{request.$W.get(...)}...", ...)
            - pattern: os.system(..., request.$W(...), ...)
            - pattern: os.system(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: os.system(..., $S % request.$W(...), ...)
            - pattern: os.system(..., f"...{request.$W(...)}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                os.system(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                os.system(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                os.system(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                os.system(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                os.system(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: $A = os.system(..., request.$W(...), ...)
            - pattern: $A = os.system(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $A = os.system(..., $S % request.$W(...), ...)
            - pattern: $A = os.system(..., f"...{request.$W(...)}...", ...)
            - pattern: return os.system(..., request.$W(...), ...)
            - pattern: return os.system(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: return os.system(..., $S % request.$W(...), ...)
            - pattern: return os.system(..., f"...{request.$W(...)}...", ...)
            - pattern: os.system(..., request.$W[...], ...)
            - pattern: os.system(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: os.system(..., $S % request.$W[...], ...)
            - pattern: os.system(..., f"...{request.$W[...]}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                os.system(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                os.system(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                os.system(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                os.system(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                os.system(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: $A = os.system(..., request.$W[...], ...)
            - pattern: $A = os.system(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $A = os.system(..., $S % request.$W[...], ...)
            - pattern: $A = os.system(..., f"...{request.$W[...]}...", ...)
            - pattern: return os.system(..., request.$W[...], ...)
            - pattern: return os.system(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: return os.system(..., $S % request.$W[...], ...)
            - pattern: return os.system(..., f"...{request.$W[...]}...", ...)
            - pattern: os.system(..., request.$W, ...)
            - pattern: os.system(..., $S.format(..., request.$W, ...), ...)
            - pattern: os.system(..., $S % request.$W, ...)
            - pattern: os.system(..., f"...{request.$W}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                os.system(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                os.system(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                os.system(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                os.system(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                os.system(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                os.system(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                os.system(..., $INTERM, ...)
            - pattern: $A = os.system(..., request.$W, ...)
            - pattern: $A = os.system(..., $S.format(..., request.$W, ...), ...)
            - pattern: $A = os.system(..., $S % request.$W, ...)
            - pattern: $A = os.system(..., f"...{request.$W}...", ...)
            - pattern: return os.system(..., request.$W, ...)
            - pattern: return os.system(..., $S.format(..., request.$W, ...), ...)
            - pattern: return os.system(..., $S % request.$W, ...)
            - pattern: return os.system(..., f"...{request.$W}...", ...)
      severity: ERROR
    - id: python.django.security.injection.command.subprocess-injection.subprocess-injection
      languages:
        - python
      message: Detected user input entering a `subprocess` call unsafely. This could result in a command injection vulnerability. An attacker could use this vulnerability to execute arbitrary commands on the host, which allows them to download malware, scan sensitive data, or run any command they wish on the server. Do not let users choose the command to run. In general, prefer to use Python API versions of system commands. If you must use subprocess, use a dictionary to allowlist a set of commands.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sanitizers:
        - patterns:
            - pattern: $DICT[$KEY]
            - focus-metavariable: $KEY
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: subprocess.$FUNC(...)
                    - pattern-not: subprocess.$FUNC("...", ...)
                    - pattern-not: subprocess.$FUNC(["...", ...], ...)
                    - pattern-not-inside: |
                        $CMD = ["...", ...]
                        ...
                        subprocess.$FUNC($CMD, ...)
                - patterns:
                    - pattern: subprocess.$FUNC(["$SHELL", "-c", ...], ...)
                    - metavariable-regex:
                        metavariable: $SHELL
                        regex: ^(sh|bash|ksh|csh|tcsh|zsh)$
                - patterns:
                    - pattern: subprocess.$FUNC(["$INTERPRETER", ...], ...)
                    - metavariable-regex:
                        metavariable: $INTERPRETER
                        regex: ^(python|python\d)$
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $REQUEST, ...):
                  ...
            - focus-metavariable: $REQUEST
            - metavariable-pattern:
                metavariable: $REQUEST
                patterns:
                    - pattern: request
                    - pattern-not-inside: request.build_absolute_uri
      severity: ERROR
    - id: python.django.security.injection.csv-writer-injection.csv-writer-injection
      languages:
        - python
      message: Detected user input into a generated CSV file using the built-in `csv` module. If user data is used to generate the data in this file, it is possible that an attacker could inject a formula when the CSV is imported into a spreadsheet application that runs an attacker script, which could steal data from the importing user or, at worst, install malware on the user's computer. `defusedcsv` is a drop-in replacement with the same API that will attempt to mitigate formula injection attempts. You can use `defusedcsv` instead of `csv` to safely generate CSVs.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1236: Improper Neutralization of Formula Elements in a CSV File'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/raphaelm/defusedcsv
            - https://owasp.org/www-community/attacks/CSV_Injection
            - https://web.archive.org/web/20220516052229/https://www.contextis.com/us/blog/comma-separated-vulnerabilities
        subcategory:
            - vuln
        technology:
            - django
            - python
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $WRITER = csv.writer(...)

                ...

                $WRITER.$WRITE(...)
            - pattern: $WRITER.$WRITE(...)
            - metavariable-regex:
                metavariable: $WRITE
                regex: ^(writerow|writerows|writeheader)$
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $REQUEST, ...):
                  ...
            - focus-metavariable: $REQUEST
            - metavariable-pattern:
                metavariable: $REQUEST
                patterns:
                    - pattern: request
                    - pattern-not-inside: request.build_absolute_uri
      severity: ERROR
    - id: python.django.security.injection.email.xss-html-email-body.xss-html-email-body
      languages:
        - python
      message: Found request data in an EmailMessage that is set to use HTML. This is dangerous because HTML emails are susceptible to XSS. An attacker could inject data into this HTML email, causing XSS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component (''Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.damonkohler.com/2008/12/email-injection.html
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
              $EMAIL.content_subtype = "html"
              ...
        - pattern-either:
            - pattern: django.core.mail.EmailMessage($SUBJ, request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $B.$C(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $B.$C(..., $DATA, ...)
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.EmailMessage($SUBJ, f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: $A = django.core.mail.EmailMessage($SUBJ, request.$W.get(...), ...)
            - pattern: return django.core.mail.EmailMessage($SUBJ, request.$W.get(...), ...)
            - pattern: django.core.mail.EmailMessage($SUBJ, request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $B.$C(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $B.$C(..., $DATA, ...)
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.EmailMessage($SUBJ, $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.EmailMessage($SUBJ, f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: $A = django.core.mail.EmailMessage($SUBJ, request.$W(...), ...)
            - pattern: return django.core.mail.EmailMessage($SUBJ, request.$W(...), ...)
            - pattern: django.core.mail.EmailMessage($SUBJ, request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.EmailMessage($SUBJ, $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.EmailMessage($SUBJ, $B.$C(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $B.$C(..., $DATA, ...)
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.EmailMessage($SUBJ, $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.EmailMessage($SUBJ, f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: $A = django.core.mail.EmailMessage($SUBJ, request.$W[...], ...)
            - pattern: return django.core.mail.EmailMessage($SUBJ, request.$W[...], ...)
            - pattern: django.core.mail.EmailMessage($SUBJ, request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.EmailMessage($SUBJ, $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.EmailMessage($SUBJ, $B.$C(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $B.$C(..., $DATA, ...)
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.EmailMessage($SUBJ, $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.EmailMessage($SUBJ, f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.EmailMessage($SUBJ, $INTERM, ...)
            - pattern: $A = django.core.mail.EmailMessage($SUBJ, request.$W, ...)
            - pattern: return django.core.mail.EmailMessage($SUBJ, request.$W, ...)
      severity: WARNING
    - id: python.django.security.injection.email.xss-send-mail-html-message.xss-send-mail-html-message
      languages:
        - python
      message: Found request data in 'send_mail(...)' that uses 'html_message'. This is dangerous because HTML emails are susceptible to XSS. An attacker could inject data into this HTML email, causing XSS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component (''Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.damonkohler.com/2008/12/email-injection.html
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: django.core.mail.send_mail(..., html_message=request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.send_mail(..., html_message=$DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.send_mail(..., html_message=f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: $A = django.core.mail.send_mail(..., html_message=request.$W.get(...), ...)
            - pattern: return django.core.mail.send_mail(..., html_message=request.$W.get(...), ...)
            - pattern: django.core.mail.send_mail(..., html_message=request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.send_mail(..., html_message=$DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.send_mail(..., html_message=f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.core.mail.send_mail(..., html_message=$STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: $A = django.core.mail.send_mail(..., html_message=request.$W(...), ...)
            - pattern: return django.core.mail.send_mail(..., html_message=request.$W(...), ...)
            - pattern: django.core.mail.send_mail(..., html_message=request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.send_mail(..., html_message=$DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.send_mail(..., html_message=$STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.send_mail(..., html_message=$STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.send_mail(..., html_message=f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.core.mail.send_mail(..., html_message=$STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: $A = django.core.mail.send_mail(..., html_message=request.$W[...], ...)
            - pattern: return django.core.mail.send_mail(..., html_message=request.$W[...], ...)
            - pattern: django.core.mail.send_mail(..., html_message=request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.send_mail(..., html_message=$DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.send_mail(..., html_message=$STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.send_mail(..., html_message=$STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.send_mail(..., html_message=f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.core.mail.send_mail(..., html_message=$STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.core.mail.send_mail(..., html_message=$INTERM, ...)
            - pattern: $A = django.core.mail.send_mail(..., html_message=request.$W, ...)
            - pattern: return django.core.mail.send_mail(..., html_message=request.$W, ...)
      severity: WARNING
    - id: python.django.security.injection.open-redirect.open-redirect
      languages:
        - python
      message: Data from request ($DATA) is passed to redirect(). This is an open redirect and could be exploited. Ensure you are redirecting to safe URLs by using django.utils.http.is_safe_url(). See https://cwe.mitre.org/data/definitions/601.html for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://www.djm.org.uk/posts/djangos-little-protections-word-redirect-dangers/
            - https://github.com/django/django/blob/d1b7bd030b1db111e1a3505b1fc029ab964382cc/django/utils/http.py#L231
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-not-inside: |
            def $FUNC(...):
              ...
              django.utils.http.is_safe_url(...)
              ...
        - pattern-not-inside: |
            def $FUNC(...):
              ...
              if <... django.utils.http.is_safe_url(...) ...>:
                ...
        - pattern-not-inside: |
            def $FUNC(...):
              ...
              django.utils.http.url_has_allowed_host_and_scheme(...)
              ...
        - pattern-not-inside: |
            def $FUNC(...):
              ...
              if <... django.utils.http.url_has_allowed_host_and_scheme(...) ...>:
                ...
        - pattern-either:
            - pattern: django.shortcuts.redirect(..., request.$W.get(...), ...)
            - pattern: django.shortcuts.redirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: django.shortcuts.redirect(..., $S % request.$W.get(...), ...)
            - pattern: django.shortcuts.redirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.shortcuts.redirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.shortcuts.redirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.shortcuts.redirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.shortcuts.redirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.shortcuts.redirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: $A = django.shortcuts.redirect(..., request.$W.get(...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S % request.$W.get(...), ...)
            - pattern: $A = django.shortcuts.redirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: return django.shortcuts.redirect(..., request.$W.get(...), ...)
            - pattern: return django.shortcuts.redirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: return django.shortcuts.redirect(..., $S % request.$W.get(...), ...)
            - pattern: return django.shortcuts.redirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: django.shortcuts.redirect(..., request.$W(...), ...)
            - pattern: django.shortcuts.redirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: django.shortcuts.redirect(..., $S % request.$W(...), ...)
            - pattern: django.shortcuts.redirect(..., f"...{request.$W(...)}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.shortcuts.redirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.shortcuts.redirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.shortcuts.redirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.shortcuts.redirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.shortcuts.redirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: $A = django.shortcuts.redirect(..., request.$W(...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S % request.$W(...), ...)
            - pattern: $A = django.shortcuts.redirect(..., f"...{request.$W(...)}...", ...)
            - pattern: return django.shortcuts.redirect(..., request.$W(...), ...)
            - pattern: return django.shortcuts.redirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: return django.shortcuts.redirect(..., $S % request.$W(...), ...)
            - pattern: return django.shortcuts.redirect(..., f"...{request.$W(...)}...", ...)
            - pattern: django.shortcuts.redirect(..., request.$W[...], ...)
            - pattern: django.shortcuts.redirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: django.shortcuts.redirect(..., $S % request.$W[...], ...)
            - pattern: django.shortcuts.redirect(..., f"...{request.$W[...]}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.shortcuts.redirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.shortcuts.redirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.shortcuts.redirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.shortcuts.redirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.shortcuts.redirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: $A = django.shortcuts.redirect(..., request.$W[...], ...)
            - pattern: $A = django.shortcuts.redirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S % request.$W[...], ...)
            - pattern: $A = django.shortcuts.redirect(..., f"...{request.$W[...]}...", ...)
            - pattern: return django.shortcuts.redirect(..., request.$W[...], ...)
            - pattern: return django.shortcuts.redirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: return django.shortcuts.redirect(..., $S % request.$W[...], ...)
            - pattern: return django.shortcuts.redirect(..., f"...{request.$W[...]}...", ...)
            - pattern: django.shortcuts.redirect(..., request.$W, ...)
            - pattern: django.shortcuts.redirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: django.shortcuts.redirect(..., $S % request.$W, ...)
            - pattern: django.shortcuts.redirect(..., f"...{request.$W}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.shortcuts.redirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.shortcuts.redirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.shortcuts.redirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.shortcuts.redirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.shortcuts.redirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.shortcuts.redirect(..., $INTERM, ...)
            - pattern: $A = django.shortcuts.redirect(..., request.$W, ...)
            - pattern: $A = django.shortcuts.redirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: $A = django.shortcuts.redirect(..., $S % request.$W, ...)
            - pattern: $A = django.shortcuts.redirect(..., f"...{request.$W}...", ...)
            - pattern: return django.shortcuts.redirect(..., request.$W, ...)
            - pattern: return django.shortcuts.redirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: return django.shortcuts.redirect(..., $S % request.$W, ...)
            - pattern: return django.shortcuts.redirect(..., f"...{request.$W}...", ...)
            - pattern: django.http.HttpResponseRedirect(..., request.$W.get(...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S % request.$W.get(...), ...)
            - pattern: django.http.HttpResponseRedirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseRedirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseRedirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseRedirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseRedirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseRedirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., request.$W.get(...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S % request.$W.get(...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: return django.http.HttpResponseRedirect(..., request.$W.get(...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S % request.$W.get(...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., f"...{request.$W.get(...)}...", ...)
            - pattern: django.http.HttpResponseRedirect(..., request.$W(...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S % request.$W(...), ...)
            - pattern: django.http.HttpResponseRedirect(..., f"...{request.$W(...)}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseRedirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseRedirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseRedirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseRedirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseRedirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., request.$W(...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S % request.$W(...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., f"...{request.$W(...)}...", ...)
            - pattern: return django.http.HttpResponseRedirect(..., request.$W(...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S % request.$W(...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., f"...{request.$W(...)}...", ...)
            - pattern: django.http.HttpResponseRedirect(..., request.$W[...], ...)
            - pattern: django.http.HttpResponseRedirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S % request.$W[...], ...)
            - pattern: django.http.HttpResponseRedirect(..., f"...{request.$W[...]}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseRedirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseRedirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseRedirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseRedirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseRedirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., request.$W[...], ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S % request.$W[...], ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., f"...{request.$W[...]}...", ...)
            - pattern: return django.http.HttpResponseRedirect(..., request.$W[...], ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S % request.$W[...], ...)
            - pattern: return django.http.HttpResponseRedirect(..., f"...{request.$W[...]}...", ...)
            - pattern: django.http.HttpResponseRedirect(..., request.$W, ...)
            - pattern: django.http.HttpResponseRedirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: django.http.HttpResponseRedirect(..., $S % request.$W, ...)
            - pattern: django.http.HttpResponseRedirect(..., f"...{request.$W}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseRedirect(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseRedirect(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseRedirect(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseRedirect(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseRedirect(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseRedirect(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., request.$W, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., $S % request.$W, ...)
            - pattern: $A = django.http.HttpResponseRedirect(..., f"...{request.$W}...", ...)
            - pattern: return django.http.HttpResponseRedirect(..., request.$W, ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S.format(..., request.$W, ...), ...)
            - pattern: return django.http.HttpResponseRedirect(..., $S % request.$W, ...)
            - pattern: return django.http.HttpResponseRedirect(..., f"...{request.$W}...", ...)
        - metavariable-regex:
            metavariable: $W
            regex: (?!get_full_path)
      severity: WARNING
    - id: python.django.security.injection.path-traversal.path-traversal-file-name.path-traversal-file-name
      languages:
        - python
      message: Data from request is passed to a file name `$FILE`. This is a path traversal vulnerability, which can lead to sensitive data being leaked. To mitigate, consider using os.path.abspath or os.path.realpath or the pathlib library.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-not-inside: |
            def $F(...):
              ...
              os.path.realpath(...)
              ...
        - pattern-not-inside: |
            def $F(...):
              ...
              os.path.abspath(...)
              ...
        - pattern-either:
            - pattern: |
                $V = request.$W.get($X)
                ...
                $FILE % ($V)
            - pattern: |
                $V = request.$W[$X]
                ...
                $FILE % ($V)
            - pattern: |
                $V = request.$W($X)
                ...
                $FILE % ($V)
            - pattern: |
                $V = request.$W
                ...
                $FILE % ($V)
                # match format use cases
            - pattern: |
                $V = request.$W.get($X)
                ...
                $FILE.format(..., $V, ...)
            - pattern: |
                $V = request.$W[$X]
                ...
                $FILE.format(..., $V, ...)
            - pattern: |
                $V = request.$W($X)
                ...
                $FILE.format(..., $V, ...)
            - pattern: |
                $V = request.$W
                ...
                $FILE.format(..., $V, ...)
        - metavariable-regex:
            metavariable: $FILE
            regex: .*\.(log|zip|txt|csv|xml|html).*
      severity: WARNING
    - id: python.django.security.injection.path-traversal.path-traversal-join.path-traversal-join
      languages:
        - python
      message: Data from request is passed to os.path.join() and to open(). This is a path traversal vulnerability, which can lead to sensitive data being leaked. To mitigate, consider using os.path.abspath or os.path.realpath or Path library.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - audit
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $F(...):
              ...
        - pattern-not-inside: |
            def $F(...):
              ...
              os.path.abspath(...)
              ...
        - pattern-not-inside: |
            def $F(...):
              ...
              os.path.realpath(...)
              ...
        - pattern-either:
            - pattern: open(os.path.join(..., request.$W.get(...), ...), ...)
            - pattern: open(os.path.join(..., request.$W(...), ...), ...)
            - pattern: open(os.path.join(..., request.$W, ...), ...)
            - pattern: open(os.path.join(..., request.$W[...], ...), ...)
            - pattern: |
                $P = os.path.join(..., request.$W.get(...), ...)
                ...
                open($P, ...)
            - pattern: |
                $P = os.path.join(..., request.$W(...), ...)
                ...
                open($P, ...)
            - pattern: |
                $P = os.path.join(..., request.$W, ...)
                ...
                open($P, ...)
            - pattern: |
                $P = os.path.join(..., request.$W[...], ...)
                ...
                open($P, ...)
            - pattern: |
                $V = request.$W.get($X)
                ...
                $P = os.path.join(..., $V, ...)
                ...
                open($P, ...)
            - pattern: |
                $V = request.$W($X)
                ...
                $P = os.path.join(..., $V, ...)
                ...
                open($P, ...)
            - pattern: |
                $V = request.$W[$X]
                ...
                $P = os.path.join(..., $V, ...)
                ...
                open($P, ...)
            - pattern: |
                $V = request.$W
                ...
                $P = os.path.join(..., $V, ...)
                ...
                open($P, ...)
            - pattern: |
                $P = request.$W.get(...)
                ...
                open(os.path.join(..., $P, ...), ...)
            - pattern: |
                $P = request.$W(...)
                ...
                open(os.path.join(..., $P, ...), ...)
            - pattern: |
                $P = request.$W
                ...
                open(os.path.join(..., $P, ...), ...)
            - pattern: |
                $P = request.$W[...]
                ...
                open(os.path.join(..., $P, ...), ...)
      severity: WARNING
    - id: python.django.security.injection.path-traversal.path-traversal-open.path-traversal-open
      languages:
        - python
      message: Found request data in a call to 'open'. Ensure the request data is validated or sanitized, otherwise it could result in path traversal attacks and therefore sensitive data being leaked. To mitigate, consider using os.path.abspath or os.path.realpath or the pathlib library.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: open(..., request.$W.get(...), ...)
            - pattern: open(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: open(..., $S % request.$W.get(...), ...)
            - pattern: open(..., f"...{request.$W.get(...)}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                open(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                open(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                open(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                open(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                open(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: $A = open(..., request.$W.get(...), ...)
            - pattern: $A = open(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $A = open(..., $S % request.$W.get(...), ...)
            - pattern: $A = open(..., f"...{request.$W.get(...)}...", ...)
            - pattern: return open(..., request.$W.get(...), ...)
            - pattern: return open(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: return open(..., $S % request.$W.get(...), ...)
            - pattern: return open(..., f"...{request.$W.get(...)}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                with open(..., $DATA, ...) as $FD:
                  ...
            - pattern: open(..., request.$W(...), ...)
            - pattern: open(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: open(..., $S % request.$W(...), ...)
            - pattern: open(..., f"...{request.$W(...)}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                open(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W(...)
                ...
                open(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W(...)
                ...
                open(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W(...)
                ...
                open(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W(...)
                ...
                open(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: $A = open(..., request.$W(...), ...)
            - pattern: $A = open(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $A = open(..., $S % request.$W(...), ...)
            - pattern: $A = open(..., f"...{request.$W(...)}...", ...)
            - pattern: return open(..., request.$W(...), ...)
            - pattern: return open(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: return open(..., $S % request.$W(...), ...)
            - pattern: return open(..., f"...{request.$W(...)}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                with open(..., $DATA, ...) as $FD:
                  ...
            - pattern: open(..., request.$W[...], ...)
            - pattern: open(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: open(..., $S % request.$W[...], ...)
            - pattern: open(..., f"...{request.$W[...]}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                open(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W[...]
                ...
                open(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W[...]
                ...
                open(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W[...]
                ...
                open(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W[...]
                ...
                open(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: $A = open(..., request.$W[...], ...)
            - pattern: $A = open(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $A = open(..., $S % request.$W[...], ...)
            - pattern: $A = open(..., f"...{request.$W[...]}...", ...)
            - pattern: return open(..., request.$W[...], ...)
            - pattern: return open(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: return open(..., $S % request.$W[...], ...)
            - pattern: return open(..., f"...{request.$W[...]}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                with open(..., $DATA, ...) as $FD:
                  ...
            - pattern: open(..., request.$W, ...)
            - pattern: open(..., $S.format(..., request.$W, ...), ...)
            - pattern: open(..., $S % request.$W, ...)
            - pattern: open(..., f"...{request.$W}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                open(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W
                ...
                open(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W
                ...
                open(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W
                ...
                open(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: |
                $DATA = request.$W
                ...
                open(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                open(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                with open(..., $INTERM, ...) as $FD:
                  ...
            - pattern: $A = open(..., request.$W, ...)
            - pattern: $A = open(..., $S.format(..., request.$W, ...), ...)
            - pattern: $A = open(..., $S % request.$W, ...)
            - pattern: $A = open(..., f"...{request.$W}...", ...)
            - pattern: return open(..., request.$W, ...)
            - pattern: return open(..., $S.format(..., request.$W, ...), ...)
            - pattern: return open(..., $S % request.$W, ...)
            - pattern: return open(..., f"...{request.$W}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                with open(..., $DATA, ...) as $FD:
                  ...
      severity: WARNING
    - id: python.django.security.injection.raw-html-format.raw-html-format
      languages:
        - python
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. To be sure this is safe, check that the HTML is rendered safely. Otherwise, use templates (`django.shortcuts.render`) which will safely render HTML instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.2/topics/http/shortcuts/#render
            - https://docs.djangoproject.com/en/3.2/topics/security/#cross-site-scripting-xss-protection
        subcategory:
            - vuln
        technology:
            - django
      mode: taint
      pattern-sanitizers:
        - pattern: django.utils.html.escape(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: '"$HTMLSTR" % ...'
                        - pattern: '"$HTMLSTR".format(...)'
                        - pattern: '"$HTMLSTR" + ...'
                        - pattern: f"$HTMLSTR{...}..."
                - patterns:
                    - pattern-inside: |
                        $HTML = "$HTMLSTR"
                        ...
                    - pattern-either:
                        - pattern: $HTML % ...
                        - pattern: $HTML.format(...)
                        - pattern: $HTML + ...
            - metavariable-pattern:
                language: generic
                metavariable: $HTMLSTR
                pattern: <$TAG ...
      pattern-sources:
        - patterns:
            - pattern: request.$ANYTHING
            - pattern-not: request.build_absolute_uri
      severity: WARNING
    - id: python.django.security.injection.reflected-data-httpresponse.reflected-data-httpresponse
      languages:
        - python
      message: Found user-controlled request data passed into HttpResponse. This could be vulnerable to XSS, leading to attackers gaining access to user cookies and protected information. Ensure that the request data is properly escaped or sanitzed.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://django-book.readthedocs.io/en/latest/chapter20.html#cross-site-scripting-xss
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: django.http.HttpResponse(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: django.http.HttpResponse(..., $S % request.$W.get(...), ...)
            - pattern: django.http.HttpResponse(..., f"...{request.$W.get(...)}...", ...)
            - pattern: django.http.HttpResponse(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponse(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponse(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponse(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponse(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponse(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponse(..., request.$W.get(...), ...)
            - pattern: return django.http.HttpResponse(..., request.$W.get(...), ...)
            - pattern: django.http.HttpResponse(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: django.http.HttpResponse(..., $S % request.$W(...), ...)
            - pattern: django.http.HttpResponse(..., f"...{request.$W(...)}...", ...)
            - pattern: django.http.HttpResponse(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponse(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponse(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponse(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponse(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponse(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponse(..., request.$W(...), ...)
            - pattern: return django.http.HttpResponse(..., request.$W(...), ...)
            - pattern: django.http.HttpResponse(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: django.http.HttpResponse(..., $S % request.$W[...], ...)
            - pattern: django.http.HttpResponse(..., f"...{request.$W[...]}...", ...)
            - pattern: django.http.HttpResponse(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponse(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponse(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponse(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponse(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponse(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponse(..., request.$W[...], ...)
            - pattern: return django.http.HttpResponse(..., request.$W[...], ...)
            - pattern: django.http.HttpResponse(..., $S.format(..., request.$W, ...), ...)
            - pattern: django.http.HttpResponse(..., $S % request.$W, ...)
            - pattern: django.http.HttpResponse(..., f"...{request.$W}...", ...)
            - pattern: django.http.HttpResponse(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponse(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponse(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponse(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponse(..., f"...{$DATA}...", ...)
            - pattern: $A = django.http.HttpResponse(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                $A = django.http.HttpResponse(..., $INTERM, ...)
            - pattern: return django.http.HttpResponse(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponse(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponse(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponse(..., $INTERM, ...)
      severity: WARNING
    - id: python.django.security.injection.reflected-data-httpresponsebadrequest.reflected-data-httpresponsebadrequest
      languages:
        - python
      message: Found user-controlled request data passed into a HttpResponseBadRequest. This could be vulnerable to XSS, leading to attackers gaining access to user cookies and protected information. Ensure that the request data is properly escaped or sanitzed.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://django-book.readthedocs.io/en/latest/chapter20.html#cross-site-scripting-xss
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: django.http.HttpResponseBadRequest(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S % request.$W.get(...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., f"...{request.$W.get(...)}...", ...)
            - pattern: django.http.HttpResponseBadRequest(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseBadRequest(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseBadRequest(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseBadRequest(..., request.$W.get(...), ...)
            - pattern: return django.http.HttpResponseBadRequest(..., request.$W.get(...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S % request.$W(...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., f"...{request.$W(...)}...", ...)
            - pattern: django.http.HttpResponseBadRequest(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseBadRequest(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseBadRequest(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.HttpResponseBadRequest(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseBadRequest(..., request.$W(...), ...)
            - pattern: return django.http.HttpResponseBadRequest(..., request.$W(...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S % request.$W[...], ...)
            - pattern: django.http.HttpResponseBadRequest(..., f"...{request.$W[...]}...", ...)
            - pattern: django.http.HttpResponseBadRequest(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseBadRequest(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseBadRequest(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseBadRequest(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseBadRequest(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.HttpResponseBadRequest(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseBadRequest(..., request.$W[...], ...)
            - pattern: return django.http.HttpResponseBadRequest(..., request.$W[...], ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S.format(..., request.$W, ...), ...)
            - pattern: django.http.HttpResponseBadRequest(..., $S % request.$W, ...)
            - pattern: django.http.HttpResponseBadRequest(..., f"...{request.$W}...", ...)
            - pattern: django.http.HttpResponseBadRequest(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseBadRequest(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseBadRequest(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseBadRequest(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseBadRequest(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.HttpResponseBadRequest(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.http.HttpResponseBadRequest(..., $INTERM, ...)
            - pattern: $A = django.http.HttpResponseBadRequest(..., request.$W, ...)
            - pattern: return django.http.HttpResponseBadRequest(..., request.$W, ...)
      severity: WARNING
    - id: python.django.security.injection.request-data-fileresponse.request-data-fileresponse
      languages:
        - python
      message: Found user-controlled request data being passed into a file open, which is them passed as an argument into the FileResponse. This is dangerous because an attacker could specify an arbitrary file to read, which could result in leaking important data. Be sure to validate or sanitize the user-inputted filename in the request data before using it in FileResponse.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://django-book.readthedocs.io/en/latest/chapter20.html#cross-site-scripting-xss
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: django.http.FileResponse(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.http.FileResponse(..., open($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = open($DATA, ...)
                ...
                django.http.FileResponse(..., $INTERM, ...)
            - pattern: $A = django.http.FileResponse(..., request.$W.get(...), ...)
            - pattern: return django.http.FileResponse(..., request.$W.get(...), ...)
            - pattern: django.http.FileResponse(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.http.FileResponse(..., open($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = open($DATA, ...)
                ...
                django.http.FileResponse(..., $INTERM, ...)
            - pattern: $A = django.http.FileResponse(..., request.$W(...), ...)
            - pattern: return django.http.FileResponse(..., request.$W(...), ...)
            - pattern: django.http.FileResponse(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.http.FileResponse(..., open($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = open($DATA, ...)
                ...
                django.http.FileResponse(..., $INTERM, ...)
            - pattern: $A = django.http.FileResponse(..., request.$W[...], ...)
            - pattern: return django.http.FileResponse(..., request.$W[...], ...)
            - pattern: django.http.FileResponse(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.http.FileResponse(..., open($DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = open($DATA, ...)
                ...
                django.http.FileResponse(..., $INTERM, ...)
            - pattern: $A = django.http.FileResponse(..., request.$W, ...)
            - pattern: return django.http.FileResponse(..., request.$W, ...)
      severity: WARNING
    - id: python.django.security.injection.request-data-write.request-data-write
      languages:
        - python
      message: Found user-controlled request data passed into '.write(...)'. This could be dangerous if a malicious actor is able to control data into sensitive files. For example, a malicious actor could force rolling of critical log files, or cause a denial-of-service by using up available disk space. Instead, ensure that request data is properly escaped or sanitized.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-93: Improper Neutralization of CRLF Sequences (''CRLF Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - django
      pattern-either:
        - pattern: $F.write(..., request.$W.get(...), ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $F.write(..., $DATA, ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $INTERM = $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $F.write(..., $B.$C(..., $DATA, ...), ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $INTERM = $B.$C(..., $DATA, ...)
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $F.write(..., $STR % $DATA, ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $INTERM = $STR % $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $F.write(..., f"...{$DATA}...", ...)
        - pattern: |
            $DATA = request.$W.get(...)
            ...
            $INTERM = f"...{$DATA}..."
            ...
            $F.write(..., $INTERM, ...)
        - pattern: $A = $F.write(..., request.$W.get(...), ...)
        - pattern: return $F.write(..., request.$W.get(...), ...)
        - pattern: $F.write(..., request.$W(...), ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $F.write(..., $DATA, ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $INTERM = $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $F.write(..., $B.$C(..., $DATA, ...), ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $INTERM = $B.$C(..., $DATA, ...)
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $F.write(..., $STR % $DATA, ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $INTERM = $STR % $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $F.write(..., f"...{$DATA}...", ...)
        - pattern: |
            $DATA = request.$W(...)
            ...
            $INTERM = f"...{$DATA}..."
            ...
            $F.write(..., $INTERM, ...)
        - pattern: $A = $F.write(..., request.$W(...), ...)
        - pattern: return $F.write(..., request.$W(...), ...)
        - pattern: $F.write(..., request.$W[...], ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $F.write(..., $DATA, ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $INTERM = $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $F.write(..., $B.$C(..., $DATA, ...), ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $INTERM = $B.$C(..., $DATA, ...)
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $F.write(..., $STR % $DATA, ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $INTERM = $STR % $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $F.write(..., f"...{$DATA}...", ...)
        - pattern: |
            $DATA = request.$W[...]
            ...
            $INTERM = f"...{$DATA}..."
            ...
            $F.write(..., $INTERM, ...)
        - pattern: $A = $F.write(..., request.$W[...], ...)
        - pattern: return $F.write(..., request.$W[...], ...)
        - pattern: $F.write(..., request.$W, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $F.write(..., $DATA, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $INTERM = $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $F.write(..., $B.$C(..., $DATA, ...), ...)
        - pattern: |
            $DATA = request.$W
            ...
            $INTERM = $B.$C(..., $DATA, ...)
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $F.write(..., $STR % $DATA, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $INTERM = $STR % $DATA
            ...
            $F.write(..., $INTERM, ...)
        - pattern: |
            $DATA = request.$W
            ...
            $F.write(..., f"...{$DATA}...", ...)
        - pattern: |
            $DATA = request.$W
            ...
            $INTERM = f"...{$DATA}..."
            ...
            $F.write(..., $INTERM, ...)
        - pattern: $A = $F.write(..., request.$W, ...)
        - pattern: return $F.write(..., request.$W, ...)
      severity: WARNING
    - id: python.django.security.injection.sql.sql-injection-extra.sql-injection-using-extra-where
      languages:
        - python
      message: User-controlled data from a request is passed to 'extra()'. This could lead to a SQL injection and therefore protected information could be leaked. Instead, use parameterized queries or escape the user-controlled data by using `params` and not using quote placeholders in the SQL string.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/expressions/#.objects.extra
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: $MODEL.objects.extra(..., where=[..., $S.format(..., request.$W.get(...), ...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S % request.$W.get(...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., f"...{request.$W.get(...)}...", ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., request.$W.get(...), ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR.format(..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR % $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., f"...{$DATA}...", ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR + $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: $A = $MODEL.objects.extra(..., where=[..., request.$W.get(...), ...], ...)
            - pattern: return $MODEL.objects.extra(..., where=[..., request.$W.get(...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S.format(..., request.$W(...), ...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S % request.$W(...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., f"...{request.$W(...)}...", ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., request.$W(...), ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR.format(..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR % $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., f"...{$DATA}...", ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR + $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: $A = $MODEL.objects.extra(..., where=[..., request.$W(...), ...], ...)
            - pattern: return $MODEL.objects.extra(..., where=[..., request.$W(...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S.format(..., request.$W[...], ...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S % request.$W[...], ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., f"...{request.$W[...]}...", ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., request.$W[...], ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., $STR.format(..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., $STR % $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., f"...{$DATA}...", ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., $STR + $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: $A = $MODEL.objects.extra(..., where=[..., request.$W[...], ...], ...)
            - pattern: return $MODEL.objects.extra(..., where=[..., request.$W[...], ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S.format(..., request.$W, ...), ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., $S % request.$W, ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., f"...{request.$W}...", ...], ...)
            - pattern: $MODEL.objects.extra(..., where=[..., request.$W, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., $STR.format(..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., $STR % $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., f"...{$DATA}...", ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., $STR + $DATA, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: $A = $MODEL.objects.extra(..., where=[..., request.$W, ...], ...)
            - pattern: return $MODEL.objects.extra(..., where=[..., request.$W, ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR % (..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.extra(..., where=[..., $STR % (..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.extra(..., where=[..., $STR % (..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.extra(..., where=[..., $STR % (..., $DATA, ...), ...], ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.extra(..., where=[..., $INTERM, ...], ...)
      severity: WARNING
    - id: python.django.security.injection.sql.sql-injection-rawsql.sql-injection-using-rawsql
      languages:
        - python
      message: User-controlled data from request is passed to 'RawSQL()'. This could lead to a SQL injection and therefore protected information could be leaked. Instead, use parameterized queries or escape the user-controlled data by using `params` and not using quote placeholders in the SQL string.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/ref/models/expressions/#django.db.models.expressions.RawSQL
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: django.db.models.expressions.RawSQL(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S % request.$W.get(...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., f"...{request.$W.get(...)}...", ...)
            - pattern: django.db.models.expressions.RawSQL(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: $A = django.db.models.expressions.RawSQL(..., request.$W.get(...), ...)
            - pattern: return django.db.models.expressions.RawSQL(..., request.$W.get(...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S % request.$W(...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., f"...{request.$W(...)}...", ...)
            - pattern: django.db.models.expressions.RawSQL(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: $A = django.db.models.expressions.RawSQL(..., request.$W(...), ...)
            - pattern: return django.db.models.expressions.RawSQL(..., request.$W(...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S % request.$W[...], ...)
            - pattern: django.db.models.expressions.RawSQL(..., f"...{request.$W[...]}...", ...)
            - pattern: django.db.models.expressions.RawSQL(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: $A = django.db.models.expressions.RawSQL(..., request.$W[...], ...)
            - pattern: return django.db.models.expressions.RawSQL(..., request.$W[...], ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S.format(..., request.$W, ...), ...)
            - pattern: django.db.models.expressions.RawSQL(..., $S % request.$W, ...)
            - pattern: django.db.models.expressions.RawSQL(..., f"...{request.$W}...", ...)
            - pattern: django.db.models.expressions.RawSQL(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                django.db.models.expressions.RawSQL(..., $INTERM, ...)
            - pattern: $A = django.db.models.expressions.RawSQL(..., request.$W, ...)
            - pattern: return django.db.models.expressions.RawSQL(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                django.db.models.expressions.RawSQL($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                django.db.models.expressions.RawSQL($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                django.db.models.expressions.RawSQL($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                django.db.models.expressions.RawSQL($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL($INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL($INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL($INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                django.db.models.expressions.RawSQL($INTERM, ...)
      severity: WARNING
    - id: python.django.security.injection.sql.sql-injection-using-db-cursor-execute.sql-injection-db-cursor-execute
      languages:
        - python
      message: User-controlled data from a request is passed to 'execute()'. This could lead to a SQL injection and therefore protected information could be leaked. Instead, use django's QuerySets, which are built with query parameterization and therefore not vulnerable to sql injection. For example, you could use `Entry.objects.filter(date=2006)`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/topics/security/#sql-injection-protection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: $CURSOR.execute(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $CURSOR.execute(..., $S % request.$W.get(...), ...)
            - pattern: $CURSOR.execute(..., f"...{request.$W.get(...)}...", ...)
            - pattern: $CURSOR.execute(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: $A = $CURSOR.execute(..., request.$W.get(...), ...)
            - pattern: return $CURSOR.execute(..., request.$W.get(...), ...)
            - pattern: $CURSOR.execute(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $CURSOR.execute(..., $S % request.$W(...), ...)
            - pattern: $CURSOR.execute(..., f"...{request.$W(...)}...", ...)
            - pattern: $CURSOR.execute(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: $A = $CURSOR.execute(..., request.$W(...), ...)
            - pattern: return $CURSOR.execute(..., request.$W(...), ...)
            - pattern: $CURSOR.execute(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $CURSOR.execute(..., $S % request.$W[...], ...)
            - pattern: $CURSOR.execute(..., f"...{request.$W[...]}...", ...)
            - pattern: $CURSOR.execute(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: $A = $CURSOR.execute(..., request.$W[...], ...)
            - pattern: return $CURSOR.execute(..., request.$W[...], ...)
            - pattern: $CURSOR.execute(..., $S.format(..., request.$W, ...), ...)
            - pattern: $CURSOR.execute(..., $S % request.$W, ...)
            - pattern: $CURSOR.execute(..., f"...{request.$W}...", ...)
            - pattern: $CURSOR.execute(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                $CURSOR.execute(..., $INTERM, ...)
            - pattern: $A = $CURSOR.execute(..., request.$W, ...)
            - pattern: return $CURSOR.execute(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $CURSOR.execute($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $CURSOR.execute($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $CURSOR.execute($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $CURSOR.execute($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $CURSOR.execute($INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $CURSOR.execute($INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $CURSOR.execute($INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $CURSOR.execute($INTERM, ...)
      severity: WARNING
    - id: python.django.security.injection.sql.sql-injection-using-raw.sql-injection-using-raw
      languages:
        - python
      message: Data that is possible user-controlled from a python request is passed to `raw()`. This could lead to SQL injection and attackers gaining access to protected information. Instead, use django's QuerySets, which are built with query parameterization and therefore not vulnerable to sql injection. For example, you could use `Entry.objects.filter(date=2006)`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.0/topics/security/#sql-injection-protection
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: $MODEL.objects.raw(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: $MODEL.objects.raw(..., $S % request.$W.get(...), ...)
            - pattern: $MODEL.objects.raw(..., f"...{request.$W.get(...)}...", ...)
            - pattern: $MODEL.objects.raw(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: $A = $MODEL.objects.raw(..., request.$W.get(...), ...)
            - pattern: return $MODEL.objects.raw(..., request.$W.get(...), ...)
            - pattern: $MODEL.objects.raw(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: $MODEL.objects.raw(..., $S % request.$W(...), ...)
            - pattern: $MODEL.objects.raw(..., f"...{request.$W(...)}...", ...)
            - pattern: $MODEL.objects.raw(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: $A = $MODEL.objects.raw(..., request.$W(...), ...)
            - pattern: return $MODEL.objects.raw(..., request.$W(...), ...)
            - pattern: $MODEL.objects.raw(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: $MODEL.objects.raw(..., $S % request.$W[...], ...)
            - pattern: $MODEL.objects.raw(..., f"...{request.$W[...]}...", ...)
            - pattern: $MODEL.objects.raw(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: $A = $MODEL.objects.raw(..., request.$W[...], ...)
            - pattern: return $MODEL.objects.raw(..., request.$W[...], ...)
            - pattern: $MODEL.objects.raw(..., $S.format(..., request.$W, ...), ...)
            - pattern: $MODEL.objects.raw(..., $S % request.$W, ...)
            - pattern: $MODEL.objects.raw(..., f"...{request.$W}...", ...)
            - pattern: $MODEL.objects.raw(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                $MODEL.objects.raw(..., $INTERM, ...)
            - pattern: $A = $MODEL.objects.raw(..., request.$W, ...)
            - pattern: return $MODEL.objects.raw(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $MODEL.objects.raw($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $MODEL.objects.raw($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $MODEL.objects.raw($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $MODEL.objects.raw($STR % (..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.raw($INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.raw($INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.raw($INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % (..., $DATA, ...)
                ...
                $MODEL.objects.raw($INTERM, ...)
      severity: WARNING
    - id: python.django.security.injection.ssrf.ssrf-injection-requests.ssrf-injection-requests
      languages:
        - python
      message: Data from request object is passed to a new server-side request. This could lead to a server-side request forgery (SSRF). To mitigate, ensure that schemes and hosts are validated against an allowlist, do not forward the response to the user, and ensure proper authentication and transport-layer security in the proxied request. See https://owasp.org/www-community/attacks/Server_Side_Request_Forgery to learn more about SSRF vulnerabilities.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: requests.$METHOD(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: requests.$METHOD(..., $S % request.$W.get(...), ...)
            - pattern: requests.$METHOD(..., f"...{request.$W.get(...)}...", ...)
            - pattern: requests.$METHOD(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                requests.$METHOD(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                requests.$METHOD(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                requests.$METHOD(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                requests.$METHOD(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                requests.$METHOD(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: $A = requests.$METHOD(..., request.$W.get(...), ...)
            - pattern: return requests.$METHOD(..., request.$W.get(...), ...)
            - pattern: requests.$METHOD(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: requests.$METHOD(..., $S % request.$W(...), ...)
            - pattern: requests.$METHOD(..., f"...{request.$W(...)}...", ...)
            - pattern: requests.$METHOD(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                requests.$METHOD(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                requests.$METHOD(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                requests.$METHOD(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                requests.$METHOD(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                requests.$METHOD(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: $A = requests.$METHOD(..., request.$W(...), ...)
            - pattern: return requests.$METHOD(..., request.$W(...), ...)
            - pattern: requests.$METHOD(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: requests.$METHOD(..., $S % request.$W[...], ...)
            - pattern: requests.$METHOD(..., f"...{request.$W[...]}...", ...)
            - pattern: requests.$METHOD(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                requests.$METHOD(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                requests.$METHOD(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                requests.$METHOD(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                requests.$METHOD(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                requests.$METHOD(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: $A = requests.$METHOD(..., request.$W[...], ...)
            - pattern: return requests.$METHOD(..., request.$W[...], ...)
            - pattern: requests.$METHOD(..., $S.format(..., request.$W, ...), ...)
            - pattern: requests.$METHOD(..., $S % request.$W, ...)
            - pattern: requests.$METHOD(..., f"...{request.$W}...", ...)
            - pattern: requests.$METHOD(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                requests.$METHOD(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                requests.$METHOD(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                requests.$METHOD(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                requests.$METHOD(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                requests.$METHOD(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                requests.$METHOD(..., $INTERM, ...)
            - pattern: $A = requests.$METHOD(..., request.$W, ...)
            - pattern: return requests.$METHOD(..., request.$W, ...)
      severity: ERROR
    - id: python.django.security.injection.ssrf.ssrf-injection-urllib.ssrf-injection-urllib
      languages:
        - python
      message: Data from request object is passed to a new server-side request. This could lead to a server-side request forgery (SSRF), which could result in attackers gaining access to private organization data. To mitigate, ensure that schemes and hosts are validated against an allowlist, do not forward the response to the user, and ensure proper authentication and transport-layer security in the proxied request.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-inside: |
            def $FUNC(...):
              ...
        - pattern-either:
            - pattern: urllib.request.urlopen(..., $S.format(..., request.$W.get(...), ...), ...)
            - pattern: urllib.request.urlopen(..., $S % request.$W.get(...), ...)
            - pattern: urllib.request.urlopen(..., f"...{request.$W.get(...)}...", ...)
            - pattern: urllib.request.urlopen(..., request.$W.get(...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                urllib.request.urlopen(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                urllib.request.urlopen(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                urllib.request.urlopen(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR % $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                urllib.request.urlopen(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                urllib.request.urlopen(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W.get(...)
                ...
                $INTERM = $STR + $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: $A = urllib.request.urlopen(..., request.$W.get(...), ...)
            - pattern: return urllib.request.urlopen(..., request.$W.get(...), ...)
            - pattern: urllib.request.urlopen(..., $S.format(..., request.$W(...), ...), ...)
            - pattern: urllib.request.urlopen(..., $S % request.$W(...), ...)
            - pattern: urllib.request.urlopen(..., f"...{request.$W(...)}...", ...)
            - pattern: urllib.request.urlopen(..., request.$W(...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                urllib.request.urlopen(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                urllib.request.urlopen(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                urllib.request.urlopen(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR % $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                urllib.request.urlopen(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = f"...{$DATA}..."
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                urllib.request.urlopen(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W(...)
                ...
                $INTERM = $STR + $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: $A = urllib.request.urlopen(..., request.$W(...), ...)
            - pattern: return urllib.request.urlopen(..., request.$W(...), ...)
            - pattern: urllib.request.urlopen(..., $S.format(..., request.$W[...], ...), ...)
            - pattern: urllib.request.urlopen(..., $S % request.$W[...], ...)
            - pattern: urllib.request.urlopen(..., f"...{request.$W[...]}...", ...)
            - pattern: urllib.request.urlopen(..., request.$W[...], ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                urllib.request.urlopen(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                urllib.request.urlopen(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                urllib.request.urlopen(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR % $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                urllib.request.urlopen(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = f"...{$DATA}..."
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                urllib.request.urlopen(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W[...]
                ...
                $INTERM = $STR + $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: $A = urllib.request.urlopen(..., request.$W[...], ...)
            - pattern: return urllib.request.urlopen(..., request.$W[...], ...)
            - pattern: urllib.request.urlopen(..., $S.format(..., request.$W, ...), ...)
            - pattern: urllib.request.urlopen(..., $S % request.$W, ...)
            - pattern: urllib.request.urlopen(..., f"...{request.$W}...", ...)
            - pattern: urllib.request.urlopen(..., request.$W, ...)
            - pattern: |
                $DATA = request.$W
                ...
                urllib.request.urlopen(..., $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                urllib.request.urlopen(..., $STR.format(..., $DATA, ...), ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR.format(..., $DATA, ...)
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                urllib.request.urlopen(..., $STR % $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR % $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                urllib.request.urlopen(..., f"...{$DATA}...", ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = f"...{$DATA}..."
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: |
                $DATA = request.$W
                ...
                urllib.request.urlopen(..., $STR + $DATA, ...)
            - pattern: |
                $DATA = request.$W
                ...
                $INTERM = $STR + $DATA
                ...
                urllib.request.urlopen(..., $INTERM, ...)
            - pattern: $A = urllib.request.urlopen(..., request.$W, ...)
            - pattern: return urllib.request.urlopen(..., request.$W, ...)
      severity: ERROR
    - id: python.django.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - python
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using the Django object-relational mappers (ORM) instead of raw SQL queries.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.djangoproject.com/en/3.0/topics/security/#sql-injection-protection
        subcategory:
            - audit
        technology:
            - django
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$SQLSTR" + ...
                - pattern: |
                    "$SQLSTR" % ...
                - pattern: |
                    "$SQLSTR".format(...)
                - pattern: |
                    f"$SQLSTR{...}..."
            - metavariable-regex:
                metavariable: $SQLSTR
                regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*
      pattern-sources:
        - patterns:
            - pattern: request.$ANYTHING
            - pattern-not: request.build_absolute_uri
      severity: ERROR
    - id: python.django.security.injection.tainted-url-host.tainted-url-host
      languages:
        - python
      message: User data flows into the host portion of this manually-constructed URL. This could allow an attacker to send data to their own server, potentially exposing sensitive data such as cookies or authorization information sent with this request. They could also probe internal servers or other resources that the server running this code can access. (This is called server-side request forgery, or SSRF.) Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - flask
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: '"$URLSTR" % ...'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $URLSTR
                        patterns:
                            - pattern-either:
                                - pattern: $SCHEME://%s
                                - pattern: $SCHEME://%r
                - patterns:
                    - pattern: '"$URLSTR".format(...)'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $URLSTR
                        pattern: $SCHEME:// { ... }
                - patterns:
                    - pattern: '"$URLSTR" + ...'
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
                - patterns:
                    - pattern: f"$URLSTR{...}..."
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
                - patterns:
                    - pattern-inside: |
                        $URL = "$URLSTR"
                        ...
                    - pattern: $URL += ...
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
      pattern-sources:
        - patterns:
            - pattern: request.$ANYTHING
            - pattern-not: request.build_absolute_uri
      severity: WARNING
    - id: python.django.security.locals-as-template-context.locals-as-template-context
      languages:
        - python
      message: 'Using ''locals()'' as a context to ''render(...)'' is extremely dangerous. This exposes Python functions to the template that were not meant to be exposed. An attacker could use these functions to execute code that was not intended to run and could compromise the application. (This is server-side template injection (SSTI)). Do not use ''locals()''. Instead, specify each variable in a dictionary or ''django.template.Context'' object, like ''{"var1": "hello"}'' and use that instead.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://docs.djangoproject.com/en/3.2/ref/settings/#templates
            - https://docs.djangoproject.com/en/3.2/topics/templates/#django.template.backends.django.DjangoTemplates
            - https://docs.djangoproject.com/en/3.2/ref/templates/api/#rendering-a-context
        subcategory:
            - audit
        technology:
            - django
      pattern-either:
        - pattern: django.shortcuts.render(..., locals(...), ...)
        - pattern: django.template.Template.render(..., locals(...), ...)
        - patterns:
            - pattern-inside: |
                $CONTEXT = locals(...)
                ...
            - pattern-either:
                - pattern: django.shortcuts.render(..., $CONTEXT, ...)
                - pattern: django.template.Template.render(..., $CONTEXT, ...)
      severity: ERROR
    - id: python.django.security.nan-injection.nan-injection
      languages:
        - python
      message: Found user input going directly into typecast for bool(), float(), or complex(). This allows an attacker to inject Python's not-a-number (NaN) into the typecast. This results in undefind behavior, particularly when doing comparisons. Either cast to a different type, or add a guard checking for all capitalizations of the string 'nan'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-704: Incorrect Type Conversion or Cast'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://discuss.python.org/t/nan-breaks-min-max-and-sorting-functions-a-solution/2868
            - https://blog.bitdiscovery.com/2021/12/python-nan-injection/
        subcategory:
            - vuln
        technology:
            - django
      mode: taint
      pattern-sanitizers:
        - not_conflicting: true
          pattern: $ANYTHING(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: float(...)
                - pattern: bool(...)
                - pattern: complex(...)
            - pattern-not-inside: |
                if $COND:
                  ...
                ...
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(request, ...):
                  ...
            - pattern-either:
                - pattern: request.$PROPERTY.get(...)
                - pattern: request.$PROPERTY[...]
      severity: ERROR
    - id: python.django.security.passwords.password-empty-string.password-empty-string
      languages:
        - python
      message: '''$VAR'' is the empty string and is being used to set the password on ''$MODEL''. If you meant to set an unusable password, set the password to None or call ''set_unusable_password()''.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-521: Weak Password Requirements'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.djangoproject.com/en/3.0/ref/contrib/auth/#django.contrib.auth.models.User.set_password
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-either:
            - pattern: |
                $MODEL.set_password($EMPTY)
                ...
                $MODEL.save()
            - pattern: |
                $VAR = $EMPTY
                ...
                $MODEL.set_password($VAR)
                ...
                $MODEL.save()
        - metavariable-regex:
            metavariable: $EMPTY
            regex: (\'\'|\"\")
      severity: ERROR
    - fix: |
        None
      id: python.django.security.passwords.use-none-for-password-default.use-none-for-password-default
      languages:
        - python
      message: '''$VAR'' is using the empty string as its default and is being used to set the password on ''$MODEL''. If you meant to set an unusable password, set the default value to ''None'' or call ''set_unusable_password()''.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-521: Weak Password Requirements'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.djangoproject.com/en/3.0/ref/contrib/auth/#django.contrib.auth.models.User.set_password
        subcategory:
            - vuln
        technology:
            - django
      patterns:
        - pattern-either:
            - pattern: |
                $VAR = request.$W.get($X, $EMPTY)
                ...
                $MODEL.set_password($VAR)
                ...
                $MODEL.save(...)
            - pattern: |
                def $F(..., $VAR=$EMPTY, ...):
                  ...
                  $MODEL.set_password($VAR)
        - metavariable-pattern:
            metavariable: $EMPTY
            pattern: '""'
        - focus-metavariable: $EMPTY
      severity: ERROR
    - id: python.docker.security.audit.docker-arbitrary-container-run.docker-arbitrary-container-run
      languages:
        - python
      message: If unverified user data can reach the `run` or `create` method it can result in running arbitrary container.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/250.html
        subcategory:
            - audit
        technology:
            - docker
      patterns:
        - pattern-either:
            - pattern-inside: |
                $CLIENT = docker.from_env()
                ...
            - pattern-inside: |
                $CLIENT = docker.DockerClient(...)
                ...
        - pattern-either:
            - pattern: |
                $CLIENT.containers.run(...)
            - pattern: |
                $CLIENT.containers.create(...)
        - pattern-not: |
            $CLIENT.containers.run("...",...)
        - pattern-not: |
            $CLIENT.containers.create("...",...)
      severity: WARNING
    - id: python.fastapi.security.wildcard-cors.wildcard-cors
      languages:
        - python
      message: CORS policy allows any origin (using wildcard '*'). This is insecure and should be avoided.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-942: Permissive Cross-domain Policy with Untrusted Domains'
        impact: LOW
        likelihood: HIGH
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
            - https://cwe.mitre.org/data/definitions/942.html
        subcategory:
            - vuln
        technology:
            - python
            - fastapi
        vulnerability_class:
            - Configuration
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $APP.add_middleware(
                  CORSMiddleware,
                  allow_origins=$ORIGIN,
                  ...);
            - focus-metavariable: $ORIGIN
      pattern-sources:
        - pattern: '[..., "*", ...]'
      severity: WARNING
    - id: python.flask.security.audit.app-run-param-config.avoid_app_run_with_bad_host
      languages:
        - python
      message: Running flask app with host 0.0.0.0 could expose the server publicly.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-668: Exposure of Resource to Wrong Sphere'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - flask
      pattern-either:
        - pattern: app.run(..., host="0.0.0.0", ...)
        - pattern: app.run(..., "0.0.0.0", ...)
      severity: WARNING
    - id: python.flask.security.audit.app-run-security-config.avoid_using_app_run_directly
      languages:
        - python
      message: top-level app.run(...) is ignored by flask. Consider putting app.run(...) behind a guard, like inside a function
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-668: Exposure of Resource to Wrong Sphere'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - flask
      patterns:
        - pattern-not-inside: |
            if __name__ == '__main__':
              ...
        - pattern-not-inside: |
            def $X(...):
              ...
        - pattern: app.run(...)
      severity: WARNING
    - id: python.flask.security.audit.debug-enabled.debug-enabled
      languages:
        - python
      message: Detected Flask app with debug=True. Do not deploy to production with this flag enabled as it will leak sensitive information. Instead, consider using Flask configuration variables or setting 'debug' using system environment variables.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-489: Active Debug Code'
        impact: MEDIUM
        likelihood: HIGH
        owasp: A06:2017 - Security Misconfiguration
        references:
            - https://labs.detectify.com/2015/10/02/how-patreon-got-hacked-publicly-exposed-werkzeug-debugger/
        subcategory:
            - vuln
        technology:
            - flask
      patterns:
        - pattern-inside: |
            import flask
            ...
        - pattern: $APP.run(..., debug=True, ...)
      severity: WARNING
    - id: python.flask.security.audit.directly-returned-format-string.directly-returned-format-string
      languages:
        - python
      message: Detected Flask route directly returning a formatted string. This is subject to cross-site scripting if user input can reach the string. Consider using the template engine instead and rendering pages with 'render_template()'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-not-inside: return "..."
            - pattern-either:
                - pattern: return "...".format(...)
                - pattern: return "..." % ...
                - pattern: return "..." + ...
                - pattern: return ... + "..."
                - pattern: return f"...{...}..."
                - patterns:
                    - pattern: return $X
                    - pattern-either:
                        - pattern-inside: |
                            $X = "...".format(...)
                            ...
                        - pattern-inside: |
                            $X = "..." % ...
                            ...
                        - pattern-inside: |
                            $X = "..." + ...
                            ...
                        - pattern-inside: |
                            $X = ... + "..."
                            ...
                        - pattern-inside: |
                            $X = f"...{...}..."
                            ...
                    - pattern-not-inside: |
                        $X = "..."
                        ...
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    @$APP.route(...)
                    def $FUNC(..., $PARAM, ...):
                      ...
                - pattern: $PARAM
            - pattern: |
                request.$FUNC.get(...)
            - pattern: |
                request.$FUNC(...)
            - pattern: request.$FUNC[...]
      severity: WARNING
    - id: python.flask.security.audit.render-template-string.render-template-string
      languages:
        - python
      message: Found a template created with string formatting. This is susceptible to server-side template injection and cross-site scripting attacks.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://nvisium.com/blog/2016/03/09/exploring-ssti-in-flask-jinja2.html
        subcategory:
            - audit
        technology:
            - flask
      pattern: flask.render_template_string(...)
      severity: WARNING
    - fix: "True"
      id: python.flask.security.audit.wtf-csrf-disabled.flask-wtf-csrf-disabled
      languages:
        - python
      message: Setting 'WTF_CSRF_ENABLED' to 'False' explicitly disables CSRF protection.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        functional-categories:
            - web::search::csrf-config::flask
            - web::search::csrf-config::flask-wtf
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://flask-wtf.readthedocs.io/en/1.2.x/csrf/
        subcategory:
            - audit
        technology:
            - flask
      options:
        symbolic_propagation: true
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $APP.config["WTF_CSRF_ENABLED"] = $FALSE
                    - pattern: $APP.config.WTF_CSRF_ENABLED = $FALSE
                    - patterns:
                        - pattern: |
                            $APP.config.$UPDATE(
                              ...,
                              WTF_CSRF_ENABLED = $FALSE,
                              ...
                            )
                        - pattern-not-inside: |
                            $APP.config.$UPDATE(
                                ...,
                                TESTING=True,
                                ...
                            )
                        - pattern-not-inside: |
                            $APP.config.$UPDATE(
                                ...,
                                DEBUG=True,
                                ...
                            )
                        - metavariable-regex:
                            metavariable: $UPDATE
                            regex: ^(update|from_mapping)$
                    - pattern: |
                        $OBJ = $CLASS()
                        ...
                        $OBJ.WTF_CSRF_ENABLED = $FALSE
                        ...
                        $APP.config.from_object($OBJ, ...)
                    - pattern: |
                        WTF_CSRF_ENABLED = $FALSE
                        ...
                        $APP.config.from_object(__name__)
                - metavariable-regex:
                    metavariable: $FALSE
                    regex: ^(False)$
                - focus-metavariable: $FALSE
      severity: WARNING
    - id: python.flask.security.dangerous-template-string.dangerous-template-string
      languages:
        - python
      message: Found a template created with string formatting. This is susceptible to server-side template injection and cross-site scripting attacks.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://nvisium.com/blog/2016/03/09/exploring-ssti-in-flask-jinja2.html
            - https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti
        subcategory:
            - audit
        technology:
            - flask
      pattern-either:
        - pattern: |
            $V = "...".format(...)
            ...
            flask.render_template_string($V, ...)
        - pattern: |
            $V = "...".format(...)
            ...
            return flask.render_template_string($V, ...), $MORE
        - pattern: |
            $V = "..." % $S
            ...
            flask.render_template_string($V, ...)
        - pattern: |
            $V = "..." % $S
            ...
            return flask.render_template_string($V, ...), $MORE
        - pattern: |
            $V = "..."
            ...
            $V += $O
            ...
            flask.render_template_string($V, ...)
        - pattern: |
            $V = "..."
            ...
            $V += $O
            ...
            return flask.render_template_string($V, ...), $MORE
        - pattern: |
            $V = f"...{$X}..."
            ...
            flask.render_template_string($V, ...)
        - pattern: |
            $V = f"...{$X}..."
            ...
            return flask.render_template_string($V, ...), $CODE
      severity: ERROR
    - id: python.flask.security.hashids-with-flask-secret.hashids-with-flask-secret
      languages:
        - python
      message: The Flask secret key is used as salt in HashIDs. The HashID mechanism is not secure. By observing sufficient HashIDs, the salt used to construct them can be recovered. This means the Flask secret key can be obtained by attackers, through the HashIDs.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A02:2021  Cryptographic Failures
        references:
            - https://flask.palletsprojects.com/en/2.2.x/config/#SECRET_KEY
            - http://carnage.github.io/2015/08/cryptanalysis-of-hashids
        subcategory:
            - vuln
        technology:
            - flask
      pattern-either:
        - pattern: hashids.Hashids(..., salt=flask.current_app.config['SECRET_KEY'], ...)
        - pattern: hashids.Hashids(flask.current_app.config['SECRET_KEY'], ...)
        - patterns:
            - pattern-inside: |
                $APP = flask.Flask(...)
                ...
            - pattern-either:
                - pattern: hashids.Hashids(..., salt=$APP.config['SECRET_KEY'], ...)
                - pattern: hashids.Hashids($APP.config['SECRET_KEY'], ...)
      severity: ERROR
    - id: python.flask.security.injection.csv-writer-injection.csv-writer-injection
      languages:
        - python
      message: Detected user input into a generated CSV file using the built-in `csv` module. If user data is used to generate the data in this file, it is possible that an attacker could inject a formula when the CSV is imported into a spreadsheet application that runs an attacker script, which could steal data from the importing user or, at worst, install malware on the user's computer. `defusedcsv` is a drop-in replacement with the same API that will attempt to mitigate formula injection attempts. You can use `defusedcsv` instead of `csv` to safely generate CSVs.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1236: Improper Neutralization of Formula Elements in a CSV File'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/raphaelm/defusedcsv
            - https://owasp.org/www-community/attacks/CSV_Injection
            - https://web.archive.org/web/20220516052229/https://www.contextis.com/us/blog/comma-separated-vulnerabilities
        subcategory:
            - vuln
        technology:
            - python
            - flask
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $WRITER = csv.writer(...)

                ...

                $WRITER.$WRITE(...)
            - pattern: $WRITER.$WRITE(...)
            - metavariable-regex:
                metavariable: $WRITE
                regex: ^(writerow|writerows|writeheader)$
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                - patterns:
                    - pattern-inside: |
                        @$APP.route($ROUTE, ...)
                        def $FUNC(..., $ROUTEVAR, ...):
                          ...
                    - focus-metavariable: $ROUTEVAR
      severity: ERROR
    - id: python.flask.security.injection.nan-injection.nan-injection
      languages:
        - python
      message: Found user input going directly into typecast for bool(), float(), or complex(). This allows an attacker to inject Python's not-a-number (NaN) into the typecast. This results in undefind behavior, particularly when doing comparisons. Either cast to a different type, or add a guard checking for all capitalizations of the string 'nan'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-704: Incorrect Type Conversion or Cast'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://discuss.python.org/t/nan-breaks-min-max-and-sorting-functions-a-solution/2868
            - https://blog.bitdiscovery.com/2021/12/python-nan-injection/
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      pattern-sanitizers:
        - not_conflicting: true
          pattern: $ANYTHING(...)
      pattern-sinks:
        - pattern-either:
            - pattern: float(...)
            - pattern: bool(...)
            - pattern: complex(...)
      pattern-sources:
        - pattern-either:
            - pattern: flask.request.$SOMETHING.get(...)
            - pattern: flask.request.$SOMETHING[...]
            - patterns:
                - pattern-inside: |
                    @$APP.route(...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                - pattern: $ROUTEVAR
      severity: ERROR
    - id: python.flask.security.injection.os-system-injection.os-system-injection
      languages:
        - python
      message: User data detected in os.system. This could be vulnerable to a command injection and should be avoided. If this must be done, use the 'subprocess' module instead and pass the arguments as a list.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/Command_Injection
        subcategory:
            - audit
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: os.system(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      os.system(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERM = <... $ROUTEVAR ...>
                      ...
                      os.system(..., <... $INTERM ...>, ...)
        - pattern: os.system(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: os.system(..., <... flask.request.$W[...] ...>, ...)
        - pattern: os.system(..., <... flask.request.$W(...) ...>, ...)
        - pattern: os.system(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                os.system(<... $INTERM ...>)
            - pattern: os.system(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                os.system(<... $INTERM ...>)
            - pattern: os.system(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                os.system(<... $INTERM ...>)
            - pattern: os.system(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                os.system(<... $INTERM ...>)
            - pattern: os.system(...)
      severity: ERROR
    - id: python.flask.security.injection.path-traversal-open.path-traversal-open
      languages:
        - python
      message: Found request data in a call to 'open'. Ensure the request data is validated or sanitized, otherwise it could result in path traversal attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        subcategory:
            - audit
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: open(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      open(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      with open(..., <... $ROUTEVAR ...>, ...) as $FD:
                        ...
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERM = <... $ROUTEVAR ...>
                      ...
                      open(..., <... $INTERM ...>, ...)
        - pattern: open(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: open(..., <... flask.request.$W[...] ...>, ...)
        - pattern: open(..., <... flask.request.$W(...) ...>, ...)
        - pattern: open(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                open(<... $INTERM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                open(<... $INTERM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                open(<... $INTERM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                open(<... $INTERM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                with open(<... $INTERM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                with open(<... $INTERM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                with open(<... $INTERM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                with open(<... $INTERM ...>, ...) as $F:
                  ...
            - pattern: open(...)
      severity: ERROR
    - id: python.flask.security.injection.raw-html-concat.raw-html-format
      languages:
        - python
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. To be sure this is safe, check that the HTML is rendered safely. Otherwise, use templates (`flask.render_template`) which will safely render HTML instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://flask.palletsprojects.com/en/2.0.x/security/#cross-site-scripting-xss
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      pattern-sanitizers:
        - pattern: jinja2.escape(...)
        - pattern: flask.escape(...)
        - pattern: flask.render_template("~=/.*\.html", ...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: '"$HTMLSTR" % ...'
                        - pattern: '"$HTMLSTR".format(...)'
                        - pattern: '"$HTMLSTR" + ...'
                        - pattern: f"$HTMLSTR{...}..."
                - patterns:
                    - pattern-inside: |
                        $HTML = "$HTMLSTR"
                        ...
                    - pattern-either:
                        - pattern: $HTML % ...
                        - pattern: $HTML.format(...)
                        - pattern: $HTML + ...
            - metavariable-pattern:
                language: generic
                metavariable: $HTMLSTR
                pattern: <$TAG ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: flask.request.$ANYTHING
                - patterns:
                    - pattern-inside: |
                        @$APP.route(...)
                        def $FUNC(..., $ROUTEVAR, ...):
                          ...
                    - pattern: $ROUTEVAR
      severity: WARNING
    - id: python.flask.security.injection.ssrf-requests.ssrf-requests
      languages:
        - python
      message: Data from request object is passed to a new server-side request. This could lead to a server-side request forgery (SSRF). To mitigate, ensure that schemes and hosts are validated against an allowlist, do not forward the response to the user, and ensure proper authentication and transport-layer security in the proxied request.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
        subcategory:
            - vuln
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: requests.$FUNC(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.$ROUTE_METHOD($ROUTE, ...)
                    def $ROUTE_FUNC(..., $ROUTEVAR, ...):
                      ...
                      requests.$FUNC(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.$ROUTE_METHOD($ROUTE, ...)
                    def $ROUTE_FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERM = <... $ROUTEVAR ...>
                      ...
                      requests.$FUNC(..., <... $INTERM ...>, ...)
            - metavariable-regex:
                metavariable: $ROUTE_METHOD
                regex: ^(route|get|post|put|delete|patch)$
        - pattern: requests.$FUNC(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: requests.$FUNC(..., <... flask.request.$W[...] ...>, ...)
        - pattern: requests.$FUNC(..., <... flask.request.$W(...) ...>, ...)
        - pattern: requests.$FUNC(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                requests.$FUNC(<... $INTERM ...>, ...)
            - pattern: requests.$FUNC(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                requests.$FUNC(<... $INTERM ...>, ...)
            - pattern: requests.$FUNC(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                requests.$FUNC(<... $INTERM ...>, ...)
            - pattern: requests.$FUNC(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                requests.$FUNC(<... $INTERM ...>, ...)
            - pattern: requests.$FUNC(...)
      severity: ERROR
    - id: python.flask.security.injection.subprocess-injection.subprocess-injection
      languages:
        - python
      message: Detected user input entering a `subprocess` call unsafely. This could result in a command injection vulnerability. An attacker could use this vulnerability to execute arbitrary commands on the host, which allows them to download malware, scan sensitive data, or run any command they wish on the server. Do not let users choose the command to run. In general, prefer to use Python API versions of system commands. If you must use subprocess, use a dictionary to allowlist a set of commands.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sanitizers:
        - patterns:
            - pattern: $DICT[$KEY]
            - focus-metavariable: $KEY
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: subprocess.$FUNC(...)
                    - pattern-not: subprocess.$FUNC("...", ...)
                    - pattern-not: subprocess.$FUNC(["...", ...], ...)
                    - pattern-not-inside: |
                        $CMD = ["...", ...]
                        ...
                        subprocess.$FUNC($CMD, ...)
                - patterns:
                    - pattern: subprocess.$FUNC(["$SHELL", "-c", ...], ...)
                    - metavariable-regex:
                        metavariable: $SHELL
                        regex: ^(sh|bash|ksh|csh|tcsh|zsh)$
                - patterns:
                    - pattern: subprocess.$FUNC(["$INTERPRETER", ...], ...)
                    - metavariable-regex:
                        metavariable: $INTERPRETER
                        regex: ^(python|python\d)$
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: flask.request.form.get(...)
                    - pattern: flask.request.form[...]
                    - pattern: flask.request.args.get(...)
                    - pattern: flask.request.args[...]
                    - pattern: flask.request.values.get(...)
                    - pattern: flask.request.values[...]
                    - pattern: flask.request.cookies.get(...)
                    - pattern: flask.request.cookies[...]
                    - pattern: flask.request.stream
                    - pattern: flask.request.headers.get(...)
                    - pattern: flask.request.headers[...]
                    - pattern: flask.request.data
                    - pattern: flask.request.full_path
                    - pattern: flask.request.url
                    - pattern: flask.request.json
                    - pattern: flask.request.get_json()
                    - pattern: flask.request.view_args.get(...)
                    - pattern: flask.request.view_args[...]
            - patterns:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                - focus-metavariable: $ROUTEVAR
      severity: ERROR
    - id: python.flask.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - python
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as SQLAlchemy which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-704: Incorrect Type Conversion or Cast'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.sqlalchemy.org/en/14/core/tutorial.html#using-textual-sql
            - https://www.tutorialspoint.com/sqlalchemy/sqlalchemy_quick_guide.htm
            - https://docs.sqlalchemy.org/en/14/core/tutorial.html#using-more-specific-text-with-table-expression-literal-column-and-expression-column
        subcategory:
            - vuln
        technology:
            - sqlalchemy
            - flask
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$SQLSTR" + ...
                - pattern: |
                    "$SQLSTR" % ...
                - pattern: |
                    "$SQLSTR".format(...)
                - pattern: |
                    f"$SQLSTR{...}..."
            - metavariable-regex:
                metavariable: $SQLSTR
                regex: \s*(?i)(select|delete|insert|create|update|alter|drop)\b.*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: flask.request.$ANYTHING
                - patterns:
                    - pattern-inside: |
                        @$APP.route(...)
                        def $FUNC(..., $ROUTEVAR, ...):
                          ...
                    - pattern: $ROUTEVAR
      severity: ERROR
    - id: python.flask.security.injection.tainted-url-host.tainted-url-host
      languages:
        - python
      message: User data flows into the host portion of this manually-constructed URL. This could allow an attacker to send data to their own server, potentially exposing sensitive data such as cookies or authorization information sent with this request. They could also probe internal servers or other resources that the server running this code can access. (This is called server-side request forgery, or SSRF.) Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - flask
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: '"$URLSTR" % ...'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $URLSTR
                        patterns:
                            - pattern-either:
                                - pattern: $SCHEME://%s
                                - pattern: $SCHEME://%r
                - patterns:
                    - pattern: '"$URLSTR".format(...)'
                    - metavariable-pattern:
                        language: generic
                        metavariable: $URLSTR
                        pattern: $SCHEME:// { ... }
                - patterns:
                    - pattern: '"$URLSTR" + ...'
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
                - patterns:
                    - pattern: f"$URLSTR{...}..."
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
                - patterns:
                    - pattern-inside: |
                        $URL = "$URLSTR"
                        ...
                    - pattern: $URL += ...
                    - metavariable-regex:
                        metavariable: $URLSTR
                        regex: .*://$
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: flask.request.$ANYTHING
                - patterns:
                    - pattern-inside: |
                        @$APP.route(...)
                        def $FUNC(..., $ROUTEVAR, ...):
                          ...
                    - pattern: $ROUTEVAR
      severity: WARNING
    - id: python.flask.security.injection.user-eval.eval-injection
      languages:
        - python
      message: Detected user data flowing into eval. This is code injection and should be avoided.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html
        subcategory:
            - vuln
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: eval(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      eval(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERM = <... $ROUTEVAR ...>
                      ...
                      eval(..., <... $INTERM ...>, ...)
        - pattern: eval(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: eval(..., <... flask.request.$W[...] ...>, ...)
        - pattern: eval(..., <... flask.request.$W(...) ...>, ...)
        - pattern: eval(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                eval(..., <... $INTERM ...>, ...)
            - pattern: eval(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                eval(..., <... $INTERM ...>, ...)
            - pattern: eval(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                eval(..., <... $INTERM ...>, ...)
            - pattern: eval(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                eval(..., <... $INTERM ...>, ...)
            - pattern: eval(...)
      severity: ERROR
    - id: python.flask.security.injection.user-exec.exec-injection
      languages:
        - python
      message: Detected user data flowing into exec. This is code injection and should be avoided.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://nedbatchelder.com/blog/201206/exec_really_is_dangerous.html
        subcategory:
            - vuln
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: exec(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      exec(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERM = <... $ROUTEVAR ...>
                      ...
                      exec(..., <... $INTERM ...>, ...)
        - pattern: exec(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: exec(..., <... flask.request.$W[...] ...>, ...)
        - pattern: exec(..., <... flask.request.$W(...) ...>, ...)
        - pattern: exec(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W.get(...) ...>
                ...
                exec(..., <... $INTERM ...>, ...)
            - pattern: exec(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W[...] ...>
                ...
                exec(..., <... $INTERM ...>, ...)
            - pattern: exec(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W(...) ...>
                ...
                exec(..., <... $INTERM ...>, ...)
            - pattern: exec(...)
        - patterns:
            - pattern-inside: |
                $INTERM = <... flask.request.$W ...>
                ...
                exec(..., <... $INTERM ...>, ...)
            - pattern: exec(...)
      severity: ERROR
    - id: python.flask.security.insecure-deserialization.insecure-deserialization
      languages:
        - python
      message: Detected the use of an insecure deserialization library in a Flask route. These libraries are prone to code execution vulnerabilities. Ensure user data does not enter this function. To fix this, try to avoid serializing whole objects. Consider instead using a serializer such as JSON.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - audit
        technology:
            - flask
      patterns:
        - pattern-inside: |
            @app.route(...)
            def $X(...):
              ...
        - pattern-not: $MODULE.$FUNC("...")
        - pattern-not: $MODULE.$FUNC(open("...", ...))
        - pattern-either:
            - pattern: pickle.$FUNC(...)
            - pattern: _pickle.$FUNC(...)
            - pattern: cPickle.$FUNC(...)
            - pattern: dill.$FUNC(...)
            - pattern: shelve.$FUNC(...)
            - pattern: yaml.load(...)
      severity: ERROR
    - id: python.flask.security.open-redirect.open-redirect
      languages:
        - python
      message: Data from request is passed to redirect(). This is an open redirect and could be exploited. Consider using 'url_for()' to generate links to known locations. If you must use a URL to unknown pages, consider using 'urlparse()' or similar and checking if the 'netloc' property is the same as your site's host name. See the references for more information.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://flask-login.readthedocs.io/en/latest/#login-example
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html#dangerous-url-redirect-example-1
            - https://docs.python.org/3/library/urllib.parse.html#url-parsing
        subcategory:
            - audit
        technology:
            - flask
      patterns:
        - pattern-inside: |
            @$APP.route(...)
            def $X(...):
              ...
        - pattern-not-inside: |
            @$APP.route(...)
            def $X(...):
              ...
              if <... werkzeug.urls.url_parse($V) ...>:
                ...
        - pattern-either:
            - pattern: flask.redirect(<... flask.request.$W.get(...) ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W[...] ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W(...) ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W ...>, ...)
            - pattern: |
                $V = flask.request.$W.get(...)
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W[...]
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W(...)
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W
                ...
                flask.redirect(<... $V ...>, ...)
        - pattern-not: flask.redirect(flask.request.path)
        - pattern-not: flask.redirect(flask.request.path + ...)
        - pattern-not: flask.redirect(f"{flask.request.path}...")
      severity: ERROR
    - id: python.flask.security.secure-static-file-serve.avoid_send_file_without_path_sanitization
      languages:
        - python
      message: Detected a user-controlled `filename` that could flow to `flask.send_file()` function. This could lead to an attacker reading arbitrary file from the system, leaking private information. Make sure to properly sanitize filename or use `flask.send_from_directory`
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-73: External Control of File Name or Path'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - audit
        technology:
            - flask
      patterns:
        - pattern-inside: |
            @app.route(...)
            def $X(filename):
              ...
        - pattern: flask.send_file(filename, ...)
      severity: WARNING
    - id: python.flask.security.unsanitized-input.response-contains-unsanitized-input
      languages:
        - python
      message: Flask response reflects unsanitized user input. This could lead to a cross-site scripting vulnerability (https://owasp.org/www-community/attacks/xss/) in which an attacker causes arbitrary code to be executed in the user's browser. To prevent, please sanitize the user input, e.g. by rendering the response in a Jinja2 template (see considerations in https://flask.palletsprojects.com/en/1.0.x/security/).
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://flask.palletsprojects.com/en/1.0.x/security/
            - https://owasp.org/www-community/attacks/xss/
        subcategory:
            - audit
        technology:
            - flask
      pattern-either:
        - pattern: |
            $X = flask.request.args.get(...)
            ...
            flask.make_response("...".format($X))
        - pattern: |
            $X = flask.request.args.get(...)
            ...
            flask.make_response(f"...{$X}...")
        - pattern: |
            $X = flask.request.args.get(...)
            ...
            flask.make_response(f"...{$X}")
        - pattern: |
            $X = flask.request.args.get(...)
            ...
            flask.make_response(f"{$X}...")
      severity: WARNING
    - fix: |
        True
      id: python.jinja2.security.audit.autoescape-disabled-false.incorrect-autoescape-disabled
      languages:
        - python
      message: Detected a Jinja2 environment with 'autoescaping' disabled. This is dangerous if you are rendering to a browser because this allows for cross-site scripting (XSS) attacks. If you are in a web context, enable 'autoescaping' by setting 'autoescape=True.' You may also consider using 'jinja2.select_autoescape()' to only enable automatic escaping for certain file extensions.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-116: Improper Encoding or Escaping of Output'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://jinja.palletsprojects.com/en/2.11.x/api/#basics
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b701_jinja2_autoescape_false.html
        subcategory:
            - vuln
        technology:
            - jinja2
      patterns:
        - pattern: jinja2.Environment(... , autoescape=$VAL, ...)
        - pattern-not: jinja2.Environment(... , autoescape=True, ...)
        - pattern-not: jinja2.Environment(... , autoescape=jinja2.select_autoescape(...), ...)
        - focus-metavariable: $VAL
      severity: WARNING
    - fix-regex:
        regex: (.*)\)
        replacement: \1, autoescape=True)
      id: python.jinja2.security.audit.missing-autoescape-disabled.missing-autoescape-disabled
      languages:
        - python
      message: Detected a Jinja2 environment without autoescaping. Jinja2 does not autoescape by default. This is dangerous if you are rendering to a browser because this allows for cross-site scripting (XSS) attacks. If you are in a web context, enable autoescaping by setting 'autoescape=True.' You may also consider using 'jinja2.select_autoescape()' to only enable automatic escaping for certain file extensions.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-116: Improper Encoding or Escaping of Output'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://jinja.palletsprojects.com/en/2.11.x/api/#basics
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b701_jinja2_autoescape_false.html
        subcategory:
            - vuln
        technology:
            - jinja2
      patterns:
        - pattern-not: jinja2.Environment(..., autoescape=$VAL, ...)
        - pattern: jinja2.Environment(...)
      severity: WARNING
    - id: python.jwt.security.jwt-exposed-credentials.jwt-python-exposed-credentials
      languages:
        - python
      message: Password is exposed through JWT token payload. This is not encrypted and the password could be compromised. Do not store passwords in JWT tokens.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://cwe.mitre.org/data/definitions/522.html
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      pattern-either:
        - pattern: |
            jwt.encode({...,"password":$P,...},...)
        - pattern: |
            $PAYLOAD = {...,"password":$P,...}
            ...
            jwt.encode($PAYLOAD,...)
      severity: ERROR
    - id: python.jwt.security.jwt-hardcode.jwt-python-hardcoded-secret
      languages:
        - python
      message: 'Hardcoded JWT secret or private key is used. This is a Insufficiently Protected Credentials weakness: https://cwe.mitre.org/data/definitions/522.html Consider using an appropriate security mechanism to protect the credentials (e.g. keeping secrets in environment variables)'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      patterns:
        - pattern: |
            jwt.encode($X, $SECRET, ...)
        - focus-metavariable: $SECRET
        - pattern: |
            "..."
      severity: ERROR
    - id: python.jwt.security.jwt-none-alg.jwt-python-none-alg
      languages:
        - python
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      pattern-either:
        - pattern: |
            jwt.encode(...,algorithm="none",...)
        - pattern: jwt.decode(...,algorithms=[...,"none",...],...)
      severity: ERROR
    - fix: |
        True
      id: python.jwt.security.unverified-jwt-decode.unverified-jwt-decode
      languages:
        - python
      message: Detected JWT token decoded with 'verify=False'. This bypasses any integrity checks for the token which means the token could be tampered with by malicious actors. Ensure that the JWT token is verified.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-287: Improper Authentication'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://github.com/we45/Vulnerable-Flask-App/blob/752ee16087c0bfb79073f68802d907569a1f0df7/app/app.py#L96
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    jwt.decode(..., options={..., "verify_signature": $BOOL, ...}, ...)
                - metavariable-pattern:
                    metavariable: $BOOL
                    pattern: |
                        False
                - focus-metavariable: $BOOL
            - patterns:
                - pattern: |
                    $OPTS = {..., "verify_signature": $BOOL, ...}
                    ...
                    jwt.decode(..., options=$OPTS, ...)
                - metavariable-pattern:
                    metavariable: $BOOL
                    pattern: |
                        False
                - focus-metavariable: $BOOL
      severity: ERROR
    - id: python.lang.correctness.tempfile.mktemp.tempfile-insecure
      languages:
        - python
      message: 'Use tempfile.NamedTemporaryFile instead. From the official Python documentation: THIS FUNCTION IS UNSAFE AND SHOULD NOT BE USED. The file name may refer to a file that did not exist at some point, but by the time you get around to creating it, someone else may have beaten you to the punch.'
      metadata:
        category: correctness
        technology:
            - python
      pattern: tempfile.mktemp(...)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-asyncio-create-exec-audit.dangerous-asyncio-create-exec-audit
      languages:
        - python
      message: Detected 'create_subprocess_exec' function without a static string. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html#asyncio.create_subprocess_exec
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - patterns:
            - pattern-not: asyncio.create_subprocess_exec($PROG, "...", ...)
            - pattern-not: asyncio.create_subprocess_exec($PROG, ["...",...], ...)
            - pattern: asyncio.create_subprocess_exec(...)
        - patterns:
            - pattern-not: asyncio.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...)
            - pattern: asyncio.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c",...)
        - patterns:
            - pattern-not: asyncio.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...], ...)
            - pattern: asyncio.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...], ...)
        - patterns:
            - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, "...", ...)
            - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, ["...",...], ...)
            - pattern: asyncio.subprocess.create_subprocess_exec(...)
        - patterns:
            - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...)
            - pattern: asyncio.subprocess.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c",...)
        - patterns:
            - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...], ...)
            - pattern: asyncio.subprocess.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...], ...)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-asyncio-create-exec-tainted-env-args.dangerous-asyncio-create-exec-tainted-env-args
      languages:
        - python
      message: Detected 'create_subprocess_exec' function with user controlled data. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html#asyncio.create_subprocess_exec
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-not: asyncio.create_subprocess_exec($PROG, "...", ...)
                - pattern-not: asyncio.create_subprocess_exec($PROG, ["...",...], ...)
                - pattern: asyncio.create_subprocess_exec(...)
            - patterns:
                - pattern-not: asyncio.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...)
                - pattern: asyncio.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c",...)
            - patterns:
                - pattern-not: asyncio.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...], ...)
                - pattern: asyncio.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...], ...)
            - patterns:
                - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, "...", ...)
                - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, ["...",...], ...)
                - pattern: asyncio.subprocess.create_subprocess_exec(...)
            - patterns:
                - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c",...)
            - patterns:
                - pattern-not: asyncio.subprocess.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...], ...)
                - pattern: asyncio.subprocess.create_subprocess_exec($PROG, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...], ...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-asyncio-exec-tainted-env-args.dangerous-asyncio-exec-tainted-env-args
      languages:
        - python
      message: Detected subprocess function '$LOOP.subprocess_exec' with user controlled data. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.subprocess_exec
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-not: $LOOP.subprocess_exec($PROTOCOL, "...", ...)
                - pattern-not: $LOOP.subprocess_exec($PROTOCOL, ["...",...], ...)
                - pattern: $LOOP.subprocess_exec(...)
            - patterns:
                - pattern-not: $LOOP.subprocess_exec($PROTOCOL, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...)
                - pattern: $LOOP.subprocess_exec($PROTOCOL, "=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c",...)
            - patterns:
                - pattern-not: $LOOP.subprocess_exec($PROTOCOL, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", "...", ...], ...)
                - pattern: $LOOP.subprocess_exec($PROTOCOL, ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...], ...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-asyncio-shell-audit.dangerous-asyncio-shell-audit
      languages:
        - python
      message: Detected asyncio subprocess function without a static string. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: $LOOP.subprocess_shell($PROTOCOL, $CMD)
            - pattern: asyncio.subprocess.create_subprocess_shell($CMD, ...)
            - pattern: asyncio.create_subprocess_shell($CMD, ...)
        - pattern-not-inside: |
            $CMD = "..."
            ...
        - pattern-not: $LOOP.subprocess_shell($PROTOCOL, "...")
        - pattern-not: asyncio.subprocess.create_subprocess_shell("...", ...)
        - pattern-not: asyncio.create_subprocess_shell("...", ...)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-asyncio-shell-tainted-env-args.dangerous-asyncio-shell-tainted-env-args
      languages:
        - python
      message: Detected asyncio subprocess function with user controlled data. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.python.org/3/library/asyncio-subprocess.html
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: $LOOP.subprocess_shell($PROTOCOL, $CMD)
                - pattern-inside: asyncio.subprocess.create_subprocess_shell($CMD, ...)
                - pattern-inside: asyncio.create_subprocess_shell($CMD, ...)
            - focus-metavariable: $CMD
            - pattern-not-inside: |
                $CMD = "..."
                ...
            - pattern-not: $LOOP.subprocess_shell($PROTOCOL, "...")
            - pattern-not: asyncio.subprocess.create_subprocess_shell("...", ...)
            - pattern-not: asyncio.create_subprocess_shell("...", ...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-code-run-audit.dangerous-interactive-code-run-audit
      languages:
        - python
      message: Found dynamic content inside InteractiveConsole/InteractiveInterpreter method. This is dangerous if external data can reach this function call because it allows a malicious actor to run arbitrary Python code. Ensure no external data reaches here.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: |
                $X.push($PAYLOAD,...)
            - pattern: |
                $X.runsource($PAYLOAD,...)
            - pattern: |
                $X.runcode(code.compile_command($PAYLOAD),...)
            - pattern: |
                $PL = code.compile_command($PAYLOAD,...)
                ...
                $X.runcode($PL,...)
        - pattern-either:
            - pattern-inside: |
                $X = code.InteractiveConsole(...)
                ...
            - pattern-inside: |
                $X = code.InteractiveInterpreter(...)
                ...
        - pattern-not: |
            $X.push("...",...)
        - pattern-not: |
            $X.runsource("...",...)
        - pattern-not: |
            $X.runcode(code.compile_command("..."),...)
        - pattern-not: |
            $PL = code.compile_command("...",...)
            ...
            $X.runcode($PL,...)
      severity: WARNING
    - id: python.lang.security.audit.dangerous-code-run-tainted-env-args.dangerous-interactive-code-run-tainted-env-args
      languages:
        - python
      message: Found user controlled data inside InteractiveConsole/InteractiveInterpreter method. This is dangerous if external data can reach this function call because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $X = code.InteractiveConsole(...)
                    ...
                - pattern-inside: |
                    $X = code.InteractiveInterpreter(...)
                    ...
            - pattern-either:
                - pattern-inside: |
                    $X.push($PAYLOAD,...)
                - pattern-inside: |
                    $X.runsource($PAYLOAD,...)
                - pattern-inside: |
                    $X.runcode(code.compile_command($PAYLOAD),...)
                - pattern-inside: |
                    $PL = code.compile_command($PAYLOAD,...)
                    ...
                    $X.runcode($PL,...)
            - pattern: $PAYLOAD
            - pattern-not: |
                $X.push("...",...)
            - pattern-not: |
                $X.runsource("...",...)
            - pattern-not: |
                $X.runcode(code.compile_command("..."),...)
            - pattern-not: |
                $PL = code.compile_command("...",...)
                ...
                $X.runcode($PL,...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: WARNING
    - id: python.lang.security.audit.dangerous-os-exec-audit.dangerous-os-exec-audit
      languages:
        - python
      message: Found dynamic content when spawning a process. This is dangerous if external data can reach this function call because it allows a malicious actor to execute commands. Ensure no external data reaches here.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - patterns:
            - pattern-not: os.$METHOD("...", ...)
            - pattern: os.$METHOD(...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (execl|execle|execlp|execlpe|execv|execve|execvp|execvpe)
        - patterns:
            - pattern-not: os.$METHOD("...", [$PATH,"...","...",...],...)
            - pattern: os.$METHOD($BASH,[$PATH,"-c",$CMD,...],...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (execv|execve|execvp|execvpe)
            - metavariable-regex:
                metavariable: $BASH
                regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
        - patterns:
            - pattern-not: os.$METHOD("...", $PATH, "...", "...",...)
            - pattern: os.$METHOD($BASH, $PATH, "-c", $CMD,...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (execl|execle|execlp|execlpe)
            - metavariable-regex:
                metavariable: $BASH
                regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-os-exec-tainted-env-args.dangerous-os-exec-tainted-env-args
      languages:
        - python
      message: Found user controlled content when spawning a process. This is dangerous because it allows a malicious actor to execute commands.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: os.$METHOD("...", ...)
                    - pattern: os.$METHOD(...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execl|execle|execlp|execlpe|execv|execve|execvp|execvpe)
                - patterns:
                    - pattern-not: os.$METHOD("...", [$PATH,"...","...",...],...)
                    - pattern-inside: os.$METHOD($BASH,[$PATH,"-c",$CMD,...],...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execv|execve|execvp|execvpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
                - patterns:
                    - pattern-not: os.$METHOD("...", $PATH, "...", "...",...)
                    - pattern-inside: os.$METHOD($BASH, $PATH, "-c", $CMD,...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execl|execle|execlp|execlpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-spawn-process-audit.dangerous-spawn-process-audit
      languages:
        - python
      message: Found dynamic content when spawning a process. This is dangerous if external data can reach this function call because it allows a malicious actor to execute commands. Ensure no external data reaches here.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - patterns:
            - pattern-not: os.$METHOD($MODE, "...", ...)
            - pattern: os.$METHOD(...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (spawnl|spawnle|spawnlp|spawnlpe|spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp|startfile)
        - patterns:
            - pattern-not: os.$METHOD($MODE, "...", ["...","...",...], ...)
            - pattern: os.$METHOD($MODE, $BASH, ["-c",$CMD,...],...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp)
            - metavariable-regex:
                metavariable: $BASH
                regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
        - patterns:
            - pattern-not: os.$METHOD($MODE, "...", "...", "...", ...)
            - pattern: os.$METHOD($MODE, $BASH, "-c", $CMD,...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: (spawnl|spawnle|spawnlp|spawnlpe)
            - metavariable-regex:
                metavariable: $BASH
                regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-spawn-process-tainted-env-args.dangerous-spawn-process-tainted-env-args
      languages:
        - python
      message: Found user controlled content when spawning a process. This is dangerous because it allows a malicious actor to execute commands.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", ...)
                    - pattern-inside: os.$METHOD($MODE, $CMD, ...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe|spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp|startfile)
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", ["...","...",...], ...)
                    - pattern-inside: os.$METHOD($MODE, $BASH, ["-c",$CMD,...],...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", "...", "...", ...)
                    - pattern-inside: os.$METHOD($MODE, $BASH, "-c", $CMD,...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-subinterpreters-run-string-audit.dangerous-subinterpreters-run-string-audit
      languages:
        - python
      message: Found dynamic content in `run_string`. This is dangerous if external data can reach this function call because it allows a malicious actor to run arbitrary Python code. Ensure no external data reaches here.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://bugs.python.org/issue43472
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern: |
            _xxsubinterpreters.run_string($ID, $PAYLOAD, ...)
        - pattern-not: |
            _xxsubinterpreters.run_string($ID, "...", ...)
      severity: WARNING
    - id: python.lang.security.audit.dangerous-subinterpreters-run-string-tainted-env-args.dangerous-subinterpreters-run-string-tainted-env-args
      languages:
        - python
      message: Found user controlled content in `run_string`. This is dangerous because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://bugs.python.org/issue43472
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                _xxsubinterpreters.run_string($ID, $PAYLOAD, ...)
            - pattern-not: |
                _xxsubinterpreters.run_string($ID, "...", ...)
            - pattern: $PAYLOAD
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: WARNING
    - id: python.lang.security.audit.dangerous-subprocess-use-audit.dangerous-subprocess-use-audit
      languages:
        - python
      message: Detected subprocess function '$FUNC' without a static string. If this data can be controlled by a malicious actor, it may be an instance of command injection. Audit the use of this call to ensure it is not controllable by an external resource. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/3172470/actual-meaning-of-shell-true-in-subprocess
            - https://docs.python.org/3/library/subprocess.html
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - patterns:
            - pattern-not: subprocess.$FUNC("...", ...)
            - pattern-not: subprocess.$FUNC(["...",...], ...)
            - pattern-not: subprocess.$FUNC(("...",...), ...)
            - pattern-not:
                patterns:
                    - pattern-not-inside: |
                        $ARR = ["=~/(sh|bash|ksh|csh|tcsh|zsh)/", "-c", ...]
                        ...
                    - pattern-inside: |
                        $ARR = [...]
                        ...
                    - pattern-either:
                        - pattern: subprocess.$FUNC(*$ARR, ...)
                        - pattern: subprocess.$FUNC([*$ARR, ...])
            - pattern-not: subprocess.CalledProcessError(...)
            - pattern-not: subprocess.SubprocessError(...)
            - pattern: subprocess.$FUNC(...)
        - patterns:
            - pattern: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",...)
            - pattern-not: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...)
        - patterns:
            - pattern-either:
                - pattern: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",...],...)
                - pattern: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c",...),...)
            - pattern-not: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...],...)
            - pattern-not: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...),...)
        - patterns:
            - pattern: subprocess.$FUNC("=~/(python)/",...)
            - pattern-not: subprocess.$FUNC("=~/(python)/","...",...)
        - patterns:
            - pattern-either:
                - pattern: subprocess.$FUNC(["=~/(python)/",...],...)
                - pattern: subprocess.$FUNC(("=~/(python)/",...),...)
            - pattern-not: subprocess.$FUNC(["=~/(python)/","...",...],...)
            - pattern-not: subprocess.$FUNC(("=~/(python)/","...",...),...)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-subprocess-use-tainted-env-args.dangerous-subprocess-use-tainted-env-args
      languages:
        - python
      message: Detected subprocess function '$FUNC' with user controlled data. A malicious actor could leverage this to perform command injection. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/3172470/actual-meaning-of-shell-true-in-subprocess
            - https://docs.python.org/3/library/subprocess.html
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: subprocess.$FUNC("...", ...)
                    - pattern-not: subprocess.$FUNC(["...",...], ...)
                    - pattern-not: subprocess.$FUNC(("...",...), ...)
                    - pattern-not: subprocess.CalledProcessError(...)
                    - pattern-not: subprocess.SubprocessError(...)
                    - pattern: subprocess.$FUNC($CMD, ...)
                - patterns:
                    - pattern-not: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...)
                    - pattern: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD)
                - patterns:
                    - pattern-not: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...],...)
                    - pattern-not: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...),...)
                    - pattern-either:
                        - pattern: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD], ...)
                        - pattern: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD), ...)
                - patterns:
                    - pattern-not: subprocess.$FUNC("=~/(python)/","...",...)
                    - pattern: subprocess.$FUNC("=~/(python)/", $CMD)
                - patterns:
                    - pattern-not: subprocess.$FUNC(["=~/(python)/","...",...],...)
                    - pattern-not: subprocess.$FUNC(("=~/(python)/","...",...),...)
                    - pattern-either:
                        - pattern: subprocess.$FUNC(["=~/(python)/", $CMD],...)
                        - pattern: subprocess.$FUNC(("=~/(python)/", $CMD),...)
            - focus-metavariable: $CMD
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-system-call-audit.dangerous-system-call-audit
      languages:
        - python
      message: Found dynamic content used in a system call. This is dangerous if external data can reach this function call because it allows a malicious actor to execute commands. Use the 'subprocess' module instead, which is easier to use without accidentally exposing a command injection vulnerability.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-not: os.$W("...", ...)
        - pattern-either:
            - pattern: os.system(...)
            - pattern: getattr(os, "system")(...)
            - pattern: __import__("os").system(...)
            - pattern: getattr(__import__("os"), "system")(...)
            - pattern: |
                $X = __import__("os")
                ...
                $X.system(...)
            - pattern: |
                $X = __import__("os")
                ...
                getattr($X, "system")(...)
            - pattern: |
                $X = getattr(os, "system")
                ...
                $X(...)
            - pattern: |
                $X = __import__("os")
                ...
                $Y = getattr($X, "system")
                ...
                $Y(...)
            - pattern: os.popen(...)
            - pattern: os.popen2(...)
            - pattern: os.popen3(...)
            - pattern: os.popen4(...)
      severity: ERROR
    - id: python.lang.security.audit.dangerous-system-call-tainted-env-args.dangerous-system-call-tainted-env-args
      languages:
        - python
      message: Found user-controlled data used in a system call. This could allow a malicious actor to execute commands. Use the 'subprocess' module instead, which is easier to use without accidentally exposing a command injection vulnerability.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-not: os.$W("...", ...)
            - pattern-either:
                - pattern: os.system(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    $X.system(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    getattr($X, "system")(...)
                - pattern: |
                    $X = getattr(os, "system")
                    ...
                    $X(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    $Y = getattr($X, "system")
                    ...
                    $Y(...)
                - pattern: os.popen(...)
                - pattern: os.popen2(...)
                - pattern: os.popen3(...)
                - pattern: os.popen4(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.audit.dangerous-testcapi-run-in-subinterp-audit.dangerous-testcapi-run-in-subinterp-audit
      languages:
        - python
      message: Found dynamic content in `run_in_subinterp`. This is dangerous if external data can reach this function call because it allows a malicious actor to run arbitrary Python code. Ensure no external data reaches here.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: |
                _testcapi.run_in_subinterp($PAYLOAD, ...)
            - pattern: |
                test.support.run_in_subinterp($PAYLOAD, ...)
        - pattern-not: |
            _testcapi.run_in_subinterp("...", ...)
        - pattern-not: |
            test.support.run_in_subinterp("...", ...)
      severity: WARNING
    - id: python.lang.security.audit.dangerous-testcapi-run-in-subinterp-tainted-env-args.dangerous-testcapi-run-in-subinterp-tainted-env-args
      languages:
        - python
      message: Found user controlled content in `run_in_subinterp`. This is dangerous because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    _testcapi.run_in_subinterp($PAYLOAD, ...)
                - pattern-inside: |
                    test.support.run_in_subinterp($PAYLOAD, ...)
            - pattern: $PAYLOAD
            - pattern-not: |
                _testcapi.run_in_subinterp("...", ...)
            - pattern-not: |
                test.support.run_in_subinterp("...", ...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: os.environ
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv
                                - pattern: sys.orig_argv
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: WARNING
    - id: python.lang.security.audit.eval-detected.eval-detected
      languages:
        - python
      message: Detected the use of eval(). eval() can be dangerous if used to evaluate dynamic content. If this content can be input from outside the program, this may be a code injection vulnerability. Ensure evaluated content is not definable by external sources.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://bandit.readthedocs.io/en/latest/blacklists/blacklist_calls.html#b307-eval
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-not: eval(f"")
        - pattern-not: eval("...")
        - pattern: eval(...)
      severity: WARNING
    - id: python.lang.security.audit.exec-detected.exec-detected
      languages:
        - python
      message: Detected the use of exec(). exec() can be dangerous if used to evaluate dynamic content. If this content can be input from outside the program, this may be a code injection vulnerability. Ensure evaluated content is not definable by external sources.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b102_exec_used.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-not: exec("...")
        - pattern: exec(...)
      severity: WARNING
    - id: python.lang.security.audit.formatted-sql-query.formatted-sql-query
      languages:
        - python
      message: Detected possible formatted SQL query. Use parameterized queries instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/775296/mysql-parameterized-queries
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - pattern: $DB.execute("..." % ...)
        - pattern: $DB.execute("...".format(...))
        - pattern: $DB.execute(f"...")
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $SQL = "..." % ...
                    ...
                - pattern-inside: |
                    $SQL = "...".format(...)
                    ...
                - pattern-inside: |
                    $SQL = f"...{$X}..."
                    ...
            - pattern: $DB.execute($SQL)
      severity: WARNING
    - id: python.lang.security.audit.insecure-file-permissions.insecure-file-permissions
      languages:
        - python
      message: These permissions `$BITS` are widely permissive and grant access to more people than may be necessary. A good default is `0o644` which gives read and write access to yourself and read access to everyone else.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-276: Incorrect Default Permissions'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern-inside: os.$METHOD(...)
        - metavariable-pattern:
            metavariable: $METHOD
            patterns:
                - pattern-either:
                    - pattern: chmod
                    - pattern: lchmod
                    - pattern: fchmod
        - pattern-either:
            - patterns:
                - pattern: os.$METHOD($FILE, $BITS, ...)
                - metavariable-comparison:
                    comparison: $BITS >= 0o650 and $BITS < 0o100000
                    metavariable: $BITS
            - patterns:
                - pattern: os.$METHOD($FILE, $BITS)
                - metavariable-comparison:
                    comparison: $BITS >= 0o100650
                    metavariable: $BITS
            - patterns:
                - pattern: os.$METHOD($FILE, $BITS, ...)
                - metavariable-pattern:
                    metavariable: $BITS
                    patterns:
                        - pattern-either:
                            - pattern: <... stat.S_IWGRP ...>
                            - pattern: <... stat.S_IXGRP ...>
                            - pattern: <... stat.S_IWOTH ...>
                            - pattern: <... stat.S_IXOTH ...>
                            - pattern: <... stat.S_IRWXO ...>
                            - pattern: <... stat.S_IRWXG ...>
            - patterns:
                - pattern: os.$METHOD($FILE, $EXPR | $MOD, ...)
                - metavariable-comparison:
                    comparison: $MOD == 0o111
                    metavariable: $MOD
      severity: WARNING
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: python.lang.security.audit.insecure-transport.requests.request-session-http-in-with-context.request-session-http-in-with-context
      languages:
        - python
      message: Detected a request using 'http://'. This request will be unencrypted. Use 'https://' instead.
      metadata:
        asvs:
            control_id: 9.2.1 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - requests
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                with requests.Session(...) as $SESSION:
                  ...
            - pattern-either:
                - pattern: $SESSION.$W($SINK, ...)
                - pattern: $SESSION.request($METHOD, $SINK, ...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern: |
                "$URL"
            - metavariable-pattern:
                language: regex
                metavariable: $URL
                patterns:
                    - pattern-regex: http://
                    - pattern-not-regex: .*://localhost
                    - pattern-not-regex: .*://127\.0\.0\.1
      severity: INFO
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: python.lang.security.audit.insecure-transport.requests.request-session-with-http.request-session-with-http
      languages:
        - python
      message: Detected a request using 'http://'. This request will be unencrypted. Use 'https://' instead.
      metadata:
        asvs:
            control_id: 9.1.1 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - requests
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: requests.Session(...).$W($SINK, ...)
                - pattern: requests.Session(...).request($METHOD, $SINK, ...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern: |
                "$URL"
            - metavariable-pattern:
                language: regex
                metavariable: $URL
                patterns:
                    - pattern-regex: http://
                    - pattern-not-regex: .*://localhost
                    - pattern-not-regex: .*://127\.0\.0\.1
      severity: INFO
    - fix-regex:
        count: 1
        regex: '[Hh][Tt][Tt][Pp]://'
        replacement: https://
      id: python.lang.security.audit.insecure-transport.requests.request-with-http.request-with-http
      languages:
        - python
      message: Detected a request using 'http://'. This request will be unencrypted, and attackers could listen into traffic on the network and be able to obtain sensitive information. Use 'https://' instead.
      metadata:
        asvs:
            control_id: 9.1.1 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v92-server-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - requests
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: requests.$W($SINK, ...)
                - pattern: requests.request($METHOD, $SINK, ...)
                - pattern: requests.Request($METHOD, $SINK, ...)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern: |
                "$URL"
            - metavariable-pattern:
                language: regex
                metavariable: $URL
                patterns:
                    - pattern-regex: http://
                    - pattern-not-regex: .*://localhost
                    - pattern-not-regex: .*://127\.0\.0\.1
      severity: INFO
    - id: python.lang.security.audit.logging.logger-credential-leak.python-logger-credential-disclosure
      languages:
        - python
      message: Detected a python logger call with a potential hardcoded secret $FORMAT_STRING being logged. This may lead to secret credentials being exposed. Make sure that the logger is not logging  sensitive information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-532: Insertion of Sensitive Information into Log File'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A09:2021 - Security Logging and Monitoring Failures
        references:
            - https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern: |
            $LOGGER_OBJ.$LOGGER_CALL($FORMAT_STRING,...)
        - metavariable-regex:
            metavariable: $LOGGER_OBJ
            regex: (?i)(_logger|logger|self.logger|log)
        - metavariable-regex:
            metavariable: $LOGGER_CALL
            regex: (debug|info|warn|warning|error|exception|critical)
        - metavariable-regex:
            metavariable: $FORMAT_STRING
            regex: (?i).*(api.key|secret|credential|token|password).*\%s.*
      severity: WARNING
    - id: python.lang.security.audit.md5-used-as-password.md5-used-as-password
      languages:
        - python
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Use a suitable password hashing function such as scrypt. You can use `hashlib.scrypt`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc6151
            - https://crypto.stackexchange.com/questions/44151/how-does-the-flame-malware-take-advantage-of-md5-collision
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
            - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
            - https://github.com/returntocorp/semgrep-rules/issues/1609
            - https://docs.python.org/3/library/hashlib.html#hashlib.scrypt
        subcategory:
            - vuln
        technology:
            - pycryptodome
            - hashlib
            - md5
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $FUNCTION(...)
            - metavariable-regex:
                metavariable: $FUNCTION
                regex: (?i)(.*password.*)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: hashlib.md5
                - pattern: hashlib.new(..., name="MD5", ...)
                - pattern: Cryptodome.Hash.MD5
                - pattern: Crypto.Hash.MD5
                - pattern: cryptography.hazmat.primitives.hashes.MD5
      severity: WARNING
    - id: python.lang.security.audit.network.bind.avoid-bind-to-all-interfaces
      languages:
        - python
      message: Running `socket.bind` to 0.0.0.0, or empty string could unexpectedly expose the server publicly as it binds to all available interfaces. Consider instead getting correct address from an environment variable or configuration file.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - python
      pattern-either:
        - pattern: |
            $S = socket.socket(...)
            ...
            $S.bind(("0.0.0.0", ...))
        - pattern: |
            $S = socket.socket(...)
            ...
            $S.bind(("::", ...))
        - pattern: |
            $S = socket.socket(...)
            ...
            $S.bind(("", ...))
      severity: INFO
    - id: python.lang.security.audit.network.disabled-cert-validation.disabled-cert-validation
      languages:
        - python
      message: certificate verification explicitly disabled, insecure connections possible
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: urllib3.PoolManager(..., cert_reqs=$REQS, ...)
            - pattern: urllib3.ProxyManager(..., cert_reqs=$REQS, ...)
            - pattern: urllib3.HTTPSConnectionPool(..., cert_reqs=$REQS, ...)
            - pattern: urllib3.connectionpool.HTTPSConnectionPool(..., cert_reqs=$REQS, ...)
            - pattern: urllib3.connection_from_url(..., cert_reqs=$REQS, ...)
            - pattern: urllib3.proxy_from_url(..., cert_reqs=$REQS, ...)
            - pattern: $CONTEXT.wrap_socket(..., cert_reqs=$REQS, ...)
            - pattern: ssl.wrap_socket(..., cert_reqs=$REQS, ...)
        - metavariable-regex:
            metavariable: $REQS
            regex: (NONE|CERT_NONE|CERT_OPTIONAL|ssl\.CERT_NONE|ssl\.CERT_OPTIONAL|\'NONE\'|\"NONE\"|\'OPTIONAL\'|\"OPTIONAL\")
      severity: ERROR
    - id: python.lang.security.audit.network.http-not-https-connection.http-not-https-connection
      languages:
        - python
      message: Detected HTTPConnectionPool. This will transmit data in cleartext. It is recommended to use HTTPSConnectionPool instead for to encrypt communications.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://urllib3.readthedocs.io/en/1.2.1/pools.html#urllib3.connectionpool.HTTPSConnectionPool
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - pattern: urllib3.HTTPConnectionPool(...)
        - pattern: urllib3.connectionpool.HTTPConnectionPool(...)
      severity: ERROR
    - id: python.lang.security.audit.non-literal-import.non-literal-import
      languages:
        - python
      message: Untrusted user input in `importlib.import_module()` function allows an attacker to load arbitrary code. Avoid dynamic values in `importlib.import_module()` or use a whitelist to prevent running untrusted code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-706: Use of Incorrectly-Resolved Name or Reference'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern: |
            importlib.import_module($NAME, ...)
        - pattern-not: |
            importlib.import_module("...", ...)
      severity: WARNING
    - id: python.lang.security.audit.python-reverse-shell.python-reverse-shell
      languages:
        - python
      message: Semgrep found a Python reverse shell using $BINPATH to $IP at $PORT
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-553: Command Shell in Externally Accessible Directory'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/553.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: pty.spawn("$BINPATH",...)
            - pattern: subprocess.call(["$BINPATH",...],...)
        - metavariable-regex:
            metavariable: $BINPATH
            regex: /bin/.*?sh\b
        - pattern-inside: |
            import socket
            ...
            $S = socket.socket(...)
            ...
            $S.connect(($IP,$PORT),...)
            ...
      severity: WARNING
    - id: python.lang.security.audit.regex-dos.regex_dos
      languages:
        - python
      message: Detected usage of re.compile with an inefficient regular expression. This can lead to regular expression denial of service, which can result in service down time. Instead, check all regexes or use safer alternatives such as pyre2.
      metadata:
        category: security
        confidence: LOW
        cwe: 'CWE-1333: Inefficient Regular Expression Complexity'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp: A06:2017 - Security Misconfiguration
        references:
            - https://docs.python.org/3/library/re.html
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern: |
            $A = re.compile("$B", ...)
            ...
            $A.$METHOD(...)
        - metavariable-analysis:
            analyzer: redos
            metavariable: $B
        - metavariable-regex:
            metavariable: $METHOD
            regex: (?!(escape)|(purge))
      severity: WARNING
    - id: python.lang.security.audit.sqli.aiopg-sqli.aiopg-sqli
      languages:
        - python
      message: 'Detected string concatenation with a non-literal variable in an aiopg Python SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries instead. You can create parameterized queries like so: ''cur.execute("SELECT %s FROM table", (user_value,))''.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/aio-libs/aiopg
        subcategory:
            - audit
        technology:
            - aiopg
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $CUR.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = '...'.format(...)
                        ...
                    - pattern-inside: |
                        $QUERY = '...' % (...)
                        ...
                    - pattern-inside: |
                        $QUERY = f'...{$USERINPUT}...'
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = '...'.format()
                    ...
                - pattern-not-inside: |
                    $QUERY = '...' % ()
                    ...
            - pattern: $CUR.$METHOD(..., $X + $Y, ...)
            - pattern: $CUR.$METHOD(..., '...'.format(...), ...)
            - pattern: $CUR.$METHOD(..., '...' % (...), ...)
            - pattern: $CUR.$METHOD(..., f'...{$USERINPUT}...', ...)
        - pattern-either:
            - pattern-inside: |
                $CONN = await aiopg.connect(...)
                ...
                $CUR = await $CONN.cursor(...)
                ...
            - pattern-inside: |
                $POOL = await aiopg.create_pool(...)
                ...
                async with $POOL.acquire(...) as $CONN:
                  ...
                  async with $CONN.cursor(...) as $CUR:
                    ...
            - pattern-inside: |
                $POOL = await aiopg.create_pool(...)
                ...
                with (await $POOL.cursor(...)) as $CUR:
                  ...
            - pattern-inside: |
                $POOL = await aiopg.create_pool(...)
                ...
                async with $POOL as $CONN:
                  ...
                  $CUR = await $CONN.cursor(...)
                  ...
            - pattern-inside: |
                $POOL = await aiopg.create_pool(...)
                ...
                async with $POOL.cursor(...) as $CUR:
                  ...
        - pattern-not: $CUR.$METHOD(..., "..." + "...", ...)
        - pattern-not: $CUR.$METHOD(..., '...'.format(), ...)
        - pattern-not: $CUR.$METHOD(..., '...'%(), ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(execute)$
      severity: WARNING
    - id: python.lang.security.audit.sqli.asyncpg-sqli.asyncpg-sqli
      languages:
        - python
      message: 'Detected string concatenation with a non-literal variable in a asyncpg Python SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can create parameterized queries like so: ''conn.fetch("SELECT $1 FROM table", value)''. You can also create prepared statements with ''Connection.prepare'': ''stmt = conn.prepare("SELECT $1 FROM table"); await stmt.fetch(user_value)'''
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/MagicStack/asyncpg
            - https://magicstack.github.io/asyncpg/current/
        subcategory:
            - audit
        technology:
            - asyncpg
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $CONN.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = '...'.format(...)
                        ...
                    - pattern-inside: |
                        $QUERY = '...' % (...)
                        ...
                    - pattern-inside: |
                        $QUERY = f'...{$USERINPUT}...'
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = '...'.format()
                    ...
                - pattern-not-inside: |
                    $QUERY = '...' % ()
                    ...
            - pattern: $CONN.$METHOD(..., $X + $Y, ...)
            - pattern: $CONN.$METHOD(..., $Y.format(...), ...)
            - pattern: $CONN.$METHOD(..., '...'.format(...), ...)
            - pattern: $CONN.$METHOD(..., '...' % (...), ...)
            - pattern: $CONN.$METHOD(..., f'...{$USERINPUT}...', ...)
        - pattern-either:
            - pattern-inside: |
                $CONN = await asyncpg.connect(...)
                ...
            - pattern-inside: |
                async with asyncpg.create_pool(...) as $CONN:
                    ...
            - pattern-inside: |
                async with $POOL.acquire(...) as $CONN:
                    ...
            - pattern-inside: |
                $CONN = await $POOL.acquire(...)
                ...
            - pattern-inside: |
                def $FUNCNAME(..., $CONN: Connection, ...):
                    ...
            - pattern-inside: |
                def $FUNCNAME(..., $CONN: asyncpg.Connection, ...):
                    ...
        - pattern-not: $CONN.$METHOD(..., "..." + "...", ...)
        - pattern-not: $CONN.$METHOD(..., '...'.format(), ...)
        - pattern-not: $CONN.$METHOD(..., '...'%(), ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(fetch|fetchrow|fetchval|execute|executemany|prepare|cursor|copyfromquery)$
      severity: WARNING
    - id: python.lang.security.audit.sqli.pg8000-sqli.pg8000-sqli
      languages:
        - python
      message: 'Detected string concatenation with a non-literal variable in a pg8000 Python SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can create parameterized queries like so: ''conn.run("SELECT :value FROM table", value=myvalue)''. You can also create prepared statements with ''conn.prepare'': ''conn.prepare("SELECT (:v) FROM table")'''
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/tlocke/pg8000
        subcategory:
            - audit
        technology:
            - pg8000
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $CONN.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = '...'.format(...)
                        ...
                    - pattern-inside: |
                        $QUERY = '...' % (...)
                        ...
                    - pattern-inside: |
                        $QUERY = f'...{$USERINPUT}...'
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = '...'.format()
                    ...
                - pattern-not-inside: |
                    $QUERY = '...' % ()
                    ...
            - pattern: $CONN.$METHOD(..., $X + $Y, ...)
            - pattern: $CONN.$METHOD(..., '...'.format(...), ...)
            - pattern: $CONN.$METHOD(..., '...' % (...), ...)
            - pattern: $CONN.$METHOD(..., f'...{$USERINPUT}...', ...)
        - pattern-either:
            - pattern-inside: |
                $CONN = pg8000.native.Connection(...)
                ...
            - pattern-inside: |
                $CONN = pg8000.dhapi.connect(...)
                ...
            - pattern-inside: |
                $CONN1 = pg8000.connect(...)
                ...
                $CONN = $CONN1.cursor(...)
                ...
            - pattern-inside: |
                $CONN = pg8000.connect(...)
                ...
        - pattern-not: $CONN.$METHOD(..., "..." + "...", ...)
        - pattern-not: $CONN.$METHOD(..., '...'.format(), ...)
        - pattern-not: $CONN.$METHOD(..., '...'%(), ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(run|execute|executemany|prepare)$
      severity: WARNING
    - id: python.lang.security.audit.sqli.psycopg-sqli.psycopg-sqli
      languages:
        - python
      message: 'Detected string concatenation with a non-literal variable in a psycopg2 Python SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use prepared statements by creating a ''sql.SQL'' string. You can also use the pyformat binding style to create parameterized queries. For example: ''cur.execute(SELECT * FROM table WHERE name=%s, user_input)'''
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.psycopg.org/docs/sql.html
        subcategory:
            - audit
        technology:
            - psycopg
      patterns:
        - pattern-either:
            - patterns:
                - pattern: $CUR.$METHOD(...,$QUERY,...)
                - pattern-either:
                    - pattern-inside: |
                        $QUERY = $X + $Y
                        ...
                    - pattern-inside: |
                        $QUERY += $X
                        ...
                    - pattern-inside: |
                        $QUERY = '...'.format(...)
                        ...
                    - pattern-inside: |
                        $QUERY = '...' % (...)
                        ...
                    - pattern-inside: |
                        $QUERY = f'...{$USERINPUT}...'
                        ...
                - pattern-not-inside: |
                    $QUERY += "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = "..." + "..."
                    ...
                - pattern-not-inside: |
                    $QUERY = '...'.format()
                    ...
                - pattern-not-inside: |
                    $QUERY = '...' % ()
                    ...
            - pattern: $CUR.$METHOD(..., $X + $Y, ...)
            - pattern: $CUR.$METHOD(..., '...'.format(...), ...)
            - pattern: $CUR.$METHOD(..., '...' % (...), ...)
            - pattern: $CUR.$METHOD(..., f'...{$USERINPUT}...', ...)
        - pattern-either:
            - pattern-inside: |
                $CONN = psycopg2.connect(...)
                ...
                $CUR = $CONN.cursor(...)
                ...
            - pattern-inside: |
                $CONN = psycopg2.connect(...)
                ...
                with $CONN.cursor(...) as $CUR:
                  ...
        - pattern-not: $CUR.$METHOD(..., "..." + "...", ...)
        - pattern-not: $CUR.$METHOD(..., '...'.format(), ...)
        - pattern-not: $CUR.$METHOD(..., '...'%(), ...)
        - metavariable-regex:
            metavariable: $METHOD
            regex: ^(execute|executemany|mogrify)$
      severity: WARNING
    - id: python.lang.security.audit.ssl-wrap-socket-is-deprecated.ssl-wrap-socket-is-deprecated
      languages:
        - python
      message: '''ssl.wrap_socket()'' is deprecated. This function creates an insecure socket without server name indication or hostname matching. Instead, create an SSL context using ''ssl.SSLContext()'' and use that to wrap a socket.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://docs.python.org/3/library/ssl.html#ssl.wrap_socket
            - https://docs.python.org/3/library/ssl.html#ssl.SSLContext.wrap_socket
        subcategory:
            - vuln
        technology:
            - python
      pattern: ssl.wrap_socket(...)
      severity: WARNING
    - fix-regex:
        regex: (shell\s*=\s*)True
        replacement: \1False
      id: python.lang.security.audit.subprocess-shell-true.subprocess-shell-true
      languages:
        - python
      message: Found 'subprocess' function '$FUNC' with 'shell=True'. This is dangerous because this call will spawn the command using a shell process. Doing so propagates current shell settings and variables, which makes it much easier for a malicious actor to execute commands. Use 'shell=False' instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/3172470/actual-meaning-of-shell-true-in-subprocess
            - https://docs.python.org/3/library/subprocess.html
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b602_subprocess_popen_with_shell_equals_true.html
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern: subprocess.$FUNC(..., shell=True, ...)
        - pattern-not: subprocess.$FUNC("...", shell=True, ...)
      severity: ERROR
    - id: python.lang.security.audit.weak-ssl-version.weak-ssl-version
      languages:
        - python
      message: An insecure SSL version was detected. TLS versions 1.0, 1.1, and all SSL versions are considered weak encryption and are deprecated. Use 'ssl.PROTOCOL_TLSv1_2' or higher.
      metadata:
        asvs:
            control_id: 9.1.3 Weak TLS
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x17-V9-Communications.md#v91-client-communications-security-requirements
            section: V9 Communications Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc7568
            - https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html
            - https://docs.python.org/3/library/ssl.html#ssl.PROTOCOL_TLSv1_2
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/insecure_ssl_tls.py#L30
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - pattern: ssl.PROTOCOL_SSLv2
        - pattern: ssl.PROTOCOL_SSLv3
        - pattern: ssl.PROTOCOL_TLSv1
        - pattern: ssl.PROTOCOL_TLSv1_1
        - pattern: pyOpenSSL.SSL.SSLv2_METHOD
        - pattern: pyOpenSSL.SSL.SSLv23_METHOD
        - pattern: pyOpenSSL.SSL.SSLv3_METHOD
        - pattern: pyOpenSSL.SSL.TLSv1_METHOD
        - pattern: pyOpenSSL.SSL.TLSv1_1_METHOD
      severity: WARNING
    - id: python.lang.security.dangerous-code-run.dangerous-interactive-code-run
      languages:
        - python
      message: Found user controlled data inside InteractiveConsole/InteractiveInterpreter method. This is dangerous if external data can reach this function call because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $X = code.InteractiveConsole(...)
                    ...
                - pattern-inside: |
                    $X = code.InteractiveInterpreter(...)
                    ...
            - pattern-either:
                - pattern: |
                    $X.push($PAYLOAD,...)
                - pattern: |
                    $X.runsource($PAYLOAD,...)
                - pattern: |
                    $X.runcode(code.compile_command($PAYLOAD),...)
                - pattern: |
                    $PL = code.compile_command($PAYLOAD,...)
                    ...
                    $X.runcode($PL,...)
            - focus-metavariable: $PAYLOAD
            - pattern-not: |
                $X.push("...",...)
            - pattern-not: |
                $X.runsource("...",...)
            - pattern-not: |
                $X.runcode(code.compile_command("..."),...)
            - pattern-not: |
                $PL = code.compile_command("...",...)
                ...
                $X.runcode($PL,...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: WARNING
    - id: python.lang.security.dangerous-globals-use.dangerous-globals-use
      languages:
        - python
      message: Found non static data as an index to 'globals()'. This is extremely dangerous because it allows an attacker to execute arbitrary code on the system. Refactor your code not to use 'globals()'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-96: Improper Neutralization of Directives in Statically Saved Code (''Static Code Injection'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/mpirnat/lets-be-bad-guys/blob/d92768fb3ade32956abd53bd6bb06e19d634a084/badguys/vulnerable/views.py#L181-L186
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: globals().get(...)
            - pattern: locals().get(...)
            - pattern: globals()[...]
            - pattern: locals()[...]
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $G = globals()
                        ...
                    - pattern-inside: |
                        $G = locals()
                        ...
                - pattern-either:
                    - pattern: $G.get(...)
                    - pattern: $G[...]
            - pattern: $FUNC.__globals__[...]
        - pattern-not: globals().get("...")
        - pattern-not: locals().get("...")
        - pattern-not: globals()["..."]
        - pattern-not: locals()["..."]
        - pattern-not: $G.get("...")
        - pattern-not: $G.get["..."]
        - pattern-not: $G["..."]
        - pattern-not: $FUNC.__globals__["..."]
        - pattern-not-inside: globals()[...] = ...
        - pattern-not-inside: locals()[...] = ...
        - pattern-not-inside: $G[...] = ...
        - pattern-not-inside: $FUNC.__globals__[...] = ...
      severity: WARNING
    - id: python.lang.security.dangerous-os-exec.dangerous-os-exec
      languages:
        - python
      message: Found user controlled content when spawning a process. This is dangerous because it allows a malicious actor to execute commands.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: os.$METHOD("...", ...)
                    - pattern: os.$METHOD(...)
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execl|execle|execlp|execlpe|execv|execve|execvp|execvpe)
                - patterns:
                    - pattern-not: os.$METHOD("...", [$PATH,"...","...",...],...)
                    - pattern-inside: os.$METHOD($BASH,[$PATH,"-c",$CMD,...],...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execv|execve|execvp|execvpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
                - patterns:
                    - pattern-not: os.$METHOD("...", $PATH, "...", "...",...)
                    - pattern-inside: os.$METHOD($BASH, $PATH, "-c", $CMD,...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (execl|execle|execlp|execlpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: ERROR
    - id: python.lang.security.dangerous-spawn-process.dangerous-spawn-process
      languages:
        - python
      message: Found user controlled content when spawning a process. This is dangerous because it allows a malicious actor to execute commands.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", ...)
                    - pattern-inside: os.$METHOD($MODE, $CMD, ...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe|spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp|startfile)
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", ["...","...",...], ...)
                    - pattern-inside: os.$METHOD($MODE, $BASH, ["-c",$CMD,...],...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnv|spawnve|spawnvp|spawnvp|spawnvpe|posix_spawn|posix_spawnp)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
                - patterns:
                    - pattern-not: os.$METHOD($MODE, "...", "...", "...", ...)
                    - pattern-inside: os.$METHOD($MODE, $BASH, "-c", $CMD,...)
                    - pattern: $CMD
                    - metavariable-regex:
                        metavariable: $METHOD
                        regex: (spawnl|spawnle|spawnlp|spawnlpe)
                    - metavariable-regex:
                        metavariable: $BASH
                        regex: (.*)(sh|bash|ksh|csh|tcsh|zsh)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - pattern: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
                - patterns:
                    - pattern-either:
                        - pattern: os.environ['$ANYTHING']
                        - pattern: os.environ.get('$FOO', ...)
                        - pattern: os.environb['$ANYTHING']
                        - pattern: os.environb.get('$FOO', ...)
                        - pattern: os.getenv('$ANYTHING', ...)
                        - pattern: os.getenvb('$ANYTHING', ...)
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern-either:
                                - pattern: sys.argv[...]
                                - pattern: sys.orig_argv[...]
                        - patterns:
                            - pattern-inside: |
                                $PARSER = argparse.ArgumentParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-inside: |
                                $PARSER = optparse.OptionParser(...)
                                ...
                            - pattern-inside: |
                                $ARGS = $PARSER.parse_args()
                            - pattern: <... $ARGS ...>
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.getopt(...)
                                    ...
                                - pattern-inside: |
                                    $OPTS, $ARGS = getopt.gnu_getopt(...)
                                    ...
                            - pattern-either:
                                - patterns:
                                    - pattern-inside: |
                                        for $O, $A in $OPTS:
                                          ...
                                    - pattern: $A
                                - pattern: $ARGS
      severity: ERROR
    - id: python.lang.security.dangerous-subinterpreters-run-string.dangerous-subinterpreters-run-string
      languages:
        - python
      message: Found user controlled content in `run_string`. This is dangerous because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://bugs.python.org/issue43472
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern: |
                _xxsubinterpreters.run_string($ID, $PAYLOAD, ...)
            - pattern-not: |
                _xxsubinterpreters.run_string($ID, "...", ...)
            - focus-metavariable: $PAYLOAD
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: WARNING
    - id: python.lang.security.dangerous-subprocess-use.dangerous-subprocess-use
      languages:
        - python
      message: Detected subprocess function '$FUNC' with user controlled data. A malicious actor could leverage this to perform command injection. You may consider using 'shlex.escape()'.
      metadata:
        asvs:
            control_id: 5.3.8 OS Command Injection
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v53-output-encoding-and-injection-prevention-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/3172470/actual-meaning-of-shell-true-in-subprocess
            - https://docs.python.org/3/library/subprocess.html
            - https://docs.python.org/3/library/shlex.html
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-not: subprocess.$FUNC("...", ...)
                    - pattern-not: subprocess.$FUNC(["...",...], ...)
                    - pattern-not: subprocess.$FUNC(("...",...), ...)
                    - pattern-not: subprocess.CalledProcessError(...)
                    - pattern-not: subprocess.SubprocessError(...)
                    - pattern: subprocess.$FUNC($CMD, ...)
                - patterns:
                    - pattern-not: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...)
                    - pattern: subprocess.$FUNC("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD)
                - patterns:
                    - pattern-not: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...],...)
                    - pattern-not: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c","...",...),...)
                    - pattern-either:
                        - pattern: subprocess.$FUNC(["=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD], ...)
                        - pattern: subprocess.$FUNC(("=~/(sh|bash|ksh|csh|tcsh|zsh)/","-c", $CMD), ...)
                - patterns:
                    - pattern-not: subprocess.$FUNC("=~/(python)/","...",...)
                    - pattern: subprocess.$FUNC("=~/(python)/", $CMD)
                - patterns:
                    - pattern-not: subprocess.$FUNC(["=~/(python)/","...",...],...)
                    - pattern-not: subprocess.$FUNC(("=~/(python)/","...",...),...)
                    - pattern-either:
                        - pattern: subprocess.$FUNC(["=~/(python)/", $CMD],...)
                        - pattern: subprocess.$FUNC(("=~/(python)/", $CMD),...)
            - focus-metavariable: $CMD
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: ERROR
    - id: python.lang.security.dangerous-system-call.dangerous-system-call
      languages:
        - python
      message: Found user-controlled data used in a system call. This could allow a malicious actor to execute commands. Use the 'subprocess' module instead, which is easier to use without accidentally exposing a command injection vulnerability.
      metadata:
        asvs:
            control_id: 5.2.4 Dyanmic Code Execution Features
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x13-V5-Validation-Sanitization-Encoding.md#v52-sanitization-and-sandboxing-requirements
            section: 'V5: Validation, Sanitization and Encoding Verification Requirements'
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        source-rule-url: https://bandit.readthedocs.io/en/latest/plugins/b605_start_process_with_a_shell.html
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-not: os.$W("...", ...)
            - pattern-either:
                - pattern: os.system(...)
                - pattern: getattr(os, "system")(...)
                - pattern: __import__("os").system(...)
                - pattern: getattr(__import__("os"), "system")(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    $X.system(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    getattr($X, "system")(...)
                - pattern: |
                    $X = getattr(os, "system")
                    ...
                    $X(...)
                - pattern: |
                    $X = __import__("os")
                    ...
                    $Y = getattr($X, "system")
                    ...
                    $Y(...)
                - pattern: os.popen(...)
                - pattern: os.popen2(...)
                - pattern: os.popen3(...)
                - pattern: os.popen4(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: ERROR
    - id: python.lang.security.dangerous-testcapi-run-in-subinterp.dangerous-testcapi-run-in-subinterp
      languages:
        - python
      message: Found user controlled content in `run_in_subinterp`. This is dangerous because it allows a malicious actor to run arbitrary Python code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code (''Eval Injection'')'
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://semgrep.dev/docs/cheat-sheets/python-command-injection/
        subcategory:
            - vuln
        technology:
            - python
      mode: taint
      options:
        symbolic_propagation: true
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    _testcapi.run_in_subinterp($PAYLOAD, ...)
                - pattern: |
                    test.support.run_in_subinterp($PAYLOAD, ...)
            - focus-metavariable: $PAYLOAD
            - pattern-not: |
                _testcapi.run_in_subinterp("...", ...)
            - pattern-not: |
                test.support.run_in_subinterp("...", ...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: flask.request.form.get(...)
                        - pattern: flask.request.form[...]
                        - pattern: flask.request.args.get(...)
                        - pattern: flask.request.args[...]
                        - pattern: flask.request.values.get(...)
                        - pattern: flask.request.values[...]
                        - pattern: flask.request.cookies.get(...)
                        - pattern: flask.request.cookies[...]
                        - pattern: flask.request.stream
                        - pattern: flask.request.headers.get(...)
                        - pattern: flask.request.headers[...]
                        - pattern: flask.request.data
                        - pattern: flask.request.full_path
                        - pattern: flask.request.url
                        - pattern: flask.request.json
                        - pattern: flask.request.get_json()
                        - pattern: flask.request.view_args.get(...)
                        - pattern: flask.request.view_args[...]
                        - patterns:
                            - pattern-inside: |
                                @$APP.route(...)
                                def $FUNC(..., $ROUTEVAR, ...):
                                  ...
                            - focus-metavariable: $ROUTEVAR
                - patterns:
                    - pattern-inside: |
                        def $FUNC(request, ...):
                          ...
                    - pattern-either:
                        - pattern: request.$PROPERTY.get(...)
                        - pattern: request.$PROPERTY[...]
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            @rest_framework.decorators.api_view(...)
                            def $FUNC($REQ, ...):
                              ...
                        - patterns:
                            - pattern-either:
                                - pattern-inside: |
                                    class $VIEW(..., rest_framework.views.APIView, ...):
                                      ...
                                - pattern-inside: "class $VIEW(..., rest_framework.generics.GenericAPIView, ...):\n  ...                              \n"
                            - pattern-inside: |
                                def $METHOD(self, $REQ, ...):
                                  ...
                            - metavariable-regex:
                                metavariable: $METHOD
                                regex: (get|post|put|patch|delete|head)
                    - pattern-either:
                        - pattern: $REQ.POST.get(...)
                        - pattern: $REQ.POST[...]
                        - pattern: $REQ.FILES.get(...)
                        - pattern: $REQ.FILES[...]
                        - pattern: $REQ.DATA.get(...)
                        - pattern: $REQ.DATA[...]
                        - pattern: $REQ.QUERY_PARAMS.get(...)
                        - pattern: $REQ.QUERY_PARAMS[...]
                        - pattern: $REQ.data.get(...)
                        - pattern: $REQ.data[...]
                        - pattern: $REQ.query_params.get(...)
                        - pattern: $REQ.query_params[...]
                        - pattern: $REQ.content_type
                        - pattern: $REQ.content_type
                        - pattern: $REQ.stream
                        - pattern: $REQ.stream
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            class $SERVER(..., http.server.BaseHTTPRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.StreamRequestHandler, ...):
                              ...
                        - pattern-inside: |
                            class $SERVER(..., http.server.DatagramRequestHandler, ...):
                              ...
                    - pattern-either:
                        - pattern: self.requestline
                        - pattern: self.path
                        - pattern: self.headers[...]
                        - pattern: self.headers.get(...)
                        - pattern: self.rfile
                - patterns:
                    - pattern-inside: |
                        @pyramid.view.view_config( ... )
                        def $VIEW($REQ):
                          ...
                    - pattern: $REQ.$ANYTHING
                    - pattern-not: $REQ.dbsession
      severity: WARNING
    - id: python.lang.security.deserialization.avoid-jsonpickle.avoid-jsonpickle
      languages:
        - python
      message: Avoid using `jsonpickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data using `json` module.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/jsonpickle/jsonpickle#jsonpickle
            - https://www.exploit-db.com/exploits/49585
        subcategory:
            - audit
        technology:
            - jsonpickle
      patterns:
        - pattern: |
            jsonpickle.decode($PAYLOAD,...)
        - pattern-not: |
            jsonpickle.decode("...",...)
      severity: WARNING
    - fix-regex:
        count: 1
        regex: unsafe_load
        replacement: safe_load
      id: python.lang.security.deserialization.avoid-pyyaml-load.avoid-pyyaml-load
      languages:
        - python
      message: Detected a possible YAML deserialization vulnerability. `yaml.unsafe_load`, `yaml.Loader`, `yaml.CLoader`, and `yaml.UnsafeLoader` are all known to be unsafe methods of deserializing YAML. An attacker with control over the YAML input could create special YAML input that allows the attacker to run arbitrary Python code. This would allow the attacker to steal files, download and install malware, or otherwise take over the machine. Use `yaml.safe_load` or `yaml.SafeLoader` instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/yaml/pyyaml/wiki/PyYAML-yaml.load(input)-Deprecation
            - https://nvd.nist.gov/vuln/detail/CVE-2017-18342
        subcategory:
            - audit
        technology:
            - pyyaml
      patterns:
        - pattern-inside: |
            import yaml
            ...
        - pattern-not-inside: |
            $YAML = ruamel.yaml.YAML(...)
            ...
        - pattern-either:
            - pattern: yaml.unsafe_load(...)
            - pattern: yaml.load(..., Loader=yaml.Loader, ...)
            - pattern: yaml.load(..., Loader=yaml.UnsafeLoader, ...)
            - pattern: yaml.load(..., Loader=yaml.CLoader, ...)
            - pattern: yaml.load_all(..., Loader=yaml.Loader, ...)
            - pattern: yaml.load_all(..., Loader=yaml.UnsafeLoader, ...)
            - pattern: yaml.load_all(..., Loader=yaml.CLoader, ...)
      severity: ERROR
    - id: python.lang.security.deserialization.avoid-unsafe-ruamel.avoid-unsafe-ruamel
      languages:
        - python
      message: Avoid using unsafe `ruamel.yaml.YAML()`. `ruamel.yaml.YAML` can create arbitrary Python objects. A malicious actor could exploit this to run arbitrary code. Use `YAML(typ='rt')` or `YAML(typ='safe')` instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://yaml.readthedocs.io/en/latest/basicuse.html?highlight=typ
        subcategory:
            - audit
        technology:
            - ruamel.yaml
      pattern-either:
        - pattern: ruamel.yaml.YAML(..., typ='unsafe', ...)
        - pattern: ruamel.yaml.YAML(..., typ='base', ...)
      severity: ERROR
    - id: python.lang.security.deserialization.pickle.avoid-pickle
      languages:
        - python
      message: Avoid using `pickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data as JSON or a similar text-based serialization format.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: pickle.$FUNC(...)
            - pattern: _pickle.$FUNC(...)
        - pattern-not: pickle.$FUNC("...")
        - pattern-not: _pickle.$FUNC("...")
      severity: WARNING
    - id: python.lang.security.deserialization.pickle.avoid-cpickle
      languages:
        - python
      message: Avoid using `cPickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data as JSON or a similar text-based serialization format.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern: cPickle.$FUNC(...)
        - pattern-not: cPickle.$FUNC("...")
      severity: WARNING
    - id: python.lang.security.deserialization.pickle.avoid-dill
      languages:
        - python
      message: Avoid using `dill`, which uses `pickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data as JSON or a similar text-based serialization format.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern: dill.$FUNC(...)
        - pattern-not: dill.$FUNC("...")
      severity: WARNING
    - id: python.lang.security.deserialization.pickle.avoid-shelve
      languages:
        - python
      message: Avoid using `shelve`, which uses `pickle`, which is known to lead to code execution vulnerabilities. When unpickling, the serialized data could be manipulated to run arbitrary code. Instead, consider serializing the relevant data as JSON or a similar text-based serialization format.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://docs.python.org/3/library/pickle.html
        subcategory:
            - audit
        technology:
            - python
      pattern: shelve.$FUNC(...)
      severity: WARNING
    - id: python.lang.security.insecure-hash-algorithms-md5.insecure-hash-algorithm-md5
      languages:
        - python
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        asvs:
            control_id: 6.2.2 Insecure Custom Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        bandit-code: B303
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern: hashlib.md5(...)
        - pattern-not: hashlib.md5(..., usedforsecurity=False, ...)
      severity: WARNING
    - fix-regex:
        regex: sha1
        replacement: sha256
      id: python.lang.security.insecure-hash-algorithms.insecure-hash-algorithm-sha1
      languages:
        - python
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        asvs:
            control_id: 6.2.2 Insecure Custom Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        bandit-code: B303
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - python
      pattern: hashlib.sha1(...)
      severity: WARNING
    - id: python.lang.security.insecure-hash-function.insecure-hash-function
      languages:
        - python
      message: Detected use of an insecure MD4 or MD5 hash function. These functions have known vulnerabilities and are considered deprecated. Consider using 'SHA256' or a similar function instead.
      metadata:
        asvs:
            control_id: 6.2.2 Insecure Custom Algorithm
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x14-V6-Cryptography.md#v62-algorithms
            section: V6 Stored Cryptography Verification Requirements
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/html/rfc6151
            - https://crypto.stackexchange.com/questions/44151/how-does-the-flame-malware-take-advantage-of-md5-collision
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/hashlib_new_insecure_functions.py
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - pattern: hashlib.new("=~/[M|m][D|d][4|5]/", ...)
        - pattern: hashlib.new(..., name="=~/[M|m][D|d][4|5]/", ...)
      severity: WARNING
    - fix-regex:
        regex: _create_unverified_context
        replacement: create_default_context
      id: python.lang.security.unverified-ssl-context.unverified-ssl-context
      languages:
        - python
      message: Unverified SSL context detected. This will permit insecure connections without verifying SSL certificates. Use 'ssl.create_default_context' instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.python.org/3/library/ssl.html#ssl-security
            - https://docs.python.org/3/library/http.client.html#http.client.HTTPSConnection
        subcategory:
            - audit
        technology:
            - python
      patterns:
        - pattern-either:
            - pattern: ssl._create_unverified_context(...)
            - pattern: ssl._create_default_https_context = ssl._create_unverified_context
      severity: ERROR
    - fix: defusedxml.etree.ElementTree.parse($...ARGS)
      id: python.lang.security.use-defused-xml-parse.use-defused-xml-parse
      languages:
        - python
      message: The native Python `xml` library is vulnerable to XML External Entity (XXE) attacks.  These attacks can leak confidential data and "XML bombs" can cause denial of service. Do not use this library to parse untrusted input. Instead  the Python documentation recommends using `defusedxml`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://docs.python.org/3/library/xml.html
            - https://github.com/tiran/defusedxml
            - https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing
        subcategory:
            - vuln
        technology:
            - python
      patterns:
        - pattern: xml.etree.ElementTree.parse($...ARGS)
        - pattern-not: xml.etree.ElementTree.parse("...")
      severity: ERROR
    - id: python.lang.security.use-defused-xml.use-defused-xml
      languages:
        - python
      message: The Python documentation recommends using `defusedxml` instead of `xml` because the native Python `xml` library is vulnerable to XML External Entity (XXE) attacks. These attacks can leak confidential data and "XML bombs" can cause denial of service.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://docs.python.org/3/library/xml.html
            - https://github.com/tiran/defusedxml
            - https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing
        subcategory:
            - audit
        technology:
            - python
      pattern: import xml
      severity: ERROR
    - id: python.pycryptodome.security.insecure-cipher-algorithm-blowfish.insecure-cipher-algorithm-blowfish
      languages:
        - python
      message: Detected Blowfish cipher algorithm which is considered insecure. This algorithm is not cryptographically secure and can be reversed easily. Use AES instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://stackoverflow.com/questions/1135186/whats-wrong-with-xor-encryption
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L84
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Cryptodome.Cipher.Blowfish.new(...)
        - pattern: Crypto.Cipher.Blowfish.new(...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-cipher-algorithm-des.insecure-cipher-algorithm-des
      languages:
        - python
      message: Detected DES cipher algorithm which is considered insecure. This algorithm is not cryptographically secure and can be reversed easily. Use AES instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/326.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L84
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Cryptodome.Cipher.DES.new(...)
        - pattern: Crypto.Cipher.DES.new(...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-cipher-algorithm-rc2.insecure-cipher-algorithm-rc2
      languages:
        - python
      message: Detected RC2 cipher algorithm which is considered insecure. This algorithm is not cryptographically secure and can be reversed easily. Use AES instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/326.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L84
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Cryptodome.Cipher.ARC2.new(...)
        - pattern: Crypto.Cipher.ARC2.new(...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-cipher-algorithm-rc4.insecure-cipher-algorithm-rc4
      languages:
        - python
      message: Detected ARC4 cipher algorithm which is considered insecure. This algorithm is not cryptographically secure and can be reversed easily. Use AES instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cwe.mitre.org/data/definitions/326.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L84
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Cryptodome.Cipher.ARC4.new(...)
        - pattern: Crypto.Cipher.ARC4.new(...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-cipher-algorithm.insecure-cipher-algorithm-xor
      languages:
        - python
      message: Detected XOR cipher algorithm which is considered insecure. This algorithm is not cryptographically secure and can be reversed easily. Use AES instead.
      metadata:
        bandit-code: B304
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://stackoverflow.com/questions/1135186/whats-wrong-with-xor-encryption
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L84
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Cryptodome.Cipher.XOR.new(...)
        - pattern: Crypto.Cipher.XOR.new(...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-hash-algorithm-md2.insecure-hash-algorithm-md2
      languages:
        - python
      message: Detected MD2 hash algorithm which is considered insecure. MD2 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Crypto.Hash.MD2.new(...)
        - pattern: Cryptodome.Hash.MD2.new (...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-hash-algorithm-md4.insecure-hash-algorithm-md4
      languages:
        - python
      message: Detected MD4 hash algorithm which is considered insecure. MD4 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Crypto.Hash.MD4.new(...)
        - pattern: Cryptodome.Hash.MD4.new (...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-hash-algorithm-md5.insecure-hash-algorithm-md5
      languages:
        - python
      message: Detected MD5 hash algorithm which is considered insecure. MD5 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Crypto.Hash.MD5.new(...)
        - pattern: Cryptodome.Hash.MD5.new (...)
      severity: WARNING
    - id: python.pycryptodome.security.insecure-hash-algorithm.insecure-hash-algorithm-sha1
      languages:
        - python
      message: Detected SHA1 hash algorithm which is considered insecure. SHA1 is not collision resistant and is therefore not suitable as a cryptographic signature. Use SHA256 or SHA3 instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.schneier.com/blog/archives/2012/10/when_will_we_se.html
            - https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/sha-1-collision-signals-the-end-of-the-algorithm-s-viability
            - http://2012.sharcs.org/slides/stevens.pdf
            - https://pycryptodome.readthedocs.io/en/latest/src/hash/sha3_256.html
        source-rule-url: https://github.com/PyCQA/bandit/blob/d5f8fa0d89d7b11442fc6ec80ca42953974354c8/bandit/blacklists/calls.py#L59
        subcategory:
            - vuln
        technology:
            - pycryptodome
      pattern-either:
        - pattern: Crypto.Hash.SHA.new(...)
        - pattern: Cryptodome.Hash.SHA.new (...)
      severity: WARNING
    - id: python.pycryptodome.security.insufficient-dsa-key-size.insufficient-dsa-key-size
      languages:
        - python
      message: Detected an insufficient key size for DSA. NIST recommends a key size of 2048 or higher.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/weak_cryptographic_key.py
        subcategory:
            - vuln
        technology:
            - pycryptodome
      patterns:
        - pattern-either:
            - pattern: Crypto.PublicKey.DSA.generate(..., bits=$SIZE, ...)
            - pattern: Crypto.PublicKey.DSA.generate($SIZE, ...)
            - pattern: Cryptodome.PublicKey.DSA.generate(..., bits=$SIZE, ...)
            - pattern: Cryptodome.PublicKey.DSA.generate($SIZE, ...)
        - metavariable-comparison:
            comparison: $SIZE < 2048
            metavariable: $SIZE
      severity: WARNING
    - id: python.pycryptodome.security.insufficient-rsa-key-size.insufficient-rsa-key-size
      languages:
        - python
      message: Detected an insufficient key size for RSA. NIST recommends a key size of 2048 or higher.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
        source-rule-url: https://github.com/PyCQA/bandit/blob/b1411bfb43795d3ffd268bef17a839dee954c2b1/bandit/plugins/weak_cryptographic_key.py
        subcategory:
            - vuln
        technology:
            - pycryptodome
      patterns:
        - pattern-either:
            - pattern: Crypto.PublicKey.RSA.generate(..., bits=$SIZE, ...)
            - pattern: Crypto.PublicKey.RSA.generate($SIZE, ...)
            - pattern: Cryptodome.PublicKey.RSA.generate(..., bits=$SIZE, ...)
            - pattern: Cryptodome.PublicKey.RSA.generate($SIZE, ...)
        - metavariable-comparison:
            comparison: $SIZE < 2048
            metavariable: $SIZE
      severity: WARNING
    - id: python.pycryptodome.security.mode-without-authentication.crypto-mode-without-authentication
      languages:
        - python
      message: 'An encryption mode of operation is being used without proper message authentication. This can potentially result in the encrypted content to be decrypted by an attacker. Consider instead use an AEAD mode of operation like GCM. '
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - cryptography
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        AES.new(..., $PYCRYPTODOME_MODE)
                - pattern-not-inside: |
                    AES.new(..., $PYCRYPTODOME_MODE)
                    ...
                    HMAC.new
                - metavariable-pattern:
                    metavariable: $PYCRYPTODOME_MODE
                    patterns:
                        - pattern-either:
                            - pattern: AES.MODE_CBC
                            - pattern: AES.MODE_CTR
                            - pattern: AES.MODE_CFB
                            - pattern: AES.MODE_OFB
      severity: ERROR
    - fix-regex:
        regex: MONGODB-CR
        replacement: SCRAM-SHA-256
      id: python.pymongo.security.mongodb.mongo-client-bad-auth
      languages:
        - python
      message: Warning MONGODB-CR was deprecated with the release of MongoDB 3.6 and is no longer supported by MongoDB 4.0 (see https://api.mongodb.com/python/current/examples/authentication.html for details).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-477: Use of Obsolete Function'
        impact: LOW
        likelihood: LOW
        references:
            - https://cwe.mitre.org/data/definitions/477.html
        subcategory:
            - vuln
        technology:
            - pymongo
      pattern: |
        pymongo.MongoClient(..., authMechanism='MONGODB-CR')
      severity: WARNING
    - fix: |
        $...PARAMS, httponly=True
      id: python.pyramid.audit.authtkt-cookie-httponly-unsafe-default.pyramid-authtkt-cookie-httponly-unsafe-default
      languages:
        - python
      message: Found a Pyramid Authentication Ticket cookie without the httponly option correctly set. Pyramid cookies should be handled securely by setting httponly=True. If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern: pyramid.authentication.$FUNC($...PARAMS)
        - metavariable-pattern:
            metavariable: $FUNC
            pattern-either:
                - pattern: AuthTktCookieHelper
                - pattern: AuthTktAuthenticationPolicy
        - pattern-not: pyramid.authentication.$FUNC(..., httponly=$HTTPONLY, ...)
        - pattern-not: pyramid.authentication.$FUNC(..., **$PARAMS, ...)
        - focus-metavariable: $...PARAMS
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.authtkt-cookie-httponly-unsafe-value.pyramid-authtkt-cookie-httponly-unsafe-value
      languages:
        - python
      message: Found a Pyramid Authentication Ticket cookie without the httponly option correctly set. Pyramid cookies should be handled securely by setting httponly=True. If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktCookieHelper(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktCookieHelper(..., httponly=$HTTPONLY, ...)
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktAuthenticationPolicy(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktAuthenticationPolicy(..., httponly=$HTTPONLY, ...)
        - pattern: $HTTPONLY
        - metavariable-pattern:
            metavariable: $HTTPONLY
            pattern: |
                False
      severity: WARNING
    - fix: |
        'Lax'
      id: python.pyramid.audit.authtkt-cookie-samesite.pyramid-authtkt-cookie-samesite
      languages:
        - python
      message: Found a Pyramid Authentication Ticket without the samesite option correctly set. Pyramid cookies should be handled securely by setting samesite='Lax'. If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1275: Sensitive Cookie with Improper SameSite Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern: pyramid.authentication.AuthTktCookieHelper(..., samesite=$SAMESITE, ...)
            - pattern: pyramid.authentication.AuthTktAuthenticationPolicy(..., samesite=$SAMESITE, ...)
        - pattern: $SAMESITE
        - metavariable-regex:
            metavariable: $SAMESITE
            regex: (?!'Lax')
      severity: WARNING
    - fix-regex:
        regex: (.*)\)
        replacement: \1, secure=True)
      id: python.pyramid.audit.authtkt-cookie-secure-unsafe-default.pyramid-authtkt-cookie-secure-unsafe-default
      languages:
        - python
      message: Found a Pyramid Authentication Ticket cookie using an unsafe default for the secure option. Pyramid cookies should be handled securely by setting secure=True. If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktCookieHelper(..., secure=$SECURE, ...)
                - pattern-not: pyramid.authentication.AuthTktCookieHelper(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktCookieHelper(...)
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktAuthenticationPolicy(..., secure=$SECURE, ...)
                - pattern-not: pyramid.authentication.AuthTktAuthenticationPolicy(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktAuthenticationPolicy(...)
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.authtkt-cookie-secure-unsafe-value.pyramid-authtkt-cookie-secure-unsafe-value
      languages:
        - python
      message: Found a Pyramid Authentication Ticket cookie without the secure option correctly set. Pyramid cookies should be handled securely by setting secure=True. If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktCookieHelper(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktCookieHelper(..., secure=$SECURE, ...)
            - patterns:
                - pattern-not: pyramid.authentication.AuthTktAuthenticationPolicy(..., **$PARAMS)
                - pattern: pyramid.authentication.AuthTktAuthenticationPolicy(..., secure=$SECURE, ...)
        - pattern: $SECURE
        - metavariable-pattern:
            metavariable: $SECURE
            pattern: |
                False
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.csrf-check-disabled.pyramid-csrf-check-disabled
      languages:
        - python
      message: CSRF protection is disabled for this view. This is a security risk.
      metadata:
        asvs:
            control_id: 4.2.2 CSRF
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V4-Access-Control.md#v42-operation-level-access-control
            section: V4 Access Control
            version: "4"
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - audit
        technology:
            - pyramid
      patterns:
        - pattern-inside: |
            from pyramid.view import view_config
            ...
            @view_config(..., require_csrf=$REQUIRE_CSRF, ...)
            def $VIEW(...):
              ...
        - pattern: $REQUIRE_CSRF
        - metavariable-comparison:
            comparison: $REQUIRE_CSRF == False
            metavariable: $REQUIRE_CSRF
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.csrf-origin-check-disabled-globally.pyramid-csrf-origin-check-disabled-globally
      languages:
        - python
      message: Automatic check of the referrer for cross-site request forgery tokens has been explicitly disabled globally, which might leave views unprotected when an unsafe CSRF storage policy is used. Use 'pyramid.config.Configurator.set_default_csrf_options(check_origin=True)' to turn the automatic check for all unsafe methods (per RFC2616).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-inside: |
            $CONFIG.set_default_csrf_options(..., check_origin=$CHECK_ORIGIN, ...)
        - pattern: $CHECK_ORIGIN
        - metavariable-comparison:
            comparison: $CHECK_ORIGIN == False
            metavariable: $CHECK_ORIGIN
      severity: ERROR
    - fix: |
        True
      id: python.pyramid.audit.csrf-origin-check-disabled.pyramid-csrf-origin-check-disabled
      languages:
        - python
      message: Origin check for the CSRF token is disabled for this view. This might represent a security risk if the CSRF storage policy is not known to be secure.
      metadata:
        asvs:
            control_id: 4.2.2 CSRF
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V4-Access-Control.md#v42-operation-level-access-control
            section: V4 Access Control
            version: "4"
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-inside: |
            from pyramid.view import view_config
            ...
            @view_config(..., check_origin=$CHECK_ORIGIN, ...)
            def $VIEW(...):
              ...
        - pattern: $CHECK_ORIGIN
        - metavariable-comparison:
            comparison: $CHECK_ORIGIN == False
            metavariable: $CHECK_ORIGIN
      severity: WARNING
    - fix-regex:
        regex: (.*)\)
        replacement: \1, httponly=True)
      id: python.pyramid.audit.set-cookie-httponly-unsafe-default.pyramid-set-cookie-httponly-unsafe-default
      languages:
        - python
      message: Found a Pyramid cookie using an unsafe default for the httponly option. Pyramid cookies should be handled securely by setting httponly=True in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., httponly=$HTTPONLY, ...)
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(...)
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.set-cookie-httponly-unsafe-value.pyramid-set-cookie-httponly-unsafe-value
      languages:
        - python
      message: Found a Pyramid cookie without the httponly option correctly set. Pyramid cookies should be handled securely by setting httponly=True in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1004: Sensitive Cookie Without ''HttpOnly'' Flag'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/www-community/controls/SecureCookieAttribute
            - https://owasp.org/www-community/HttpOnly
            - https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#httponly-attribute
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(..., httponly=$HTTPONLY, ...)
        - pattern: $HTTPONLY
        - metavariable-pattern:
            metavariable: $HTTPONLY
            pattern: |
                False
      severity: WARNING
    - fix-regex:
        regex: (.*)\)
        replacement: \1, samesite='Lax')
      id: python.pyramid.audit.set-cookie-samesite-unsafe-default.pyramid-set-cookie-samesite-unsafe-default
      languages:
        - python
      message: Found a Pyramid cookie using an unsafe value for the samesite option. Pyramid cookies should be handled securely by setting samesite='Lax' in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1275: Sensitive Cookie with Improper SameSite Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., samesite=$SAMESITE, ...)
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(...)
      severity: WARNING
    - fix: |
        'Lax'
      id: python.pyramid.audit.set-cookie-samesite-unsafe-value.pyramid-set-cookie-samesite-unsafe-value
      languages:
        - python
      message: Found a Pyramid cookie without the samesite option correctly set. Pyramid cookies should be handled securely by setting samesite='Lax' in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1275: Sensitive Cookie with Improper SameSite Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(..., samesite=$SAMESITE, ...)
        - pattern: $SAMESITE
        - metavariable-regex:
            metavariable: $SAMESITE
            regex: (?!'Lax')
      severity: WARNING
    - fix-regex:
        regex: (.*)\)
        replacement: \1, secure=True)
      id: python.pyramid.audit.set-cookie-secure-unsafe-default.pyramid-set-cookie-secure-unsafe-default
      languages:
        - python
      message: Found a Pyramid cookie using an unsafe default for the secure option. Pyramid cookies should be handled securely by setting secure=True in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., secure=$SECURE, ...)
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(...)
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.audit.set-cookie-secure-unsafe-value.pyramid-set-cookie-secure-unsafe-value
      languages:
        - python
      message: Found a Pyramid cookie without the secure option correctly set. Pyramid cookies should be handled securely by setting secure=True in response.set_cookie(...). If this parameter is not properly set, your cookies are not properly protected and are at risk of being stolen by an attacker.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-either:
            - pattern-inside: |
                @pyramid.view.view_config(...)
                def $VIEW($REQUEST):
                    ...
                    $RESPONSE = $REQUEST.response
                    ...
            - pattern-inside: |
                def $VIEW(...):
                    ...
                    $RESPONSE = pyramid.httpexceptions.HTTPFound(...)
                    ...
        - pattern-not: $RESPONSE.set_cookie(..., **$PARAMS)
        - pattern: $RESPONSE.set_cookie(..., secure=$SECURE, ...)
        - pattern: $SECURE
        - metavariable-pattern:
            metavariable: $SECURE
            pattern: |
                False
      severity: WARNING
    - fix: |
        True
      id: python.pyramid.security.csrf-check-disabled-globally.pyramid-csrf-check-disabled-globally
      languages:
        - python
      message: Automatic check of cross-site request forgery tokens has been explicitly disabled globally, which might leave views unprotected. Use 'pyramid.config.Configurator.set_default_csrf_options(require_csrf=True)' to turn the automatic check for all unsafe methods (per RFC2616).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - pyramid
      patterns:
        - pattern-inside: |
            $CONFIG.set_default_csrf_options(..., require_csrf=$REQUIRE_CSRF, ...)
        - pattern: $REQUIRE_CSRF
        - metavariable-comparison:
            comparison: $REQUIRE_CSRF == False
            metavariable: $REQUIRE_CSRF
      severity: ERROR
    - id: python.pyramid.security.direct-use-of-response.pyramid-direct-use-of-response
      languages:
        - python
      message: Detected data rendered directly to the end user via 'Response'. This bypasses Pyramid's built-in cross-site scripting (XSS) defenses and could result in an XSS vulnerability. Use Pyramid's template engines to safely render HTML.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - pyramid
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    pyramid.request.Response.text($SINK)
                - pattern: |
                    pyramid.request.Response($SINK)
                - pattern: |
                    $REQ.response.body = $SINK
                - pattern: |
                    $REQ.response.text = $SINK
                - pattern: |
                    $REQ.response.ubody = $SINK
                - pattern: |
                    $REQ.response.unicode_body = $SINK
            - pattern: $SINK
      pattern-sources:
        - patterns:
            - pattern-inside: |
                @pyramid.view.view_config( ... )
                def $VIEW($REQ):
                  ...
            - pattern: $REQ.$ANYTHING
            - pattern-not: $REQ.dbsession
      severity: ERROR
    - fix-regex:
        regex: format
        replacement: bindparams
      id: python.pyramid.security.sqlalchemy-sql-injection.pyramid-sqlalchemy-sql-injection
      languages:
        - python
      message: Distinct, Having, Group_by, Order_by, and Filter in SQLAlchemy can cause sql injections if the developer inputs raw SQL into the before-mentioned clauses. This pattern captures relevant cases in which the developer inputs raw SQL into the distinct, having, group_by, order_by or filter clauses and injects user-input into the raw SQL with any function besides "bindparams". Use bindParams to securely bind user-input to SQL statements.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.sqlalchemy.org/en/14/tutorial/data_select.html#tutorial-selecting-data
        subcategory:
            - vuln
        technology:
            - pyramid
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $QUERY = $REQ.dbsession.query(...)
                ...
            - pattern-either:
                - pattern: |
                    $QUERY.$SQLFUNC("...".$FORMATFUNC(..., $SINK, ...))
                - pattern: |
                    $QUERY.join(...).$SQLFUNC("...".$FORMATFUNC(..., $SINK, ...))
            - pattern: $SINK
            - metavariable-regex:
                metavariable: $SQLFUNC
                regex: (group_by|order_by|distinct|having|filter)
            - metavariable-regex:
                metavariable: $FORMATFUNC
                regex: (?!bindparams)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                from pyramid.view import view_config
                ...
                @view_config( ... )
                def $VIEW($REQ):
                  ...
            - pattern: $REQ.$ANYTHING
            - pattern-not: $REQ.dbsession
      severity: ERROR
    - fix-regex:
        regex: verify(\s)*=(\s)*False
        replacement: verify=True
      id: python.requests.security.disabled-cert-validation.disabled-cert-validation
      languages:
        - python
      message: Certificate verification has been explicitly disabled. This permits insecure connections to insecure servers. Re-enable certification validation.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://stackoverflow.com/questions/41740361/is-it-safe-to-disable-ssl-certificate-verification-in-pythonss-requests-lib
        subcategory:
            - audit
        technology:
            - requests
      pattern-either:
        - pattern: requests.put(..., verify=False, ...)
        - pattern: requests.patch(..., verify=False, ...)
        - pattern: requests.delete(..., verify=False, ...)
        - pattern: requests.head(..., verify=False, ...)
        - pattern: requests.options(..., verify=False, ...)
        - pattern: requests.request(..., verify=False, ...)
        - pattern: requests.get(..., verify=False, ...)
        - pattern: requests.post(..., verify=False, ...)
      severity: ERROR
    - id: python.sh.security.string-concat.string-concat
      languages:
        - python
      message: Detected string concatenation or formatting in a call to a command via 'sh'. This could be a command injection vulnerability if the data is user-controlled. Instead, use a list and append the argument.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - sh
      pattern-either:
        - pattern: sh.$BIN($X + $Y)
        - pattern: sh.$BIN($X.format(...))
        - pattern: sh.$BIN(f"...{...}...")
      severity: ERROR
    - id: python.sqlalchemy.security.audit.avoid-sqlalchemy-text.avoid-sqlalchemy-text
      languages:
        - python
      message: sqlalchemy.text passes the constructed SQL statement to the database mostly unchanged. This means that the usual SQL injection protections are not applied and this function is vulnerable to SQL injection if user input can reach here. Use normal SQLAlchemy operators (such as or_, and_, etc.) to construct SQL.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.sqlalchemy.org/en/14/core/tutorial.html#using-textual-sql
        subcategory:
            - audit
        technology:
            - sqlalchemy
      mode: taint
      pattern-sinks:
        - pattern: |
            sqlalchemy.text(...)
      pattern-sources:
        - patterns:
            - pattern: |
                $X + $Y
            - metavariable-type:
                metavariable: $X
                type: string
        - patterns:
            - pattern: |
                $X + $Y
            - metavariable-type:
                metavariable: $Y
                type: string
        - patterns:
            - pattern: |
                f"..."
        - patterns:
            - pattern: |
                $X.format(...)
            - metavariable-type:
                metavariable: $X
                type: string
        - patterns:
            - pattern: |
                $X % $Y
            - metavariable-type:
                metavariable: $X
                type: string
      severity: ERROR
    - id: python.sqlalchemy.security.sqlalchemy-execute-raw-query.sqlalchemy-execute-raw-query
      languages:
        - python
      message: 'Avoiding SQL string concatenation: untrusted input concatenated with raw SQL query can result in SQL Injection. In order to execute raw query safely, prepared statement should be used. SQLAlchemy provides TextualSQL to easily used prepared statement with named parameters. For complex SQL composition, use SQL Expression Language or Schema Definition Language. In most cases, SQLAlchemy ORM will be a better option.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.sqlalchemy.org/en/14/core/tutorial.html#using-textual-sql
            - https://www.tutorialspoint.com/sqlalchemy/sqlalchemy_quick_guide.htm
            - https://docs.sqlalchemy.org/en/14/core/tutorial.html#using-more-specific-text-with-table-expression-literal-column-and-expression-column
        subcategory:
            - audit
        technology:
            - sqlalchemy
      pattern-either:
        - pattern: |
            $CONNECTION.execute( $SQL + ..., ... )
        - pattern: |
            $CONNECTION.execute( $SQL % (...), ...)
        - pattern: |
            $CONNECTION.execute( $SQL.format(...), ... )
        - pattern: |
            $CONNECTION.execute(f"...{...}...", ...)
        - patterns:
            - pattern-inside: |
                $QUERY = $SQL + ...
                ...
            - pattern: |
                $CONNECTION.execute($QUERY, ...)
        - patterns:
            - pattern-inside: |
                $QUERY = $SQL % (...)
                ...
            - pattern: |
                $CONNECTION.execute($QUERY, ...)
        - patterns:
            - pattern-inside: |
                $QUERY = $SQL.format(...)
                ...
            - pattern: |
                $CONNECTION.execute($QUERY, ...)
        - patterns:
            - pattern-inside: |
                $QUERY = f"...{...}..."
                ...
            - pattern: |
                $CONNECTION.execute($QUERY, ...)
      severity: ERROR
    - fix-regex:
        regex: format
        replacement: bindparams
      id: python.sqlalchemy.security.sqlalchemy-sql-injection.sqlalchemy-sql-injection
      languages:
        - python
      message: Distinct, Having, Group_by, Order_by, and Filter in SQLAlchemy can cause sql injections if the developer inputs raw SQL into the before-mentioned clauses. This pattern captures relevant cases in which the developer inputs raw SQL into the distinct, having, group_by, order_by or filter clauses and injects user-input into the raw SQL with any function besides "bindparams". Use bindParams to securely bind user-input to SQL statements.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - sqlalchemy
      patterns:
        - pattern-either:
            - pattern: |
                def $FUNC(...,$VAR,...):
                  ...
                  $SESSION.query(...).$SQLFUNC("...".$FORMATFUNC(...,$VAR,...))
            - pattern: |
                def $FUNC(...,$VAR,...):
                  ...
                  $SESSION.query.join(...).$SQLFUNC("...".$FORMATFUNC(...,$VAR,...))
            - pattern: |
                def $FUNC(...,$VAR,...):
                  ...
                  $SESSION.query.$SQLFUNC("...".$FORMATFUNC(...,$VAR,...))
            - pattern: |
                def $FUNC(...,$VAR,...):
                  ...
                  query.$SQLFUNC("...".$FORMATFUNC(...,$VAR,...))
        - metavariable-regex:
            metavariable: $SQLFUNC
            regex: (group_by|order_by|distinct|having|filter)
        - metavariable-regex:
            metavariable: $FORMATFUNC
            regex: (?!bindparams)
      severity: WARNING
    - id: python.twilio.security.twiml-injection.twiml-injection
      languages:
        - python
      message: Using non-constant TwiML (Twilio Markup Language) argument when creating a Twilio conversation could allow the injection of additional TwiML commands
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-91: XML Injection'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://codeberg.org/fennix/funjection
        subcategory: vuln
        technology:
            - python
            - twilio
            - twiml
      mode: taint
      pattern-sanitizers:
        - pattern: xml.sax.saxutils.escape(...)
        - pattern: html.escape(...)
      pattern-sinks:
        - patterns:
            - pattern: |
                $CLIENT.calls.create(..., twiml=$SINK, ...)
            - focus-metavariable: $SINK
      pattern-sources:
        - pattern: |
            f"..."
        - pattern: |
            "..." % ...
        - pattern: |
            "...".format(...)
        - patterns:
            - pattern: $ARG
            - pattern-inside: |
                def $F(..., $ARG, ...):
                    ...
      severity: WARNING
    - id: ruby.aws-lambda.security.activerecord-sqli.activerecord-sqli
      languages:
        - ruby
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `Example.find_by_sql ["SELECT title FROM posts WHERE author = ? AND created > ?", author_id, start_date]`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://guides.rubyonrails.org/active_record_querying.html#finding-by-sql
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - active-record
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-either:
                - pattern: ActiveRecord::Base.connection.execute($QUERY,...)
                - pattern: $MODEL.find_by_sql($QUERY,...)
                - pattern: $MODEL.select_all($QUERY,...)
            - pattern-inside: |
                require 'active_record'
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: WARNING
    - id: ruby.aws-lambda.security.mysql2-sqli.mysql2-sqli
      languages:
        - ruby
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use sanitize statements like so: `escaped = client.escape(user_input)`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/brianmario/mysql2
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - mysql2
      mode: taint
      pattern-sanitizers:
        - pattern: $CLIENT.escape(...)
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-either:
                - pattern: $CLIENT.query($QUERY,...)
                - pattern: $CLIENT.prepare($QUERY,...)
            - pattern-inside: |
                require 'mysql2'
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: WARNING
    - id: ruby.aws-lambda.security.pg-sqli.pg-sqli
      languages:
        - ruby
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `conn.exec_params(''SELECT $1 AS a, $2 AS b, $3 AS c'', [1, 2, nil])`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.rubydoc.info/gems/pg/PG/Connection
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - postgres
            - pg
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-either:
                - pattern: $CONN.exec($QUERY,...)
                - pattern: $CONN.exec_params($QUERY,...)
                - pattern: $CONN.exec_prepared($QUERY,...)
                - pattern: $CONN.async_exec($QUERY,...)
                - pattern: $CONN.async_exec_params($QUERY,...)
                - pattern: $CONN.async_exec_prepared($QUERY,...)
            - pattern-inside: |
                require 'pg'
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: WARNING
    - id: ruby.aws-lambda.security.sequel-sqli.sequel-sqli
      languages:
        - ruby
      message: 'Detected SQL statement that is tainted by `event` object. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized statements like so: `DB[''select * from items where name = ?'', name]`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/jeremyevans/sequel#label-Arbitrary+SQL+queries
        subcategory:
            - vuln
        technology:
            - aws-lambda
            - sequel
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-either:
                - pattern: DB[$QUERY,...]
                - pattern: DB.run($QUERY,...)
            - pattern-inside: |
                require 'sequel'
                ...
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: WARNING
    - id: ruby.aws-lambda.security.tainted-deserialization.tainted-deserialization
      languages:
        - ruby
      message: Deserialization of a string tainted by `event` object found. Objects in Ruby can be serialized into strings, then later loaded from strings. However, uses of `load` can cause remote code execution. Loading user input with MARSHAL, YAML or CSV can potentially be dangerous. If you need to deserialize untrusted data, you should use JSON as it is only capable of returning 'primitive' types such as strings, arrays, hashes, numbers and nil.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://ruby-doc.org/core-3.1.2/doc/security_rdoc.html
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_deserialize.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $SINK
            - pattern-either:
                - pattern-inside: |
                    YAML.load($SINK,...)
                - pattern-inside: |
                    CSV.load($SINK,...)
                - pattern-inside: |
                    Marshal.load($SINK,...)
                - pattern-inside: |
                    Marshal.restore($SINK,...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: WARNING
    - id: ruby.aws-lambda.security.tainted-sql-string.tainted-sql-string
      languages:
        - ruby
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as Sequelize which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://rorsecurity.info/portfolio/ruby-on-rails-sql-injection-cheat-sheet
        subcategory:
            - vuln
        technology:
            - aws-lambda
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        "...#{...}..."
                    - pattern-regex: (?i)(select|delete|insert|create|update|alter|drop)\b|\w+\s*!?[<>=].*
                - patterns:
                    - pattern-either:
                        - pattern: Kernel::sprintf("$SQLSTR", ...)
                        - pattern: |
                            "$SQLSTR" + $EXPR
                        - pattern: |
                            "$SQLSTR" % $EXPR
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(select|delete|insert|create|update|alter|drop)\b|\w+\s*!?[<>=].*
            - pattern-not-inside: |
                puts(...)
      pattern-sources:
        - patterns:
            - pattern: event
            - pattern-inside: |
                def $HANDLER(event, context)
                  ...
                end
      severity: ERROR
    - id: ruby.jwt.security.audit.jwt-decode-without-verify.ruby-jwt-decode-without-verify
      languages:
        - ruby
      message: Detected the decoding of a JWT token without a verify step. JWT tokens must be verified before use, otherwise the token's integrity is unknown. This means a malicious actor could forge a JWT token with any claims.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: LOW
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            require 'jwt'
            ...
        - pattern: JWT.decode($PAYLOAD,$SECRET,false,...)
      severity: WARNING
    - id: ruby.jwt.security.jwt-exposed-credentials.ruby-jwt-exposed-credentials
      languages:
        - ruby
      message: Password is exposed through JWT token payload. This is not encrypted and the password could be compromised. Do not store passwords in JWT tokens.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://cwe.mitre.org/data/definitions/522.html
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            require 'jwt'
            ...
        - pattern: |
            $PAYLOAD = {...,password:...,...}
            ...
            JWT.encode($PAYLOAD,...)
      severity: ERROR
    - id: ruby.jwt.security.jwt-hardcode.ruby-jwt-hardcoded-secret
      languages:
        - ruby
      message: 'Hardcoded JWT secret or private key is used. This is a Insufficiently Protected Credentials weakness: https://cwe.mitre.org/data/definitions/522.html Consider using an appropriate security mechanism to protect the credentials (e.g. keeping secrets in environment variables)'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            require 'jwt'
            ...
        - pattern-either:
            - pattern: |
                JWT.encode($PAYLOAD,"...",...)
            - pattern: |
                JWT.decode($PAYLOAD,"...",...)
            - pattern: |
                JWT.encode($PAYLOAD,nil,...)
            - pattern: |
                JWT.decode($PAYLOAD,nil,...)
            - pattern: |
                $SECRET = "..."
                ...
                JWT.encode($PAYLOAD,$SECRET,...)
            - pattern: |
                $SECRET = "..."
                ...
                JWT.decode($PAYLOAD,$SECRET,...)
        - pattern-not: |
            JWT.encode($PAYLOAD, nil, ... , jwks: ..., ...)
        - pattern-not: |
            JWT.decode($PAYLOAD, nil, ..., jwks: ..., ...)
      severity: ERROR
    - id: ruby.jwt.security.jwt-none-alg.ruby-jwt-none-alg
      languages:
        - ruby
      message: Detected use of the 'none' algorithm in a JWT token. The 'none' algorithm assumes the integrity of the token has already been verified. This would allow a malicious actor to forge a JWT token that will automatically be verified. Do not explicitly use the 'none' algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      patterns:
        - pattern-inside: |
            require 'jwt'
            ...
        - pattern: |
            JWT.encode($PAYLOAD, $SECRET, 'none', ...)
      severity: ERROR
    - id: ruby.lang.security.bad-deserialization-env.bad-deserialization-env
      languages:
        - ruby
      message: Checks for unsafe deserialization. Objects in Ruby can be serialized into strings, then later loaded from strings. However, uses of load and object_load can cause remote code execution. Loading user input with MARSHAL or CSV can potentially be dangerous. Use JSON in a secure fashion instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_deserialize.rb
        subcategory:
            - vuln
        technology:
            - ruby
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: |
                CSV.load(...)
            - pattern: |
                Marshal.load(...)
            - pattern: |
                Marshal.restore(...)
            - pattern: |
                Oj.object_load(...)
            - pattern: |
                Oj.load($X)
      pattern-sources:
        - pattern-either:
            - pattern: request.env
      severity: ERROR
    - fix: Psych.safe_load($...ARGS)
      id: ruby.lang.security.bad-deserialization-yaml.bad-deserialization-yaml
      languages:
        - ruby
      message: Unsafe deserialization from YAML. Objects in Ruby can be serialized into strings, then later loaded from strings. However, uses of load and object_load can cause remote code execution. Loading user input with YAML can potentially be dangerous. Use JSON in a secure fashion instead. However, loading YAML from a static file is not dangerous and should not be flagged.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_deserialize.rb
        subcategory:
            - audit
        technology:
            - ruby
            - yaml
      patterns:
        - pattern: |
            YAML.load($...ARGS)
        - pattern-not: |
            YAML.load(..., safe: true, ...)
        - pattern-not: |
            YAML.load("...", ...)
        - pattern-not-inside: |
            YAML.load(..., File.read(...), ...)
        - pattern-not-inside: |
            $FILE = File.read(...)
            ...
            YAML.load(..., $FILE, ...)
        - pattern-not-inside: |
            $FILENAME = ...
            ...
            $FILE = File.read($FILENAME, ...)
            ...
            YAML.load(..., $FILE, ...)
        - pattern-not-inside: |
            YAML.load(..., $X.$Y(File.read(...)), ...)
        - pattern-not-inside: |
            YAML.load(..., $X.$Y(File.read(...)).$Z, ...)
        - pattern-not-inside: |
            $T = $MOD.$MET(File.read(...))
            ...
            YAML.load(..., $T, ...)
        - pattern-not-inside: |
            $T = $MOD.$MET(File.read(...))
            ...
            YAML.load(..., $T.$R, ...)
      severity: ERROR
    - id: ruby.lang.security.bad-deserialization.bad-deserialization
      languages:
        - ruby
      message: Checks for unsafe deserialization. Objects in Ruby can be serialized into strings, then later loaded from strings. However, uses of load and object_load can cause remote code execution. Loading user input with MARSHAL or CSV can potentially be dangerous. Use JSON in a secure fashion instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-502: Deserialization of Untrusted Data'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A08:2017 - Insecure Deserialization
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_deserialize.rb
        subcategory:
            - vuln
        technology:
            - ruby
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: |
                CSV.load(...)
            - pattern: |
                Marshal.load(...)
            - pattern: |
                Marshal.restore(...)
            - pattern: |
                Oj.object_load(...)
            - pattern: |
                Oj.load($X)
      pattern-sources:
        - pattern-either:
            - pattern: params
            - pattern: cookies
      severity: ERROR
    - id: ruby.lang.security.cookie-serialization.cookie-serialization
      languages:
        - ruby
      message: Checks if code allows cookies to be deserialized using Marshal. If the attacker can craft a valid cookie, this could lead to remote code execution. The hybrid check is just to warn users to migrate to :json for best practice.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_cookie_serialization.rb
            - https://robertheaton.com/2013/07/22/how-to-hack-a-rails-app-using-its-secret-token/
        subcategory:
            - audit
        technology:
            - ruby
      pattern-either:
        - pattern: |
            Rails.application.config.action_dispatch.cookies_serializer = :marshal
        - pattern: |
            Rails.application.config.action_dispatch.cookies_serializer = :hybrid
      severity: ERROR
    - id: ruby.lang.security.dangerous-exec.dangerous-exec
      languages:
        - ruby
      message: Detected non-static command inside $EXEC. Audit the input to '$EXEC'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://guides.rubyonrails.org/security.html#command-line-injection
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_execute.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $EXEC(...)
            - pattern-not: |
                $EXEC("...","...","...",...)
            - pattern-not: |
                $EXEC(["...","...","...",...],...)
            - pattern-not: |
                $EXEC({...},"...","...","...",...)
            - pattern-not: |
                $EXEC({...},["...","...","...",...],...)
            - metavariable-regex:
                metavariable: $EXEC
                regex: ^(system|exec|spawn|Process.exec|Process.spawn|Open3.capture2|Open3.capture2e|Open3.capture3|Open3.popen2|Open3.popen2e|Open3.popen3|IO.popen|Gem::Util.popen|PTY.spawn)$
      pattern-sources:
        - patterns:
            - pattern: |
                def $F(...,$ARG,...)
                    ...
                end
            - focus-metavariable: $ARG
        - pattern: params
        - pattern: cookies
      severity: WARNING
    - id: ruby.lang.security.dangerous-open.dangerous-open
      languages:
        - ruby
      message: Detected non-static command inside 'open'. Audit the input to 'open'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - ruby
      patterns:
        - pattern: |
            open($CMD,...)
        - pattern-not: |
            open("...",...)
        - metavariable-regex:
            metavariable: $CMD
            regex: '|'
      severity: WARNING
    - id: ruby.lang.security.dangerous-open3-pipeline.dangerous-open3-pipeline
      languages:
        - ruby
      message: Detected non-static command inside $PIPE. Audit the input to '$PIPE'. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - ruby
      patterns:
        - pattern: |
            Open3.$PIPE(...)
        - pattern-not: |
            Open3.$PIPE(...,"...",...)
        - metavariable-regex:
            metavariable: $PIPE
            regex: ^(pipeline|pipeline_r|pipeline_rw|pipeline_start|pipeline_w)$
      severity: WARNING
    - id: ruby.lang.security.dangerous-subshell.dangerous-subshell
      languages:
        - ruby
      message: Detected non-static command inside `...`. If unverified user data can reach this call site, this is a code injection vulnerability. A malicious actor can inject a malicious script to execute arbitrary code.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - ruby
      patterns:
        - pattern: |
            `...#{$VAL}...`
        - pattern-not: |
            `...#{"..."}...`
        - pattern-not-inside: |
            $VAL = "..."
            ...
      severity: WARNING
    - id: ruby.lang.security.divide-by-zero.divide-by-zero
      languages:
        - ruby
      message: Detected a possible ZeroDivisionError.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-369: Divide By Zero'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_divide_by_zero.rb
        subcategory:
            - vuln
        technology:
            - ruby
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: $NUMER / 0
            - pattern: $NUMER
      pattern-sources:
        - patterns:
            - pattern: $VAR
            - metavariable-regex:
                metavariable: $VAR
                regex: ^\d*(?!\.)$
      severity: WARNING
    - fix-regex:
        regex: =\s*false
        replacement: = true
      id: ruby.lang.security.force-ssl-false.force-ssl-false
      languages:
        - ruby
      message: Checks for configuration setting of force_ssl to false. Force_ssl forces usage of HTTPS, which could lead to network interception of unencrypted application traffic. To fix, set config.force_ssl = true.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_force_ssl.rb
        subcategory:
            - vuln
        technology:
            - ruby
      pattern: config.force_ssl = false
      severity: WARNING
    - id: ruby.lang.security.hardcoded-http-auth-in-controller.hardcoded-http-auth-in-controller
      languages:
        - ruby
      message: Detected hardcoded password used in basic authentication in a controller class. Including this password in version control could expose this credential. Consider refactoring to use environment variables or configuration files.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/basic_auth/index.markdown
        subcategory:
            - audit
        technology:
            - ruby
            - secrets
      patterns:
        - pattern-inside: |
            class $CONTROLLER < ApplicationController
              ...
              http_basic_authenticate_with ..., :password => "$SECRET", ...
            end
        - focus-metavariable: $SECRET
      severity: WARNING
    - id: ruby.lang.security.hardcoded-secret-rsa-passphrase.hardcoded-secret-rsa-passphrase
      languages:
        - ruby
      message: Found the use of an hardcoded passphrase for RSA. The passphrase can be easily discovered, and therefore should not be stored in source-code. It is recommended to remove the passphrase from source-code, and use system environment variables or a restricted configuration file.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cwe.mitre.org/data/definitions/522.html
        subcategory:
            - vuln
        technology:
            - ruby
            - secrets
      patterns:
        - pattern-either:
            - pattern: OpenSSL::PKey::RSA.new(..., '...')
            - pattern: OpenSSL::PKey::RSA.new(...).to_pem(..., '...')
            - pattern: OpenSSL::PKey::RSA.new(...).export(..., '...')
            - patterns:
                - pattern-inside: |
                    $OPENSSL = OpenSSL::PKey::RSA.new(...)
                    ...
                - pattern-either:
                    - pattern: |
                        $OPENSSL.export(...,'...')
                    - pattern: |
                        $OPENSSL.to_pem(...,'...')
            - patterns:
                - pattern-either:
                    - patterns:
                        - pattern-inside: |
                            $ASSIGN = '...'
                            ...
                        - pattern: OpenSSL::PKey::RSA.new(..., $ASSIGN)
                    - patterns:
                        - pattern-inside: |
                            def $METHOD1(...)
                            ...
                            $ASSIGN = '...'
                            ...
                            end
                            ...
                            def $METHOD2(...)
                            ...
                            end
                        - pattern: OpenSSL::PKey::RSA.new(..., $ASSIGN)
                    - patterns:
                        - pattern-inside: |
                            $ASSIGN = '...'
                            ...
                            def $METHOD(...)
                              $OPENSSL = OpenSSL::PKey::RSA.new(...)
                            ...
                            end
                            ...
                        - pattern-either:
                            - pattern: $OPENSSL.export(...,$ASSIGN)
                            - pattern: $OPENSSL.to_pem(...,$ASSIGN)
                    - patterns:
                        - pattern-inside: |
                            def $METHOD1(...)
                            ...
                            $OPENSSL = OpenSSL::PKey::RSA.new(...)
                            ...
                            $ASSIGN = '...'
                            ...
                            end
                            ...
                        - pattern-either:
                            - pattern: $OPENSSL.export(...,$ASSIGN)
                            - pattern: $OPENSSL.to_pem(...,$ASSIGN)
                    - patterns:
                        - pattern-inside: |
                            def $METHOD1(...)
                            ...
                            $ASSIGN = '...'
                            ...
                            end
                            ...
                            def $METHOD2(...)
                            ...
                            $OPENSSL = OpenSSL::PKey::RSA.new(...)
                            ...
                            end
                            ...
                        - pattern-either:
                            - pattern: $OPENSSL.export(...,$ASSIGN)
                            - pattern: $OPENSSL.to_pem(...,$ASSIGN)
      severity: WARNING
    - id: ruby.lang.security.insufficient-rsa-key-size.insufficient-rsa-key-size
      languages:
        - ruby
      message: The RSA key size $SIZE is insufficent by NIST standards. It is recommended to use a key length of 2048 or higher.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf
        subcategory:
            - vuln
        technology:
            - ruby
      patterns:
        - pattern-either:
            - pattern: OpenSSL::PKey::RSA.generate($SIZE,...)
            - pattern: OpenSSL::PKey::RSA.new($SIZE, ...)
            - patterns:
                - pattern-either:
                    - patterns:
                        - pattern-inside: |
                            $ASSIGN = $SIZE
                            ...
                        - pattern-either:
                            - pattern: OpenSSL::PKey::RSA.new($ASSIGN, ...)
                            - pattern: OpenSSL::PKey::RSA.generate($ASSIGN, ...)
                    - patterns:
                        - pattern-inside: |
                            def $METHOD1(...)
                            ...
                            $ASSIGN = $SIZE
                            ...
                            end
                            ...
                        - pattern-either:
                            - pattern: OpenSSL::PKey::RSA.new($ASSIGN, ...)
                            - pattern: OpenSSL::PKey::RSA.generate($ASSIGN, ...)
        - metavariable-comparison:
            comparison: $SIZE < 2048
            metavariable: $SIZE
      severity: WARNING
    - id: ruby.lang.security.md5-used-as-password.md5-used-as-password
      languages:
        - ruby
      message: It looks like MD5 is used as a password hash. MD5 is not considered a secure password hash because it can be cracked by an attacker in a short amount of time. Instead, use a suitable password hashing function such as bcrypt. You can use the `bcrypt` gem.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-327: Use of a Broken or Risky Cryptographic Algorithm'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://tools.ietf.org/id/draft-lvelvindron-tls-md5-sha1-deprecate-01.html
            - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
            - https://github.com/returntocorp/semgrep-rules/issues/1609
        subcategory:
            - vuln
        technology:
            - md5
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $FUNCTION(...);
            - metavariable-regex:
                metavariable: $FUNCTION
                regex: (?i)(.*password.*)
      pattern-sources:
        - pattern: Digest::MD5
      severity: WARNING
    - id: ruby.lang.security.missing-csrf-protection.missing-csrf-protection
      languages:
        - ruby
      message: Detected controller which does not enable cross-site request forgery protections using 'protect_from_forgery'. Add 'protect_from_forgery :with => :exception' to your controller class.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/cross-site_request_forgery/index.markdown
        subcategory:
            - audit
        technology:
            - ruby
      patterns:
        - pattern: |
            class $CONTROLLER < ActionController::Base
              ...
            end
        - pattern-not: |
            class $CONTROLLER < ActionController::Base
              ...
              protect_from_forgery :with => :exception
            end
        - pattern-not: |
            class $CONTROLLER < ActionController::Base
              ...
              protect_from_forgery prepend: true, with: :exception
            end
      severity: ERROR
    - id: ruby.lang.security.model-attr-accessible.model-attr-accessible
      languages:
        - ruby
      message: 'Checks for dangerous permitted attributes that can lead to mass assignment vulnerabilities. Query parameters allowed using permit and attr_accessible are checked for allowance of dangerous attributes admin, banned, role, and account_id. Also checks for usages of params.permit!, which allows everything. Fix: don''t allow admin, banned, role, and account_id using permit or attr_accessible.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_model_attr_accessible.rb
        subcategory:
            - audit
        technology:
            - ruby
      pattern-either:
        - pattern: |
            ....permit(..., :admin, ...)
        - pattern: |
            ....permit(..., :role, ...)
        - pattern: |
            ....permit(..., :banned, ...)
        - pattern: |
            ....permit(..., :account_id, ...)
        - pattern: |
            attr_accessible ..., :admin, ...
        - pattern: |
            attr_accessible ..., :role, ...
        - pattern: |
            attr_accessible ..., :banned, ...
        - pattern: |
            attr_accessible ..., :account_id, ...
        - pattern: |
            params.permit!
      severity: ERROR
    - id: ruby.lang.security.model-attributes-attr-accessible.model-attributes-attr-accessible
      languages:
        - ruby
      message: Checks for models that do not use attr_accessible. This means there is no limiting of which variables can be manipulated through mass assignment. For newer Rails applications, parameters should be allowlisted using strong parameters. For older Rails versions, they should be allowlisted using strong_attributes.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_model_attributes.rb
        subcategory:
            - audit
        technology:
            - rails
      patterns:
        - pattern-not: |
            class $CLASS < $TYPE
            ...
            attr_accessible :$XXX
            ...
            end
            ...
            $CLASS.$FUNC(...)
        - pattern: |
            class $CLASS < $TYPE
            ...
            end
            ...
            $CLASS.$FUNC(...)
        - metavariable-pattern:
            metavariable: $TYPE
            patterns:
                - pattern-not-regex: (?i)(Error|Exception)
        - focus-metavariable: $CLASS
      severity: ERROR
    - id: ruby.lang.security.no-eval.ruby-eval
      languages:
        - ruby
      message: Use of eval with user-controllable input detected. This can lead  to attackers running arbitrary code. Ensure external data does not  reach here, otherwise this is a security vulnerability. Consider  other ways to do this without eval.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_evaluation.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $X.eval
                - pattern: $X.class_eval
                - pattern: $X.instance_eval
                - pattern: $X.module_eval
                - pattern: $X.eval(...)
                - pattern: $X.class_eval(...)
                - pattern: $X.instance_eval(...)
                - pattern: $X.module_eval(...)
                - pattern: eval(...)
                - pattern: class_eval(...)
                - pattern: module_eval(...)
                - pattern: instance_eval(...)
            - pattern-not: $M("...",...)
      pattern-sources:
        - pattern-either:
            - pattern: params
            - pattern: cookies
            - patterns:
                - pattern: |
                    RubyVM::InstructionSequence.compile(...)
                - pattern-not: |
                    RubyVM::InstructionSequence.compile("...")
      severity: WARNING
    - id: ruby.lang.security.no-send.bad-send
      languages:
        - ruby
      message: Checks for unsafe use of Object#send, try, __send__, and public_send. These only account for unsafe use of a method, not target. This can lead to arbitrary calling of exit, along with arbitrary code execution. Please be sure to sanitize input in order to avoid this.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_send.rb
            - https://the.igreque.info/posts/2016/01-object-send-considered-harmful-en.html
        subcategory:
            - audit
        technology:
            - ruby
      pattern-either:
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.send($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.try($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.__send__($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.public_send($PARAM.$FUNC)
      severity: ERROR
    - fix-regex:
        regex: VERIFY_NONE
        replacement: VERIFY_PEER
      id: ruby.lang.security.ssl-mode-no-verify.ssl-mode-no-verify
      languages:
        - ruby
      message: Detected SSL that will accept an unverified connection. This makes the connections susceptible to man-in-the-middle attacks. Use 'OpenSSL::SSL::VERIFY_PEER' instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
        subcategory:
            - vuln
        technology:
            - ruby
      pattern: OpenSSL::SSL::VERIFY_NONE
      severity: WARNING
    - id: ruby.lang.security.weak-hashes-md5.weak-hashes-md5
      languages:
        - ruby
      message: Should not use md5 to generate hashes. md5 is proven to be vulnerable through the use of brute-force attacks. Could also result in collisions, leading to potential collision attacks. Use SHA256 or other hashing functions instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.ibm.com/support/pages/security-bulletin-vulnerability-md5-signature-and-hash-algorithm-affects-sterling-integrator-and-sterling-file-gateway-cve-2015-7575
        subcategory:
            - vuln
        technology:
            - ruby
      pattern-either:
        - pattern: Digest::MD5.base64digest $X
        - pattern: Digest::MD5.hexdigest $X
        - pattern: Digest::MD5.digest $X
        - pattern: Digest::MD5.new
        - pattern: OpenSSL::Digest::MD5.base64digest $X
        - pattern: OpenSSL::Digest::MD5.hexdigest $X
        - pattern: OpenSSL::Digest::MD5.digest $X
        - pattern: OpenSSL::Digest::MD5.new
      severity: WARNING
    - id: ruby.lang.security.weak-hashes-sha1.weak-hashes-sha1
      languages:
        - ruby
      message: Should not use SHA1 to generate hashes. There is a proven SHA1 hash collision by Google, which could lead to vulnerabilities. Use SHA256, SHA3 or other hashing functions instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-328: Use of Weak Hash'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html
            - https://shattered.io/
        subcategory:
            - vuln
        technology:
            - ruby
      pattern-either:
        - pattern: Digest::SHA1.$FUNC
        - pattern: OpenSSL::Digest::SHA1.$FUNC
        - pattern: OpenSSL::HMAC.$FUNC("sha1",...)
      severity: WARNING
    - id: ruby.rails.security.audit.avoid-session-manipulation.avoid-session-manipulation
      languages:
        - ruby
      message: This gets data from session using user inputs. A malicious user may be able to retrieve information from your session that you didn't intend them to. Do not use user input as a session key.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-276: Incorrect Default Permissions'
        cwe2021-top25: true
        cwe2022-top25: true
        help: |
            ## Remediation
            Session manipulation can occur when an application allows user-input in session keys. Since sessions are typically considered a source of truth (e.g. to check the logged-in user or to match CSRF tokens), allowing an attacker to manipulate the session may lead to unintended behavior.

            ## References
            [Session Manipulation](https://brakemanscanner.org/docs/warning_types/session_manipulation/)
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/session_manipulation/
        shortDescription: Allowing an attacker to manipulate the session may lead to unintended behavior.
        subcategory:
            - vuln
        tags:
            - security
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - pattern: session[...]
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby.rails.security.audit.avoid-tainted-file-access.avoid-tainted-file-access
      languages:
        - ruby
      message: Using user input when accessing files is potentially dangerous. A malicious actor could use this to modify or access files they have no right to.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/file_access/index.markdown
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: Dir.$X(...)
                - pattern: File.$X(...)
                - pattern: IO.$X(...)
                - pattern: Kernel.$X(...)
                - pattern: PStore.$X(...)
                - pattern: Pathname.$X(...)
            - metavariable-pattern:
                metavariable: $X
                patterns:
                    - pattern-either:
                        - pattern: chdir
                        - pattern: chroot
                        - pattern: delete
                        - pattern: entries
                        - pattern: foreach
                        - pattern: glob
                        - pattern: install
                        - pattern: lchmod
                        - pattern: lchown
                        - pattern: link
                        - pattern: load
                        - pattern: load_file
                        - pattern: makedirs
                        - pattern: move
                        - pattern: new
                        - pattern: open
                        - pattern: read
                        - pattern: readlines
                        - pattern: rename
                        - pattern: rmdir
                        - pattern: safe_unlink
                        - pattern: symlink
                        - pattern: syscopy
                        - pattern: sysopen
                        - pattern: truncate
                        - pattern: unlink
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby.rails.security.audit.avoid-tainted-ftp-call.avoid-tainted-ftp-call
      languages:
        - ruby
      message: Using user input when accessing files is potentially dangerous. A malicious actor could use this to modify or access files they have no right to.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/file_access/index.markdown
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: Net::FTP.$X(...)
            - patterns:
                - pattern-inside: |
                    $FTP = Net::FTP.$OPEN(...)
                    ...
                    $FTP.$METHOD(...)
                - pattern: $FTP.$METHOD(...)
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby.rails.security.audit.avoid-tainted-http-request.avoid-tainted-http-request
      languages:
        - ruby
      message: Using user input when accessing files is potentially dangerous. A malicious actor could use this to modify or access files they have no right to.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/file_access/index.markdown
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: Net::HTTP::$METHOD.new(...)
                - metavariable-pattern:
                    metavariable: $METHOD
                    patterns:
                        - pattern-either:
                            - pattern: Copy
                            - pattern: Delete
                            - pattern: Get
                            - pattern: Head
                            - pattern: Lock
                            - pattern: Mkcol
                            - pattern: Move
                            - pattern: Options
                            - pattern: Patch
                            - pattern: Post
                            - pattern: Propfind
                            - pattern: Proppatch
                            - pattern: Put
                            - pattern: Trace
                            - pattern: Unlock
            - patterns:
                - pattern: Net::HTTP.$X(...)
                - metavariable-pattern:
                    metavariable: $X
                    patterns:
                        - pattern-either:
                            - pattern: get
                            - pattern: get2
                            - pattern: head
                            - pattern: head2
                            - pattern: options
                            - pattern: patch
                            - pattern: post
                            - pattern: post2
                            - pattern: post_form
                            - pattern: put
                            - pattern: request
                            - pattern: request_get
                            - pattern: request_head
                            - pattern: request_post
                            - pattern: send_request
                            - pattern: trace
                            - pattern: get_print
                            - pattern: get_response
                            - pattern: start
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby.rails.security.audit.avoid-tainted-shell-call.avoid-tainted-shell-call
      languages:
        - ruby
      message: Using user input when accessing files is potentially dangerous. A malicious actor could use this to modify or access files they have no right to.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/file_access/index.markdown
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: Kernel.$X(...)
                - patterns:
                    - pattern-either:
                        - pattern: Shell.$X(...)
                        - patterns:
                            - pattern-inside: |
                                $SHELL = Shell.$ANY(...)
                                ...
                                $SHELL.$X(...)
                            - pattern: $SHELL.$X(...)
            - metavariable-pattern:
                metavariable: $X
                patterns:
                    - pattern-either:
                        - pattern: cat
                        - pattern: chdir
                        - pattern: chroot
                        - pattern: delete
                        - pattern: entries
                        - pattern: exec
                        - pattern: foreach
                        - pattern: glob
                        - pattern: install
                        - pattern: lchmod
                        - pattern: lchown
                        - pattern: link
                        - pattern: load
                        - pattern: load_file
                        - pattern: makedirs
                        - pattern: move
                        - pattern: new
                        - pattern: open
                        - pattern: read
                        - pattern: readlines
                        - pattern: rename
                        - pattern: rmdir
                        - pattern: safe_unlink
                        - pattern: symlink
                        - pattern: syscopy
                        - pattern: sysopen
                        - pattern: system
                        - pattern: truncate
                        - pattern: unlink
      pattern-sources:
        - pattern-either:
            - pattern: params[...]
            - pattern: cookies
            - pattern: request.env
      severity: ERROR
    - id: ruby.rails.security.audit.rails-skip-forgery-protection.rails-skip-forgery-protection
      languages:
        - ruby
      message: This call turns off CSRF protection allowing CSRF attacks against the application
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://api.rubyonrails.org/classes/ActionController/RequestForgeryProtection/ClassMethods.html#method-i-skip_forgery_protection
        subcategory:
            - audit
        technology:
            - rails
      pattern: skip_forgery_protection
      severity: WARNING
    - id: ruby.rails.security.audit.sqli.ruby-pg-sqli.ruby-pg-sqli
      languages:
        - ruby
      message: 'Detected string concatenation with a non-literal variable in a pg Ruby SQL statement. This could lead to SQL injection if the variable is user-controlled and not properly sanitized. In order to prevent SQL injection, use parameterized queries or prepared statements instead. You can use parameterized queries like so: `conn.exec_params(''SELECT $1 AS a, $2 AS b, $3 AS c'', [1, 2, nil])` And you can use prepared statements with `exec_prepared`.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://www.rubydoc.info/gems/pg/PG/Connection
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-propagators:
        - from: $Y
          pattern: $X << $Y
          to: $X
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $CON = PG.connect(...)
                    ...
                - pattern-inside: |
                    $CON = PG::Connection.open(...)
                    ...
                - pattern-inside: |
                    $CON = PG::Connection.new(...)
                    ...
            - pattern-either:
                - pattern: |
                    $CON.$METHOD($X,...)
                - pattern: |
                    $CON.$METHOD $X, ...
            - focus-metavariable: $X
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(exec|exec_params)$
      pattern-sources:
        - pattern-either:
            - pattern: |
                params
            - pattern: |
                cookies
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-content-tag.avoid-content-tag
      languages:
        - ruby
      message: '''content_tag()'' bypasses HTML escaping for some portion of the content. If external data can reach here, this exposes your application to cross-site scripting (XSS) attacks. Ensure no external data reaches here. If you must do this, create your HTML manually and use ''html_safe''. Ensure no external data enters the HTML-safe string!'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/template_injection/index.markdown
            - https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_content_tag.rb
        subcategory:
            - audit
        technology:
            - rails
      pattern: content_tag(...)
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-html-safe.avoid-html-safe
      languages:
        - ruby
      message: '''html_safe()'' does not make the supplied string safe. ''html_safe()'' bypasses HTML escaping. If external data can reach here, this exposes your application to cross-site scripting (XSS) attacks. Ensure no external data reaches here.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/cross_site_scripting/index.markdown
            - https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_cross_site_scripting.rb
        subcategory:
            - audit
        technology:
            - rails
      pattern-either:
        - pattern: $STR.html_safe
        - pattern: $STR.html_safe.$MORE
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-link-to.avoid-link-to
      languages:
        - ruby
      message: This code includes user input in `link_to`. In Rails 2.x, the body of `link_to` is not escaped. This means that user input which reaches the body will be executed when the HTML is rendered. Even in other versions, values starting with `javascript:` or `data:` are not escaped. It is better to create and use a safer function which checks the body argument.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://brakemanscanner.org/docs/warning_types/link_to/
            - https://brakemanscanner.org/docs/warning_types/link_to_href/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_link_to.rb
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                "...#{...}..."
            - pattern-not: |
                "#{...}..."
      pattern-sinks:
        - pattern: link_to(...)
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
        - pattern-either:
            - pattern: $MODEL.url(...)
            - pattern: $MODEL.uri(...)
            - pattern: $MODEL.link(...)
            - pattern: $MODEL.page(...)
            - pattern: $MODEL.site(...)
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-raw.avoid-raw
      languages:
        - ruby
      message: '''raw()'' bypasses HTML escaping. If external data can reach here, this exposes your application to cross-site scripting (XSS) attacks. If you must do this, construct individual strings and mark them as safe for HTML rendering with `html_safe()`.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw
            - https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_cross_site_scripting.rb
        subcategory:
            - audit
        technology:
            - rails
      pattern: raw(...)
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-redirect.avoid-redirect
      languages:
        - ruby
      message: When a redirect uses user input, a malicious user can spoof a website under a trusted URL or access restricted parts of a site. When using user-supplied values, sanitize the value before using it for the redirect.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/redirect/
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - pattern: params.merge(:only_path => true)
        - pattern: params.merge(:host => ...)
      pattern-sinks:
        - pattern: redirect_to(...)
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
        - patterns:
            - pattern: $MODEL.$X(...)
            - pattern-not: $MODEL.$X("...")
            - metavariable-pattern:
                metavariable: $X
                pattern-either:
                    - pattern: all
                    - pattern: create
                    - pattern: create!
                    - pattern: find
                    - pattern: find_by_sql
                    - pattern: first
                    - pattern: last
                    - pattern: new
                    - pattern: from
                    - pattern: group
                    - pattern: having
                    - pattern: joins
                    - pattern: lock
                    - pattern: order
                    - pattern: reorder
                    - pattern: select
                    - pattern: where
                    - pattern: find_by
                    - pattern: find_by!
                    - pattern: take
      severity: WARNING
    - id: ruby.rails.security.audit.xss.avoid-render-dynamic-path.avoid-render-dynamic-path
      languages:
        - ruby
      message: Avoid rendering user input. It may be possible for a malicious user to input a path that lets them access a template they shouldn't. To prevent this, check dynamic template paths against a predefined allowlist to make sure it's an allowed template.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/dynamic_render_paths/
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: render($X => $INPUT, ...)
            - pattern: $INPUT
            - metavariable-pattern:
                metavariable: $X
                pattern-either:
                    - pattern: action
                    - pattern: template
                    - pattern: partial
                    - pattern: file
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - fix-regex:
        regex: 'text:'
        replacement: 'plain:'
      id: ruby.rails.security.audit.xss.avoid-render-text.avoid-render-text
      languages:
        - ruby
      message: '''render text: ...'' actually sets the content-type to ''text/html''. If external data can reach here, this exposes your application to cross-site scripting (XSS) attacks. Instead, use ''render plain: ...'' to render non-HTML text.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#inline-renders---even-worse-than-xss
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_render_inline.rb
        subcategory:
            - audit
        technology:
            - rails
      pattern: 'render text: ...'
      severity: WARNING
    - id: ruby.rails.security.audit.xss.templates.avoid-html-safe.avoid-html-safe
      languages:
        - generic
      message: '''html_safe'' renders raw HTML. This means that normal HTML escaping is bypassed. If user data can be controlled here, this exposes your application to cross-site scripting (XSS). If you need to do this, be sure to correctly sanitize the data using a library such as DOMPurify.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/4251284/raw-vs-html-safe-vs-h-to-unescape-html#:~:text===
            - https://medium.com/sumone-technical-blog/a-pretty-way-to-unescape-html-in-a-ruby-on-rails-application-efc22b850027
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_cross_site_scripting.rb
        subcategory:
            - audit
        technology:
            - rails
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern-inside: <%= ... %>
        - pattern: $SOMETHING.html_safe
      severity: WARNING
    - id: ruby.rails.security.audit.xss.templates.avoid-raw.avoid-raw
      languages:
        - generic
      message: '''raw'' renders raw HTML, as the name implies. This means that normal HTML escaping is bypassed. If user data can be controlled here, this exposes your application to cross-site scripting (XSS). If you need to do this, be sure to correctly sanitize the data using a library such as DOMPurify.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://stackoverflow.com/questions/4251284/raw-vs-html-safe-vs-h-to-unescape-html#:~:text===
            - https://medium.com/sumone-technical-blog/a-pretty-way-to-unescape-html-in-a-ruby-on-rails-application-efc22b850027
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_cross_site_scripting.rb
        subcategory:
            - audit
        technology:
            - rails
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern-inside: <%= ... %>
        - pattern: raw
      severity: WARNING
    - id: ruby.rails.security.audit.xss.templates.dangerous-link-to.dangerous-link-to
      languages:
        - generic
      message: 'Detected a template variable used in ''link_to''. This will generate dynamic data in the ''href'' attribute. This allows a malicious actor to input the ''javascript:'' URI and is subject to cross- site scripting (XSS) attacks. If using a relative URL, start with a literal forward slash and concatenate the URL, like this: ''link_to "Here", "/"+@link''. You may also consider setting the Content Security Policy (CSP) header.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html#cross-site-scripting-xss
            - https://brakemanscanner.org/docs/warning_types/link_to_href/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_link_to.rb
        subcategory:
            - audit
        technology:
            - rails
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern-inside: <%= ... %>
        - pattern-not-inside: link_to ... "/" + ... @$VAR
        - pattern-not-inside: link_to ... '/' + ... @$VAR
        - pattern: link_to ... @$VAR
      severity: WARNING
    - fix-regex:
        regex: <%=(.*?)%>
        replacement: '"<%=\1%>"'
      id: ruby.rails.security.audit.xss.templates.unquoted-attribute.unquoted-attribute
      languages:
        - generic
      message: 'Detected a unquoted template variable as an attribute. If unquoted, a malicious actor could inject custom JavaScript handlers. To fix this, add quotes around the template expression, like this: "<%= expr %>".'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#unquoted-attributes
            - https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss
        subcategory:
            - audit
        technology:
            - rails
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern-inside: <$TAG ...>
        - pattern-not-inside: ="..."
        - pattern-not-inside: ="<%= ... %>"
        - pattern-not-inside: ='...'
        - pattern-not-inside: ='<%= ... %>'
        - pattern: <%= ... %>
      severity: WARNING
    - id: ruby.rails.security.audit.xss.templates.var-in-href.var-in-href
      languages:
        - generic
      message: 'Detected a template variable used in an anchor tag with the ''href'' attribute. This allows a malicious actor to input the ''javascript:'' URI and is subject to cross- site scripting (XSS) attacks. If using a relative URL, start with a literal forward slash and concatenate the URL, like this: href=''/<%= link =>''. You may also consider setting the Content Security Policy (CSP) header.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss#:~:text=javascript:%20URI
            - https://github.com/pugjs/pug/issues/2952
        subcategory:
            - audit
        technology:
            - rails
      paths:
        include:
            - '*.erb'
      pattern-either:
        - pattern: <a ... href = "<%= ... %>" ... >
        - pattern: <a ... href = '<%= ... %>' ... >
      severity: WARNING
    - id: ruby.rails.security.audit.xxe.xml-external-entities-enabled.xml-external-entities-enabled
      languages:
        - ruby
      message: This application is explicitly enabling external entities enabling an attacker to inject malicious XML to exploit an XML External Entities (XXE) vulnerability. This could let the attacker cause a denial-of-service by forcing the parser to parse large files, or at worst, let the attacker download sensitive files or user data. Use the built-in Rails XML parser, REXML, instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.stackhawk.com/blog/rails-xml-external-entities-xxe-guide-examples-and-prevention/
            - https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - rails
            - libxml
      patterns:
        - pattern-either:
            - pattern-inside: |
                LibXML::XML.class_eval do
                  ...
                end
            - pattern-inside: |
                XML.class_eval do
                  ...
                end
        - pattern: XML.default_substitute_entities = true
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-before-filter.check-before-filter
      languages:
        - ruby
      message: 'Disabled-by-default Rails controller checks make it much easier to introduce access control mistakes. Prefer an allowlist approach with `:only => [...]` rather than `except: => [...]`'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_skip_before_filter.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: search
      patterns:
        - pattern-either:
            - pattern: |
                skip_filter ..., :except => $ARGS
            - pattern: |
                skip_before_filter ..., :except => $ARGS
            - pattern: |
                skip_before_action ..., :except => $ARGS
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-dynamic-render-local-file-include.check-dynamic-render-local-file-include
      languages:
        - generic
      message: Found request parameters in a call to `render` in a dynamic context. This can allow end users to request arbitrary local files which may result in leaking sensitive information persisted on disk.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion
            - https://github.com/presidentbeef/brakeman/blob/f74cb53ead47f0af821d98b5b41e16d63100c240/test/apps/rails2/app/views/home/test_render.html.erb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_render.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: search
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern: |
            params[...]
        - pattern-inside: |
            render :file => ...
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-http-verb-confusion.check-http-verb-confusion
      languages:
        - ruby
      message: Found an improperly constructed control flow block with `request.get?`. Rails will route HEAD requests as GET requests but they will fail the `request.get?` check, potentially causing unexpected behavior unless an `elif` condition is used.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-650: Trusting HTTP Permission Methods on the Server Side'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails6/app/controllers/accounts_controller.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_verb_confusion.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: search
      patterns:
        - pattern: |
            if request.get?
              ...
            else
              ...
            end
        - pattern-not-inside: |
            if ...
            elsif ...
              ...
            end
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-permit-attributes-high.check-permit-attributes-high
      languages:
        - ruby
      message: Calling `permit` on security-critical properties like `$ATTRIBUTE` may leave your application vulnerable to mass assignment.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_permit_attributes.rb
        subcategory:
            - audit
        technology:
            - ruby
            - rails
      patterns:
        - pattern: $P.permit($ATTRIBUTE)
        - metavariable-regex:
            metavariable: $ATTRIBUTE
            regex: .*(admin|account_id).*
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-rails-secret-yaml.check-rails-secret-yaml
      languages:
        - yaml
      message: $VALUE Found a string literal assignment to a production Rails session secret in `secrets.yaml`. Do not commit secret values to source control! Any user in possession of this value may falsify arbitrary session data in your application. Read this value from an environment variable, KMS, or file on disk outside of source control.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-540: Inclusion of Sensitive Information in Source Code'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails4/config/secrets.yml
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_session_settings.rb
        subcategory:
            - audit
        technology:
            - ruby
            - rails
      paths:
        include:
            - '*secrets.*.yml'
            - '*secrets.*.yaml'
      patterns:
        - pattern: |
            secret_key_base: $VALUE
        - metavariable-pattern:
            language: generic
            metavariable: $VALUE
            patterns:
                - pattern-not: |
                    <%= ... %>
        - pattern-inside: |
            production:
              ...
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-rails-session-secret-handling.check-rails-session-secret-handling
      languages:
        - ruby
      message: Found a string literal assignment to a Rails session secret `$KEY`. Do not commit secret values to source control! Any user in possession of this value may falsify arbitrary session data in your application. Read this value from an environment variable, KMS, or file on disk outside of source control.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-540: Inclusion of Sensitive Information in Source Code'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/02-Testing_for_Cookies_Attributes
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails4_with_engines/config/initializers/secret_token.rb
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails3/config/initializers/secret_token.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_session_settings.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    :$KEY => "$LITERAL"
                - pattern-inside: |
                    ActionController::Base.session = {...}
            - pattern: |
                $RAILS::Application.config.$KEY = "$LITERAL"
            - pattern: |
                Rails.application.config.$KEY = "$LITERAL"
        - metavariable-regex:
            metavariable: $KEY
            regex: ^secret(_(token|key_base))?$
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-redirect-to.check-redirect-to
      languages:
        - ruby
      message: Found potentially unsafe handling of redirect behavior $X. Do not pass `params` to `redirect_to` without the `:only_path => true` hash value.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_redirect.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        $F(...)
                    - metavariable-pattern:
                        metavariable: $F
                        patterns:
                            - pattern-not-regex: (params|url_for|cookies|request.env|permit|redirect_to)
                - pattern: |
                    params.merge! :only_path => true
                    ...
                - pattern: |
                    params.slice(...)
                    ...
                - pattern: |
                    redirect_to [...]
                - patterns:
                    - pattern: |
                        $MODEL. ... .$M(...)
                        ...
                    - metavariable-regex:
                        metavariable: $MODEL
                        regex: '[A-Z]\w+'
                    - metavariable-regex:
                        metavariable: $M
                        regex: (all|create|find|find_by|find_by_sql|first|last|new|from|group|having|joins|lock|order|reorder|select|where|take)
                - patterns:
                    - pattern: |
                        params.$UNSAFE_HASH.merge(...,:only_path => true,...)
                        ...
                    - metavariable-regex:
                        metavariable: $UNSAFE_HASH
                        regex: to_unsafe_h(ash)?
                - patterns:
                    - pattern: params.permit(...,$X,...)
                    - metavariable-pattern:
                        metavariable: $X
                        patterns:
                            - pattern-not-regex: (host|port|(sub)?domain)
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-inside: |
                redirect_to $X, ...
            - pattern-not-regex: params\.\w+(?<!permit)\(.*?\)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: params
                - pattern: cookies
                - pattern: request.env
                - pattern: url_for(params[...],...,:only_path => false,...)
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-regex-dos.check-regex-dos
      languages:
        - ruby
      message: Found a potentially user-controllable argument in the construction of a regular expressions. This may result in excessive resource consumption when applied to certain inputs, or when the user is allowed to control the match target. Avoid allowing users to specify regular expressions processed by the server. If you must support user-controllable input in a regular expression, use an allow-list to restrict the expressions users may supply to limit catastrophic backtracking.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1333: Inefficient Regular Expression Complexity'
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_regex_dos.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $Y
                    - pattern-inside: |
                        /...#{...}.../
                - patterns:
                    - pattern: $Y
                    - pattern-inside: |
                        Regexp.new(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    cookies[...]
                - patterns:
                    - pattern: |
                        cookies. ... .$PROPERTY[...]
                    - metavariable-regex:
                        metavariable: $PROPERTY
                        regex: (?!signed|encrypted)
                - pattern: |
                    params[...]
                - pattern: |
                    request.env[...]
                - patterns:
                    - pattern: $Y
                    - pattern-either:
                        - pattern-inside: |
                            $RECORD.read_attribute($Y)
                        - pattern-inside: |
                            $RECORD[$Y]
                    - metavariable-regex:
                        metavariable: $RECORD
                        regex: '[A-Z][a-z]+'
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-render-local-file-include.check-render-local-file-include
      languages:
        - ruby
      message: Found request parameters in a call to `render`. This can allow end users to request arbitrary local files which may result in leaking sensitive information persisted on disk. Where possible, avoid letting users specify template paths for `render`. If you must allow user input, use an allow-list of known templates or normalize the user-supplied value with `File.basename(...)`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion
            - https://github.com/presidentbeef/brakeman/blob/f74cb53/test/apps/rails2/app/controllers/home_controller.rb#L48-L60
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_render.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
        vulnerability_class:
            - Path Traversal
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: $MAP[...]
            - metavariable-pattern:
                metavariable: $MAP
                patterns:
                    - pattern-not-regex: params
        - pattern: File.basename(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    render ..., file: $X
                - pattern: |
                    render ..., inline: $X
                - pattern: |
                    render ..., template: $X
                - pattern: |
                    render ..., action: $X
                - pattern: |
                    render $X, ...
            - focus-metavariable: $X
      pattern-sources:
        - patterns:
            - pattern: params[...]
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-reverse-tabnabbing.check-reverse-tabnabbing
      languages:
        - generic
      message: Setting an anchor target of `_blank` without the `noopener` or `noreferrer` attribute allows reverse tabnabbing on Internet Explorer, Opera, and Android Webview.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1022: Use of Web Link to Untrusted Target with window.opener Access'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#browser_compatibility
            - https://github.com/presidentbeef/brakeman/blob/3f5d5d5/test/apps/rails5/app/views/users/show.html.erb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_reverse_tabnabbing.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: search
      paths:
        include:
            - '*.erb'
      patterns:
        - pattern: |
            _blank
        - pattern-inside: |
            target: ...
        - pattern-not-inside: |
            <%= ... rel: 'noopener noreferrer' ...%>
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    <%= $...INLINERUBYDO do -%>
                    ...
                    <% end %>
                - metavariable-pattern:
                    language: ruby
                    metavariable: $...INLINERUBYDO
                    patterns:
                        - pattern: |
                            link_to ...
                        - pattern-not: |
                            link_to "...", "...", ...
            - patterns:
                - pattern-not-inside: |
                    <%= ... do - %>
                - pattern-inside: |
                    <%= $...INLINERUBY %>
                - metavariable-pattern:
                    language: ruby
                    metavariable: $...INLINERUBY
                    patterns:
                        - pattern: |
                            link_to ...
                        - pattern-not: |
                            link_to '...', '...', ...
                        - pattern-not: |
                            link_to '...', target: ...
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-secrets.check-secrets
      languages:
        - ruby
      message: Found a Brakeman-style secret - a variable with the name password/secret/api_key/rest_auth_site_key and a non-empty string literal value.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
            - https://github.com/presidentbeef/brakeman/blob/3f5d5d5f00864cdf7769c50f5bd26f1769a4ba75/test/apps/rails3.1/app/controllers/users_controller.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_secrets.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      patterns:
        - pattern: $VAR = "$VALUE"
        - metavariable-regex:
            metavariable: $VAR
            regex: (?i)password|secret|(rest_auth_site|api)_key$
        - metavariable-regex:
            metavariable: $VALUE
            regex: .+
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-send-file.check-send-file
      languages:
        - ruby
      message: Allowing user input to `send_file` allows a malicious user to potentially read arbitrary files from the server. Avoid accepting user input in `send_file` or normalize with `File.basename(...)`
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-73: External Control of File Name or Path'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control/
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_send_file.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                send_file ...
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-sql.check-sql
      languages:
        - ruby
      message: Found potential SQL injection due to unsafe SQL query construction via $X. Where possible, prefer parameterized queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails3.1/app/models/product.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_sql.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $X
                    - pattern-either:
                        - pattern-inside: |
                            :$KEY => $X
                        - pattern-inside: |
                            ["...",$X,...]
                - pattern: |
                    params[...].to_i
                - pattern: |
                    params[...].to_f
                - patterns:
                    - pattern: |
                        params[...] ? $A : $B
                    - metavariable-pattern:
                        metavariable: $A
                        patterns:
                            - pattern-not: |
                                params[...]
                    - metavariable-pattern:
                        metavariable: $B
                        patterns:
                            - pattern-not: |
                                params[...]
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-not-inside: |
                $P.where("...",...)
            - pattern-not-inside: |
                $P.where(:$KEY => $VAL,...)
            - pattern-either:
                - pattern-inside: |
                    $P.$M(...)
                - pattern-inside: |
                    $P.$M("...",...)
            - pattern-inside: |
                class $P < ActiveRecord::Base
                  ...
                end
            - metavariable-regex:
                metavariable: $M
                regex: (where|find|first|last|select|minimum|maximum|calculate|sum|average)
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-unsafe-reflection-methods.check-unsafe-reflection-methods
      languages:
        - ruby
      message: Found user-controllable input to a reflection method. This may allow a user to alter program behavior and potentially execute arbitrary instructions in the context of the process. Do not provide arbitrary user input to `tap`, `method`, or `to_proc`
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails6/app/controllers/groups_controller.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_unsafe_reflection_methods.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-either:
                - pattern-inside: |
                    $X. ... .to_proc
                - patterns:
                    - pattern-inside: |
                        $Y.method($Z)
                    - focus-metavariable: $Z
                - patterns:
                    - pattern-inside: |
                        $Y.tap($Z)
                    - focus-metavariable: $Z
                - patterns:
                    - pattern-inside: |
                        $Y.tap{ |$ANY| $Z }
                    - focus-metavariable: $Z
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-unsafe-reflection.check-unsafe-reflection
      languages:
        - ruby
      message: Found user-controllable input to Ruby reflection functionality. This allows a remote user to influence runtime behavior, up to and including arbitrary remote code execution. Do not provide user-controllable input to reflection functionality. Do not call symbol conversion on user-controllable input.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2021 - Injection
        references:
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails2/app/controllers/application_controller.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_unsafe_reflection.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-either:
                - pattern-inside: |
                    $X.constantize
                - pattern-inside: |
                    $X. ... .safe_constantize
                - pattern-inside: |
                    const_get(...)
                - pattern-inside: |
                    qualified_const_get(...)
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby.rails.security.brakeman.check-unscoped-find.check-unscoped-find
      languages:
        - ruby
      message: Found an unscoped `find(...)` with user-controllable input. If the ActiveRecord model being searched against is sensitive, this may lead to Insecure Direct Object Reference (IDOR) behavior and allow users to read arbitrary records. Scope the find to the current user, e.g. `current_user.accounts.find(params[:id])`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-639: Authorization Bypass Through User-Controlled Key'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/unscoped_find/
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails3.1/app/controllers/users_controller.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_unscoped_find.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $MODEL.find(...)
                - pattern: $MODEL.find_by_id(...)
                - pattern: $MODEL.find_by_id!(...)
            - metavariable-regex:
                metavariable: $MODEL
                regex: '[A-Z]\S+'
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: WARNING
    - id: ruby.rails.security.brakeman.check-validation-regex.check-validation-regex
      languages:
        - ruby
      message: $V Found an incorrectly-bounded regex passed to `validates_format_of` or `validate ... format => ...`. Ruby regex behavior is multiline by default and lines should be terminated by `\A` for beginning of line and `\Z` for end of line, respectively.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-185: Incorrect Regular Expression'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/format_validation/
            - https://github.com/presidentbeef/brakeman/blob/aef6253a8b7bcb97116f2af1ed2a561a6ae35bd5/test/apps/rails3/app/models/account.rb
            - https://github.com/presidentbeef/brakeman/blob/main/test/apps/rails3.1/app/models/account.rb
        source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_validation_regex.rb
        subcategory:
            - vuln
        technology:
            - ruby
            - rails
      mode: search
      patterns:
        - pattern-either:
            - pattern: |
                validates ..., :format => <... $V ...>,...
            - pattern: |
                validates_format_of ..., :with => <... $V ...>,...
        - metavariable-regex:
            metavariable: $V
            regex: /(.{2}(?<!\\A)[^\/]+|[^\/]+(?<!\\[Zz]))\/
      severity: ERROR
    - id: ruby.rails.security.injection.raw-html-format.raw-html-format
      languages:
        - ruby
      message: Detected user input flowing into a manually constructed HTML string. You may be accidentally bypassing secure methods of rendering HTML by manually constructing HTML and this could create a cross-site scripting vulnerability, which could let attackers steal sensitive user data. Use the `render template` and make template files which will safely render HTML instead, or inspect that the HTML is absolutely rendered safely with a function like `sanitize`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/
            - https://api.rubyonrails.org/classes/ActionView/Helpers/SanitizeHelper.html
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - pattern: sanitize(...)
            - pattern: strip_tags(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        $HTMLSTR
                    - pattern-regex: <\w+.*
                - patterns:
                    - pattern-either:
                        - pattern: Kernel::sprintf("$HTMLSTR", ...)
                        - pattern: |
                            "$HTMLSTR" + $EXPR
                        - pattern: |
                            "$HTMLSTR" % $EXPR
                    - metavariable-pattern:
                        language: generic
                        metavariable: $HTMLSTR
                        pattern: <$TAG ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: params
                - pattern: request
      severity: WARNING
    - id: ruby.rails.security.injection.tainted-sql-string.tainted-sql-string
      languages:
        - ruby
      message: Detected user input used to manually construct a SQL string. This is usually bad practice because manual construction could accidentally result in a SQL injection. An attacker could use a SQL injection to steal or modify contents of the database. Instead, use a parameterized query which is available by default in most database engines. Alternatively, consider using an object-relational mapper (ORM) such as ActiveRecord which will protect your queries.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://rorsecurity.info/portfolio/ruby-on-rails-sql-injection-cheat-sheet
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - pattern: |
            $PARAMS.slice(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - patterns:
                            - pattern: |
                                $RECORD.where($X,...)
                        - pattern: |
                            $RECORD.find(..., :conditions => $X,...)
                    - focus-metavariable: $X
                - patterns:
                    - pattern: |
                        "$SQLVERB#{$EXPR}..."
                    - pattern-not-inside: |
                        $FUNC("...",  "...#{$EXPR}...",...)
                    - focus-metavariable: $SQLVERB
                    - pattern-regex: (?i)(select|delete|insert|create|update|alter|drop)\b
                - patterns:
                    - pattern-either:
                        - pattern: Kernel::sprintf("$SQLSTR", $EXPR)
                        - pattern: |
                            "$SQLSTR" + $EXPR
                        - pattern: |
                            "$SQLSTR" % $EXPR
                    - pattern-not-inside: |
                        $FUNC("...",  "...#{$EXPR}...",...)
                    - focus-metavariable: $EXPR
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(select|delete|insert|create|update|alter|drop)\b
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: params
                - pattern: request
      severity: ERROR
    - id: ruby.rails.security.injection.tainted-url-host.tainted-url-host
      languages:
        - ruby
      message: User data flows into the host portion of this manually-constructed URL. This could allow an attacker to send data to their own server, potentially exposing sensitive data such as cookies or authorization information sent with this request. They could also probe internal servers or other resources that the server running this code can access. (This is called server-side request forgery, or SSRF.) Do not allow arbitrary hosts. Use the `ssrf_filter` gem and guard the url construction with `SsrfFilter(...)`, or create an allowlist for approved hosts.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
            - https://github.com/arkadiyt/ssrf_filter
        subcategory:
            - vuln
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - pattern: SsrfFilter
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        $URLSTR
                    - pattern-regex: \w+:\/\/#{.*}
                - patterns:
                    - pattern-either:
                        - pattern: Kernel::sprintf("$URLSTR", ...)
                        - pattern: |
                            "$URLSTR" + $EXPR
                        - pattern: |
                            "$URLSTR" % $EXPR
                    - metavariable-pattern:
                        language: generic
                        metavariable: $URLSTR
                        pattern: $SCHEME:// ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: params
                - pattern: request
      severity: WARNING
    - id: rust.lang.security.args-os.args-os
      languages:
        - rust
      message: 'args_os should not be used for security operations. From the docs: "The first element is traditionally the path of the executable, but it can be set to arbitrary text, and might not even exist. This means this property should not be relied upon for security purposes."'
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-807: Reliance on Untrusted Inputs in a Security Decision'
        impact: LOW
        likelihood: LOW
        references:
            - https://doc.rust-lang.org/stable/std/env/fn.args_os.html
        subcategory: audit
        technology:
            - rust
      pattern: std::env::args_os()
      severity: INFO
    - id: rust.lang.security.args.args
      languages:
        - rust
      message: 'args should not be used for security operations. From the docs: "The first element is traditionally the path of the executable, but it can be set to arbitrary text, and might not even exist. This means this property should not be relied upon for security purposes."'
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-807: Reliance on Untrusted Inputs in a Security Decision'
        impact: LOW
        likelihood: LOW
        references:
            - https://doc.rust-lang.org/stable/std/env/fn.args.html
        subcategory: audit
        technology:
            - rust
      pattern: std::env::args()
      severity: INFO
    - id: rust.lang.security.current-exe.current-exe
      languages:
        - rust
      message: 'current_exe should not be used for security operations. From the docs: "The output of this function should not be trusted for anything that might have security implications. Basically, if users can run the executable, they can change the output arbitrarily."'
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-807: Reliance on Untrusted Inputs in a Security Decision'
        impact: LOW
        likelihood: LOW
        references:
            - https://doc.rust-lang.org/stable/std/env/fn.current_exe.html#security
        subcategory: audit
        technology:
            - rust
      pattern: std::env::current_exe()
      severity: INFO
    - id: rust.lang.security.insecure-hashes.insecure-hashes
      languages:
        - rust
      message: Detected cryptographically insecure hashing function
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-328: Use of Weak Hash'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://github.com/RustCrypto/hashes
            - https://docs.rs/md2/latest/md2/
            - https://docs.rs/md4/latest/md4/
            - https://docs.rs/md5/latest/md5/
            - https://docs.rs/sha-1/latest/sha1/
        subcategory: audit
        technology:
            - rust
      pattern-either:
        - pattern: md2::Md2::new(...)
        - pattern: md4::Md4::new(...)
        - pattern: md5::Md5::new(...)
        - pattern: sha1::Sha1::new(...)
      severity: WARNING
    - id: rust.lang.security.reqwest-accept-invalid.reqwest-accept-invalid
      languages:
        - rust
      message: Dangerously accepting invalid TLS information
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://docs.rs/reqwest/latest/reqwest/struct.ClientBuilder.html#method.danger_accept_invalid_hostnames
            - https://docs.rs/reqwest/latest/reqwest/struct.ClientBuilder.html#method.danger_accept_invalid_certs
        subcategory: vuln
        technology:
            - reqwest
      pattern-either:
        - pattern: reqwest::Client::builder(). ... .danger_accept_invalid_hostnames(true)
        - pattern: reqwest::Client::builder(). ... .danger_accept_invalid_certs(true)
      severity: WARNING
    - id: rust.lang.security.reqwest-set-sensitive.reqwest-set-sensitive
      languages:
        - rust
      message: Set sensitive flag on security headers with 'set_sensitive' to treat data with special care
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-921: Storage of Sensitive Data in a Mechanism without Access Control'
        impact: LOW
        likelihood: LOW
        references:
            - https://docs.rs/reqwest/latest/reqwest/header/struct.HeaderValue.html#method.set_sensitive
        subcategory: audit
        technology:
            - reqwest
      patterns:
        - pattern: |
            let mut $HEADERS = header::HeaderMap::new();
            ...
            let $HEADER_VALUE = <... header::HeaderValue::$FROM_FUNC(...) ...>;
            ...
            $HEADERS.insert($HEADER, $HEADER_VALUE);
        - pattern-not: |
            let mut $HEADERS = header::HeaderMap::new();
            ...
            let $HEADER_VALUE = <... header::HeaderValue::$FROM_FUNC(...) ...>;
            ...
            $HEADER_VALUE.set_sensitive(true);
            ...
            $HEADERS.insert($HEADER, $HEADER_VALUE);
        - metavariable-pattern:
            metavariable: $FROM_FUNC
            pattern-either:
                - pattern: from_static
                - pattern: from_str
                - pattern: from_name
                - pattern: from_bytes
                - pattern: from_maybe_shared
        - metavariable-pattern:
            metavariable: $HEADER
            pattern-either:
                - pattern: header::AUTHORIZATION
                - pattern: '"Authorization"'
      severity: INFO
    - id: rust.lang.security.rustls-dangerous.rustls-dangerous
      languages:
        - rust
      message: Dangerous client config used, ensure SSL verification
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://docs.rs/rustls/latest/rustls/client/struct.DangerousClientConfig.html
            - https://docs.rs/rustls/latest/rustls/client/struct.ClientConfig.html#method.dangerous
        subcategory: vuln
        technology:
            - rustls
      pattern-either:
        - pattern: rustls::client::DangerousClientConfig
        - pattern: $CLIENT.dangerous().set_certificate_verifier(...)
        - pattern: |
            let $CLIENT = rustls::client::ClientConfig::dangerous(...);
            ...
            $CLIENT.set_certificate_verifier(...);
      severity: WARNING
    - id: rust.lang.security.ssl-verify-none.ssl-verify-none
      languages:
        - rust
      message: SSL verification disabled, this allows for MitM attacks
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://docs.rs/openssl/latest/openssl/ssl/struct.SslContextBuilder.html#method.set_verify
        subcategory: vuln
        technology:
            - openssl
      pattern: $BUILDER.set_verify(openssl::ssl::SSL_VERIFY_NONE)
      severity: WARNING
    - id: rust.lang.security.temp-dir.temp-dir
      languages:
        - rust
      message: 'temp_dir should not be used for security operations. From the docs: ''The temporary directory may be shared among users, or between processes with different privileges; thus, the creation of any files or directories in the temporary directory must use a secure method to create a uniquely named file. Creating a file or directory with a fixed or predictable name may result in insecure temporary file security vulnerabilities.'''
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-807: Reliance on Untrusted Inputs in a Security Decision'
        impact: LOW
        likelihood: LOW
        references:
            - https://doc.rust-lang.org/stable/std/env/fn.temp_dir.html
        subcategory: audit
        technology:
            - rust
      pattern: std::env::temp_dir()
      severity: INFO
    - id: rust.lang.security.unsafe-usage.unsafe-usage
      languages:
        - rust
      message: Detected 'unsafe' usage, please audit for secure usage
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-242: Use of Inherently Dangerous Function'
        impact: LOW
        likelihood: LOW
        references:
            - https://doc.rust-lang.org/std/keyword.unsafe.html
        subcategory: audit
        technology:
            - rust
      pattern: unsafe { ... }
      severity: INFO
    - id: scala.jwt-scala.security.jwt-scala-hardcode.jwt-scala-hardcode
      languages:
        - scala
      message: 'Hardcoded JWT secret or private key is used. This is a Insufficiently Protected Credentials weakness: https://cwe.mitre.org/data/definitions/522.html Consider using an appropriate security mechanism to protect the credentials (e.g. keeping secrets in environment variables)'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://jwt-scala.github.io/jwt-scala/
        subcategory:
            - vuln
        technology:
            - scala
      patterns:
        - pattern-inside: |
            import pdi.jwt.$DEPS
            ...
        - pattern-either:
            - pattern: $JWT.encode($X, "...", ...)
            - pattern: $JWT.decode($X, "...", ...)
            - pattern: $JWT.decodeRawAll($X, "...", ...)
            - pattern: $JWT.decodeRaw($X, "...", ...)
            - pattern: $JWT.decodeAll($X, "...", ...)
            - pattern: $JWT.validate($X, "...", ...)
            - pattern: $JWT.isValid($X, "...", ...)
            - pattern: $JWT.decodeJson($X, "...", ...)
            - pattern: $JWT.decodeJsonAll($X, "...", ...)
            - patterns:
                - pattern-either:
                    - pattern: $JWT.encode($X, $KEY, ...)
                    - pattern: $JWT.decode($X, $KEY, ...)
                    - pattern: $JWT.decodeRawAll($X, $KEY, ...)
                    - pattern: $JWT.decodeRaw($X, $KEY, ...)
                    - pattern: $JWT.decodeAll($X, $KEY, ...)
                    - pattern: $JWT.validate($X, $KEY, ...)
                    - pattern: $JWT.isValid($X, $KEY, ...)
                    - pattern: $JWT.decodeJson($X, $KEY, ...)
                    - pattern: $JWT.decodeJsonAll($X, $KEY, ...)
                    - pattern: $JWT.encode($X, this.$KEY, ...)
                    - pattern: $JWT.decode($X, this.$KEY, ...)
                    - pattern: $JWT.decodeRawAll($X, this.$KEY, ...)
                    - pattern: $JWT.decodeRaw($X, this.$KEY, ...)
                    - pattern: $JWT.decodeAll($X, this.$KEY, ...)
                    - pattern: $JWT.validate($X, this.$KEY, ...)
                    - pattern: $JWT.isValid($X, this.$KEY, ...)
                    - pattern: $JWT.decodeJson($X, this.$KEY, ...)
                    - pattern: $JWT.decodeJsonAll($X, this.$KEY, ...)
                - pattern-either:
                    - pattern-inside: |
                        class $CL {
                          ...
                          $KEY = "..."
                          ...
                        }
                    - pattern-inside: |
                        object $CL {
                          ...
                          $KEY = "..."
                          ...
                        }
        - metavariable-pattern:
            metavariable: $JWT
            patterns:
                - pattern-either:
                    - pattern: Jwt
                    - pattern: JwtArgonaut
                    - pattern: JwtCirce
                    - pattern: JwtJson4s
                    - pattern: JwtJson
                    - pattern: JwtUpickle
      severity: WARNING
    - id: scala.lang.correctness.positive-number-index-of.positive-number-index-of
      languages:
        - scala
      message: Flags scala code that look for values that are greater than 0. This ignores the first element, which is most likely a bug. Instead, use indexOf with -1. If the intent is to check the inclusion of a value, use the contains method instead.
      metadata:
        category: correctness
        confidence: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        references:
            - https://blog.codacy.com/9-scala-security-issues/
        technology:
            - scala
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    $OBJ.indexOf(...) > $VALUE
                - metavariable-comparison:
                    comparison: $VALUE >= 0
                    metavariable: $VALUE
            - patterns:
                - pattern: |
                    $OBJ.indexOf(...) >= $SMALLERVAL
                - metavariable-comparison:
                    comparison: $SMALLERVAL > 0
                    metavariable: $SMALLERVAL
      severity: WARNING
    - id: scala.lang.security.audit.dangerous-seq-run.dangerous-seq-run
      languages:
        - scala
      message: Found dynamic content used for the external process. This is dangerous if arbitrary data can reach this function call because it allows a malicious actor to execute commands. Ensure your variables are not controlled by users or sufficiently sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern: Seq($CMD, ...)
        - pattern-not: Seq("...", ...)
        - pattern-inside: |
            import sys.process
            ...
        - pattern-not-inside: |
            $CMD = "..."
            ...
        - pattern-either:
            - pattern-inside: Seq(...).!
            - pattern-inside: Seq(...).!!
            - pattern-inside: Seq(...).lazyLines
      severity: ERROR
    - id: scala.lang.security.audit.dangerous-shell-run.dangerous-shell-run
      languages:
        - scala
      message: Found dynamic content used for the external process. This is dangerous if arbitrary data can reach this function call because it allows a malicious actor to execute commands. Ensure your variables are not controlled by users or sufficiently sanitized.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern: Seq($SH, "-c", $CMD, ...)
        - pattern-not: Seq($SH, "-c", "...", ...)
        - pattern-inside: |
            import sys.process
            ...
        - pattern-not-inside: |
            $CMD = "..."
            ...
        - pattern-either:
            - pattern-inside: Seq(...).!
            - pattern-inside: Seq(...).!!
            - pattern-inside: Seq(...).lazyLines
        - metavariable-regex:
            metavariable: $SH
            regex: '"(sh|bash|ksh|csh|tcsh|zsh)"'
      severity: ERROR
    - id: scala.lang.security.audit.dispatch-ssrf.dispatch-ssrf
      languages:
        - scala
      message: A parameter being passed directly into `url` most likely lead to SSRF. This could allow an attacker to send data to their own server, potentially exposing sensitive data sent with this request. They could also probe internal servers or other resources that the server running this code can access. Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
            - https://dispatchhttp.org/Dispatch.html
        subcategory:
            - audit
        technology:
            - scala
            - dispatch
      patterns:
        - pattern: url($URL)
        - pattern-inside: |
            import dispatch._
            ...
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = $A {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = {
                  ...
                }
      severity: WARNING
    - id: scala.lang.security.audit.documentbuilder-dtd-enabled.documentbuilder-dtd-enabled
      languages:
        - scala
      message: Document Builder being instantiated without calling the `setFeature` functions that are generally used for disabling entity processing. User controlled data in XML Document builder can result in XML Internal Entity Processing vulnerabilities like the disclosure of confidential data, denial of service, Server Side Request Forgery (SSRF), port scanning. Make sure to disable entity processing functionality.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        source-rule-url: https://cheatsheetseries.owasp.org//cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern: |
                $DF = DocumentBuilderFactory.newInstance(...)
                ...
                $DB = $DF.newDocumentBuilder(...)
            - patterns:
                - pattern: $DB = DocumentBuilderFactory.newInstance(...)
                - pattern-not-inside: |
                    ...
                    $X = $DB.newDocumentBuilder(...)
            - pattern: $DB = DocumentBuilderFactory.newInstance(...).newDocumentBuilder(...)
        - pattern-not-inside: |
            ...
            $DB.setXIncludeAware(true)
            ...
            $DB.setNamespaceAware(true)
            ...
            $DB.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
        - pattern-not-inside: |
            ...
            $DB.setXIncludeAware(true)
            ...
            $DB.setNamespaceAware(true)
            ...
            $DB.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-general-entities", false)
        - pattern-not-inside: |
            ...
            $DB.setXIncludeAware(true)
            ...
            $DB.setNamespaceAware(true)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $DB.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
        - pattern-not-inside: |
            ...
            $DB.setXIncludeAware(true)
            ...
            $DB.setNamespaceAware(true)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $DB.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
            ...
            $DB.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
      severity: WARNING
    - id: scala.lang.security.audit.insecure-random.insecure-random
      languages:
        - scala
      message: Flags the use of a predictable random value from `scala.util.Random`. This can lead to vulnerabilities when used in security contexts, such as in a CSRF token, password reset token, or any other secret value. To fix this, use java.security.SecureRandom instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-330: Use of Insufficiently Random Values'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        resources:
            - https://find-sec-bugs.github.io/bugs.htm
        subcategory:
            - audit
        technology:
            - scala
            - cryptography
      patterns:
        - pattern: |
            import scala.util.Random
      severity: WARNING
    - id: scala.lang.security.audit.io-source-ssrf.io-source-ssrf
      languages:
        - scala
      message: A parameter being passed directly into `fromURL` most likely lead to SSRF. This could allow an attacker to send data to their own server, potentially exposing sensitive data sent with this request. They could also probe internal servers or other resources that the server running this code can access. Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
            - https://www.scala-lang.org/api/current/scala/io/Source$.html#fromURL(url:java.net.URL)(implicitcodec:scala.io.Codec):scala.io.BufferedSource
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern: Source.fromURL($URL,...)
            - pattern: Source.fromURI($URL,...)
        - pattern-inside: |
            import scala.io.$SOURCE
            ...
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = $A {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = {
                  ...
                }
      severity: WARNING
    - id: scala.lang.security.audit.path-traversal-fromfile.path-traversal-fromfile
      languages:
        - scala
      message: Flags cases of possible path traversal. If an unfiltered parameter is passed into 'fromFile', file from an arbitrary filesystem location could be read. This could lead to sensitive data exposure and other provles. Instead, sanitize the user input instead of performing direct string concatenation.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path Traversal'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        resources:
            - https://find-sec-bugs.github.io/bugs.htm
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        $FILENAME = "..." + $VAR
                        ...
                    - pattern-inside: |
                        $FILENAME = $VAR + "..."
                        ...
                    - pattern-inside: |
                        $FILENAME = $STR.concat($VAR)
                        ...
                    - pattern-inside: |
                        $FILENAME = "...".format(..., $VAR, ...)
                        ...
                - pattern: Source.fromFile($FILENAME, ...)
            - patterns:
                - pattern-either:
                    - pattern: Source.fromFile("..." + $VAR, ...)
                    - pattern: Source.fromFile($VAR + "...", ...)
                    - pattern: Source.fromFile($STR.concat($VAR), ...)
                    - pattern: Source.fromFile("...".format(..., $VAR, ...), ...)
        - pattern-inside: |
            def $FUNC(..., $VAR: $TYPE, ...) = Action {
              ...
            }
      severity: WARNING
    - id: scala.lang.security.audit.rsa-padding-set.rsa-padding-set
      languages:
        - scala
      message: Usage of RSA without OAEP (Optimal Asymmetric Encryption Padding) may weaken encryption. This could lead to sensitive data exposure. Instead, use RSA with `OAEPWithMD5AndMGF1Padding` instead.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-780: Use of RSA Algorithm without OAEP'
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        resources:
            - https://blog.codacy.com/9-scala-security-issues/
        subcategory:
            - audit
        technology:
            - scala
            - cryptography
      patterns:
        - pattern: |
            $VAR = $CIPHER.getInstance($MODE)
        - metavariable-regex:
            metavariable: $MODE
            regex: .*RSA/.*/NoPadding.*
      severity: WARNING
    - id: scala.lang.security.audit.sax-dtd-enabled.sax-dtd-enabled
      languages:
        - scala
      message: XML processor being instantiated without calling the `setFeature` functions that are generally used for disabling entity processing. User controlled data in XML Parsers can result in XML Internal Entity Processing vulnerabilities like the disclosure of confidential data, denial of service, Server Side Request Forgery (SSRF), port scanning. Make sure to disable entity processing functionality.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        source-rule-url: https://cheatsheetseries.owasp.org//cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern: $SR = new SAXReader(...)
            - pattern: |
                $SF = SAXParserFactory.newInstance(...)
                ...
                $SR = $SF.newSAXParser(...)
            - patterns:
                - pattern: $SR = SAXParserFactory.newInstance(...)
                - pattern-not-inside: |
                    ...
                    $X = $SR.newSAXParser(...)
            - pattern: $SR = SAXParserFactory.newInstance(...).newSAXParser(...)
            - pattern: $SR = new SAXBuilder(...)
        - pattern-not-inside: |
            ...
            $SR.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
        - pattern-not-inside: |
            ...
            $SR.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-general-entities", false)
        - pattern-not-inside: |
            ...
            $SR.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $SR.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
        - pattern-not-inside: |
            ...
            $SR.setFeature("http://xml.org/sax/features/external-general-entities", false)
            ...
            $SR.setFeature("http://xml.org/sax/features/external-parameter-entities", false)
            ...
            $SR.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
      severity: WARNING
    - id: scala.lang.security.audit.scala-dangerous-process-run.scala-dangerous-process-run
      languages:
        - scala
      message: Found dynamic content used for the external process. This is dangerous if arbitrary data can reach this function call because it allows a malicious actor to execute commands. Use `Seq(...)` for dynamically generated commands.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern: $X.!
            - pattern: $X.!!
            - pattern: $X.lazyLines
        - pattern-inside: |
            import sys.process
            ...
        - pattern-not: |
            "...".!
        - pattern-not: |
            "...".!!
        - pattern-not: |
            "...".lazyLines
        - pattern-not: |
            Seq(...).!
        - pattern-not: |
            Seq(...).!!
        - pattern-not: |
            Seq(...).lazyLines
        - pattern-not-inside: |
            val $X = "..."
            ...
        - pattern-not-inside: |
            val $X = Seq(...)
            ...
      severity: ERROR
    - id: scala.lang.security.audit.scalac-debug.scalac-debug
      languages:
        - generic
      message: Scala applications built with `debug` set to true in production may leak debug information to attackers. Debug mode also affects performance and reliability. Remove it from configuration.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-489: Active Debug Code'
        impact: LOW
        likelihood: LOW
        owasp: A05:2021 - Security Misconfiguration
        references:
            - https://docs.scala-lang.org/overviews/compiler-options/index.html
        subcategory:
            - audit
        technology:
            - scala
            - sbt
      paths:
        include:
            - '*.sbt*'
      patterns:
        - pattern-either:
            - pattern: scalacOptions ... "-Vdebug"
            - pattern: scalacOptions ... "-Ydebug"
      severity: WARNING
    - id: scala.lang.security.audit.scalaj-http-ssrf.scalaj-http-ssrf
      languages:
        - scala
      message: A parameter being passed directly into `Http` can likely lead to SSRF. This could allow an attacker to send data to their own server, potentially exposing sensitive data sent with this request. They could also probe internal servers or other resources that the server running this code can access. Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts, or hardcode the correct host.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
            - https://github.com/scalaj/scalaj-http#simplified-http
        subcategory:
            - audit
        technology:
            - scala
            - scalaj-http
      patterns:
        - pattern: Http($URL)
        - pattern-inside: |
            import scalaj.http.$HTTP
            ...
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = $A {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = {
                  ...
                }
      severity: WARNING
    - id: scala.lang.security.audit.scalajs-eval.scalajs-eval
      languages:
        - scala
      message: '`eval()` function evaluates JavaScript code represented as a string. Executing JavaScript from a string is an enormous security risk. It is far too easy for a bad actor to run arbitrary code when you use `eval()`. Do not use eval(). Alternatively: Ensure evaluated content is not definable by external sources. If its not possible, strip everything except alphanumeric characters from an input provided for the command string and arguments.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2021 - Injection
        references:
            - https://www.scala-js.org/doc/
        subcategory:
            - vuln
        technology:
            - scala
            - scala-js
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $JS.eval(...)
            - pattern-inside: |
                import scala.scalajs.$X
                ...
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-either:
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = {
                      ...
                    }
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = $A {
                      ...
                    }
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = $A(...) {
                      ...
                    }
      severity: WARNING
    - id: scala.lang.security.audit.tainted-sql-string.tainted-sql-string
      languages:
        - scala
      message: User data flows into this manually-constructed SQL string. User data can be safely inserted into SQL strings using prepared statements or an object-relational mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL injection, which could let an attacker steal or manipulate data from the database. Instead, use prepared statements (`connection.PreparedStatement`) or a safe library.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html
        subcategory:
            - vuln
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $LOGGER.$METHOD(...)
                    - pattern: $LOGGER(...)
                - metavariable-regex:
                    metavariable: $LOGGER
                    regex: (i?)log.*
            - patterns:
                - pattern: $LOGGER.$METHOD(...)
                - metavariable-regex:
                    metavariable: $METHOD
                    regex: (i?)(trace|info|warn|warning|warnToError|error|debug)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: |
                            "$SQLSTR" + ...
                        - pattern: |
                            "$SQLSTR".format(...)
                        - patterns:
                            - pattern-inside: |
                                $SB = new StringBuilder("$SQLSTR");
                                ...
                            - pattern: $SB.append(...)
                        - patterns:
                            - pattern-inside: |
                                $VAR = "$SQLSTR"
                                ...
                            - pattern: $VAR += ...
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(select|delete|insert|create|update|alter|drop)\b
                - patterns:
                    - pattern-either:
                        - pattern: s"..."
                        - pattern: f"..."
                    - pattern-regex: |
                        .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
            - pattern-not-inside: println(...)
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-either:
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = {
                      ...
                    }
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = $A {
                      ...
                    }
                - pattern-inside: |
                    def $CTRL(..., $PARAM: $TYPE, ...) = $A(...) {
                      ...
                    }
      severity: ERROR
    - id: scala.lang.security.audit.xmlinputfactory-dtd-enabled.xmlinputfactory-dtd-enabled
      languages:
        - scala
      message: XMLInputFactory being instantiated without calling the setProperty functions that are generally used for disabling entity processing. User controlled data in XML Document builder can result in XML Internal Entity Processing vulnerabilities like the disclosure of confidential data, denial of service, Server Side Request Forgery (SSRF), port scanning. Make sure to disable entity processing functionality.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-611: Improper Restriction of XML External Entity Reference'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2017 - XML External Entities (XXE)
            - A05:2021 - Security Misconfiguration
        references:
            - https://owasp.org/Top10/A05_2021-Security_Misconfiguration
        source-rule-url: https://cheatsheetseries.owasp.org//cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
        subcategory:
            - audit
        technology:
            - scala
      patterns:
        - pattern-not-inside: |
            ...
            $XMLFACTORY.setProperty("javax.xml.stream.isSupportingExternalEntities", false)
        - pattern-either:
            - pattern: $XMLFACTORY = XMLInputFactory.newFactory(...)
            - pattern: $XMLFACTORY = XMLInputFactory.newInstance(...)
            - pattern: $XMLFACTORY = new XMLInputFactory(...)
      severity: WARNING
    - id: scala.play.security.conf-csrf-headers-bypass.conf-csrf-headers-bypass
      languages:
        - generic
      message: Possibly bypassable CSRF configuration found. CSRF is an attack that forces an end user to execute unwanted actions on a web application in which theyre currently authenticated. Make sure that Content-Type black list is configured and CORS filter is turned on.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-352: Cross-Site Request Forgery (CSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: LOW
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://www.playframework.com/documentation/2.8.x/Migration25#CSRF-changes
            - https://owasp.org/www-community/attacks/csrf
        subcategory:
            - vuln
        technology:
            - scala
            - play
      paths:
        include:
            - '*.conf'
      patterns:
        - pattern-either:
            - pattern: X-Requested-With = "*"
            - pattern: Csrf-Token = "..."
        - pattern-inside: |
            bypassHeaders {...
            ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."application/x-www-form-urlencoded"..."multipart/form-data"..."text/plain"...]
              ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."application/x-www-form-urlencoded"..."text/plain"..."multipart/form-data"...]
              ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."multipart/form-data"..."application/x-www-form-urlencoded"..."text/plain"...]
              ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."multipart/form-data"..."text/plain"..."application/x-www-form-urlencoded"...]
              ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."text/plain"..."application/x-www-form-urlencoded"..."multipart/form-data"...]
              ...
            ...}
        - pattern-not-inside: |
            {...
              ...
              ...blackList = [..."text/plain"..."multipart/form-data"..."application/x-www-form-urlencoded"...]
              ...
            ...}
      severity: ERROR
    - id: scala.play.security.conf-insecure-cookie-settings.conf-insecure-cookie-settings
      languages:
        - generic
      message: Session cookie `Secure` flag is explicitly disabled. The `secure` flag for cookies prevents the client from transmitting the cookie over insecure channels such as HTTP. Set the `Secure` flag by setting `secure` to `true` in configuration file.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-614: Sensitive Cookie in HTTPS Session Without ''Secure'' Attribute'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#security
            - https://www.playframework.com/documentation/2.8.x/SettingsSession#Session-Configuration
        subcategory:
            - vuln
        technology:
            - play
            - scala
      paths:
        include:
            - '*.conf'
      patterns:
        - pattern: secure = false
        - pattern-inside: |
            session = {
              ...
            }
      severity: WARNING
    - id: scala.play.security.tainted-html-response.tainted-html-response
      languages:
        - scala
      message: Detected a request with potential user-input going into an `Ok()` response. This bypasses any view or template environments, including HTML escaping, which may expose this application to cross-site scripting (XSS) vulnerabilities. Consider using a view technology such as Twirl which automatically escapes HTML views.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - vuln
        technology:
            - scala
            - play
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - pattern: org.apache.commons.lang3.StringEscapeUtils.escapeHtml4(...)
            - pattern: org.owasp.encoder.Encode.forHtml(...)
      pattern-sinks:
        - pattern-either:
            - pattern: Html.apply(...)
            - pattern: Ok(...).as(HTML)
            - pattern: Ok(...).as(ContentTypes.HTML)
            - patterns:
                - pattern: Ok(...).as($CTYPE)
                - metavariable-regex:
                    metavariable: $CTYPE
                    regex: '"[tT][eE][xX][tT]/[hH][tT][mM][lL]"'
            - patterns:
                - pattern: Ok(...).as($CTYPE)
                - pattern-not: Ok(...).as("...")
                - pattern-either:
                    - pattern-inside: |
                        def $FUNC(..., $URL: $T, ...) = $A {
                          ...
                        }
                    - pattern-inside: |
                        def $FUNC(..., $URL: $T, ...) = {
                          ...
                        }
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $REQ
                    - pattern-either:
                        - pattern-inside: "Action {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                - patterns:
                    - pattern: $PARAM
                    - pattern-either:
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action(...) {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async(...) {
                              ...
                            }
      severity: WARNING
    - id: scala.play.security.tainted-slick-sqli.tainted-slick-sqli
      languages:
        - scala
      message: Detected a tainted SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Avoid using using user input for generating SQL strings.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://scala-slick.org/doc/3.3.3/sql.html#splicing-literal-values
            - https://scala-slick.org/doc/3.2.0/sql-to-slick.html#non-optimal-sql-code
        subcategory:
            - vuln
        technology:
            - scala
            - slick
            - play
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $MODEL.overrideSql(...)
                - pattern: sql"..."
            - pattern-inside: |
                import slick.$DEPS
                ...
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $REQ
                    - pattern-either:
                        - pattern-inside: "Action {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                - patterns:
                    - pattern: $PARAM
                    - pattern-either:
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action(...) {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async(...) {
                              ...
                            }
      severity: ERROR
    - id: scala.play.security.tainted-sql-from-http-request.tainted-sql-from-http-request
      languages:
        - scala
      message: User data flows into this manually-constructed SQL string. User data can be safely inserted into SQL strings using prepared statements or an object-relational mapper (ORM). Manually-constructed SQL strings is a possible indicator of SQL injection, which could let an attacker steal or manipulate data from the database. Instead, use prepared statements (`connection.PreparedStatement`) or a safe library.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html
        subcategory:
            - vuln
        technology:
            - scala
            - play
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: |
                            "$SQLSTR" + ...
                        - pattern: |
                            "$SQLSTR".format(...)
                        - patterns:
                            - pattern-inside: |
                                $SB = new StringBuilder("$SQLSTR");
                                ...
                            - pattern: $SB.append(...)
                        - patterns:
                            - pattern-inside: |
                                $VAR = "$SQLSTR"
                                ...
                            - pattern: $VAR += ...
                    - metavariable-regex:
                        metavariable: $SQLSTR
                        regex: (?i)(select|delete|insert|create|update|alter|drop)\b
                - patterns:
                    - pattern: s"..."
                    - pattern-regex: |
                        .*\b(?i)(select|delete|insert|create|update|alter|drop)\b.*
            - pattern-not-inside: println(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $REQ
                    - pattern-either:
                        - pattern-inside: "Action {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async {\n  $REQ: Request[$T] => \n    ...\n}\n"
                        - pattern-inside: "Action.async(...) {\n  $REQ: Request[$T] => \n    ...\n}\n"
                - patterns:
                    - pattern: $PARAM
                    - pattern-either:
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action(...) {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async {
                              ...
                            }
                        - pattern-inside: |
                            def $CTRL(..., $PARAM: $TYPE, ...) = Action.async(...) {
                              ...
                            }
      severity: ERROR
    - id: scala.play.security.webservice-ssrf.webservice-ssrf
      languages:
        - scala
      message: A parameter being passed directly into `WSClient` most likely lead to SSRF. This could allow an attacker to send data to their own server, potentially exposing sensitive data sent with this request. They could also probe internal servers or other resources that the server running this code can access. Do not allow arbitrary hosts. Instead, create an allowlist for approved hosts hardcode the correct host.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
            - https://www.playframework.com/documentation/2.8.x/ScalaWS
        subcategory:
            - audit
        technology:
            - scala
            - play
      patterns:
        - pattern: $WS.url($URL)
        - pattern-either:
            - pattern-inside: |
                class $CLASS (..., $WS: WSClient, ...) {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $WS: WSClient, ...) = {
                  ...
                }
            - pattern-inside: |
                $WS = AhcWSClient(...)
                ...
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = $A {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $URL: $T, ...) = {
                  ...
                }
      severity: WARNING
    - id: scala.scala-jwt.security.jwt-hardcode.scala-jwt-hardcoded-secret
      languages:
        - scala
      message: 'Hardcoded JWT secret or private key is used. This is a Insufficiently Protected Credentials weakness: https://cwe.mitre.org/data/definitions/522.html Consider using an appropriate security mechanism to protect the credentials (e.g. keeping secrets in environment variables)'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
      pattern-either:
        - pattern: |
            com.auth0.jwt.algorithms.Algorithm.HMAC256("...");
        - pattern: |
            $SECRET = "...";
            ...
            com.auth0.jwt.algorithms.Algorithm.HMAC256($SECRET);
        - pattern: |
            class $CLASS {
              ...
              $DECL $SECRET = "...";
              ...
              def $FUNC (...): $RETURNTYPE = {
                ...
                com.auth0.jwt.algorithms.Algorithm.HMAC256($SECRET);
                ...
              }
              ...
            }
        - pattern: |
            com.auth0.jwt.algorithms.Algorithm.HMAC384("...");
        - pattern: |
            $SECRET = "...";
            ...
            com.auth0.jwt.algorithms.Algorithm.HMAC384($SECRET);
        - pattern: |
            class $CLASS {
              ...
              $DECL $SECRET = "...";
              ...
              def $FUNC (...): $RETURNTYPE = {
                ...
                com.auth0.jwt.algorithms.Algorithm.HMAC384($SECRET);
                ...
              }
              ...
            }
        - pattern: |
            com.auth0.jwt.algorithms.Algorithm.HMAC512("...");
        - pattern: |
            $SECRET = "...";
            ...
            com.auth0.jwt.algorithms.Algorithm.HMAC512($SECRET);
        - pattern: |
            class $CLASS {
              ...
              $DECL $SECRET = "...";
              ...
              def $FUNC (...): $RETURNTYPE = {
                ...
                com.auth0.jwt.algorithms.Algorithm.HMAC512($SECRET);
                ...
              }
              ...
            }
      severity: ERROR
    - id: scala.slick.security.scala-slick-overridesql-literal.scala-slick-overridesql-literal
      languages:
        - scala
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Avoid using non literal values in `overrideSql(...)`.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        subcategory:
            - audit
        technology:
            - scala
            - slick
      patterns:
        - pattern: $MODEL.overrideSql($QUERY,...)
        - pattern-not: $MODEL.overrideSql("...",...)
        - pattern-not-inside: |
            $QUERY = "..."
            ...
      severity: ERROR
    - id: scala.slick.security.scala-slick-sql-non-literal.scala-slick-sql-non-literal
      languages:
        - scala
      message: Detected a formatted string in a SQL statement. This could lead to SQL injection if variables in the SQL statement are not properly sanitized. Avoid using `#$variable` and use `$variable` in `sql"..."` strings instead.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command (''SQL Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://scala-slick.org/doc/3.3.3/sql.html#splicing-literal-values
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SCALA_SQL_INJECTION_SLICK
        subcategory:
            - audit
        technology:
            - scala
            - slick
      patterns:
        - pattern: sql"..."
        - pattern-regex: \#\$
        - pattern-inside: |
            import slick.$DEPS
            ...
      severity: ERROR
    - id: swift.lang.storage.sensitive-storage-userdefaults.swift-user-defaults
      languages:
        - swift
      message: Potentially sensitive data was observed to be stored in UserDefaults, which is not adequate protection of sensitive information. For data of a sensitive nature, applications should leverage the Keychain.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: HIGH
        likelihood: LOW
        masvs:
            - 'MASVS-STORAGE-1: The app securely stores sensitive data'
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://developer.apple.com/library/archive/documentation/Security/Conceptual/SecureCodingGuide/Articles/ValidatingInput.html
            - https://mas.owasp.org/MASVS/controls/MASVS-STORAGE-1/
        subcategory:
            - vuln
        technology:
            - ios
            - macos
      options:
        symbolic_propagation: true
      patterns:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $VALUE
                    regex: (?i).*(passcode|password|pass_word|passphrase|pass_code|pass_word|pass_phrase)$
                - focus-metavariable: $VALUE
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $KEY
                    regex: (?i).*(passcode|password|pass_word|passphrase|pass_code|pass_word|pass_phrase)$
                - focus-metavariable: $KEY
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $VALUE
                    regex: (?i).*(api_key|apikey)$
                - focus-metavariable: $VALUE
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $KEY
                    regex: (?i).*(api_key|apikey)$
                - focus-metavariable: $KEY
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $VALUE
                    regex: (?i).*(secretkey|secret_key|secrettoken|secret_token|clientsecret|client_secret)$
                - focus-metavariable: $VALUE
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $KEY
                    regex: (?i).*(secretkey|secret_key|secrettoken|secret_token|clientsecret|client_secret)$
                - focus-metavariable: $KEY
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $VALUE
                    regex: (?i).*(cryptkey|cryptokey|crypto_key|cryptionkey|symmetrickey|privatekey|symmetric_key|private_key)$
                - focus-metavariable: $VALUE
            - patterns:
                - pattern-either:
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set("$VALUE", forKey: $KEY)
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: "$KEY")
                    - pattern: |
                        UserDefaults.standard.set($VALUE, forKey: $KEY)
                - metavariable-regex:
                    metavariable: $KEY
                    regex: (?i).*(cryptkey|cryptokey|crypto_key|cryptionkey|symmetrickey|privatekey|symmetric_key|private_key)$
                - focus-metavariable: $KEY
      severity: WARNING
    - id: swift.webview.webview-js-window.swift-webview-config-allows-js-open-windows
      languages:
        - swift
      message: Webviews were observed that explictly allow JavaScript in an WKWebview to open windows automatically. Consider disabling this functionality if not required, following the principle of least privelege.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-272: Least Privilege Violation'
        impact: LOW
        likelihood: LOW
        masvs:
            - 'MASVS-PLATFORM-2: The app uses WebViews securely'
        references:
            - https://mas.owasp.org/MASVS/controls/MASVS-PLATFORM-2/
            - https://developer.apple.com/documentation/webkit/wkpreferences/1536573-javascriptcanopenwindowsautomati
        subcategory:
            - audit
        technology:
            - ios
            - macos
      patterns:
        - pattern: |
            $P = WKPreferences()
            ...
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $P.JavaScriptCanOpenWindowsAutomatically  = $FALSE
                    ...
                    $P.JavaScriptCanOpenWindowsAutomatically  = $TRUE
                - pattern-not-inside: |
                    ...
                    $P.JavaScriptCanOpenWindowsAutomatically  = $TRUE
                    ...
                    $P.JavaScriptCanOpenWindowsAutomatically = $FALSE
                - pattern: |
                    $P.JavaScriptCanOpenWindowsAutomatically  = true
                - metavariable-regex:
                    metavariable: $TRUE
                    regex: ^(true)$
                - metavariable-regex:
                    metavariable: $TRUE
                    regex: (.*(?!true))
            - patterns:
                - pattern: |
                    $P.JavaScriptCanOpenWindowsAutomatically  = true
                - pattern-not-inside: |
                    ...
                    $P.JavaScriptCanOpenWindowsAutomatically  = ...
                    ...
                    $P.JavaScriptCanOpenWindowsAutomatically  = ...
      severity: WARNING
    - id: terraform.aws.correctness.subscription-filter-missing-depends.subscription-filter-missing-depends
      languages:
        - hcl
      message: The `aws_cloudwatch_log_subscription_filter` resource "$NAME" needs a `depends_on` clause on the `aws_lambda_permission`, otherwise Terraform may try to create these out-of-order and fail.
      metadata:
        category: correctness
        confidence: MEDIUM
        references:
            - https://stackoverflow.com/questions/38407660/terraform-configuring-cloudwatch-log-subscription-delivery-to-lambda/38428834#38428834
        technology:
            - aws
            - terraform
            - aws-lambda
            - cloudwatch
      patterns:
        - pattern: |
            resource "aws_cloudwatch_log_subscription_filter" $NAME {
              ...
              destination_arn = aws_lambda_function.$LAMBDA_NAME.arn
            }
        - pattern-not-inside: |
            resource "aws_cloudwatch_log_subscription_filter" $NAME {
              ...
              depends_on = [..., aws_lambda_permission.$PERMISSION_NAME, ...]
            }
      severity: WARNING
    - id: terraform.aws.security.aws-cloudfront-insecure-tls.aws-insecure-cloudfront-distribution-tls-version
      languages:
        - hcl
      message: Detected an AWS CloudFront Distribution with an insecure TLS version. TLS versions less than 1.2 are considered insecure because they can be broken. To fix this, set your `minimum_protocol_version` to `"TLSv1.2_2018", "TLSv1.2_2019" or "TLSv1.2_2021"`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_cloudfront_distribution" $ANYTHING {
              ...
              viewer_certificate {
                ...
              }
              ...
            }
        - pattern-not-inside: |
            resource "aws_cloudfront_distribution" $ANYTHING {
              ...
              viewer_certificate {
                ...
                minimum_protocol_version = "TLSv1.2_2018"
                ...
              }
              ...
            }
        - pattern-not-inside: |
            resource "aws_cloudfront_distribution" $ANYTHING {
              ...
              viewer_certificate {
                ...
                minimum_protocol_version = "TLSv1.2_2019"
                ...
              }
              ...
            }
        - pattern-not-inside: |
            resource "aws_cloudfront_distribution" $ANYTHING {
              ...
              viewer_certificate {
                ...
                minimum_protocol_version = "TLSv1.2_2021"
                ...
              }
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-cloudwatch-log-group-no-retention.aws-cloudwatch-log-group-no-retention
      languages:
        - hcl
      message: The AWS CloudWatch Log Group has no retention. Missing retention in log groups can cause losing important event information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_cloudwatch_log_group" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_cloudwatch_log_group" $ANYTHING {
              ...
              retention_in_days = ...
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-codebuild-project-unencrypted.aws-codebuild-project-unencrypted
      languages:
        - hcl
      message: The AWS CodeBuild Project is unencrypted. The AWS KMS encryption key protects projects in the CodeBuild. To create your own, create a aws_kms_key resource or use the ARN string of a key in your account.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_codebuild_project" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_codebuild_project" $ANYTHING {
              ...
              encryption_key = ...
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-config-aggregator-not-all-regions.aws-config-aggregator-not-all-regions
      languages:
        - hcl
      message: The AWS configuration aggregator does not aggregate all AWS Config region. This may result in unmonitored configuration in regions that are thought to be unused. Configure the aggregator with all_regions for the source.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-778: Insufficient Logging'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A09:2021 - Security Logging and Monitoring Failures
        references:
            - https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      pattern-either:
        - pattern: |
            resource "aws_config_configuration_aggregator" $ANYTHING {
              ...
              account_aggregation_source {
                ...
                regions = ...
                ...
              }
              ...
            }
        - pattern: |
            resource "aws_config_configuration_aggregator" $ANYTHING {
              ...
              organization_aggregation_source {
                ...
                regions = ...
                ...
              }
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-db-instance-no-logging.aws-db-instance-no-logging
      languages:
        - hcl
      message: Database instance has no logging. Missing logs can cause missing important event information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: LOW
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_db_instance" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_db_instance" $ANYTHING {
              ...
              enabled_cloudwatch_logs_exports = [$SOMETHING, ...]
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-documentdb-auditing-disabled.aws-documentdb-auditing-disabled
      languages:
        - hcl
      message: Auditing is not enabled for DocumentDB. To ensure that you are able to accurately audit the usage of your DocumentDB cluster, you should enable auditing and export logs to CloudWatch.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-778: Insufficient Logging'
        impact: LOW
        likelihood: LOW
        owasp:
            - A09:2021 - Security Logging and Monitoring Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#enabled_cloudwatch_logs_exports
            - https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_docdb_cluster" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_docdb_cluster" $ANYTHING {
              ...
              enabled_cloudwatch_logs_exports = [..., "audit", ...]
              ...
            }
      severity: INFO
    - id: terraform.aws.security.aws-dynamodb-table-unencrypted.aws-dynamodb-table-unencrypted
      languages:
        - hcl
      message: By default, AWS DynamoDB Table is encrypted using AWS-managed keys. However, for added security, it's recommended to configure your own AWS KMS encryption key to protect your data in the DynamoDB table. You can either create a new aws_kms_key resource or use the ARN of an existing key in your AWS account to do so.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_dynamodb_table" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_dynamodb_table" $ANYTHING {
              ...
              server_side_encryption {
                enabled = true
                kms_key_arn = ...
              }
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ebs-snapshot-encrypted-with-cmk.aws-ebs-snapshot-encrypted-with-cmk
      languages:
        - hcl
      message: Ensure EBS Snapshot is encrypted at rest using KMS CMKs. CMKs gives you control over the encryption key in terms of access and rotation.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_ebs_snapshot_copy" $ANYTHING {
              ...
              encrypted = true
              ...
            }
        - pattern-not-inside: |
            resource "aws_ebs_snapshot_copy" $ANYTHING {
              ...
              encrypted = true
              kms_key_id = ...
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ebs-unencrypted.aws-ebs-unencrypted
      languages:
        - hcl
      message: The AWS EBS is unencrypted. The AWS EBS encryption protects data in the EBS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_ebs_encryption_by_default" $ANYTHING {
              ...
              enabled = false
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ebs-volume-unencrypted.aws-ebs-volume-unencrypted
      languages:
        - hcl
      message: The AWS EBS volume is unencrypted. The volume, the disk I/O and any derived snapshots could be read if compromised. Volumes should be encrypted to ensure sensitive data is stored securely.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#encrypted
            - https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_ebs_volume" $ANYTHING {
              ...
            }
        - pattern-not: |
            resource "aws_ebs_volume" $ANYTHING {
              ...
              encrypted = true
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ec2-has-public-ip.aws-ec2-has-public-ip
      languages:
        - hcl
      message: EC2 instances should not have a public IP address attached in order to block public access to the instances. To fix this, set your `associate_public_ip_address` to `"false"`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_instance" $ANYTHING {
                  ...
                  associate_public_ip_address = true
                  ...
                }
            - pattern: |
                resource "aws_launch_template" $ANYTHING {
                  ...
                  network_interfaces {
                    ...
                    associate_public_ip_address = true
                    ...
                  }
                  ...
                }
      severity: WARNING
    - id: terraform.aws.security.aws-ec2-launch-template-metadata-service-v1-enabled.aws-ec2-launch-template-metadata-service-v1-enabled
      languages:
        - hcl
      message: The EC2 launch template has Instance Metadata Service Version 1 (IMDSv1) enabled. IMDSv2 introduced session authentication tokens which improve security when talking to IMDS. You should either disable IMDS or require the use of IMDSv2.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-1390: Weak Authentication'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#metadata_options
            - https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_launch_template" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_launch_template" $ANYTHING {
              ...
              metadata_options {
                ...
                http_endpoint = "disabled"
                ...
              }
              ...
            }
        - pattern-not-inside: |
            resource "aws_launch_template" $ANYTHING {
              ...
              metadata_options {
                ...
                http_tokens = "required"
                ...
              }
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ecr-mutable-image-tags.aws-ecr-mutable-image-tags
      languages:
        - hcl
      message: The ECR repository allows tag mutability. Image tags could be overwritten with compromised images. ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting `image_tag_mutability` to IMMUTABLE.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-345: Insufficient Verification of Data Authenticity'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A08:2021 - Software and Data Integrity Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#image_tag_mutability
            - https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_ecr_repository" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_ecr_repository" $ANYTHING {
              ...
              image_tag_mutability = "IMMUTABLE"
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-ecr-repository-wildcard-principal.aws-ecr-repository-wildcard-principal
      languages:
        - hcl
      message: Detected wildcard access granted in your ECR repository policy principal. This grants access to all users, including anonymous users (public access). Instead, limit principals, actions and resources to what you need according to least privilege.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository_policy
            - https://docs.aws.amazon.com/lambda/latest/operatorguide/wildcard-permissions-iam.html
            - https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/monitor-amazon-ecr-repositories-for-wildcard-permissions-using-aws-cloudformation-and-aws-config.html
            - https://cwe.mitre.org/data/definitions/732.html
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-inside: |
            resource "aws_ecr_repository_policy" $ANYTHING {
              ...
            }
        - pattern-either:
            - patterns:
                - pattern: policy = "$JSONPOLICY"
                - metavariable-pattern:
                    language: json
                    metavariable: $JSONPOLICY
                    patterns:
                        - pattern-not-inside: |
                            {..., "Effect": "Deny", ...}
                        - pattern-either:
                            - pattern: |
                                {..., "Principal": "*", ...}
                            - pattern: |
                                {..., "Principal": [..., "*", ...], ...}
                            - pattern: |
                                {..., "Principal": { "AWS": "*" }, ...}
                            - pattern: |
                                {..., "Principal": { "AWS": [..., "*", ...] }, ...}
            - patterns:
                - pattern-inside: policy = jsonencode(...)
                - pattern-not-inside: |
                    {..., Effect = "Deny", ...}
                - pattern-either:
                    - pattern: |
                        {..., Principal = "*", ...}
                    - pattern: |
                        {..., Principal = [..., "*", ...], ...}
                    - pattern: |
                        {..., Principal = { AWS = "*" }, ...}
                    - pattern: |
                        {..., Principal = { AWS = [..., "*", ...] }, ...}
      severity: WARNING
    - id: terraform.aws.security.aws-efs-filesystem-encrypted-with-cmk.aws-efs-filesystem-encrypted-with-cmk
      languages:
        - hcl
      message: Ensure EFS filesystem is encrypted at rest using KMS CMKs. CMKs gives you control over the encryption key in terms of access and rotation.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_efs_file_system" $ANYTHING {
              ...
              encrypted  = true
              ...
            }
        - pattern-not-inside: |
            resource "aws_efs_file_system" $ANYTHING {
              ...
              encrypted  = true
              kms_key_id = ...
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-elasticsearch-insecure-tls-version.aws-elasticsearch-insecure-tls-version
      languages:
        - terraform
      message: Detected an AWS Elasticsearch domain using an insecure version of TLS. To fix this, set "tls_security_policy" equal to "Policy-Min-TLS-1-2-2019-07".
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      pattern: |
        resource "aws_elasticsearch_domain" $ANYTHING {
          ...
          domain_endpoint_options {
            ...
            enforce_https = true
            tls_security_policy = "Policy-Min-TLS-1-0-2019-07"
            ...
          }
          ...
        }
      severity: WARNING
    - id: terraform.aws.security.aws-elasticsearch-nodetonode-encryption.aws-elasticsearch-nodetonode-encryption-not-enabled
      languages:
        - hcl
      message: "Ensure all Elasticsearch has node-to-node encryption enabled.\t"
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_elasticsearch_domain" $ANYTHING {
                  ...
                  node_to_node_encryption {
                    ...
                    enabled = false
                    ...
                  }
                  ...
                }
            - pattern: |
                resource "aws_elasticsearch_domain" $ANYTHING {
                  ...
                  cluster_config {
                    ...
                    instance_count = $COUNT
                    ...
                  }
                }
        - pattern-not-inside: |
            resource "aws_elasticsearch_domain" $ANYTHING {
              ...
              cluster_config {
                ...
                instance_count = $COUNT
                ...
              }
              node_to_node_encryption {
                ...
                enabled = true
                ...
              }
            }
        - metavariable-comparison:
            comparison: $COUNT > 1
            metavariable: $COUNT
      severity: WARNING
    - id: terraform.aws.security.aws-glacier-vault-any-principal.aws-glacier-vault-any-principal
      languages:
        - hcl
      message: 'Detected wildcard access granted to Glacier Vault. This means anyone within your AWS account ID can perform actions on Glacier resources. Instead, limit to a specific identity in your account, like this: `arn:aws:iam::<account_id>:<identity>`.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
        subcategory:
            - vuln
        technology:
            - aws
      patterns:
        - pattern-inside: |
            resource "aws_glacier_vault" $ANYTHING {
              ...
            }
        - pattern: access_policy = "$STATEMENT"
        - metavariable-pattern:
            language: json
            metavariable: $STATEMENT
            patterns:
                - pattern-inside: |
                    {..., "Effect": "Allow", ...}
                - pattern-either:
                    - pattern: |
                        "Principal": "*"
                    - pattern: |
                        "Principal": {..., "AWS": "*", ...}
                    - pattern-inside: |
                        "Principal": {..., "AWS": ..., ...}
                    - pattern-regex: |
                        (^\"arn:aws:iam::\*:(.*)\"$)
      severity: ERROR
    - id: terraform.aws.security.aws-iam-admin-policy-ssoadmin.aws-iam-admin-policy-ssoadmin
      languages:
        - hcl
      message: Detected admin access granted in your policy. This means anyone with this policy can perform administrative actions. Instead, limit actions and resources to what you need according to least privilege.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
        subcategory:
            - vuln
        technology:
            - aws
      patterns:
        - pattern-inside: |
            resource "aws_ssoadmin_permission_set_inline_policy" $ANYTHING {
              ...
            }
        - pattern: inline_policy = "$STATEMENT"
        - metavariable-pattern:
            language: json
            metavariable: $STATEMENT
            patterns:
                - pattern-not-inside: |
                    {..., "Effect": "Deny", ...}
                - pattern-either:
                    - pattern: |
                        {..., "Action": [..., "*", ...], "Resource": [..., "*", ...], ...}
                    - pattern: |
                        {..., "Action": "*", "Resource": "*", ...}
                    - pattern: |
                        {..., "Action": "*", "Resource": [...], ...}
                    - pattern: |
                        {..., "Action": [...], "Resource": "*", ...}
      severity: ERROR
    - id: terraform.aws.security.aws-iam-admin-policy.aws-iam-admin-policy
      languages:
        - hcl
      message: Detected admin access granted in your policy. This means anyone with this policy can perform administrative actions. Instead, limit actions and resources to what you need according to least privilege.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-inside: |
            resource "aws_iam_policy" $ANYTHING {
              ...
            }
        - pattern: policy = "$STATEMENT"
        - metavariable-pattern:
            language: json
            metavariable: $STATEMENT
            patterns:
                - pattern-not-inside: |
                    {..., "Effect": "Deny", ...}
                - pattern-either:
                    - pattern: |
                        {..., "Action": [..., "*", ...], "Resource": [..., "*", ...], ...}
                    - pattern: |
                        {..., "Action": "*", "Resource": "*", ...}
                    - pattern: |
                        {..., "Action": "*", "Resource": [...], ...}
                    - pattern: |
                        {..., "Action": [...], "Resource": "*", ...}
      severity: ERROR
    - id: terraform.aws.security.aws-insecure-api-gateway-tls-version.aws-insecure-api-gateway-tls-version
      languages:
        - terraform
      message: Detected AWS API Gateway to be using an insecure version of TLS. To fix this issue make sure to set "security_policy" equal to "TLS_1_2".
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_api_gateway_domain_name" $ANYTHING {
                    ...
                    security_policy = "..."
                    ...
                }
            - pattern: |
                resource "aws_apigatewayv2_domain_name" $ANYTHING {
                    ...
                    domain_name_configuration {...}
                    ...
                }
        - pattern-not: |
            resource "aws_api_gateway_domain_name" $ANYTHING {
                    ...
                    security_policy = "TLS_1_2"
                    ...
                }
        - pattern-not: |
            resource "aws_apigatewayv2_domain_name" $ANYTHING {
                    ...
                    domain_name_configuration {
                        ...
                        security_policy = "TLS_1_2"
                        ...
                    }
                }
      severity: WARNING
    - id: terraform.aws.security.aws-insecure-redshift-ssl-configuration.aws-insecure-redshift-ssl-configuration
      languages:
        - hcl
      message: Detected an AWS Redshift configuration with a SSL disabled. To fix this, set your `require_ssl` to `"true"`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_redshift_parameter_group" $ANYTHING {
              ...
            }
        - pattern-not-inside: |
            resource "aws_redshift_parameter_group" $ANYTHING {
              ...
              parameter {
                name  = "require_ssl"
                value = "true"
              }
              ...
            }
        - pattern-not-inside: |
            resource "aws_redshift_parameter_group" $ANYTHING {
              ...
              parameter {
                name  = "require_ssl"
                value = true
              }
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-kinesis-stream-unencrypted.aws-kinesis-stream-unencrypted
      languages:
        - hcl
      message: The AWS Kinesis stream does not encrypt data at rest. The data could be read if the Kinesis stream storage layer is compromised. Enable Kinesis stream server-side encryption.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://owasp.org/Top10/A04_2021-Insecure_Design
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_stream#encryption_type
            - https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html
        rule-origin-note: published from /src/aws-kinesis-stream-unencrypted.yml in None
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_kinesis_stream" $ANYTHING {
              ...
            }
        - pattern-not: |
            resource "aws_kinesis_stream" $ANYTHING {
              ...
              encryption_type = "KMS"
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-kms-key-wildcard-principal.aws-kms-key-wildcard-principal
      languages:
        - hcl
      message: Detected wildcard access granted in your KMS key. This means anyone with this policy can perform administrative actions over the keys. Instead, limit principals, actions and resources to what you need according to least privilege.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-inside: |
            resource "aws_kms_key" $ANYTHING {
              ...
            }
        - pattern: policy = "$STATEMENT"
        - metavariable-pattern:
            language: json
            metavariable: $STATEMENT
            patterns:
                - pattern-not-inside: |
                    {..., "Effect": "Deny", ...}
                - pattern-either:
                    - pattern: |
                        {..., "Principal": "*", "Action": "kms:*", "Resource": "*", ...}
                    - pattern: |
                        {..., "Principal": [..., "*", ...], "Action": "kms:*", "Resource": "*", ...}
                    - pattern: |
                        {..., "Principal": { "AWS": "*" }, "Action": "kms:*", "Resource": "*", ...}
                    - pattern: |
                        {..., "Principal": { "AWS": [..., "*", ...] }, "Action": "kms:*", "Resource": "*", ...}
      severity: ERROR
    - id: terraform.aws.security.aws-kms-no-rotation.aws-kms-no-rotation
      languages:
        - hcl
      message: The AWS KMS has no rotation. Missing rotation can cause leaked key to be used by attackers. To fix this, set a `enable_key_rotation`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_kms_key" $ANYTHING {
                  ...
                  enable_key_rotation = false
                  ...
                }
            - pattern: |
                resource "aws_kms_key" $ANYTHING {
                  ...
                  customer_master_key_spec = "SYMMETRIC_DEFAULT"
                  enable_key_rotation = false
                  ...
                }
            - pattern: |
                resource "aws_kms_key" $ANYTHING {
                  ...
                }
        - pattern-not-inside: |
            resource "aws_kms_key" $ANYTHING {
              ...
              enable_key_rotation = true
              ...
            }
        - pattern-not-inside: |
            resource "aws_kms_key" $ANYTHING {
              ...
              customer_master_key_spec = "RSA_2096"
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.aws-lambda-environment-credentials.aws-lambda-environment-credentials
      languages:
        - hcl
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
            - secrets
      patterns:
        - pattern-inside: |
            resource "$ANYTING" $ANYTHING {
              ...
              environment {
                variables = {
                  ...
                }
              }
              ...
            }
        - pattern-either:
            - pattern-inside: |
                AWS_ACCESS_KEY_ID = "$Y"
            - pattern-regex: |
                (?<![A-Z0-9])[A-Z0-9]{20}(?![A-Z0-9])
            - pattern-inside: |
                AWS_SECRET_ACCESS_KEY = "$Y"
            - pattern-regex: |
                (?<![A-Za-z0-9/+=])[A-Za-z0-9/+=]{40}(?![A-Za-z0-9/+=])
        - focus-metavariable: $Y
      severity: ERROR
    - id: terraform.aws.security.aws-lambda-permission-unrestricted-source-arn.aws-lambda-permission-unrestricted-source-arn
      languages:
        - hcl
      message: The AWS Lambda permission has an AWS service principal but does not specify a source ARN. If you grant permission to a service principal without specifying the source, other accounts could potentially configure resources in their account to invoke your Lambda function. Set the source_arn value to the ARN of the AWS resource that invokes the function, eg. an S3 bucket, CloudWatch Events Rule, API Gateway, or SNS topic.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission
            - https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern: |
            resource "aws_lambda_permission" $ANYTHING {
              ...
              principal = "$PRINCIPAL"
              ...
            }
        - pattern-not: |
            resource "aws_lambda_permission" $ANYTHING {
              ...
              source_arn = ...
              ...
            }
        - metavariable-regex:
            metavariable: $PRINCIPAL
            regex: .*[.]amazonaws[.]com$
      severity: ERROR
    - id: terraform.aws.security.aws-lambda-x-ray-tracing-not-active.aws-lambda-x-ray-tracing-not-active
      languages:
        - hcl
      message: The AWS Lambda function does not have active X-Ray tracing enabled. X-Ray tracing enables end-to-end debugging and analysis of all function activity. This makes it easier to trace the flow of logs and identify bottlenecks, slow downs and timeouts.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-778: Insufficient Logging'
        impact: LOW
        likelihood: LOW
        owasp:
            - A09:2021 Security Logging and Monitoring Failures
        references:
            - https://cwe.mitre.org/data/definitions/778.html
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function#mode
            - https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html
        subcategory:
            - audit
        technology:
            - aws
            - terraform
      patterns:
        - pattern: |
            resource "aws_lambda_function" $ANYTHING {
              ...
            }
        - pattern-not: |
            resource "aws_lambda_function" $ANYTHING {
              ...
              tracing_config {
                ...
                mode = "Active"
                ...
              }
              ...
            }
      severity: INFO
    - id: terraform.aws.security.aws-provider-static-credentials.aws-provider-static-credentials
      languages:
        - hcl
      message: A hard-coded credential was detected. It is not recommended to store credentials in source-code, as this risks secrets being leaked and used by either an internal or external malicious adversary. It is recommended to use environment variables to securely provide credentials or retrieve credentials from a secure vault or HSM (Hardware Security Module).
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - secrets
            - aws
            - terraform
      patterns:
        - pattern-inside: |
            provider "aws" {
            ...
                secret_key = "$SECRET"
            }
        - focus-metavariable: $SECRET
      severity: WARNING
    - id: terraform.aws.security.aws-rds-backup-no-retention.aws-rds-backup-no-retention
      languages:
        - hcl
      message: The AWS RDS has no retention. Missing retention can cause losing important event information. To fix this, set a `backup_retention_period`.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_rds_cluster" $ANYTHING {
                  ...
                  backup_retention_period = 0
                  ...
                }
            - pattern: |
                resource "aws_db_instance" $ANYTHING {
                  ...
                  backup_retention_period = 0
                  ...
                }
      severity: WARNING
    - id: terraform.aws.security.aws-sqs-queue-policy-wildcard-principal.aws-sqs-queue-policy-wildcard-principal
      languages:
        - hcl
      message: Wildcard used in your SQS queue policy principal. This grants access to all users, including anonymous users (public access). Unless you explicitly require anyone on the internet to be able to read or write to your queue, limit principals, actions and resources to what you need according to least privilege.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
        references:
            - https://cwe.mitre.org/data/definitions/732.html
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue_policy
            - https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html
        rule-origin-note: published from /src/aws-sqs-queue-policy-wildcard-principal.yml in None
        subcategory:
            - vuln
        technology:
            - aws
            - terraform
      patterns:
        - pattern-either:
            - pattern-inside: |
                resource "aws_sqs_queue_policy" $ANYTHING {
                  ...
                }
            - pattern-inside: |
                resource "aws_sqs_queue" $ANYTHING {
                  ...
                }
        - pattern-either:
            - patterns:
                - pattern: policy = "$JSONPOLICY"
                - metavariable-pattern:
                    language: json
                    metavariable: $JSONPOLICY
                    patterns:
                        - pattern-not-inside: |
                            {..., "Effect": "Deny", ...}
                        - pattern-either:
                            - pattern: |
                                {..., "Principal": "*", ...}
                            - pattern: |
                                {..., "Principal": [..., "*", ...], ...}
                            - pattern: |
                                {..., "Principal": { "AWS": "*" }, ...}
                            - pattern: |
                                {..., "Principal": { "AWS": [..., "*", ...] }, ...}
            - patterns:
                - pattern-inside: policy = jsonencode(...)
                - pattern-not-inside: |
                    {..., Effect = "Deny", ...}
                - pattern-either:
                    - pattern: |
                        {..., Principal = "*", ...}
                    - pattern: |
                        {..., Principal = [..., "*", ...], ...}
                    - pattern: |
                        {..., Principal = { AWS = "*" }, ...}
                    - pattern: |
                        {..., Principal = { AWS = [..., "*", ...] }, ...}
      severity: ERROR
    - id: terraform.aws.security.aws-subnet-has-public-ip-address.aws-subnet-has-public-ip-address
      languages:
        - hcl
      message: Resources in the AWS subnet are assigned a public IP address. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application. Set `map_public_ip_on_launch` to false so that resources are not publicly-accessible.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control/
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/subnet#map_public_ip_on_launch
            - https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html#concepts-public-addresses
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - pattern: |
                resource "aws_subnet" $ANYTHING {
                  ...
                  map_public_ip_on_launch = true
                  ...
                }
            - pattern: |
                resource "aws_default_subnet" $ANYTHING {
                  ...
                }
        - pattern-not: |
            resource "aws_default_subnet" $ANYTHING {
              ...
              map_public_ip_on_launch = false
              ...
            }
      severity: WARNING
    - id: terraform.aws.security.insecure-load-balancer-tls-version.insecure-load-balancer-tls-version
      languages:
        - hcl
      message: Detected an AWS load balancer with an insecure TLS version. TLS versions less than 1.2 are considered insecure because they can be broken. To fix this, set your `ssl_policy` to `"ELBSecurityPolicy-TLS13-1-2-2021-06"`, or include a default action to redirect to HTTPS.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.ietf.org/rfc/rfc5246.txt
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - patterns:
                - pattern: ssl_policy = $ANYTHING
                - pattern-not-regex: ELBSecurityPolicy-TLS13-1-[23]-[0-9-]+
                - pattern-not-regex: ELBSecurityPolicy-FS-1-2-[(Res)0-9-]+
            - patterns:
                - pattern: protocol = "HTTP"
                - pattern-not-inside: |
                    resource $ANYTHING $NAME {
                      ...
                      default_action {
                        ...
                        redirect {
                          ...
                          protocol = "HTTPS"
                          ...
                        }
                        ...
                      }
                      ...
                    }
        - pattern-inside: |
            resource $RESOURCE $X {
              ...
            }
        - metavariable-pattern:
            metavariable: $RESOURCE
            patterns:
                - pattern-either:
                    - pattern: |
                        "aws_lb_listener"
                    - pattern: |
                        "aws_alb_listener"
      severity: WARNING
    - id: terraform.aws.security.unrestricted-github-oidc-policy.unrestricted-github-oidc-policy
      languages:
        - hcl
      match:
        all:
            - inside: |
                data "aws_iam_policy_document" $POLICY {
                  ...
                }
            - |
              statement {
                ...
                principals {
                  ...
                  type = "Federated"
                  identifiers = [..., $IDENTIFIER, ...]
                }
              }
            - not: |
                statement {
                  ...
                  condition {
                    ...
                    variable = "token.actions.githubusercontent.com:sub"
                  }
                }
        where:
            - metavariable: $IDENTIFIER
              regex: .*oidc-provider/token\.actions\.githubusercontent\.com
      message: '`$POLICY` is missing a `condition` block which scopes users of this policy to specific GitHub repositories. Without this, `$POLICY` is open to all users on GitHub. Add a `condition` block on the variable `token.actions.githubusercontent.com:sub` which scopes it to prevent this.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Sensitive Data Exposure
            - A01:2021 - Broken Access Control
        references:
            - https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services#configuring-the-role-and-trust-policy
            - https://dagrz.com/writing/aws-security/hacking-github-aws-oidc/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      severity: WARNING
    - id: terraform.aws.security.wildcard-assume-role.wildcard-assume-role
      languages:
        - hcl
      message: 'Detected wildcard access granted to sts:AssumeRole. This means anyone with your AWS account ID and the name of the role can assume the role. Instead, limit to a specific identity in your account, like this: `arn:aws:iam::<account_id>:root`.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A06:2017 - Security Misconfiguration
            - A05:2021 - Security Misconfiguration
        references:
            - https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/
        subcategory:
            - vuln
        technology:
            - aws
      patterns:
        - pattern-inside: |
            resource "aws_iam_role" $NAME {
              ...
            }
        - pattern: assume_role_policy = "$STATEMENT"
        - metavariable-pattern:
            language: json
            metavariable: $STATEMENT
            patterns:
                - pattern-inside: |
                    {..., "Effect": "Allow", ..., "Action": "sts:AssumeRole", ...}
                - pattern: |
                    "Principal": {..., "AWS": "*", ...}
      severity: ERROR
    - id: terraform.azure.security.appservice.appservice-authentication-enabled.appservice-authentication-enabled
      languages:
        - hcl
      message: Enabling authentication ensures that all communications in the application are authenticated. The `auth_settings` block needs to be filled out with the appropriate auth backend settings
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-287: Improper Authentication'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#auth_settings
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_app_service" "..." {
            ...
              auth_settings {
                ...
                enabled = true
                ...
              }
            ...
            }
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                }
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                  auth_settings {
                    ...
                    enabled = false
                    ...
                  }
                ...
                }
      severity: ERROR
    - id: terraform.azure.security.appservice.appservice-enable-http2.appservice-enable-http2
      languages:
        - hcl
      message: Use the latest version of HTTP to ensure you are benefiting from security fixes. Add `http2_enabled = true` to your appservice resource block
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-444: Inconsistent Interpretation of HTTP Requests (''HTTP Request/Response Smuggling'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http2_enabled
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_app_service" "..." {
            ...
              site_config {
                ...
                http2_enabled = true
                ...
              }
            ...
            }
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                }
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                  site_config {
                    ...
                    http2_enabled = false
                    ...
                  }
                ...
                }
      severity: INFO
    - id: terraform.azure.security.appservice.appservice-enable-https-only.appservice-enable-https-only
      languages:
        - hcl
      message: By default, clients can connect to App Service by using both HTTP or HTTPS. HTTP should be disabled enabling the HTTPS Only setting.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#https_only
            - https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_app_service" "..." {
            ...
              https_only = true
            ...
            }
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                }
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                  https_only = false
                ...
                }
      severity: ERROR
    - id: terraform.azure.security.appservice.appservice-require-client-cert.appservice-require-client-cert
      languages:
        - hcl
      message: Detected an AppService that was not configured to use a client certificate. Add `client_cert_enabled = true` in your resource block.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-295: Improper Certificate Validation'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#client_cert_enabled
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_app_service" "..." {
            ...
              client_cert_enabled = true
            ...
            }
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                }
            - pattern-inside: |
                resource "azurerm_app_service" "..." {
                ...
                  client_cert_enabled = false
                ...
                }
      severity: INFO
    - id: terraform.azure.security.appservice.appservice-use-secure-tls-policy.appservice-use-secure-tls-policy
      languages:
        - hcl
      message: Detected an AppService that was not configured to use TLS 1.2. Add `site_config.min_tls_version = "1.2"` in your resource block.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#min_tls_version
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: min_tls_version = $ANYTHING
        - pattern-inside: |
            resource "azurerm_app_service" "$NAME" {
              ...
            }
        - pattern-not-inside: min_tls_version = "1.2"
      severity: ERROR
    - id: terraform.azure.security.appservice.azure-appservice-https-only.azure-appservice-https-only
      languages:
        - hcl
      message: Ensure web app redirects all HTTP traffic to HTTPS in Azure App Service Slot
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_app_service" "..." {
            ...
            https_only = true
            ...
            }
        - pattern-inside: |
            resource "azurerm_app_service" "..." {
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.appservice.azure-appservice-min-tls-version.azure-appservice-min-tls-version
      languages:
        - hcl
      message: Ensure web app is using the latest version of TLS encryption
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - audit
        technology:
            - terraform
            - azure
      patterns:
        - pattern-either:
            - pattern: |
                "1.0"
            - pattern: |
                "1.1"
        - pattern-inside: min_tls_version = ...
        - pattern-inside: |
            $RESOURCE "azurerm_app_service" "..." {
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.azure-key-no-expiration-date.azure-key-no-expiration-date
      languages:
        - hcl
      message: Ensure that the expiration date is set on all keys
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: LOW
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_key_vault_key" "..." {
            ...
            expiration_date = "..."
            ...
            }
        - pattern-inside: |
            resource "azurerm_key_vault_key" "..." {
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.azure-mssql-service-mintls-version.azure-mssql-service-mintls-version
      languages:
        - hcl
      message: Ensure MSSQL is using the latest version of TLS encryption
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern-either:
            - pattern: |
                "1.0"
            - pattern: |
                "1.1"
        - pattern-inside: minimum_tls_version = ...
        - pattern-inside: |
            $RESOURCE "azurerm_mssql_server" "..." {
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.azure-mysql-encryption-enabled.azure-mysql-encryption-enabled
      languages:
        - hcl
      message: Ensure that MySQL server enables infrastructure encryption
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-320: CWE CATEGORY: Key Management Errors'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-inside: |
            resource "azurerm_mysql_server" "..." {
            ...
            }
        - pattern-not-inside: |
            resource "azurerm_mysql_server" "..." {
            ...
            infrastructure_encryption_enabled = true
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.azure-mysql-mintls-version.azure-mysql-mintls-version
      languages:
        - hcl
      message: Ensure MySQL is using the latest version of TLS encryption
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern-either:
            - pattern: |
                "TLS1_0"
            - pattern: |
                "TLS1_1"
        - pattern-inside: ssl_minimal_tls_version_enforced = ...
        - pattern-inside: |
            $RESOURCE "azurerm_mysql_server" "..." {
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.keyvault.keyvault-ensure-key-expires.keyvault-ensure-key-expires
      languages:
        - hcl
      message: Ensure that the expiration date is set on all keys
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-262: Not Using Password Aging'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_key#expiration_date
            - https://docs.microsoft.com/en-us/powershell/module/az.keyvault/update-azkeyvaultkey?view=azps-5.8.0#example-1--modify-a-key-to-enable-it--and-set-the-expiration-date-and-tags
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_key_vault_key" "..." {
            ...
            expiration_date = "..."
            ...
            }
        - pattern-inside: |
            resource "azurerm_key_vault_key" "..." {
            ...
            }
      severity: INFO
    - id: terraform.azure.security.keyvault.keyvault-ensure-secret-expires.keyvault-ensure-secret-expires
      languages:
        - hcl
      message: Ensure that the expiration date is set on all secrets
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-262: Not Using Password Aging'
        impact: MEDIUM
        likelihood: LOW
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date
            - https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_key_vault_secret" "..." {
            ...
            expiration_date = "..."
            ...
            }
        - pattern-inside: |
            resource "azurerm_key_vault_secret" "..." {
            ...
            }
      severity: INFO
    - id: terraform.azure.security.keyvault.keyvault-purge-enabled.keyvault-purge-enabled
      languages:
        - hcl
      message: Key vault should have purge protection enabled
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-693: Protection Mechanism Failure'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#purge_protection_enabled
            - https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview#purge-protection
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern: resource
        - pattern-not-inside: |
            resource "azurerm_key_vault" "..." {
            ...
             purge_protection_enabled = true
            ...
            }
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_key_vault" "..." {
                ...
                }
            - pattern-inside: |
                resource "azurerm_key_vault" "..." {
                ...
                  purge_protection_enabled = false
                ...
                }
      severity: WARNING
    - id: terraform.azure.security.storage.storage-enforce-https.storage-enforce-https
      languages:
        - hcl
      message: Detected a Storage that was not configured to deny action by default. Add `enable_https_traffic_only = true` in your resource block.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only
            - https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern-not-inside: |
            resource "azurerm_storage_account" "..." {
            ...
              enable_https_traffic_only = true
            ...
            }
        - pattern-inside: |
            resource "azurerm_storage_account" "..." {
            ...
              enable_https_traffic_only = false
            ...
            }
      severity: WARNING
    - id: terraform.azure.security.storage.storage-use-secure-tls-policy.storage-use-secure-tls-policy
      languages:
        - hcl
      message: 'Azure Storage currently supports three versions of the TLS protocol: 1.0, 1.1, and 1.2. Azure Storage uses TLS 1.2 on public HTTPS endpoints, but TLS 1.0 and TLS 1.1 are still supported for backward compatibility. This check will warn if the minimum TLS is not set to TLS1_2.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#min_tls_version
            - https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version
        subcategory:
            - vuln
        technology:
            - terraform
            - azure
      patterns:
        - pattern-either:
            - pattern-inside: |
                resource "azurerm_storage_account" "..." {
                  ...
                  min_tls_version = "$ANYTHING"
                  ...
                }
            - pattern-inside: |
                resource "azurerm_storage_account" "..." {
                  ...
                }
        - pattern-not-inside: |
            resource "azurerm_storage_account" "..." {
              ...
              min_tls_version = "TLS1_2"
              ...
            }
      severity: ERROR
    - id: terraform.gcp.security.gcp-cloud-storage-logging.gcp-cloud-storage-logging
      languages:
        - hcl
      message: Ensure bucket logs access.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-778: Insufficient Logging'
        impact: LOW
        likelihood: LOW
        owasp:
            - A10:2017 - Insufficient Logging & Monitoring
            - A09:2021 - Security Logging and Monitoring Failures
        references:
            - https://docs.bridgecrew.io/docs/google-cloud-policy-index
        subcategory:
            - vuln
        technology:
            - terraform
            - gcp
      patterns:
        - pattern: |
            resource "google_storage_bucket" $ANYTHING {
              ...
            }
        - pattern-not-inside: "resource \"google_storage_bucket\" $ANYTHING {\n  ...\n  logging {\n      log_bucket = ...\n  }          \n  ...\n}\n"
      severity: WARNING
    - id: terraform.gcp.security.gcp-dns-key-specs-rsasha1.gcp-dns-key-specs-rsasha1
      languages:
        - hcl
      message: "Ensure that RSASHA1 is not used for the zone-signing and key-signing keys in Cloud DNS DNSSEC\t"
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - gcp
      patterns:
        - pattern: resource
        - pattern-inside: |
            resource "google_dns_managed_zone" "..." {
            ...
            dnssec_config {
                ...
                default_key_specs {
                    ...
                    algorithm  = "rsasha1"
                    key_type   = "zoneSigning"
                    ...
                }
                ...
            }
            ...
            }
        - pattern-inside: |
            resource "google_dns_managed_zone" "..." {
            ...
            dnssec_config {
                ...
                default_key_specs {
                    ...
                    algorithm  = "rsasha1"
                    key_type   = "keySigning"
                    ...
                }
                ...
            }
            ...
            }
      severity: WARNING
    - id: terraform.gcp.security.gcp-sql-database-require-ssl.gcp-sql-database-require-ssl
      languages:
        - hcl
      message: Ensure all Cloud SQL database instance requires all incoming connections to use SSL
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-326: Inadequate Encryption Strength'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        subcategory:
            - vuln
        technology:
            - terraform
            - gcp
      patterns:
        - pattern: resource
        - pattern-inside: |
            resource "google_sql_database_instance" "..." {
                ...
            }
        - pattern-not-inside: |
            resource "google_sql_database_instance" "..." {
                ...
                ip_configuration {
                    ...
                    require_ssl = true
                    ...
                }
                ...
            }
      severity: WARNING
    - id: terraform.gcp.security.gcp-sql-public-database.gcp-sql-public-database
      languages:
        - hcl
      message: Ensure that Cloud SQL database Instances are not open to the world
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - vuln
        technology:
            - terraform
            - gcp
      patterns:
        - pattern: resource
        - pattern-either:
            - pattern-inside: |
                resource "google_sql_database_instance" "..." {
                ...
                ip_configuration {
                  ...
                  authorized_networks {
                    ...
                    value = "0.0.0.0/0"
                    ...
                  }
                  ...
                }
                ...
                }
            - pattern-inside: |
                resource "google_sql_database_instance" "..." {
                ...
                ip_configuration {
                  ...
                  dynamic "authorized_networks" {
                    ...
                    content {
                      ...
                      value = "0.0.0.0/0"
                      ...
                    }
                    ...
                  }
                  ...
                }
                ...
                }
      severity: WARNING
    - id: terraform.lang.security.ec2-imdsv1-optional.ec2-imdsv1-optional
      languages:
        - hcl
      message: AWS EC2 Instance allowing use of the IMDSv1
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-918: Server-Side Request Forgery (SSRF)'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A10:2021 - Server-Side Request Forgery (SSRF)
        references:
            - https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#metadata-options
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      pattern-either:
        - patterns:
            - pattern: http_tokens = "optional"
            - pattern-inside: |
                metadata_options { ... }
        - patterns:
            - pattern: |
                resource "aws_instance" "$NAME" {
                  ...
                }
            - pattern-not: |
                resource "aws_instance" "$NAME" {
                  ...
                  metadata_options {
                    ...
                    http_tokens = "required"
                    ...
                  }
                  ...
                }
            - pattern-not: |
                resource "aws_instance" "$NAME" {
                  ...
                  metadata_options {
                    ...
                    http_tokens = "optional"
                    ...
                  }
                  ...
                }
            - pattern-not: |
                resource "aws_instance" "$NAME" {
                  ...
                  metadata_options {
                    ...
                    http_endpoint = "disabled"
                    ...
                  }
                  ...
                }
      severity: ERROR
    - id: terraform.lang.security.iam.no-iam-admin-privileges.no-iam-admin-privileges
      languages:
        - hcl
      message: IAM policies that allow full "*-*" admin privileges violates the principle of least privilege. This allows an attacker to take full control over all AWS account resources. Instead, give each user more fine-grained control with only the privileges they need. $TYPE
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://github.com/bridgecrewio/checkov/blob/master/checkov/terraform/checks/data/aws/AdminPolicyDocument.py
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      pattern-either:
        - patterns:
            - pattern-inside: |
                resource $TYPE "..." {
                  ...
                  policy = jsonencode({
                    ...
                    Statement = [
                      ...
                    ]
                    ...
                  })
                  ...
                }
            - pattern-not-inside: |
                resource $TYPE "..." {
                  ...
                  policy = jsonencode({
                    ...
                    Statement = [
                      ...,
                      {... Effect = "Deny" ...},
                      ...
                    ]
                    ...
                  })
                  ...
                }
            - patterns:
                - pattern: |
                    {..., Action = "*", ...}
                - pattern: |
                    {..., Resource = "*", ...}
            - metavariable-pattern:
                metavariable: $TYPE
                pattern-either:
                    - pattern: |
                        "aws_iam_role_policy"
                    - pattern: |
                        "aws_iam_policy"
                    - pattern: |
                        "aws_iam_user_policy"
                    - pattern: |
                        "aws_iam_group_policy"
        - patterns:
            - pattern-inside: |
                data aws_iam_policy_document "..." {
                  ...
                  statement {
                    ...
                  }
                  ...
                }
            - pattern-not-inside: |
                data aws_iam_policy_document "..." {
                  ...
                  statement {
                    ...
                    effect = "Deny"
                    ...
                  }
                  ...
                }
            - patterns:
                - pattern: |
                    {..., resources = ["*"], ...}
                - pattern: |
                    {..., actions = ["*"], ...}
      severity: WARNING
    - id: terraform.lang.security.iam.no-iam-priv-esc-funcs.no-iam-priv-esc-funcs
      languages:
        - hcl
      message: Ensure that actions that can result in privilege escalation are not used. These actions could potentially result in an attacker gaining full administrator access of an AWS account. Try not to use these actions.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        references:
            - https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
            - https://cloudsplaining.readthedocs.io/en/latest/glossary/privilege-escalation/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern-not-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...,
                          {... Effect = "Deny" ...},
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern: Action = $ACTION
                - metavariable-pattern:
                    metavariable: $TYPE
                    pattern-either:
                        - pattern: |
                            "aws_iam_role_policy"
                        - pattern: |
                            "aws_iam_policy"
                        - pattern: |
                            "aws_iam_user_policy"
                        - pattern: |
                            "aws_iam_group_policy"
            - patterns:
                - pattern-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                      }
                      ...
                    }
                - pattern-not-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                        effect = "Deny"
                        ...
                      }
                      ...
                    }
                - pattern: |
                    actions = [..., $ACTION, ...]
        - metavariable-pattern:
            metavariable: $ACTION
            pattern-either:
                - pattern: |
                    "iam:AddUserToGroup"
                - pattern: |
                    "iam:CreatePolicyVersion"
                - pattern: |
                    "iam:SetDefaultPolicyVersion"
                - pattern: |
                    "iam:AttachUserPolicy"
                - pattern: |
                    "iam:AttachGroupPolicy"
                - pattern: |
                    "iam:AttachRolePolicy"
                - pattern: |
                    "iam:PutUserPolicy"
                - pattern: |
                    "iam:PutGroupPolicy"
                - pattern: |
                    "iam:PutRolePolicy"
                - pattern: |
                    "glue:UpdateDevEndpoint"
                - pattern: |
                    "iam:*"
                - pattern: |
                    "glue:*"
      severity: WARNING
    - id: terraform.lang.security.iam.no-iam-priv-esc-other-users.no-iam-priv-esc-other-users
      languages:
        - hcl
      message: Ensure that IAM policies with permissions on other users don't allow for privilege escalation. This can lead to an attacker gaining full administrator access of AWS accounts. Instead, specify which user the permission should be used on or do not use the listed actions. $RESOURCE
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://cloudsplaining.readthedocs.io/en/latest/glossary/privilege-escalation/
            - https://github.com/bridgecrewio/checkov/blob/ca830e14745c2c8e1b941985f305abe985d7f1f9/checkov/terraform/checks/data/aws/IAMPrivilegeEscalation.py
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...,
                          {... Resource = $RESOURCE ...},
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern-not-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...,
                          {... Effect = "Deny" ...},
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern: |
                    Action = $ACTION
                - metavariable-pattern:
                    metavariable: $TYPE
                    pattern-either:
                        - pattern: |
                            "aws_iam_role_policy"
                        - pattern: |
                            "aws_iam_policy"
                        - pattern: |
                            "aws_iam_user_policy"
                        - pattern: |
                            "aws_iam_group_policy"
            - patterns:
                - pattern-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                        resources = $RESOURCE
                        ...
                      }
                      ...
                    }
                - pattern-not-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                        effect = "Deny"
                        ...
                      }
                      ...
                    }
                - pattern: |
                    actions = [..., $ACTION, ...]
        - metavariable-pattern:
            metavariable: $RESOURCE
            pattern-either:
                - pattern-regex: .*\*.*
        - metavariable-pattern:
            metavariable: $ACTION
            pattern-either:
                - pattern: |
                    "iam:CreateAccessKey"
                - pattern: |
                    "iam:CreateLoginProfile"
                - pattern: |
                    "iam:UpdateLoginProfile"
                - pattern: |
                    "iam:*"
      severity: WARNING
    - id: terraform.lang.security.iam.no-iam-priv-esc-roles.no-iam-priv-esc-roles
      languages:
        - hcl
      message: Ensure that groups of actions that include iam:PassRole and could result in privilege escalation are not all allowed for the same user. These actions could result in an attacker gaining full admin access of an AWS account. Try not to use these actions in conjuction.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-269: Improper Privilege Management'
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A04:2021 - Insecure Design
        references:
            - https://cloudsplaining.readthedocs.io/en/latest/glossary/privilege-escalation/
            - https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern-not-inside: |
                    resource $TYPE "..." {
                      ...
                      policy = jsonencode({
                        ...
                        Statement = [
                          ...,
                          {... Effect = "Deny" ...},
                          ...
                        ]
                        ...
                      })
                      ...
                    }
                - pattern: |
                    Action = $ACTION
                - metavariable-pattern:
                    metavariable: $TYPE
                    pattern-either:
                        - pattern: |
                            "aws_iam_role_policy"
                        - pattern: |
                            "aws_iam_policy"
                        - pattern: |
                            "aws_iam_user_policy"
                        - pattern: |
                            "aws_iam_group_policy"
            - patterns:
                - pattern-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                      }
                      ...
                    }
                - pattern-not-inside: |
                    data aws_iam_policy_document "..." {
                      ...
                      statement {
                        ...
                        effect = "Deny"
                        ...
                      }
                      ...
                    }
                - pattern: |
                    actions = $ACTION
        - metavariable-pattern:
            metavariable: $ACTION
            pattern-either:
                - patterns:
                    - pattern: |
                        [..., "sts:AssumeRole", ...]
                    - pattern: |
                        [..., "iam:UpdateAssumeRolePolicy", ...]
                - patterns:
                    - pattern: |
                        [..., "iam:PassRole", ...]
                    - pattern: |
                        [..., "lambda:CreateFunction", ...]
                    - pattern: |
                        [..., "lambda:InvokeFunction", ...]
                - patterns:
                    - pattern: |
                        [..., "iam:PassRole", ...]
                    - pattern: |
                        [..., "lambda:CreateFunction", ...]
                    - pattern: |
                        [..., "lambda:CreateEventSourceMapping", ...]
                - pattern: |
                    "lambda:UpdateFunctionCode"
                - patterns:
                    - pattern: |
                        [..., "iam:PassRole", ...]
                    - pattern: |
                        [..., "glue:CreateDevEndpoint", ...]
                - patterns:
                    - pattern: |
                        [..., "iam:PassRole", ...]
                    - pattern: |
                        [..., "cloudformation:CreateStack", ...]
                - patterns:
                    - pattern: |
                        [..., "iam:PassRole", ...]
                    - pattern: |
                        [..., "datapipeline:CreatePipeline", ...]
                    - pattern: |
                        [..., "datapipeline:PutPipelineDefinition", ...]
      severity: WARNING
    - id: terraform.lang.security.rds-insecure-password-storage-in-source-code.rds-insecure-password-storage-in-source-code
      languages:
        - hcl
      message: RDS instance or cluster with hardcoded credentials in source code. It is recommended to pass the credentials at runtime, or generate random credentials using the random_password resource.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-522: Insufficiently Protected Credentials'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A02:2017 - Broken Authentication
            - A04:2021 - Insecure Design
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#master_password
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster#master_password
            - https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/password
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      pattern-either:
        - patterns:
            - pattern: password = "..."
            - pattern-inside: |
                resource "aws_db_instance" "..." {
                  ...
                }
        - patterns:
            - pattern: master_password = "..."
            - pattern-inside: |
                resource "aws_rds_cluster" "..." {
                  ...
                }
      severity: WARNING
    - id: terraform.lang.security.rds-public-access.rds-public-access
      languages:
        - hcl
      message: RDS instance accessible from the Internet detected.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: LOW
        likelihood: LOW
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#publicly_accessible
            - https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding
        subcategory:
            - audit
        technology:
            - terraform
            - aws
      patterns:
        - pattern: publicly_accessible = true
        - pattern-inside: |
            resource "aws_db_instance" "..." {
              ...
            }
      severity: WARNING
    - id: terraform.lang.security.s3-public-rw-bucket.s3-public-rw-bucket
      languages:
        - hcl
      message: S3 bucket with public read-write access detected.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-200: Exposure of Sensitive Information to an Unauthorized Actor'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#acl
            - https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      pattern: acl = "public-read-write"
      severity: ERROR
    - id: terraform.lang.security.s3-unencrypted-bucket.s3-unencrypted-bucket
      languages:
        - hcl
      message: This rule has been deprecated, as all s3 buckets are encrypted by default with no way to disable it. See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_server_side_encryption_configuration for more info.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        deprecated: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#server_side_encryption_configuration
            - https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html
        subcategory:
            - vuln
        technology:
            - terraform
            - aws
      patterns:
        - pattern: a
        - pattern: b
      severity: INFO
    - id: typescript.angular.security.audit.angular-domsanitizer.angular-bypasssecuritytrust
      languages:
        - typescript
      message: Detected the use of `$TRUST`. This can introduce a Cross-Site-Scripting (XSS) vulnerability if this comes from user-provided input. If you have to use `$TRUST`, ensure it does not come from user-input or use the appropriate prevention mechanism e.g. input validation or sanitization depending on the context.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://angular.io/api/platform-browser/DomSanitizer
            - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - angular
            - browser
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern: sanitizer.sanitize(...)
            - pattern-not: sanitizer.sanitize(SecurityContext.NONE, ...);
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $X.$TRUST($Y)
            - focus-metavariable: $Y
            - pattern-not: |
                $X.$TRUST(`...`)
            - pattern-not: |
                $X.$TRUST("...")
            - metavariable-regex:
                metavariable: $TRUST
                regex: (bypassSecurityTrustHtml|bypassSecurityTrustStyle|bypassSecurityTrustScript|bypassSecurityTrustUrl|bypassSecurityTrustResourceUrl)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    function ...({..., $X: string, ...}) { ... }
                - pattern-inside: |
                    function ...(..., $X: string, ...) { ... }
            - focus-metavariable: $X
      severity: WARNING
    - id: typescript.aws-cdk.security.audit.awscdk-bucket-encryption.awscdk-bucket-encryption
      languages:
        - typescript
      message: 'Add "encryption: $Y.BucketEncryption.KMS_MANAGED" or "encryption: $Y.BucketEncryption.S3_MANAGED" to the bucket props for Bucket construct $X'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html
        subcategory:
            - vuln
        technology:
            - AWS-CDK
      pattern-either:
        - patterns:
            - pattern-inside: |
                import {Bucket} from '@aws-cdk/aws-s3'
                ...
            - pattern: const $X = new Bucket(...)
            - pattern-not: |
                const $X = new Bucket(..., {..., encryption: BucketEncryption.KMS_MANAGED, ...})
            - pattern-not: |
                const $X = new Bucket(..., {..., encryption: BucketEncryption.KMS, ...})
            - pattern-not: |
                const $X = new Bucket(..., {..., encryption: BucketEncryption.S3_MANAGED, ...})
        - patterns:
            - pattern-inside: |
                import * as $Y from '@aws-cdk/aws-s3'
                ...
            - pattern: const $X = new $Y.Bucket(...)
            - pattern-not: |
                const $X = new $Y.Bucket(..., {..., encryption: $Y.BucketEncryption.KMS_MANAGED, ...})
            - pattern-not: |
                const $X = new $Y.Bucket(..., {..., encryption: $Y.BucketEncryption.KMS, ...})
            - pattern-not: |
                const $X = new $Y.Bucket(..., {..., encryption: $Y.BucketEncryption.S3_MANAGED, ...})
      severity: ERROR
    - id: typescript.aws-cdk.security.audit.awscdk-bucket-enforcessl.aws-cdk-bucket-enforcessl
      languages:
        - ts
      message: Bucket $X is not set to enforce encryption-in-transit, if not explictly setting this on the bucket policy - the property "enforceSSL" should be set to true
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html
        subcategory:
            - vuln
        technology:
            - AWS-CDK
      pattern-either:
        - patterns:
            - pattern-inside: |
                import {Bucket} from '@aws-cdk/aws-s3';
                ...
            - pattern: const $X = new Bucket(...)
            - pattern-not: |
                const $X = new Bucket(..., {enforceSSL: true}, ...)
        - patterns:
            - pattern-inside: |
                import * as $Y from '@aws-cdk/aws-s3';
                ...
            - pattern: const $X = new $Y.Bucket(...)
            - pattern-not: |
                const $X = new $Y.Bucket(..., {..., enforceSSL: true, ...})
      severity: ERROR
    - id: typescript.aws-cdk.security.audit.awscdk-sqs-unencryptedqueue.awscdk-sqs-unencryptedqueue
      languages:
        - ts
      message: 'Queue $X is missing encryption at rest. Add "encryption: $Y.QueueEncryption.KMS" or "encryption: $Y.QueueEncryption.KMS_MANAGED" to the queue props to enable encryption at rest for the queue.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-311: Missing Encryption of Sensitive Data'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A04:2021 - Insecure Design
        references:
            - https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-data-protection.html
        subcategory:
            - vuln
        technology:
            - AWS-CDK
      pattern-either:
        - patterns:
            - pattern-inside: |
                import {Queue} from '@aws-cdk/aws-sqs'
                ...
            - pattern: const $X = new Queue(...)
            - pattern-not: |
                const $X = new Queue(..., {..., encryption: QueueEncryption.KMS_MANAGED, ...})
            - pattern-not: |
                const $X = new Queue(..., {..., encryption: QueueEncryption.KMS, ...})
        - patterns:
            - pattern-inside: |
                import * as $Y from '@aws-cdk/aws-sqs'
                ...
            - pattern: const $X = new $Y.Queue(...)
            - pattern-not: |
                const $X = new $Y.Queue(..., {..., encryption: $Y.QueueEncryption.KMS_MANAGED, ...})
            - pattern-not: |
                const $X = new $Y.Queue(..., {..., encryption: $Y.QueueEncryption.KMS, ...})
      severity: WARNING
    - id: typescript.aws-cdk.security.awscdk-bucket-grantpublicaccessmethod.awscdk-bucket-grantpublicaccessmethod
      languages:
        - ts
      message: Using the GrantPublicAccess method on bucket contruct $X will make the objects in the bucket world accessible. Verify if this is intentional.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-306: Missing Authentication for Critical Function'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html
        subcategory:
            - vuln
        technology:
            - AWS-CDK
      pattern-either:
        - patterns:
            - pattern-inside: |
                import {Bucket} from '@aws-cdk/aws-s3'
                ...
            - pattern: |
                const $X = new Bucket(...)
                ...
                $X.grantPublicAccess(...)
        - patterns:
            - pattern-inside: |
                import * as $Y from '@aws-cdk/aws-s3'
                ...
            - pattern: |
                const $X = new $Y.Bucket(...)
                ...
                $X.grantPublicAccess(...)
      severity: WARNING
    - id: typescript.aws-cdk.security.awscdk-codebuild-project-public.awscdk-codebuild-project-public
      languages:
        - ts
      message: CodeBuild Project $X is set to have a public URL. This will make the build results, logs, artifacts publically accessible, including builds prior to the project being public. Ensure this is acceptable for the project.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-306: Missing Authentication for Critical Function'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://docs.aws.amazon.com/codebuild/latest/userguide/public-builds.html
        subcategory:
            - vuln
        technology:
            - AWS-CDK
      pattern-either:
        - patterns:
            - pattern-inside: |
                import {Project} from '@aws-cdk/aws-codebuild'
                ...
            - pattern: |
                const $X = new Project(..., {..., badge: true, ...})
        - patterns:
            - pattern-inside: |
                import * as $Y from '@aws-cdk/aws-codebuild'
                ...
            - pattern: |
                const $X = new $Y.Project(..., {..., badge: true, ...})
      severity: WARNING
    - id: typescript.nestjs.security.audit.nestjs-open-redirect.nestjs-open-redirect
      languages:
        - typescript
      message: 'Untrusted user input in {url: ...} can result in Open Redirect vulnerability.'
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-601: URL Redirection to Untrusted Site (''Open Redirect'')'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        subcategory:
            - audit
        technology:
            - nestjs
      patterns:
        - pattern: |
            return {url: $URL}
        - pattern-inside: |
            class $CN {
                @Redirect(...)
                $FN(...) {
                    ...
                }
            }
        - pattern-not: |
            return {url: "..."}
      severity: WARNING
    - id: typescript.react.security.audit.react-dangerouslysetinnerhtml.react-dangerouslysetinnerhtml
      languages:
        - typescript
        - javascript
      message: Detection of dangerouslySetInnerHTML from non-constant definition. This can inadvertently expose users to cross-site scripting (XSS) attacks if this comes from user-provided input. If you have to use dangerouslySetInnerHTML, consider using a sanitization library such as DOMPurify to sanitize your HTML.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html
        subcategory:
            - vuln
        technology:
            - react
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $S = new Remarkable()
                    ...
            - pattern: $S.render(...)
      pattern-sinks:
        - patterns:
            - focus-metavariable: $X
            - pattern-either:
                - pattern: |
                    {...,dangerouslySetInnerHTML: {__html: $X},...}
                - pattern: |
                    <$Y ... dangerouslySetInnerHTML={{__html: $X}} />
            - pattern-not: |
                <$Y ... dangerouslySetInnerHTML={{__html: "..."}} />
            - pattern-not: |
                {...,dangerouslySetInnerHTML:{__html: "..."},...}
            - metavariable-pattern:
                metavariable: $X
                patterns:
                    - pattern-not: |
                        {...}
            - pattern-not: |
                <... {__html: "..."} ...>
            - pattern-not: |
                <... {__html: `...`} ...>
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    function ...({..., $X, ...}) { ... }
                - pattern-inside: |
                    function ...(..., $X, ...) { ... }
            - focus-metavariable: $X
            - pattern-not-inside: |
                $F. ... .$SANITIZEUNC(...)
      severity: WARNING
    - id: typescript.react.security.audit.react-unsanitized-method.react-unsanitized-method
      languages:
        - typescript
        - javascript
      message: Detection of $HTML from non-constant definition. This can inadvertently expose users to cross-site scripting (XSS) attacks if this comes from user-provided input. If you have to use $HTML, consider using a sanitization library such as DOMPurify to sanitize your HTML.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://developer.mozilla.org/en-US/docs/Web/API/Document/writeln
            - https://developer.mozilla.org/en-US/docs/Web/API/Document/write
            - https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentHTML
        subcategory:
            - vuln
        technology:
            - react
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $S = new Remarkable()
                    ...
            - pattern: $S.render(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: "this.window.document. ... .$HTML('...',$SINK) \n"
                - pattern: "window.document. ... .$HTML('...',$SINK) \n"
                - pattern: "document.$HTML($SINK)  \n"
            - metavariable-regex:
                metavariable: $HTML
                regex: (writeln|write)
            - focus-metavariable: $SINK
        - patterns:
            - pattern-either:
                - pattern: "$PROP. ... .$HTML('...',$SINK) \n"
            - metavariable-regex:
                metavariable: $HTML
                regex: (insertAdjacentHTML)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    function ...({..., $X, ...}) { ... }
                - pattern-inside: |
                    function ...(..., $X, ...) { ... }
            - focus-metavariable: $X
            - pattern-either:
                - pattern: $X.$Y
                - pattern: $X[...]
      severity: WARNING
    - id: typescript.react.security.audit.react-unsanitized-property.react-unsanitized-property
      languages:
        - typescript
        - javascript
      message: Detection of $HTML from non-constant definition. This can inadvertently expose users to cross-site scripting (XSS) attacks if this comes from user-provided input. If you have to use $HTML, consider using a sanitization library such as DOMPurify to sanitize your HTML.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site Scripting'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A07:2017 - Cross-Site Scripting (XSS)
            - A03:2021 - Injection
        references:
            - https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html
        subcategory:
            - vuln
        technology:
            - react
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import * as $S from "underscore.string"
                    ...
                - pattern-inside: |
                    import $S from "underscore.string"
                    ...
                - pattern-inside: |
                    $S = require("underscore.string")
                    ...
            - pattern-either:
                - pattern: $S.escapeHTML(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from "dompurify"
                    ...
                - pattern-inside: |
                    import { ..., $S,... } from "dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "dompurify"
                    ...
                - pattern-inside: |
                    $S = require("dompurify")
                    ...
                - pattern-inside: |
                    import $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    import * as $S from "isomorphic-dompurify"
                    ...
                - pattern-inside: |
                    $S = require("isomorphic-dompurify")
                    ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S(...)
                        ...
                    - pattern: $VALUE.sanitize(...)
                - patterns:
                    - pattern-inside: |
                        $VALUE = $S.sanitize
                        ...
                    - pattern: $S(...)
                - pattern: $S.sanitize(...)
                - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'xss';
                    ...
                - pattern-inside: |
                    import * as $S from 'xss';
                    ...
                - pattern-inside: |
                    $S = require("xss")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $S from 'sanitize-html';
                    ...
                - pattern-inside: |
                    import * as $S from "sanitize-html";
                    ...
                - pattern-inside: |
                    $S = require("sanitize-html")
                    ...
            - pattern: $S(...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $S = new Remarkable()
                    ...
            - pattern: $S.render(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $BODY = $REACT.useRef(...)
                    ...
                - pattern-inside: |
                    $BODY = useRef(...)
                    ...
                - pattern-inside: |
                    $BODY = findDOMNode(...)
                    ...
                - pattern-inside: |
                    $BODY = createRef(...)
                    ...
                - pattern-inside: |
                    $BODY = $REACT.findDOMNode(...)
                    ...
                - pattern-inside: |
                    $BODY = $REACT.createRef(...)
                    ...
            - pattern-either:
                - pattern: "$BODY. ... .$HTML = $SINK \n"
                - pattern: "$BODY.$HTML = $SINK  \n"
            - metavariable-regex:
                metavariable: $HTML
                regex: (innerHTML|outerHTML)
            - focus-metavariable: $SINK
        - patterns:
            - pattern-either:
                - pattern: ReactDOM.findDOMNode(...).$HTML = $SINK
            - metavariable-regex:
                metavariable: $HTML
                regex: (innerHTML|outerHTML)
            - focus-metavariable: $SINK
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    function ...({..., $X, ...}) { ... }
                - pattern-inside: |
                    function ...(..., $X, ...) { ... }
            - focus-metavariable: $X
            - pattern-either:
                - pattern: $X.$Y
                - pattern: $X[...]
      severity: WARNING
    - id: typescript.react.security.react-insecure-request.react-insecure-request
      languages:
        - typescript
        - javascript
      message: Unencrypted request over HTTP detected.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://www.npmjs.com/package/axios
        subcategory:
            - vuln
        technology:
            - react
        vulnerability: Insecure Transport
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $AXIOS from 'axios';
                    ...
                    $AXIOS.$METHOD(...)
                - pattern-inside: |
                    $AXIOS = require('axios');
                    ...
                    $AXIOS.$METHOD(...)
            - pattern-either:
                - pattern: $AXIOS.get("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.post("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.delete("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.head("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.patch("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.put("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
                - pattern: $AXIOS.options("=~/[Hh][Tt][Tt][Pp]:\/\/.*/",...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import $AXIOS from 'axios';
                    ...
                    $AXIOS(...)
                - pattern-inside: |
                    $AXIOS = require('axios');
                    ...
                    $AXIOS(...)
            - pattern-either:
                - pattern: '$AXIOS({url: "=~/[Hh][Tt][Tt][Pp]:\/\/.*/"}, ...)'
                - pattern: |
                    $OPTS = {url: "=~/[Hh][Tt][Tt][Pp]:\/\/.*/"}
                    ...
                    $AXIOS($OPTS, ...)
        - pattern: fetch("=~/[Hh][Tt][Tt][Pp]:\/\/.*/", ...)
      severity: ERROR
    - id: yaml.argo.security.argo-workflow-parameter-command-injection.argo-workflow-parameter-command-injection
      languages:
        - yaml
      message: Using input or workflow parameters in here-scripts can lead to command injection or code injection. Convert the parameters to env variables instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A03:2021  Injection
        references:
            - https://github.com/argoproj/argo-workflows/issues/5061
            - https://github.com/argoproj/argo-workflows/issues/5114#issue-808865370
        subcategory:
            - vuln
        technology:
            - ci
            - argo
      patterns:
        - pattern-inside: |
            apiVersion: $VERSION
            ...
        - metavariable-regex:
            metavariable: $VERSION
            regex: (argoproj.io.*)
        - pattern-either:
            - patterns:
                - pattern-inside: "command:\n  ...\n  - python\n  ...\n...\nsource: \n  $SCRIPT\n"
                - focus-metavariable: $SCRIPT
                - metavariable-pattern:
                    language: python
                    metavariable: $SCRIPT
                    patterns:
                        - pattern: |
                            $FUNC(..., $PARAM, ...)
                        - metavariable-pattern:
                            metavariable: $PARAM
                            pattern-either:
                                - pattern-regex: (.*{{.*inputs.parameters.*}}.*)
                                - pattern-regex: (.*{{.*workflow.parameters.*}}.*)
            - patterns:
                - pattern-inside: "command:\n  ...\n  - $LANG\n  ...\n...\nsource: \n  $SCRIPT\n"
                - metavariable-regex:
                    metavariable: $LANG
                    regex: (bash|sh)
                - focus-metavariable: $SCRIPT
                - metavariable-pattern:
                    language: bash
                    metavariable: $SCRIPT
                    patterns:
                        - pattern: |
                            $CMD ... $PARAM  ...
                        - metavariable-pattern:
                            metavariable: $PARAM
                            pattern-either:
                                - pattern-regex: (.*{{.*inputs.parameters.*}}.*)
                                - pattern-regex: (.*{{.*workflow.parameters.*}}.*)
            - patterns:
                - pattern-inside: |
                    container:
                      ...
                      command: $LANG
                      ...
                      args: $PARAM
                - metavariable-regex:
                    metavariable: $LANG
                    regex: .*(sh|bash|ksh|csh|tcsh|zsh).*
                - metavariable-pattern:
                    metavariable: $PARAM
                    pattern-either:
                        - pattern-regex: (.*{{.*inputs.parameters.*}}.*)
                        - pattern-regex: (.*{{.*workflow.parameters.*}}.*)
                - focus-metavariable: $PARAM
      severity: ERROR
    - id: yaml.docker-compose.security.exposing-docker-socket-volume.exposing-docker-socket-volume
      languages:
        - yaml
      message: Exposing host's Docker socket to containers via a volume. The owner of this socket is root. Giving someone access to it is equivalent to giving unrestricted root access to your host. Remove 'docker.sock' from volumes to prevent this.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        likelihood: LOW
        owasp:
            - A06:2017 - Security Misconfiguration
            - A05:2021 - Security Misconfiguration
        references:
            - https://docs.docker.com/compose/compose-file/compose-file-v3/#volume-configuration-reference
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-1-do-not-expose-the-docker-daemon-socket-even-to-the-containers
        subcategory:
            - audit
        technology:
            - docker-compose
      patterns:
        - pattern-inside: |
            version: ...
            ...
        - pattern-either:
            - pattern: |
                volumes:
                  - ...
                  - /var/run/docker.sock:/var/run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - /run/docker.sock:/run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - /var/run/docker.sock:/run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - /run/docker.sock:/var/run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - /var/run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - /run/docker.sock
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - ...
                    source: /var/run/docker.sock
                    ...
                  - ...
            - pattern: |
                volumes:
                  - ...
                  - ...
                    source: /run/docker.sock
                    ...
                  - ...
      severity: WARNING
    - fix: |
        false
      id: yaml.docker-compose.security.privileged-service.privileged-service
      languages:
        - yaml
      message: Service '$SERVICE' is running in privileged mode. This grants the container the equivalent of root capabilities on the host machine. This can lead to container escapes, privilege escalation, and other security concerns. Remove the 'privileged' key to disable this capability.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: HIGH
        owasp:
            - A06:2017 - Security Misconfiguration
            - A05:2021 - Security Misconfiguration
        references:
            - https://www.trendmicro.com/en_us/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html
            - https://containerjournal.com/topics/container-security/why-running-a-privileged-container-is-not-a-good-idea/
        subcategory:
            - vuln
        technology:
            - docker-compose
      patterns:
        - pattern-inside: |
            version: ...
            ...
            services:
              ...
              $SERVICE:
                ...
                privileged: $TRUE
        - focus-metavariable: $TRUE
        - metavariable-regex:
            metavariable: $TRUE
            regex: (true)
      severity: WARNING
    - id: yaml.github-actions.security.allowed-unsecure-commands.allowed-unsecure-commands
      languages:
        - yaml
      message: The environment variable `ACTIONS_ALLOW_UNSECURE_COMMANDS` grants this workflow permissions to use the `set-env` and `add-path` commands. There is a vulnerability in these commands that could result in environment variables being modified by an attacker. Depending on the use of the environment variable, this could enable an attacker to, at worst, modify the system path to run a different command than intended, resulting in arbitrary code execution. This could result in stolen code or secrets. Don't use `ACTIONS_ALLOW_UNSECURE_COMMANDS`. Instead, use Environment Files. See https://github.com/actions/toolkit/blob/main/docs/commands.md#environment-files for more information.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-749: Exposed Dangerous Method or Function'
        impact: MEDIUM
        likelihood: LOW
        owasp: A06:2017 - Security Misconfiguration
        references:
            - https://github.blog/changelog/2020-10-01-github-actions-deprecating-set-env-and-add-path-commands/
            - https://github.com/actions/toolkit/security/advisories/GHSA-mfwh-5m23-j46w
            - https://github.com/actions/toolkit/blob/main/docs/commands.md#environment-files
        subcategory:
            - vuln
        technology:
            - github-actions
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: '{env: ...}'
                - pattern: 'ACTIONS_ALLOW_UNSECURE_COMMANDS: true'
      severity: WARNING
    - id: yaml.github-actions.security.curl-eval.curl-eval
      languages:
        - yaml
      message: Data is being eval'd from a `curl` command. An attacker with control of the server in the `curl` command could inject malicious code into the `eval`, resulting in a system comrpomise. Avoid eval'ing untrusted data if you can. If you must do this, consider checking the SHA sum of the content returned by the server to verify its integrity.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: LOW
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.github.com/en/actions/learn-github-actions/security-hardening-for-github-actions#understanding-the-risk-of-script-injections
        subcategory:
            - audit
        technology:
            - github-actions
            - bash
            - curl
      patterns:
        - pattern-inside: 'steps: [...]'
        - pattern-inside: |
            - run: ...
              ...
        - pattern: 'run: $SHELL'
        - metavariable-pattern:
            language: bash
            metavariable: $SHELL
            patterns:
                - pattern: |
                    $DATA=<... curl ...>
                    ...
                    eval <... $DATA ...>
      severity: ERROR
    - id: yaml.github-actions.security.github-script-injection.github-script-injection
      languages:
        - yaml
      message: 'Using variable interpolation `${{...}}` with `github` context data in a `actions/github-script`''s `script:` step could allow an attacker to inject their own code into the runner. This would allow them to steal secrets and code. `github` context data can have arbitrary user input and should be treated as untrusted. Instead, use an intermediate environment variable with `env:` to store the data and use the environment variable in the `run:` script. Be sure to use double-quotes the environment variable, like this: "$ENVVAR".'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-94: Improper Control of Generation of Code (''Code Injection'')'
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A03:2021 - Injection
        references:
            - https://docs.github.com/en/actions/learn-github-actions/security-hardening-for-github-actions#understanding-the-risk-of-script-injections
            - https://securitylab.github.com/research/github-actions-untrusted-input/
            - https://github.com/actions/github-script
        subcategory:
            - vuln
        technology:
            - github-actions
      patterns:
        - pattern-inside: 'steps: [...]'
        - pattern-inside: |
            uses: $ACTION
            ...
        - pattern-inside: |
            with:
              ...
              script: ...
              ...
        - pattern: 'script: $SHELL'
        - metavariable-regex:
            metavariable: $ACTION
            regex: actions/github-script@.*
        - metavariable-pattern:
            language: generic
            metavariable: $SHELL
            patterns:
                - pattern-either:
                    - pattern: ${{ github.event.issue.title }}
                    - pattern: ${{ github.event.issue.body }}
                    - pattern: ${{ github.event.pull_request.title }}
                    - pattern: ${{ github.event.pull_request.body }}
                    - pattern: ${{ github.event.comment.body }}
                    - pattern: ${{ github.event.review.body }}
                    - pattern: ${{ github.event.review_comment.body }}
                    - pattern: ${{ github.event.pages. ... .page_name}}
                    - pattern: ${{ github.event.head_commit.message }}
                    - pattern: ${{ github.event.head_commit.author.email }}
                    - pattern: ${{ github.event.head_commit.author.name }}
                    - pattern: ${{ github.event.commits ... .author.email }}
                    - pattern: ${{ github.event.commits ... .author.name }}
                    - pattern: ${{ github.event.pull_request.head.ref }}
                    - pattern: ${{ github.event.pull_request.head.label }}
                    - pattern: ${{ github.event.pull_request.head.repo.default_branch }}
                    - pattern: ${{ github.head_ref }}
                    - pattern: ${{ github.event.inputs ... }}
      severity: ERROR
    - id: yaml.github-actions.security.pull-request-target-code-checkout.pull-request-target-code-checkout
      languages:
        - yaml
      message: This GitHub Actions workflow file uses `pull_request_target` and checks out code from the incoming pull request. When using `pull_request_target`, the Action runs in the context of the target repository, which includes access to all repository secrets. Normally, this is safe because the Action only runs code from the target repository, not the incoming PR. However, by checking out the incoming PR code, you're now using the incoming code for the rest of the action. You may be inadvertently executing arbitrary code from the incoming PR with access to repository secrets, which would let an attacker steal repository secrets. This normally happens by running build scripts (e.g., `npm build` and `make`) or dependency installation scripts (e.g., `python setup.py install`). Audit your workflow file to make sure no code from the incoming PR is executed. Please see https://securitylab.github.com/research/github-actions-preventing-pwn-requests/ for additional mitigations.
      metadata:
        category: security
        confidence: LOW
        cwe:
            - 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021 - Broken Access Control
        references:
            - https://securitylab.github.com/research/github-actions-preventing-pwn-requests/
            - https://github.com/justinsteven/advisories/blob/master/2021_github_actions_checkspelling_token_leak_via_advice_symlink.md
        subcategory:
            - audit
        technology:
            - github-actions
      patterns:
        - pattern-either:
            - pattern-inside: |
                on:
                  ...
                  pull_request_target: ...
                  ...
                ...
            - pattern-inside: |
                on: [..., pull_request_target, ...]
                ...
            - pattern-inside: |
                on: pull_request_target
                ...
        - pattern-inside: |
            jobs:
              ...
              $JOBNAME:
                ...
                steps:
                  ...
        - pattern: |
            ...
            uses: "$ACTION"
            with:
              ...
              ref: $EXPR
        - metavariable-regex:
            metavariable: $ACTION
            regex: actions/checkout@.*
        - metavariable-pattern:
            language: generic
            metavariable: $EXPR
            patterns:
                - pattern: ${{ github.event.pull_request ... }}
      severity: WARNING
    - id: yaml.github-actions.security.run-shell-injection.run-shell-injection
      languages:
        - yaml
      message: 'Using variable interpolation `${{...}}` with `github` context data in a `run:` step could allow an attacker to inject their own code into the runner. This would allow them to steal secrets and code. `github` context data can have arbitrary user input and should be treated as untrusted. Instead, use an intermediate environment variable with `env:` to store the data and use the environment variable in the `run:` script. Be sure to use double-quotes the environment variable, like this: "$ENVVAR".'
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-78: Improper Neutralization of Special Elements used in an OS Command (''OS Command Injection'')'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: HIGH
        likelihood: HIGH
        owasp:
            - A01:2017 - Injection
            - A03:2021 - Injection
        references:
            - https://docs.github.com/en/actions/learn-github-actions/security-hardening-for-github-actions#understanding-the-risk-of-script-injections
            - https://securitylab.github.com/research/github-actions-untrusted-input/
        subcategory:
            - vuln
        technology:
            - github-actions
      patterns:
        - pattern-inside: 'steps: [...]'
        - pattern-inside: |
            - run: ...
              ...
        - pattern: 'run: $SHELL'
        - metavariable-pattern:
            language: generic
            metavariable: $SHELL
            patterns:
                - pattern-either:
                    - pattern: ${{ github.event.issue.title }}
                    - pattern: ${{ github.event.issue.body }}
                    - pattern: ${{ github.event.pull_request.title }}
                    - pattern: ${{ github.event.pull_request.body }}
                    - pattern: ${{ github.event.comment.body }}
                    - pattern: ${{ github.event.review.body }}
                    - pattern: ${{ github.event.review_comment.body }}
                    - pattern: ${{ github.event.pages. ... .page_name}}
                    - pattern: ${{ github.event.head_commit.message }}
                    - pattern: ${{ github.event.head_commit.author.email }}
                    - pattern: ${{ github.event.head_commit.author.name }}
                    - pattern: ${{ github.event.commits ... .author.email }}
                    - pattern: ${{ github.event.commits ... .author.name }}
                    - pattern: ${{ github.event.pull_request.head.ref }}
                    - pattern: ${{ github.event.pull_request.head.label }}
                    - pattern: ${{ github.event.pull_request.head.repo.default_branch }}
                    - pattern: ${{ github.head_ref }}
                    - pattern: ${{ github.event.inputs ... }}
      severity: ERROR
    - id: yaml.github-actions.security.third-party-action-not-pinned-to-commit-sha.third-party-action-not-pinned-to-commit-sha
      languages:
        - yaml
      message: An action sourced from a third-party repository on GitHub is not pinned to a full length commit SHA. Pinning an action to a full length commit SHA is currently the only way to use an action as an immutable release. Pinning to a particular SHA helps mitigate the risk of a bad actor adding a backdoor to the action's repository, as they would need to generate a SHA-1 collision for a valid Git object payload.
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-1357: Reliance on Insufficiently Trustworthy Component'
            - 'CWE-353: Missing Support for Integrity Check'
        impact: LOW
        likelihood: LOW
        owasp: A06:2021 - Vulnerable and Outdated Components
        references:
            - https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components
            - https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#using-third-party-actions
        subcategory:
            - vuln
        technology:
            - github-actions
      patterns:
        - pattern-inside: '{steps: ...}'
        - pattern: |
            uses: "$USES"
        - metavariable-pattern:
            language: generic
            metavariable: $USES
            patterns:
                - pattern-not-regex: ^[.]/
                - pattern-not-regex: ^actions/
                - pattern-not-regex: ^github/
                - pattern-not-regex: '@[0-9a-f]{40}$'
                - pattern-not-regex: ^docker://.*@sha256:[0-9a-f]{64}$
      severity: WARNING
    - id: yaml.github-actions.security.workflow-run-target-code-checkout.workflow-run-target-code-checkout
      languages:
        - yaml
      message: This GitHub Actions workflow file uses `workflow_run` and checks out code from the incoming pull request. When using `workflow_run`, the Action runs in the context of the target repository, which includes access to all repository secrets. Normally, this is safe because the Action only runs code from the target repository, not the incoming PR. However, by checking out the incoming PR code, you're now using the incoming code for the rest of the action. You may be inadvertently executing arbitrary code from the incoming PR with access to repository secrets, which would let an attacker steal repository secrets. This normally happens by running build scripts (e.g., `npm build` and `make`) or dependency installation scripts (e.g., `python setup.py install`). Audit your workflow file to make sure no code from the incoming PR is executed. Please see https://securitylab.github.com/research/github-actions-preventing-pwn-requests/ for additional mitigations.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-913: Improper Control of Dynamically-Managed Code Resources'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp: A01:2017 - Injection
        references:
            - https://securitylab.github.com/research/github-actions-preventing-pwn-requests/
            - https://github.com/justinsteven/advisories/blob/master/2021_github_actions_checkspelling_token_leak_via_advice_symlink.md
            - https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability
        subcategory:
            - vuln
        technology:
            - github-actions
      patterns:
        - pattern-inside: |
            on:
              ...
              workflow_run: ...
              ...
            ...
        - pattern-inside: |
            jobs:
              ...
              $JOBNAME:
                ...
                steps:
                  ...
        - pattern: |
            ...
            uses: "$ACTION"
            with:
              ...
              ref: $EXPR
        - metavariable-regex:
            metavariable: $ACTION
            regex: actions/checkout@.*
        - metavariable-pattern:
            language: generic
            metavariable: $EXPR
            patterns:
                - pattern: ${{ github.event.workflow_run ... }}
      severity: WARNING
    - fix: |
        securityContext:
          allowPrivilegeEscalation: false
        $NAME
      id: yaml.kubernetes.security.allow-privilege-escalation-no-securitycontext.allow-privilege-escalation-no-securitycontext
      languages:
        - yaml
      message: In Kubernetes, each pod runs in its own isolated environment with its own set of security policies. However, certain container images may contain `setuid` or `setgid` binaries that could allow an attacker to perform privilege escalation and gain access to sensitive resources. To mitigate this risk, it's recommended to add a `securityContext` to the container in the pod, with the parameter `allowPrivilegeEscalation` set to `false`. This will prevent the container from running any privileged processes and limit the impact of any potential attacks. By adding a `securityContext` to your Kubernetes pod, you can help to ensure that your containerized applications are more secure and less vulnerable to privilege escalation attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A06:2017 - Security Misconfiguration
        references:
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#privilege-escalation
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
            - https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-4-add-no-new-privileges-flag
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern-inside: |
            containers:
              ...
        - pattern-inside: |
            - $NAME: $CONTAINER
              ...
        - pattern: |
            image: ...
            ...
        - pattern-not: |
            image: ...
            ...
            securityContext:
              ...
        - metavariable-regex:
            metavariable: $NAME
            regex: name
        - focus-metavariable: $NAME
      severity: WARNING
    - fix: |
        false
      id: yaml.kubernetes.security.allow-privilege-escalation-true.allow-privilege-escalation-true
      languages:
        - yaml
      message: In Kubernetes, each pod runs in its own isolated environment with its own  set of security policies. However, certain container images may contain  `setuid` or `setgid` binaries that could allow an attacker to perform  privilege escalation and gain access to sensitive resources. To mitigate  this risk, it's recommended to add a `securityContext` to the container in  the pod, with the parameter `allowPrivilegeEscalation` set to `false`.  This will prevent the container from running any privileged processes and  limit the impact of any potential attacks.  In the container `$CONTAINER` this parameter is set to `true` which makes this container much more vulnerable to privelege escalation attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A06:2017 - Security Misconfiguration
        references:
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#privilege-escalation
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
            - https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-4-add-no-new-privileges-flag
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern-inside: |
            containers:
              ...
        - pattern-inside: |
            - name: $CONTAINER
              ...
        - pattern-inside: |
            image: ...
            ...
        - pattern-inside: |
            securityContext:
              ...
        - pattern: |
            allowPrivilegeEscalation: $TRUE
        - metavariable-pattern:
            metavariable: $TRUE
            pattern: |
                true
        - focus-metavariable: $TRUE
      severity: WARNING
    - fix: |
        securityContext:
          allowPrivilegeEscalation: false #
      id: yaml.kubernetes.security.allow-privilege-escalation.allow-privilege-escalation
      languages:
        - yaml
      message: In Kubernetes, each pod runs in its own isolated environment with its own set of security policies. However, certain container images may contain `setuid` or `setgid` binaries that could allow an attacker to perform privilege escalation and gain access to sensitive resources. To mitigate this risk, it's recommended to add a `securityContext` to the container in the pod, with the parameter `allowPrivilegeEscalation` set to `false`. This will prevent the container from running any privileged processes and limit the impact of any potential attacks. By adding the `allowPrivilegeEscalation` parameter to your the `securityContext`, you can help to ensure that your containerized applications are more secure and less vulnerable to privilege escalation attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-732: Incorrect Permission Assignment for Critical Resource'
        cwe2021-top25: true
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A06:2017 - Security Misconfiguration
        references:
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#privilege-escalation
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
            - https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-4-add-no-new-privileges-flag
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern-inside: |
            containers:
              ...
        - pattern-inside: |
            - name: $CONTAINER
              ...
        - pattern: |
            image: ...
            ...
        - pattern-inside: |
            image: ...
            ...
            $SC:
              ...
        - metavariable-regex:
            metavariable: $SC
            regex: ^(securityContext)$
        - pattern-not-inside: |
            image: ...
            ...
            securityContext:
              ...
              allowPrivilegeEscalation: $VAL
        - focus-metavariable: $SC
      severity: WARNING
    - id: yaml.kubernetes.security.exposing-docker-socket-hostpath.exposing-docker-socket-hostpath
      languages:
        - yaml
      message: Exposing host's Docker socket to containers via a volume. The owner of this socket is root. Giving someone access to it is equivalent to giving unrestricted root access to your host. Remove 'docker.sock' from hostpath to prevent this.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        likelihood: LOW
        references:
            - https://kubernetes.io/docs/concepts/storage/volumes/#hostpath
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-1-do-not-expose-the-docker-daemon-socket-even-to-the-containers
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern-inside: |
            volumes:
              ...
        - pattern: |
            hostPath:
              ...
              path: /var/run/docker.sock
      severity: WARNING
    - id: yaml.kubernetes.security.legacy-api-clusterrole-excessive-permissions.legacy-api-clusterrole-excessive-permissions
      languages:
        - yaml
      message: 'Semgrep detected a Kubernetes core API ClusterRole with excessive permissions. Attaching excessive permissions to a ClusterRole associated with the core namespace allows the V1 API to perform arbitrary actions on arbitrary resources attached to the cluster. Prefer explicit allowlists of verbs/resources when configuring the core API namespace. '
      metadata:
        category: security
        confidence: HIGH
        cwe:
            - 'CWE-269: Improper Privilege Management'
        cwe2021-top25: false
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A06:2017 - Security Misconfiguration
        references:
            - https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole
            - https://kubernetes.io/docs/concepts/security/rbac-good-practices/#general-good-practice
            - https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.28/#api-groups
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern: |
            "*"
        - pattern-inside: |
            resources: $A
            ...
        - pattern-inside: |
            verbs: $A
            ...
        - pattern-inside: |
            - apiGroups: [""]
              ...
        - pattern-inside: |
            apiVersion: rbac.authorization.k8s.io/v1
            ...
        - pattern-inside: |
            kind: ClusterRole
            ...
      severity: WARNING
    - id: yaml.kubernetes.security.privileged-container.privileged-container
      languages:
        - yaml
      message: Container or pod is running in privileged mode. This grants the container the equivalent of root capabilities on the host machine. This can lead to container escapes, privilege escalation, and other security concerns. Remove the 'privileged' key to disable this capability.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: MEDIUM
        likelihood: MEDIUM
        references:
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#privileged
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html
        subcategory:
            - vuln
        technology:
            - kubernetes
      pattern-either:
        - patterns:
            - pattern-inside: |
                containers:
                  ...
            - pattern: |
                image: ...
                ...
                securityContext:
                  ...
                  privileged: true
        - patterns:
            - pattern-inside: |
                spec:
                  ...
            - pattern-not-inside: |
                image: ...
                ...
            - pattern: |
                privileged: true
      severity: WARNING
    - fix: |
        true
      id: yaml.kubernetes.security.run-as-non-root-unsafe-value.run-as-non-root-unsafe-value
      languages:
        - yaml
      message: When running containers in Kubernetes, it's important to ensure that they  are properly secured to prevent privilege escalation attacks.  One potential vulnerability is when a container is allowed to run  applications as the root user, which could allow an attacker to gain  access to sensitive resources. To mitigate this risk, it's recommended to  add a `securityContext` to the container, with the parameter `runAsNonRoot`  set to `true`. This will ensure that the container runs as a non-root user,  limiting the damage that could be caused by any potential attacks. By  adding a `securityContext` to the container in your Kubernetes pod, you can  help to ensure that your containerized applications are more secure and  less vulnerable to privilege escalation attacks.
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-250: Execution with Unnecessary Privileges'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A05:2021 - Security Misconfiguration
            - A06:2017 - Security Misconfiguration
        references:
            - https://kubernetes.io/blog/2016/08/security-best-practices-kubernetes-deployment/
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/
            - https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user
        subcategory:
            - audit
        technology:
            - kubernetes
      patterns:
        - pattern-either:
            - pattern: |
                spec:
                  ...
                  securityContext:
                    ...
                    runAsNonRoot: $VALUE
            - patterns:
                - pattern-inside: |
                    containers:
                      ...
                - pattern: |
                    image: ...
                    ...
                    securityContext:
                      ...
                      runAsNonRoot: $VALUE
        - metavariable-pattern:
            metavariable: $VALUE
            pattern: |
                false
        - focus-metavariable: $VALUE
      severity: INFO
    - id: yaml.kubernetes.security.seccomp-confinement-disabled.seccomp-confinement-disabled
      languages:
        - yaml
      message: 'Container is explicitly disabling seccomp confinement. This runs the service in an unrestricted state. Remove ''seccompProfile: unconfined'' to prevent this.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-284: Improper Access Control'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A05:2017 - Broken Access Control
            - A01:2021 - Broken Access Control
        references:
            - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#seccomp
            - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern-inside: |
            containers:
              ...
        - pattern: |
            image: ...
            ...
            securityContext:
              ...
              seccompProfile: unconfined
      severity: WARNING
    - id: yaml.kubernetes.security.secrets-in-config-file.secrets-in-config-file
      languages:
        - yaml
      message: 'Secrets ($VALUE) should not be stored in infrastructure as code files. Use an alternative such as Bitnami Sealed Secrets or KSOPS to encrypt Kubernetes Secrets. '
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-798: Use of Hard-coded Credentials'
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A07:2021 - Identification and Authentication Failures
        references:
            - https://kubernetes.io/docs/concepts/configuration/secret/
            - https://media.defense.gov/2021/Aug/03/2002820425/-1/-1/0/CTR_Kubernetes_Hardening_Guidance_1.1_20220315.PDF
            - https://docs.gitlab.com/ee/user/clusters/agent/gitops/secrets_management.html
            - https://www.cncf.io/blog/2021/04/22/revealing-the-secrets-of-kubernetes-secrets/
            - https://github.com/bitnami-labs/sealed-secrets
            - https://www.cncf.io/blog/2022/01/25/secrets-management-essential-when-using-kubernetes/
            - https://blog.oddbit.com/post/2021-03-09-getting-started-with-ksops/
        subcategory:
            - vuln
        technology:
            - kubernetes
      patterns:
        - pattern: |
            $KEY: $VALUE
        - pattern-inside: |
            data: ...
        - pattern-inside: |
            kind: Secret
            ...
        - metavariable-regex:
            metavariable: $VALUE
            regex: (?i)^[aA-zZ0-9+/]+={0,2}$
        - metavariable-analysis:
            analyzer: entropy
            metavariable: $VALUE
      severity: WARNING
    - id: yaml.kubernetes.security.skip-tls-verify-cluster.skip-tls-verify-cluster
      languages:
        - yaml
      message: 'Cluster is disabling TLS certificate verification when communicating with the server. This makes your HTTPS connections insecure. Remove the ''insecure-skip-tls-verify: true'' key to secure communication.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://kubernetes.io/docs/reference/config-api/client-authentication.v1beta1/#client-authentication-k8s-io-v1beta1-Cluster
        subcategory:
            - vuln
        technology:
            - kubernetes
      pattern: |
        cluster:
          ...
          insecure-skip-tls-verify: true
      severity: WARNING
    - id: yaml.kubernetes.security.skip-tls-verify-service.skip-tls-verify-service
      languages:
        - yaml
      message: 'Service is disabling TLS certificate verification when communicating with the server. This makes your HTTPS connections insecure. Remove the ''insecureSkipTLSVerify: true'' key to secure communication.'
      metadata:
        category: security
        confidence: MEDIUM
        cwe:
            - 'CWE-319: Cleartext Transmission of Sensitive Information'
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A03:2017 - Sensitive Data Exposure
            - A02:2021 - Cryptographic Failures
        references:
            - https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#apiservice-v1-apiregistration-k8s-io
        subcategory:
            - vuln
        technology:
            - kubernetes
      pattern: |
        spec:
          ...
          insecureSkipTLSVerify: true
      severity: WARNING
    - id: yaml.openapi.security.use-of-basic-authentication.use-of-basic-authentication
      languages:
        - yaml
      message: Basic authentication is considered weak and should be avoided.  Use a different authentication scheme, such of OAuth2, OpenID Connect, or mTLS.
      metadata:
        category: security
        confidence: HIGH
        cwe: 'CWE-287: Improper Authentication'
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A04:2021 Insecure Design
            - A07:2021 Identification and Authentication Failures
        references:
            - https://cwe.mitre.org/data/definitions/287.html
            - https://owasp.org/Top10/A04_2021-Insecure_Design/
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/
        subcategory:
            - vuln
        technology:
            - openapi
      patterns:
        - pattern-inside: |
            openapi: $VERSION
            ...
            components:
              ...
              securitySchemes:
                ...
                $SCHEME:
                  ...
        - metavariable-regex:
            metavariable: $VERSION
            regex: 3.*
        - pattern: |
            type: http
            ...
            scheme: basic
      severity: ERROR
    - id: c_buffer_rule-gets--getts
      languages:
        - c
        - cpp
        - cpp
      message: |
        The gets() function reads a line from stdin into the provided buffer
        until either a terminating newline or EOF. This terminating newline or
        EOF is replaced with a null byte `'\0'`. No check for buffer overruns are
        performed so it is recommended to use `fgets()` instead. Do note
        that some platforms will continue reading data after a `'\0'` is encountered.

        Usage of `fgets()` is not recommended for reading binary based files or inputs,
        instead the `read` or `fread` functions should be used.

        For more information please see: https://linux.die.net/man/3/fgets
      metadata:
        category: security
        cwe: CWE-120
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Use of deprecated function (gets)
      pattern-either:
        - pattern: gets(...)
        - pattern: _getts(...)
        - pattern: _getws(...)
      severity: ERROR
    - id: c_buffer_rule-memcpy-CopyMemory
      languages:
        - c
        - cpp
        - cpp
      message: |
        The `memcpy` family of functions require the developer to validate that the destination buffer
        is the same size or larger than the source buffer. Buffer overflows could be introduced if care
        is not taken to validate buffer sizes.

        If developing for C Runtime Library (CRT), more secure versions of these functions should be
        used, see:
        https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/memcpy-s-wmemcpy-s?view=msvc-170
      metadata:
        category: security
        cwe: CWE-120
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Function does not check for buffer overflows when copying
      pattern-either:
        - pattern: memcpy(...)
        - pattern: CopyMemory(...)
        - pattern: bcopy(...)
      severity: INFO
    - id: c_buffer_rule-strcpy
      languages:
        - c
        - cpp
        - cpp
      message: |
        The `strcpy` family of functions do not provide the ability to limit or check buffer
        sizes before copying to a destination buffer. This can lead to buffer overflows. Consider
        using more secure alternatives such as `strncpy` and provide the correct limit to the
        destination buffer and ensure the string is null terminated.

        For more information please see: https://linux.die.net/man/3/strncpy

        If developing for C Runtime Library (CRT), more secure versions of these functions should be
        used, see:
        https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/strncpy-s-strncpy-s-l-wcsncpy-s-wcsncpy-s-l-mbsncpy-s-mbsncpy-s-l?view=msvc-170
      metadata:
        category: security
        cwe: CWE-120
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Insecure string processing function (strcpy)
      pattern: strcpy(...)
      severity: ERROR
    - id: c_crypto_rule-EVP-des-ecb-EVP-des-cbc
      languages:
        - c
        - cpp
        - cpp
      message: |
        The DES algorithm has not been recommended for over 15 years and was withdrawn from NIST (FIPS
        46-3) in 2005.

        Consider using libsodium's `crypto_secretbox_easy` authenticated encryption functions instead.

        For more information please see:
         https://libsodium.gitbook.io/doc/secret-key_cryptography/secretbox.

        If you must be FIPS compliant, consider using OpenSSLs AES or 3DES ciphers.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Insecure encryption algorithm (DES)
      pattern-either:
        - pattern: EVP_des_ecb(...)
        - pattern: EVP_des_cbc(...)
        - pattern: EVP_des_cfb(...)
        - pattern: EVP_des_ofb(...)
        - pattern: EVP_desx_cbc(...)
      severity: ERROR
    - id: c_crypto_rule-EVP-rc4-40-EVP-rc2-40-cbc
      languages:
        - c
        - cpp
        - cpp
      message: |
        The RC4 algorithm is vulnerable to many attacks and should no longer be used for encrypting
        data streams.

        Consider using libsodium's `crypto_secretstream_xchacha20poly1305` stream cipher encryption
        functions instead. For more information please see:
        https://libsodium.gitbook.io/doc/secret-key_cryptography/secretstream

        If you must be FIPS compliant, consider using OpenSSLs AES or 3DES ciphers.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Insecure stream cipher (RC4)
      pattern-either:
        - pattern: EVP_rc4_40(...)
        - pattern: EVP_rc2_40_cbc(...)
        - pattern: EVP_rc2_64_cbc(...)
      severity: ERROR
    - id: c_format_rule-fprintf-vfprintf
      languages:
        - c
        - cpp
        - cpp
      message: |
        Format string vulnerabilities allow an attacker to read or in some cases,
        potentially write data to
        and from locations in the processes' memory. To prevent against format
        string attacks, do not allow
        users or un-validated input to provide the format specification.
        Consider using a constant for the format specification, or only allow specific
        characters to be provided to the format argument for the `fprintf` family of functions.

        For more information please see: https://linux.die.net/man/3/fprintf

        For more information on format string attacks please see OWASP's attack
        guide: https://owasp.org/www-community/attacks/Format_string_attack
      metadata:
        category: security
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Potential format string vulnerability
      pattern-either:
        - patterns:
            - pattern: fprintf($FD, $FMT, ...)
            - pattern-not: fprintf($FD, "...", ...)
        - patterns:
            - pattern: vfprintf($FMT, $ARGS, ...)
            - pattern-not: vfprintf("...", $ARGS, ...)
        - patterns:
            - pattern: _ftprintf($FD, $FMT, ...)
            - pattern-not: _ftprintf($FD, "...", ...)
        - patterns:
            - pattern: fwprintf($FD, $FMT, ...)
            - pattern-not: fwprintf($FD, "...", ...)
        - patterns:
            - pattern: fvwprintf($FD, $FMT, ...)
            - pattern-not: fvwprintf($FD, "...", ...)
      severity: ERROR
    - id: c_format_rule-printf-vprintf
      languages:
        - c
        - cpp
        - cpp
      message: |
        Format string vulnerabilities allow an attacker to read or in some cases, potentially write
        data to
        and from locations in the processes' memory. To prevent against format string attacks, do not
        allow
        users or un-validated input to provide the format specification.
        Consider using a constant for the format specification, or only allow specific
        characters to be provided to the format argument for the `printf` family of functions.

        For more information please see: https://linux.die.net/man/3/fprintf

        For more information on format string attacks please see OWASP's attack guide:
        https://owasp.org/www-community/attacks/Format_string_attack
      metadata:
        category: security
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Potential format string vulnerability
      pattern-either:
        - patterns:
            - pattern: printf(...)
            - pattern-not: printf("...",...)
        - patterns:
            - pattern: vprintf($FMT, ...)
            - pattern-not: vprintf("...", ...)
        - patterns:
            - pattern: vwprintf($FMT, ...)
            - pattern-not: vwprintf("...", ...)
        - patterns:
            - pattern: vfwprintf($FILE, $FMT, ...)
            - pattern-not: vfwprintf($FILE, "...", ...)
        - patterns:
            - pattern: _vtprintf($FILE, $FMT, ...)
            - pattern-not: _vtprintf($FILE, "...", ...)
        - patterns:
            - pattern: wprintf($FMT, ...)
            - pattern-not: wprintf("...", ...)
      severity: ERROR
    - id: c_format_rule-snprintf-vsnprintf
      languages:
        - c
        - cpp
        - cpp
      message: |
        Format string vulnerabilities allow an attacker to read or in some cases, potentially write
        data to
        and from locations in the processes' memory. To prevent against format string attacks, do not
        allow
        users or un-validated input to provide the format specification.
        Consider using a constant for the format specification, or strip all format
        specifiers from the input prior to calling the `snprintf` family of functions.

        Note that some variations of this function do not always null terminate the strings.

        For more information on using snprintf please see: https://linux.die.net/man/3/snprintf

        For more information on format string attacks please see OWASP's attack guide:
        https://owasp.org/www-community/attacks/Format_string_attack
      metadata:
        category: security
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Potential format string vulnerability
      pattern-either:
        - patterns:
            - pattern: snprintf($BUF,$SIZE,$FMT,...)
            - pattern-not: snprintf($BUF,$SIZE,"...",...)
        - patterns:
            - pattern: vsnprintf($BUF,$SIZE,$FMT)
            - pattern-not: vsnprintf($BUF,$SIZE,"...",...)
        - patterns:
            - pattern: _snprintf($BUF,$SIZE,$FMT,...)
            - pattern-not: _snprintf($BUF,$SIZE,$FMT,"...",...)
        - patterns:
            - pattern: _sntprintf($VAR,$FMT,...)
            - pattern-not: sntprintf($VAR,"...",...)
        - patterns:
            - pattern: _vsntprintf($VAR,$FMT,...)
            - pattern-not: _vsntprintf($VAR,"...",...)
      severity: ERROR
    - id: c_format_rule-syslog
      languages:
        - c
        - cpp
        - cpp
      message: |
        Format string vulnerabilities allow an attacker to read or in some cases, potentially write
        data to
        and from locations in the processes' memory. To prevent against format string attacks, do not
        allow
        users or un-validated input to provide the format specification.
        Consider using a constant for the format specification, or strip all format
        specifiers from the input prior to calling the `syslog` function.

        For more information please see: https://capec.mitre.org/data/definitions/67.html
      metadata:
        category: security
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Potential format string vulnerability in syslog call
      pattern-either:
        - patterns:
            - pattern: syslog($FUNC,...)
            - pattern-not: syslog($FUNC,"...",...)
      severity: ERROR
    - id: c_race_rule-readlink
      languages:
        - c
        - cpp
        - cpp
      message: |
        Usage of the `readlink` function call hints at a potential Time Of Check Time Of Use (TOCTOU)
        vulnerability. An attacker may be able to modify the file being specified by the `readlink`
        function prior to the `readlink` function being called. Additionally, care must be taken
        that the buffer provided is large enough to hold the contents of the file.

        Instead of using `readlink`, use `lstat` prior to opening the file and confirm the attributes
        are correct. Then use `open` to get a file descriptor to this file. Call `fstat` on the
        `open` file descriptor to confirm that `st_dev` and `st_ino` are equal between the two.
        If they are, it is safe to read and operate on the file's contents.

        For more information please see:
        https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.+Avoid+TOCTOU+race+conditions+while+accessing+files
      metadata:
        category: security
        cwe: CWE-367
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Time-of-check time-of-use (TOCTOU) race condition
      pattern: readlink(...)
      severity: ERROR
    - id: c_tmpfile_rule-mktemp
      languages:
        - c
        - cpp
        - cpp
      message: |
        The `mktemp` function should no longer be used due to multiple flaws. Some implementations
        created random files by using known information like the process ID and a single letter. This
        allows for possible race conditions where an attacker could guess or manipulate these files
        prior to them being used.

        Consider using the `mkstemp` function instead, but be aware it also contains possible
        risks. Ensure the process has called the `umask` function with restricted permissions prior
        to calling `mkstemp` and validate the permissions prior to using the file descriptor.

        For more information on temporary files please see:
        https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152425
      metadata:
        category: security
        cwe: CWE-377
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Use of deprecated function (mktemp)
      pattern: mktemp(...)
      severity: ERROR
    - id: c_tmpfile_rule-tmpnam-tempnam
      languages:
        - c
        - cpp
        - cpp
      message: |
        There exists a possible race condition in between the time that `tempnam` or `tmpnam`
        returns a pathname, and the time that the program opens it, another program might create
        that pathname using `open`, or create it as a symbolic link.

        Consider using the `mkstemp` function instead, but be aware it also contains possible
        risks. Ensure the process has called the `umask` function with restricted permissions prior
        to calling `mkstemp` and validate the permissions prior to using the file descriptor.

        For more information on temporary files please see:
        https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152425
      metadata:
        category: security
        cwe: CWE-377
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Potential time of check time of use vulnerability (tmpnam/tempnam)
      pattern-either:
        - pattern: tmpnam(...)
        - pattern: tempnam(...)
      severity: WARNING
    - id: csharp_crypto_rule-CertificateValidationDisabled
      languages:
        - csharp
      message: |
        The `ServicePointManager.ServerCertificateValidationCallback` event has been set
        to always return `true`, which effectively disables the validation of server
        certificates.

        This allows for an adversary who is in between the application and the target host to intercept
        potentially sensitive information or transmit malicious data.

        Remove the callback function that is returning true to allow normal certificate validation to
        proceed.
        When no callback is provided, the client will validate that the certificate name matches the
        hostname
        that was used when creating the request.

        For more information on the `ServerCertificateValidationCallback` property see:
        https://learn.microsoft.com/en-us/dotnet/api/system.net.servicepointmanager.servercertificatevalidationcallback
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Medium
        shortDescription: Certificate validation disabled
      patterns:
        - pattern-inside: |
            using System.Net;
            ...
        - pattern: ServicePointManager.ServerCertificateValidationCallback += $CALLBACK;
        - metavariable-pattern:
            metavariable: $CALLBACK
            patterns:
                - pattern-either:
                    - pattern: $RETURNTYPE $FUNC(...) { return true; }
                    - pattern: (...) => true;
      severity: WARNING
    - id: csharp_crypto_rule-WeakCipherAlgorithm
      languages:
        - csharp
      message: |
        DES, TripleDES and RC2 are all considered broken or insecure cryptographic algorithms.
        If using .NET Framework greater than version 6.0 consider using `ChaCha20Poly1305`
        instead as it is easier and faster than the alternatives such as `AES-256-GCM`.

        For older applications, `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        // Generate a random key
        byte[] key = new byte[32];
        RandomNumberGenerator.Fill(key);

        // Note nonce values _must_ be regenerated every time they are used.
        byte[] nonce = new byte[12];
        RandomNumberGenerator.Fill(nonce);

        byte[] authTag = new byte[16];
        byte[] cipherText;

        using (ChaCha20Poly1305 encryptor = new ChaCha20Poly1305(key))
        {
            byte[] plainText = System.Text.Encoding.UTF8.GetBytes("Secret text to encrypt");
            cipherText = new byte[plainText.Length];
            encryptor.Encrypt(nonce, plainText, cipherText, authTag);
        }

        using (ChaCha20Poly1305 decryptor = new ChaCha20Poly1305(key))
        {
            byte[] output = new byte[cipherText.Length];
            decryptor.Decrypt(nonce, cipherText, authTag, output);
            Console.WriteLine("Output: {0}", System.Text.Encoding.UTF8.GetString(output));
        }
        ```

        Example using `AES-256-GCM`:
        ```
        // Generate a random key
        byte[] key = new byte[32];
        RandomNumberGenerator.Fill(key);

        // Note nonce values _must_ be regenerated every time they are used.
        byte[] nonce = new byte[AesGcm.NonceByteSizes.MaxSize];
        RandomNumberGenerator.Fill(nonce);

        byte[] authTag = new byte[AesGcm.TagByteSizes.MaxSize];
        byte[] cipherText;

        using (AesGcm encryptor = new AesGcm(key))
        {
            byte[] plainText = Encoding.UTF8.GetBytes("Secret text to encrypt");
            cipherText = new byte[plainText.Length];
            encryptor.Encrypt(nonce, plainText, cipherText, authTag);
        }

        using (AesGcm decryptor = new AesGcm(key))
        {
            byte[] output = new byte[cipherText.Length];
            decryptor.Decrypt(nonce, cipherText, authTag, output);
            Console.WriteLine("Output: {0}",  Encoding.UTF8.GetString(output));
        }
        ```
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-inside: |
            using System.Security.Cryptography;
            ...
        - pattern-either:
            - pattern-regex: .*DES\.Create\(\);
            - pattern: new DESCryptoServiceProvider();
            - pattern-regex: .*TripleDES\.Create\(\);
            - pattern: new TripleDESCryptoServiceProvider();
            - pattern-regex: .*RC2\.Create\(\);
            - pattern: new RC2CryptoServiceProvider();
      severity: WARNING
    - id: csharp_crypto_rule-WeakRNG
      languages:
        - csharp
      message: |
        Depending on the context, generating weak random numbers may expose cryptographic functions
        which rely on these numbers to be exploitable. When generating numbers for sensitive values
        such as tokens, nonces, and cryptographic keys, it is recommended that the
        `RandomNumberGenerator` class be used.

        Example `RandomNumberGenerator` usage:
        ```
        Int32 randInt = RandomNumberGenerator.GetInt32(32000);
        byte[] randomBytes = new byte[64];
        RandomNumberGenerator.Fill(randomBytes);
        Console.WriteLine("Random Int32: {0}", randInt);
        Console.WriteLine("Random Bytes: {0}", BitConverter.ToString(randomBytes).Replace("-", ""));
        ```

        For more information see:
        https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.randomnumbergenerator
      metadata:
        category: security
        cwe: CWE-338
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of cryptographically weak Pseudo-Random Number Generator (PRNG)
      patterns:
        - pattern: (Random $RNG).$METHOD(...);
        - focus-metavariable: $RNG
      severity: WARNING
    - id: csharp_csrf_rule-Csrf
      languages:
        - csharp
      message: |
        The application failed to protect against Cross-Site Request Forgery (CSRF)
        due to not including the `[ValidateAntiForgeryToken]` attribute on an
        HTTP method handler that could change user state (usually in the form of POST or PUT
        methods).

        The vulnerability can be exploited by an adversary creating a link or form on a third
        party site and tricking an authenticated victim to access them.

        Add the `[ValidateAntiForgeryToken]` to all methods which take in user data and change
        user state (such as updating a database with a new value). This is especially true for
        functionality such as updating passwords or other security sensitive functions.

        Alternatively, applications can enable a global
        [AutoValidateAntiforgeryTokenAttribute](https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.autovalidateantiforgerytokenattribute)
        filter.

        For more information on ValidateAntiForgeryToken and other CSRF protections in .NET
        see the following URL:
        https://learn.microsoft.com/en-us/aspnet/core/security/anti-request-forgery

        Additionally, consider setting all session cookies to have the `SameSite=Strict` attribute.
        It should be noted that this may impact usability when sharing links across other mediums.
        It is recommended that a two cookie based approach is taken, as outlined in the
        [Top level
        navigations](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-08#section-8.8.2)
        section
        of the SameSite RFC.

        For more information on CSRF see OWASP's guide:
        https://owasp.org/www-community/attacks/csrf
      metadata:
        category: security
        cwe: CWE-352
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Potential Cross-Site Request Forgery (CSRF)
      patterns:
        - pattern: |
            [$HTTPMETHOD]
            public $RET $FOO(...) {
              ...
            }
        - pattern-not: |
            [ValidateAntiForgeryToken]
            public $RET $FOO(...) {
              ...
            }
        - pattern-not-inside: |
            [AutoValidateAntiforgeryToken]
            class $CLASS{
              ...
            }
        - pattern-not-inside: |
            [ValidateAntiForgeryToken]
            class $CLASS{
              ...
            }
        - metavariable-regex:
            metavariable: $HTTPMETHOD
            regex: Http(Post|Delete|Patch|Put)
      severity: WARNING
    - id: csharp_deserialization_rule-InsecureDeserialization
      languages:
        - csharp
      message: |
        Deserialization attacks exploit the process of reading serialized data and turning it back into an
        object. By constructing malicious objects and serializing them, an adversary may attempt to:

        - Inject code that is executed upon object construction, which occurs during the deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized data but are
          read in during deserialization.

        Microsoft recommends no longer using the following serialization formats:

        - BinaryFormatter
        - SoapFormatter
        - NetDataContractSerializer
        - LosFormatter
        - ObjectStateFormatter

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format chosen allows
        the application to specify exactly which object types are allowed to be deserialized. Additionally, when
        deserializing, never deserialize to base object types like `Object` and only cast to the exact object
        type that is expected.

        To protect against mass assignment, only allow deserialization of the specific fields that are required.
        If this is not easily done, consider creating an intermediary type that can be serialized with only the
        necessary fields exposed.

        For more information see Microsoft's deserialization security guide:
        https://learn.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide

        For more details on deserialization attacks in general, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html

        It should be noted that [tools exist](https://github.com/pwntester/ysoserial.net) to automatically create
        exploit code for these vulnerabilities.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of potentially untrusted data
      mode: taint
      pattern-sinks:
        - pattern: (System.Runtime.Serialization.Formatters.Binary.BinaryFormatter $OBJ).Deserialize(...)
        - pattern: (System.Runtime.Serialization.Formatters.Binary.BinaryFormatter $OBJ).UnsafeDeserialize(...)
        - pattern: (System.Runtime.Serialization.Formatters.Binary.BinaryFormatter $OBJ).UnsafeDeserializeMethod(...)
        - pattern: (System.Runtime.Serialization.Formatters.Soap.SoapFormatter $OBJ).Deserialize(...)
        - pattern: (System.Runtime.Serialization.NetDataContractSerializer $OBJ).Deserialize(...)
        - pattern: (System.Web.UI.LosFormatter $OBJ).Deserialize(...)
      pattern-sources:
        - pattern: Request.Cookies[...]
        - pattern: Request.Cookies.Get(...)
        - pattern: Request.Form[...]
        - pattern: Request.Form.Get(...)
        - pattern: Request.Headers[...]
        - pattern: Request.Headers.Get(...)
        - pattern: Request.QueryString[...]
        - pattern: Request.QueryString.Get(...)
        - pattern: Request.Body
        - pattern: $CTX.Request.Cookies[...]
        - pattern: $CTX.Request.Cookies.Get(...)
        - pattern: $CTX.Request.Form[...]
        - pattern: $CTX.Request.Form.Get(...)
        - pattern: $CTX.Request.Headers[...]
        - pattern: $CTX.Request.Headers.Get(...)
        - pattern: $CTX.Request.QueryString[...]
        - pattern: $CTX.Request.QueryString.Get(...)
        - pattern: $CTX.Request.Body
        - pattern: System.IO.File.ReadAllText(...)
        - pattern: System.IO.File.ReadAllTextAsync(...)
        - pattern: System.IO.File.ReadAllLines(...)
        - pattern: System.IO.File.ReadAllLinesAsync(...)
        - pattern: System.IO.File.ReadAllBytes(...)
        - pattern: System.IO.File.ReadAllBytesAsync(...)
        - pattern: System.IO.File.ReadLines(...)
        - pattern: System.IO.File.ReadLinesAsync(...)
        - pattern: System.Environment.GetEnvironmentVariable(...)
      severity: WARNING
    - id: csharp_endpoint_rule-UnvalidatedRedirect
      languages:
        - csharp
      message: |
        The application may allow open redirects if created using user supplied input. Open redirects
        are
        commonly
        abused in phishing attacks where the original domain or URL looks like a legitimate link, but
        then
        redirects a user to a malicious site. An example would be
        `https://example.com/redirect?url=https://%62%61%64%2e%63%6f%6d%2f%66%61%6b%65%6c%6f%67%69%6e`
        which,
        when decoded, turns into `bad.com/fakelogin`.

        Never redirect a client based on user input. It is recommended that the list of target links
        to
        redirect a user to are contained server side, and retrieved using a numerical value
        as an index to return the link to be redirected to. For example, `/redirect?id=1` would cause
        the
        application to look up the `1` index and return a URL such as `https://example.com`. This URL
        would
        then be used to redirect the user, using the 301 response code and `Location` header.

        For more information on open redirects see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-601
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Info
        shortDescription: URL redirection to untrusted site 'open redirect'
      mode: taint
      pattern-sanitizers:
        - pattern: Url.Action(...)
        - pattern: Url.HttpRouteUrl(...)
        - pattern: Url.RouteUrl(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern: return $METHOD(...)
                        - pattern: return new $METHOD(...)
                    - pattern: |
                        if (!Url.IsLocalUrl(...)) {
                            ...
                            return $METHOD(...)
                        }
                - patterns:
                    - pattern-not-inside: |
                        if (Url.IsLocalUrl(...)) {
                            ...
                        }
                    - pattern-not-inside: |
                        if (!Url.IsLocalUrl(...)) {
                            return $X
                        }
                        ...
                    - pattern-either:
                        - pattern: $METHOD(...)
                        - pattern: new $METHOD(...)
                    - metavariable-pattern:
                        metavariable: $METHOD
                        pattern-either:
                            - pattern: Redirect
                            - pattern: RedirectPermanent
                            - pattern: RedirectToRoute
                            - pattern: RedirectToRoutePermanent
                            - pattern: RedirectResult
      pattern-sources:
        - patterns:
            - pattern: $SRC
            - pattern-inside: |
                public $RET $FUNC(...,$SRC,...){...}
        - patterns:
            - pattern: $SRC
            - pattern-inside: |
                if (Uri.TryCreate(..., ..., $SRC)){
                ...
                }
      severity: WARNING
    - id: csharp_injection_rule-CommandInjection
      languages:
        - csharp
      message: |
        OS command injection is a critical vulnerability that can lead to a full system
        compromise as it may allow an adversary to pass in arbitrary commands or arguments
        to be executed.

        User input should never be used in constructing commands or command arguments
        to functions which execute OS commands. This includes filenames supplied by
        user uploads or downloads.

        Ensure your application does not:

        - Use user-supplied information in the process name to execute.
        - Use user-supplied information in an OS command execution function which does
        not escape shell meta-characters.
        - Use user-supplied information in arguments to OS commands.

        The application should have a hardcoded set of arguments that are to be passed
        to OS commands. If filenames are being passed to these functions, it is
        recommended that a hash of the filename be used instead, or some other unique
        identifier. It is strongly recommended that a native library that implements
        the same functionality be used instead of using OS system commands, due to the
        risk of unknown attacks against third party commands.

        When specifying the OS command, ensure the application uses the full path
        information, otherwise the OS may attempt to look up which process to execute
        and could be vulnerable to untrusted search path vulnerabilities (CWE-426).

        Example of safely executing an OS command:
        ```
        public void ExecuteCommand(string userFileData) {
            // generate a random filename, do not using user input
            string fileName = "C:\\Temp\\" + Guid.NewGuid();
            File.WriteAllText(fileName, userFileData);

            using (Process process = new Process())
            {
                // hardcode the full process path
                ProcessStartInfo processInfo = new ProcessStartInfo("C:\\App\\FileReader.exe");
                // only pass in trust arguments, and never direct user input.
                processInfo.Arguments = fileName;
                processInfo.UseShellExecute = false;
                process.StartInfo = processInfo;
                process.Start();
            }
        }
        ```

        For more information on OS command injection, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    ...
                    (System.Diagnostics.Process $PROC).Start(...);
                - pattern-either:
                    - patterns:
                        - pattern: (System.Diagnostics.Process $PROC).StartInfo.FileName = <...$ARG...>;
                        - pattern-not: (System.Diagnostics.Process $PROC).StartInfo.FileName = "...";
                    - patterns:
                        - pattern: (System.Diagnostics.Process $PROC).StartInfo.Arguments = <...$ARG...>;
                        - pattern-not: (System.Diagnostics.Process $PROC).StartInfo.Arguments = "...";
            - patterns:
                - pattern: System.Diagnostics.Process.Start($ARG);
                - pattern-not: System.Diagnostics.Process.Start("...");
            - patterns:
                - pattern-not: $PSINFO.Arguments = "...";
                - pattern-not: $PSINFO.FileName = "...";
                - pattern-not: new System.Diagnostics.ProcessStartInfo("...");
                - pattern-not: new System.Diagnostics.ProcessStartInfo();
                - pattern-either:
                    - pattern: new System.Diagnostics.ProcessStartInfo(...);
                    - pattern: $PSINFO.Arguments = <...$ARG...>;
                    - pattern: $PSINFO.FileName = <...$ARG...>;
            - patterns:
                - pattern-inside: |
                    new System.Diagnostics.ProcessStartInfo{
                    ...
                    }
                - pattern-not: Arguments = "..."
                - pattern-not: FileName = "..."
                - pattern-either:
                    - pattern: Arguments = ...
                    - pattern: FileName = ...
      severity: ERROR
    - id: csharp_injection_rule-LdapInjection
      languages:
        - csharp
      message: |
        LDAP injection attacks exploit LDAP queries to influence how data is returned by
        the LDAP, or in this case an Active Directory server.

        It is recommended that newer applications use the `System.DirectoryServices.AccountManagement`
        API instead of `DirectorySearcher` API as it hides the complexity of querying LDAP directly.
        However,
        the `AccountManagement` API is still susceptible to LDAP injection if a user inputs LDAP
        queries,
        including LDAP filter characters such as `*`.

        It is recommended that all input passed to LDAP querying systems encode the following values:

        - Any occurrence of the null character must be escaped as \00.
        - Any occurrence of the open parenthesis character must be escaped as \28.
        - Any occurrence of the close parenthesis character must be escaped as \29.
        - Any occurrence of the asterisk character must be escaped as \2a.
        - Any occurrence of the backslash character must be escaped as \5c.

        Example code that safely encodes input for use in an LDAP query using the `AccountManagement`
        API:
        ```
        using System.DirectoryServices.AccountManagement;

        string EncodeLDAPString(string input) {
            // Note the \ character is replaced first
            char[] chars = new char[] { '\\', '\0', '(', ')', '*' };
            string[] encoded = new string[] { "\\5c", "\\00", "\\28", "\\29", "\\2a" };

            for (int i = 0; i < chars.Length; i++)
            {
                input = input.Replace(chars[i].ToString(), encoded[i]);
            }

            return input;
        }

        // unsafe, do not use without encoding first
        string userInput = "Administrator";
        PrincipalContext AD = new PrincipalContext(ContextType.Domain, "ad.example.dev");

        UserPrincipal u = new UserPrincipal(AD);
        string encodedUserName = EncodeLDAPString(userInput);

        // The AD search term, encoded prior to calling search
        u.SamAccountName = encodedUserName;

        // Search for user
        PrincipalSearcher search = new PrincipalSearcher(u);

        // Use FindOne to only return a single result
        UserPrincipal result = (UserPrincipal)search.FindOne();
        search.Dispose();

        // show some details
        if (result != null) {
            Console.WriteLine("User: {0}", result.DisplayName);
        } else {
            Console.WriteLine("user not found");
        }
        ```

        The same encoding method shown in `EncodeLDAPString` can also be used when using the
        older `DirectorySearcher` API.

        For more information see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-90
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of special elements used in an LDAP query ('LDAP Injection')
      mode: taint
      pattern-sinks:
        - pattern: System.DirectoryServices.AccountManagement.UserPrincipal.FindByIdentity(...)
        - pattern: new System.DirectoryServices.DirectoryEntry(...)
        - pattern: new System.DirectoryServices.DirectorySearcher(...)
        - pattern: new System.DirectoryServices.Protocols.SearchRequest(...)
        - patterns:
            - focus-metavariable: $TAINTED
            - pattern-either:
                - pattern: (System.DirectoryServices.DirectoryEntry $SOURCE).Path = $TAINTED
                - pattern: (System.DirectoryServices.DirectorySearcher $SEARCHER).Filter = $TAINTED
                - pattern: (System.DirectoryServices.Protocols.SearchRequest $SEARCHREQ).Filter = $TAINTED
                - pattern: (System.DirectoryServices.Protocols.SearchRequest $SEARCHREQ).DistinguishedName = $TAINTED
                - pattern: (System.DirectoryServices.AccountManagement.UserPrincipal $SEARCHREQ).$PROP = $TAINTED
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $RET $METHOD(...,$VAR,...){...}
            - pattern: $VAR
      severity: WARNING
    - id: csharp_injection_rule-SQLInjection
      languages:
        - csharp
      message: |
        SQL Injection is a critical vulnerability that can lead to data or system compromise. By
        dynamically generating SQL query strings, user input may be able to influence the logic of
        the SQL statement. This could lead to an adversary accessing information they should
        not have access to, or in some circumstances, being able to execute OS functionality or code.

        Replace all dynamically generated SQL queries with parameterized queries. In situations where
        dynamic queries must be created, never use direct user input, but instead use a map or
        dictionary of valid values and resolve them using a user supplied key.

        For example, some database drivers do not allow parameterized queries for `>` or `<` comparison
        operators. In these cases, do not use a user supplied `>` or `<` value, but rather have the
        user
        supply a `gt` or `lt` value. The alphabetical values are then used to look up the `>` and `<`
        values to be used in the construction of the dynamic query. The same goes for other queries
        where
        column or table names are required but cannot be parameterized.

        Example using parameterized queries with `SqlCommand`:
        ```
        string userInput = "someUserInput";
        string connectionString = ...;
        using (SqlConnection connection = new SqlConnection(connectionString))
        {
            connection.Open();
            String sql = "SELECT name, value FROM table where name=@Name";

            using (SqlCommand command = new SqlCommand(sql, connection))
            {
                command.Parameters.Add("@Name", System.Data.SqlDbType.NVarChar);
                command.Parameters["@Name"].Value = userInput;
                using (SqlDataReader reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Console.WriteLine("{0} {1}", reader.GetString(0), reader.GetString(1));
                    }
                }
            }
        }
        ```

        For more information on SQL Injection see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
      patterns:
        - pattern-either:
            - patterns:
                - metavariable-pattern:
                    metavariable: $FUNC
                    pattern-either:
                        - pattern: SqlQuery
                        - pattern: ExecuteSqlCommand
                        - pattern: ExecuteSqlCommandAsync
                        - pattern: ExecuteSqlRaw
                        - pattern: ExecuteSqlRawAsync
                        - pattern: FromSqlRaw
                        - pattern: FromSql
                        - pattern: GetSqlStringCommand
                        - pattern: ExecuteDataSet
                        - pattern: ExecuteReader
                        - pattern: ExecuteNonQuery
                        - pattern: ExecuteScalar
                        - pattern: CreateSQLQuery
                - pattern-either:
                    - pattern: $DB.$FUNC($ARG, ...)
                    - pattern: $DB.$FUNC<$CC>($ARG, ...)
                - pattern-not: $DB.$FUNC("...", ...)
                - pattern-not: $DB.$FUNC<$CC>("...", ...)
            - patterns:
                - pattern-inside: |
                    using System.Data.Linq;
                    ...
                - pattern-either:
                    - patterns:
                        - pattern: (DataContext $CTX).ExecuteQuery<$TRESULT>($ARG, ...)
                        - pattern-not: (DataContext $CTX).ExecuteQuery<$TRESULT>("...", ...)
                    - patterns:
                        - pattern: (DataContext $CTX).ExecuteQuery($TYPE, $ARG, ...)
                        - pattern-not: (DataContext $CTX).ExecuteQuery($TYPE, "...", ...)
                    - patterns:
                        - pattern: (DataContext $CTX).ExecuteCommand($ARG, ...)
                        - pattern-not: (DataContext $CTX).ExecuteCommand("...", ...)
            - patterns:
                - metavariable-pattern:
                    metavariable: $IMPL
                    pattern-either:
                        - pattern: SqlCommand
                        - pattern: OracleCommand
                        - pattern: NpgsqlCommand
                        - pattern: MySqlCommand
                        - pattern: EntityCommand
                        - pattern: OdbcCommand
                        - pattern: OleDbCommand
                        - pattern: SqliteCommand
                - pattern-either:
                    - patterns:
                        - pattern: new $IMPL($ARG, ...);
                        - pattern-not: new $IMPL("...", ...);
                    - patterns:
                        - pattern: ($IMPL $CMD).CommandText = <...$ARG...>;
                        - pattern-not: ($IMPL $CMD).CommandText = "...";
            - patterns:
                - metavariable-pattern:
                    metavariable: $FUNC
                    pattern-either:
                        - pattern: ExecuteDataRow
                        - pattern: ExecuteDataRowAsync
                        - pattern: ExecuteDataset
                        - pattern: ExecuteDatasetAsync
                        - pattern: ExecuteNonQuery
                        - pattern: ExecuteNonQueryAsync
                        - pattern: ExecuteReader
                        - pattern: ExecuteReaderAsync
                        - pattern: ExecuteScalar
                        - pattern: ExecuteScalarAsync
                        - pattern: UpdateDataSet
                        - pattern: UpdateDataSetAsync
                - pattern-inside: |
                    using MySql.Data.MySqlClient;
                    ...
                - pattern: MySqlHelper.$FUNC($CONN, $ARG, ...)
                - pattern-not: MySqlHelper.$FUNC($CONN, "...", ...)
            - patterns:
                - pattern-inside: |
                    using Cassandra;
                    ...
                - pattern-not: $SESS.Execute("...", ...)
                - pattern-either:
                    - pattern: (Session $SESS).Execute($ARG, ...)
                    - patterns:
                        - pattern-inside: |
                            var $SESS = $CLUSTER.Connect(...);
                            ...
                        - pattern: $SESS.Execute($ARG, ...)
      severity: WARNING
    - id: csharp_injection_rule-XPathInjection
      languages:
        - csharp
      message: |
        XPath injection is a vulnerability that can allow an adversary to inject or modify how an XML
        query
        is structured. Depending on the logic of the original query, this could lead to adversaries
        extracting unauthorized information or in rare cases bypassing authorization checks.

        It is recommended that LINQ to XML is used instead of XPath for querying XML documents. Care
        must be taken to **not** call these LINQ functions with user input as they can still lead to
        XPath
        injection:

        - `XPathEvaluate`
        - `XPathSelectElement`
        - `XPathSelectElements`

        Example using LINQ to XML to safely extract the first user from a list of users:
        ```
        // XDocument is safe from XXE attacks as the resolver is disabled by default
        XDocument doc = XDocument.Load("users.xml");
        XNamespace ns = "urn:users-schema";

        string userInput = "LastName";

        // Get all the users.
        var user = doc.Descendants(ns + "user")
                       .Select(u => new {
                          FirstName = (string)u.Element(ns + "first-name"),
                          LastName = (string)u.Element(ns + "last-name")
                       }).Where(u => u.LastName == userInput).FirstOrDefault();

        Console.WriteLine(user.FirstName + " " + user.LastName);
        ```

        For more information on LINQ to XML security see:
        https://learn.microsoft.com/en-us/dotnet/standard/linq/linq-xml-security

        For more information on XML security see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#net
      metadata:
        category: security
        cwe: CWE-643
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of data within XPath expressions ('XPath Injection')
      patterns:
        - pattern-inside: |
            using System.Xml;
            ...
        - pattern-either:
            - patterns:
                - metavariable-regex:
                    metavariable: $FUNC
                    regex: ^(SelectNodes|SelectSingleNode|Compile|Evaluate|Matches|Select|SelectAncestors|SelectChildren|SelectDescendants)$
                - metavariable-regex:
                    metavariable: $TY
                    regex: ^(XPathNavigator|XmlDocument|XmlNode|XmlDocumentXPathExtensions)$
                - pattern: ($TY $VAR).$FUNC(<...$ARG...>, ...)
                - pattern-not: ($TY $VAR).$FUNC("...", ...)
            - patterns:
                - pattern-inside: |
                    using System.Xml.Linq;
                    ...
                - metavariable-regex:
                    metavariable: $FUNC
                    regex: ^(XPathEvaluate|XPathSelectElement|XPathSelectElements)$
                - pattern: $VAR.$FUNC(<...$ARG...>, ...)
                - pattern-not: $VAR.$FUNC("...", ...)
            - patterns:
                - pattern-inside: |
                    using System.Xml.Schema;
                    ...
                - pattern-either:
                    - patterns:
                        - pattern: $VAR.XPath = <...$ARG...>;
                        - pattern-not: $VAR.XPath = "..."
                    - patterns:
                        - pattern: new XmlSchemaXPath { XPath = <...$ARG...> };
                        - focus-metavariable: $ARG
      severity: INFO
    - id: csharp_injection_rule-XmlDocumentXXEInjection
      languages:
        - csharp
      message: |
        External XML entities are a feature of XML parsers that allow documents to contain references
        to
        other documents or data. This feature can be abused to read files, communicate with external
        hosts,
        exfiltrate data, or cause a Denial of Service (DoS).

        XML parsers and document loaders must be configured to not resolve entities. This can be done
        by:
        - Ensuring you are running a version of .NET Framework greater than 4.5.2 (released in 2014).
        - Using `XDocument` which disables entity resolution and is generally safe from DoS.
        - Setting `XmlDocument`'s `XmlResolver` to null.

        Example of safely loading an XML file using `XmlDocument`:
        ```
        XmlDocument document = new XmlDocument();
        document.XmlResolver = null;
        document.Load("users.xml");
        ```

        For more information on XML security, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#net
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-not-inside: |
                (XmlDocument $DOC).XmlResolver = null;
                ...
            - pattern-either:
                - pattern: (XmlDocument $DOC).Load(...);
                - pattern: (XmlDocument $DOC).LoadXml(...);
      pattern-sources:
        - pattern: var $DOC = new System.Xml.XmlDocument(...);
        - patterns:
            - pattern: var $DOC = new System.Xml.XmlDocument {...};
            - pattern-not: var $DOC = new System.Xml.XmlDocument {...,XmlResolver = null,...};
      severity: WARNING
    - id: csharp_injection_rule-XmlReaderXXEInjection
      languages:
        - csharp
      message: |
        External XML entities are a feature of XML parsers that allow documents to contain references
        to
        other documents or data. This feature can be abused to read files, communicate with external
        hosts,
        exfiltrate data, or cause a Denial of Service (DoS).

        XML parsers and document loaders must be configured to not resolve entities. This can be done
        by:
        - Ensuring you are running a version of .NET Framework greater than 4.5.2 (released in 2014).
        - Setting `XmlTextReader`'s  `ProhibitDtd` to `true`
        - Setting `XmlReaderSettings` `DtdProcessing` to `DtdProcessing.Prohibit`

        Example of safely loading an XML file using `XmlDocument`:
        ```
        var settings = new XmlReaderSettings();
        settings.DtdProcessing = DtdProcessing.Prohibit;
        XmlReader reader = XmlReader.Create(path, settings);
        ```

        For more information on XML security, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#net
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $SETTINGS.ProhibitDtd = false;
                    ...
                - pattern-inside: |
                    $SETTINGS.DtdProcessing = DtdProcessing.Parse;
                    ...
            - pattern: System.Xml.XmlReader.Create(..., $SETTINGS);
      pattern-sources:
        - pattern: var $SETTINGS = new XmlReaderSettings();
      severity: WARNING
    - id: csharp_other_rule-UnsafeXSLTSettingUsed
      languages:
        - csharp
      message: |
        By setting `XsltSettings.EnableScript` to true, an adversary who is able to influence the
        loaded
        XSL document could directly inject code to compromise the system. It is strongly
        recommended that an alternative approach is used to work with XML data.

        For increased security:

        - Never process user-supplied XSL style sheets
        - Ensure `XsltSettings.EnableScript` is set to false
        - Ensure `XsltSettings.EnableDocumentFunction` is set to false

        If the application must calculate values from XML input, instead of using XSL scripts to
        execute functions, modify the XML document prior to running the
        `XslCompiledTransform.Transform` method.

        Example of modifying the XML prior to running `Transform`:
        ```
        const String filename = "number.xml";
        const String stylesheet = "calc.xsl";

        // Compile the style sheet.
        XsltSettings xslt_settings = new XsltSettings();
        xslt_settings.EnableScript = false; // disable script
        xslt_settings.EnableDocumentFunction = false; // disable document() function
        XslCompiledTransform xslt = new XslCompiledTransform();
        XmlResolver resolver = null; // set a null entity resolver
        xslt.Load(stylesheet, xslt_settings, resolver);

        // Load the XML source file, using XDocument for safety
        XDocument doc = XDocument.Load(filename);

        // do our modifications to the document before the transformation
        // instead of inside of a script.
        doc.Element("data").Add(new XElement("circle", new XElement("radius", 12)));

        // Create an XmlWriter.
        XmlWriterSettings settings = new XmlWriterSettings();
        settings.OmitXmlDeclaration = true;
        settings.Indent = true;
        XmlWriter writer = XmlWriter.Create("output.xml", settings);
        // Finally, execute the transformation.
        xslt.Transform(doc.CreateReader(), writer);
        writer.Close();
        ```

        For more information on security considerations when using XSL see the following URLs:
        - https://learn.microsoft.com/en-us/dotnet/standard/data/xml/xslt-security-considerations
        - https://learn.microsoft.com/en-us/dotnet/api/system.xml.xsl.xslcompiledtransform?view=net-7.0#security-considerations
      metadata:
        category: security
        cwe: CWE-91
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: XML injection (aka Blind XPath injection)
      patterns:
        - pattern-either:
            - patterns:
                - pattern: new XsltSettings() {...,$OPTIONS,...};
                - metavariable-pattern:
                    metavariable: $OPTIONS
                    pattern-either:
                        - pattern: EnableDocumentFunction = true
                        - pattern: EnableScript = true
            - patterns:
                - pattern: $SETTINGS.$OPT = true;
                - pattern: |
                    var $SETTINGS = new XsltSettings();
                    ...
                    $SETTINGS.$OPT = true;
                - metavariable-pattern:
                    metavariable: $OPT
                    pattern-either:
                        - pattern: EnableDocumentFunction
                        - pattern: EnableScript
      severity: WARNING
    - id: csharp_path_rule-PathTraversal
      languages:
        - csharp
      message: |
        The application dynamically constructs file or path information. If the path
        information comes from user input, it could be abused to read sensitive files,
        access other users data, or aid in exploitation to gain further system access.

        User input should never be used in constructing paths or files for interacting
        with the filesystem. This includes filenames supplied by user uploads or downloads.
        If possible consider hashing user input or replacing it with unique values and
        use `System.IO.Path.GetFullPath` to resolve and validate the path information
        prior to processing any file functionality.

        Example using `Path.GetFullPath` and not allowing direct user input:
        ```
        // store user input alongside an ID we control
        struct userData
        {
            public string userFilename;
            public Guid id;
        }

        class Program
        {
            public static void Main()
            {
                userData data = new userData();
                // user input, saved only as a reference
                data.userFilename = "..\\test.txt";

                // random id as the filename
                data.id = Guid.NewGuid();

                // restrict all file processing to this directory only
                string basePath = "C:\\Restricted\\";

                // resolve the full path, but only use our random generated id
                string fullPath = Path.GetFullPath(basePath + data.id);

                // verify the path is contained within our basePath
                if (!fullPath.StartsWith(basePath)) {
                    Console.WriteLine("Invalid path specified!");
                    return;
                }
                // process / work with file
            }
        }
        ```

        For more information on path traversal issues see OWASP:
        https://owasp.org/www-community/attacks/Path_Traversal
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - pattern: (Microsoft.Extensions.FileProviders.PhysicalFileProvider $E).GetFileInfo(...)
            - pattern: (System.Web.HttpServerUtility $E).MapPath(...)
            - pattern: (System.Web.HttpServerUtilityBase $E).MapPath(...)
            - pattern: (System.Web.HttpRequest $E).MapPath(...)
      pattern-sinks:
        - pattern-either:
            - pattern: System.IO.Directory.Delete(...)
            - pattern: System.IO.Directory.GetFiles(...)
            - pattern: System.IO.Directory.Move(...)
            - pattern: System.IO.File.AppendAllLines(...)
            - pattern: System.IO.File.AppendAllLinesAsync(...)
            - pattern: System.IO.File.AppendAllText(...)
            - pattern: System.IO.File.AppendAllTextAsync(...)
            - pattern: System.IO.File.AppendText(...)
            - pattern: System.IO.File.Copy(...)
            - pattern: System.IO.File.Create(...)
            - pattern: System.IO.File.CreateText(...)
            - pattern: System.IO.File.Delete(...)
            - pattern: System.IO.File.Move(...)
            - pattern: System.IO.File.Open(...)
            - pattern: System.IO.File.OpenRead(...)
            - pattern: System.IO.File.OpenText(...)
            - pattern: System.IO.File.OpenWrite(...)
            - pattern: System.IO.File.ReadAllBytes(...)
            - pattern: System.IO.File.ReadAllBytesAsync(...)
            - pattern: System.IO.File.ReadAllLines(...)
            - pattern: System.IO.File.ReadAllLinesAsync(...)
            - pattern: System.IO.File.ReadAllText(...)
            - pattern: System.IO.File.ReadAllTextAsync(...)
            - pattern: System.IO.File.ReadLines(...)
            - pattern: System.IO.File.Replace(...)
            - pattern: System.IO.File.SetAccessControl(...)
            - pattern: System.IO.File.WriteAllBytes(...)
            - pattern: System.IO.File.WriteAllBytesAsync(...)
            - pattern: System.IO.File.WriteAllLines(...)
            - pattern: System.IO.File.WriteAllLinesAsync(...)
            - pattern: System.IO.File.WriteAllText(...)
            - pattern: System.IO.File.WriteAllTextAsync(...)
            - pattern: new System.IO.FileInfo(...)
            - pattern: (System.IO.FileInfo $E).CopyTo(...)
            - pattern: (System.IO.FileInfo $E).MoveTo(...)
            - pattern: (System.IO.FileInfo $E).Replace(...)
            - pattern: System.Reflection.Assembly.LoadFile(...)
            - pattern: System.Reflection.Assembly.LoadFrom(...)
            - pattern: System.Reflection.Assembly.ReflectionOnlyLoadFrom(...)
            - pattern: System.Reflection.Assembly.UnsafeLoadFrom(...)
            - pattern: System.AppDomain.AppendPrivatePath(...)
            - pattern: System.Xml.XmlReader.Create(...)
            - pattern: new System.IO.StreamReader.ctor(...)
            - pattern: new System.IO.StreamWriter.ctor(...)
            - pattern: new System.IO.FileStream.ctor(...)
            - pattern: new System.Web.Mvc.FilePathResult(...)
            - pattern: new Microsoft.AspNetCore.Mvc.PhysicalFileResult(...)
            - pattern: (Microsoft.AspNetCore.Mvc.RazorPages.PageModel $E).PhysicalFile(...)
            - pattern: (System.Web.UI.WebControls.FileUpload $E).SaveAs(...)
            - pattern: (System.Web.HttpResponse $E).TransmitFile(...)
            - pattern: (System.Web.HttpResponse $E).WriteFile(...)
            - pattern: (System.Web.HttpResponseBase $E).TransmitFile(...)
            - pattern: (System.Web.HttpResponseBase $E).WriteFile(...)
            - pattern: (System.IO.Compression.ZipFileExtensions $E).CreateEntryFromFile(...)
            - pattern: (System.IO.Compression.ZipFileExtensions $E).ExtractToFile(...)
            - pattern: (System.IO.Compression.ZipFileExtensions $E).ExtractToDirectory(...)
            - pattern: (System.Net.WebClient $E).DownloadFile(...)
            - pattern: (System.Net.WebClient $E).DownloadFileAsync(...)
            - pattern: (System.Net.WebClient $E).DownloadFileTaskAsync(...)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                public class $CLASS : Controller {
                  ...
                }
            - pattern: $PARAM
            - pattern-either:
                - patterns:
                    - metavariable-regex:
                        metavariable: $HTTP_ANNO
                        regex: ^(Http)
                    - pattern-inside: |
                        [$HTTP_ANNO]
                        public string $METHOD(...,$PARAM,...){...}
                - pattern-inside: |
                    public IActionResult $METHOD(...,$PARAM,...){...}
      severity: WARNING
    - id: csharp_xss_rule-HtmlElementXss
      languages:
        - csharp
      message: |
        Cross Site Scripting (XSS) is an attack which exploits a web application or system to treat
        user input
        as markup or script code. It is important to encode the data depending on the specific context
        it
        is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`
        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Consider using built-in framework capabilities for automatically encoding user input.
        Depending
        on output context, consider using the following `System.Text.Encodings.Web` encoders:

        - [HtmlEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.htmlencoder)
        - [JavaScriptEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.javascriptencoder)
        - [UrlEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.urlencoder)

        For more information on protecting ASP.NET Core applications from XSS see:
        https://learn.microsoft.com/en-us/aspnet/core/security/cross-site-scripting#accessing-encoders-in-code
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - metavariable-regex:
                metavariable: $FUNC
                regex: (SerializeObject|HtmlAttributeEncode|HtmlEncode|HtmlFormUrlEncode|UrlEncode|UrlPathEncode|XmlAttributeEncode|XmlEncode|Encode)
            - pattern: $CLASS.$FUNC(...)
      pattern-sinks:
        - pattern: (System.Web.Mvc.HtmlHelper $E).Raw(...)
        - pattern: (Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper $E).Raw(...)
        - pattern: Response.Write(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).AddAttribute(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).AddStyleAttribute(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).RenderBeginTag(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).Write(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).WriteAttribute(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).WriteBeginTag(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).WriteEndTag(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).WriteFullBeginTag(...)
        - pattern: (System.Web.UI.HtmlTextWriter $E).WriteStyleAttribute(...)
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-inside: |
                $RET $METHOD(...,$PARAM,...){...}
        - pattern: Request.Cookies[...]
        - pattern: Request.Cookies.Get(...)
        - pattern: Request.Form[...]
        - pattern: Request.Form.Get(...)
        - pattern: Request.Headers[...]
        - pattern: Request.Headers.Get(...)
        - pattern: Request.QueryString[...]
        - pattern: Request.QueryString.Get(...)
        - pattern: Request.Params[...]
        - pattern: Request.RawUrl
        - pattern: Request.Url
        - pattern: Request.Path
        - pattern: Request.Body
        - pattern: $CTX.Request.Cookies[...]
        - pattern: $CTX.Request.Cookies.Get(...)
        - pattern: $CTX.Request.Form[...]
        - pattern: $CTX.Request.Form.Get(...)
        - pattern: $CTX.Request.Headers[...]
        - pattern: $CTX.Request.Headers.Get(...)
        - pattern: $CTX.Request.QueryString[...]
        - pattern: $CTX.Request.QueryString.Get(...)
        - pattern: $CTX.Request.Body
      severity: WARNING
    - id: csharp_xss_rule-ScriptXss
      languages:
        - csharp
      message: |
        Cross Site Scripting (XSS) is an attack which exploits a web application or system to treat
        user input
        as markup or script code. It is important to encode the data depending on the specific context
        it
        is used in.

        User input that is used within the application scripts must be encoded, sanitized or validated
        to ensure it cannot change the behavior of the Javascript code.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Consider using built-in framework capabilities for automatically encoding user input.
        Depending
        on output context, consider using the following `System.Text.Encodings.Web` encoders:

        - [HtmlEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.htmlencoder)
        - [JavaScriptEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.javascriptencoder)
        - [UrlEncoder](https://learn.microsoft.com/en-us/dotnet/api/system.text.encodings.web.urlencoder)

        For more information on protecting ASP.NET Core applications from XSS see:
        https://learn.microsoft.com/en-us/aspnet/core/security/cross-site-scripting#accessing-encoders-in-code
      metadata:
        category: security
        cwe: CWE-79
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      mode: taint
      pattern-propagators:
        - from: $IN
          pattern: (StringBuilder $OUT).Append($IN)
          to: $OUT
      pattern-sanitizers:
        - patterns:
            - metavariable-regex:
                metavariable: $FUNC
                regex: (SerializeObject|HtmlAttributeEncode|HtmlEncode|HtmlFormUrlEncode|UrlEncode|UrlPathEncode|XmlAttributeEncode|XmlEncode|Encode)
            - pattern: $CLASS.$FUNC(...)
      pattern-sinks:
        - pattern: $SCRIPTMANAGER.RegisterStartupScript(...)
        - pattern: $SCRIPTMANAGER.RegisterClientScriptBlock(...)
        - pattern: System.Web.UI.RegisterStartupScript(...)
        - pattern: System.Web.UI.RegisterClientScriptBlock(...)
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-inside: |
                $RET $METHOD(...,$PARAM,...){...}
        - pattern: Request.Cookies[...]
        - pattern: Request.Cookies.Get(...)
        - pattern: Request.Form[...]
        - pattern: Request.Form.Get(...)
        - pattern: Request.Headers[...]
        - pattern: Request.Headers.Get(...)
        - pattern: Request.QueryString[...]
        - pattern: Request.QueryString.Get(...)
        - pattern: Request.Params[...]
        - pattern: Request.RawUrl
        - pattern: Request.Url
        - pattern: Request.Path
        - pattern: Request.Body
        - pattern: $CTX.Request.Cookies[...]
        - pattern: $CTX.Request.Cookies.Get(...)
        - pattern: $CTX.Request.Form[...]
        - pattern: $CTX.Request.Form.Get(...)
        - pattern: $CTX.Request.Headers[...]
        - pattern: $CTX.Request.Headers.Get(...)
        - pattern: $CTX.Request.QueryString[...]
        - pattern: $CTX.Request.QueryString.Get(...)
        - pattern: $CTX.Request.Body
        - pattern: $ELE.Text
      severity: WARNING
    - id: go_blocklist_rule-blocklist-des
      languages:
        - go
      message: |
        The DES algorithm has not been recommended for over 15 years and was withdrawn from NIST (FIPS
        46-3) in 2005. It is recommended that an algorithm that provides message integrity be used
        instead. Consider using `XChaCha20Poly1305` or `AES-256-GCM`.

        For older applications, `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `XChaCha20Poly1305`
        - Smaller nonce value size compared to `XChaCha20Poly1305`
        - Catastrophic failure if nonce values are re-used

        Example using
        [XChaCha20Poly1305](https://pkg.go.dev/golang.org/x/crypto/chacha20poly1305#NewX):
        ```
        key := make([]byte, chacha20poly1305.KeySize)
        if _, err := io.ReadFull(rand.Reader, key); err != nil {
          log.Fatal(err)
        }

        // NewX is a variant that uses longer nonce values for better security
        aead, err := chacha20poly1305.NewX(key)
        if err != nil {
          log.Fatal(err)
        }

        var encrypted = []byte{}
        var nonce = []byte{}

        // Encryption routine
        {
          msg := []byte("Some secret message")
          nonce = make([]byte, aead.NonceSize())
          if _, err := io.ReadFull(rand.Reader, nonce); err != nil {
            log.Fatal("failed to generate nonce")
          }

          encrypted = aead.Seal(nil, nonce, msg, nil)
        }

        // Decryption routine
        {
          if len(encrypted) < aead.NonceSize() {
            log.Fatal("incorrect ciphertext length")
          }

          msg, err := aead.Open(nil, nonce, encrypted, nil)
          if err != nil {
            log.Fatal(err)
          }
          fmt.Printf("Decrypted: %s\n", msg)
        }
        ```

        Example using [AES-256-GCM](https://pkg.go.dev/crypto/cipher#NewGCM):
        ```
        // 32 byte keys will configure AES-256
        key := make([]byte, 32)
        if _, err := io.ReadFull(rand.Reader, key); err != nil {
          log.Fatal(err)
        }

        blockCipher, err := aes.NewCipher(key)
        if err != nil {
          log.Fatal(err)
        }

        aead, err := cipher.NewGCM(blockCipher)
        if err != nil {
          log.Fatal(err)
        }

        var encrypted = []byte{}
        var nonce = []byte{}
        // Encryption routine
        {
          msg := []byte("Some secret message")
          // note that the key must be rotated every 2^32 random nonces used otherwise
          // cipher text could be repeated
          nonce = make([]byte, 12)
          if _, err := io.ReadFull(rand.Reader, nonce); err != nil {
            log.Fatal(err)
          }
          encrypted = aead.Seal(nil, nonce, msg, nil)
        }

        // Decryption routine
        {
          msg, err := aead.Open(nil, nonce, encrypted, nil)
          if err != nil {
            log.Fatal(err)
          }
          fmt.Printf("Decrypted: %s\n", msg)
        }
        ```
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern: |
            import "crypto/des"
      severity: WARNING
    - id: go_blocklist_rule-blocklist-md5
      languages:
        - go
      message: |
        The MD5 message-digest algorithm has been cryptographically broken and is unsuitable for
        further use. The MD5 hash algorithm has been found to be vulnerable to producing collisions.
        This means that two different values, when hashed, can lead to the same hash value. It is
        recommended that the SHA-3 or BLAKE2 family of algorithms be used for non-password based
        cryptographic hashes instead. For password based cryptographic hashes,  consider using the
        bcrypt or Argon2id family of cryptographic hashes.

        Hashing values using [BLAKE2](https://pkg.go.dev/golang.org/x/crypto/blake2b):
        ```
        fileContents := []byte("some file contents to create hash for")
        blake2bHasher, err := blake2b.New512(nil)
        if err != nil {
          log.Fatal(err)
        }
        hashedValue := blake2bHasher.Sum(fileContents)
        fmt.Printf("%s\n", hex.EncodeToString(hashedValue))
        ```

        Hashing and securely comparing passwords using
        [Argon2id](https://pkg.go.dev/golang.org/x/crypto/argon2#hdr-Argon2id):
        ```
        type argonParameters struct {
          variant     string
          version     int
          memory      uint32
          iterations  uint32
          parallelism uint8
          saltLength  uint32
          keyLength   uint32
        }

        func (a argonParameters) StringFormat(salt, derivedKey []byte) string {
          encodedSalt := base64.RawStdEncoding.EncodeToString(salt)
          encodedKey := base64.RawStdEncoding.EncodeToString(derivedKey)

          return fmt.Sprintf("$argon2id$v=%d$m=%d,t=%d,p=%d$%s$%s",
            argon2.Version,
            a.memory,
            a.iterations,
            a.parallelism,
            encodedSalt,
            encodedKey,
          )
        }

        func main() {
          // Initialize Argon2id parameters
          p := argonParameters{
            memory:      64 * 1024,
            iterations:  3,
            parallelism: 2,
            saltLength:  16,
            keyLength:   32,
          }

          // Generate random salt (to be stored alongside derived hash key)
          salt := make([]byte, p.saltLength)
          if _, err := io.ReadFull(rand.Reader, salt); err != nil {
            log.Fatal(err)
          }

          usersPassword := []byte("User's Very S3cur3P4ss@rd@#$%")

          var derivedKey []byte
          // Create key hash derived from user's password
          {
            derivedKey = argon2.IDKey(usersPassword, salt, p.iterations, p.memory, p.parallelism,
        p.keyLength)
            // store p.StringFormat(...) result in a data store...
            fmt.Printf("%s\n", p.StringFormat(salt, derivedKey))
          }

          // Verify a user's password against key
          {
            keyToCompare := argon2.IDKey(usersPassword, salt, p.iterations, p.memory, p.parallelism,
        p.keyLength)

            // Use subtle.ConstantTimeCompare(..., ...) to ensure no side channel leaks used in timing
        attacks
            if subtle.ConstantTimeCompare(derivedKey, keyToCompare) == 1 {
              fmt.Printf("Passwords match\n")
            } else {
              fmt.Printf("Passwords do not match\n")
            }
          }
        }
        ```

        For more information on password storage see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern: |
            import "crypto/md5"
      severity: WARNING
    - id: go_blocklist_rule-blocklist-rc4
      languages:
        - go
      message: |
        The RC4 stream-cipher has been cryptographically broken and is unsuitable
        for use in production. It is recommended that ChaCha20 or Advanced Encryption
        Standard (AES) be used instead. Consider using `XChaCha20Poly1305` or `AES-256-GCM`.

        For older applications, `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `XChaCha20Poly1305`
        - Smaller nonce value size compared to `XChaCha20Poly1305`
        - Catastrophic failure if nonce values are re-used

        Example using
        [XChaCha20Poly1305](https://pkg.go.dev/golang.org/x/crypto/chacha20poly1305#NewX):
        ```
        key := make([]byte, chacha20poly1305.KeySize)
        if _, err := io.ReadFull(rand.Reader, key); err != nil {
          log.Fatal(err)
        }

        // NewX is a variant that uses longer nonce values for better security
        aead, err := chacha20poly1305.NewX(key)
        if err != nil {
          log.Fatal(err)
        }

        var encrypted = []byte{}
        var nonce = []byte{}

        // Encryption routine
        {
          msg := []byte("Some secret message")
          nonce = make([]byte, aead.NonceSize())
          if _, err := io.ReadFull(rand.Reader, nonce); err != nil {
            log.Fatal("failed to generate nonce")
          }

          encrypted = aead.Seal(nil, nonce, msg, nil)
        }

        // Decryption routine
        {
          if len(encrypted) < aead.NonceSize() {
            log.Fatal("incorrect ciphertext length")
          }

          msg, err := aead.Open(nil, nonce, encrypted, nil)
          if err != nil {
            log.Fatal(err)
          }
          fmt.Printf("Decrypted: %s\n", msg)
        }
        ```

        Example using [AES-256-GCM](https://pkg.go.dev/crypto/cipher#NewGCM):
        ```
        // 32 byte keys will configure AES-256
        key := make([]byte, 32)
        if _, err := io.ReadFull(rand.Reader, key); err != nil {
          log.Fatal(err)
        }

        blockCipher, err := aes.NewCipher(key)
        if err != nil {
          log.Fatal(err)
        }

        aead, err := cipher.NewGCM(blockCipher)
        if err != nil {
          log.Fatal(err)
        }

        var encrypted = []byte{}
        var nonce = []byte{}
        // Encryption routine
        {
          msg := []byte("Some secret message")
          // note that the key must be rotated every 2^32 random nonces used otherwise
          // cipher text could be repeated
          nonce = make([]byte, 12)
          if _, err := io.ReadFull(rand.Reader, nonce); err != nil {
            log.Fatal(err)
          }
          encrypted = aead.Seal(nil, nonce, msg, nil)
        }

        // Decryption routine
        {
          msg, err := aead.Open(nil, nonce, encrypted, nil)
          if err != nil {
            log.Fatal(err)
          }
          fmt.Printf("Decrypted: %s\n", msg)
        }
        ```
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern: |
            import "crypto/rc4"
      severity: WARNING
    - id: go_blocklist_rule-blocklist-sha1
      languages:
        - go
      message: |
        The SHA-1 message-digest algorithm has been cryptographically broken and
        is unsuitable for further use. It is
        recommended that the SHA-3, or BLAKE2 family of algorithms be used for non-password based
        cryptographic hashes instead. For password based cryptographic hashes, consider using the
        bcrypt or Argon2id family of cryptographic hashes.

        Hashing values using [BLAKE2](https://pkg.go.dev/golang.org/x/crypto/blake2b):
        ```
        fileContents := []byte("some file contents to create hash for")
        blake2bHasher, err := blake2b.New512(nil)
        if err != nil {
          log.Fatal(err)
        }
        hashedValue := blake2bHasher.Sum(fileContents)
        fmt.Printf("%s\n", hex.EncodeToString(hashedValue))
        ```

        Hashing and securely comparing passwords using
        [Argon2id](https://pkg.go.dev/golang.org/x/crypto/argon2#hdr-Argon2id):
        ```
        type argonParameters struct {
          variant     string
          version     int
          memory      uint32
          iterations  uint32
          parallelism uint8
          saltLength  uint32
          keyLength   uint32
        }

        func (a argonParameters) StringFormat(salt, derivedKey []byte) string {
          encodedSalt := base64.RawStdEncoding.EncodeToString(salt)
          encodedKey := base64.RawStdEncoding.EncodeToString(derivedKey)

          return fmt.Sprintf("$argon2id$v=%d$m=%d,t=%d,p=%d$%s$%s",
            argon2.Version,
            a.memory,
            a.iterations,
            a.parallelism,
            encodedSalt,
            encodedKey,
          )
        }

        func main() {
          // Initialize Argon2id parameters
          p := argonParameters{
            memory:      64 * 1024,
            iterations:  3,
            parallelism: 2,
            saltLength:  16,
            keyLength:   32,
          }

          // Generate random salt (to be stored alongside derived hash key)
          salt := make([]byte, p.saltLength)
          if _, err := io.ReadFull(rand.Reader, salt); err != nil {
            log.Fatal(err)
          }

          usersPassword := []byte("User's Very S3cur3P4ss@rd@#$%")

          var derivedKey []byte
          // Create key hash derived from user's password
          {
            derivedKey = argon2.IDKey(usersPassword, salt, p.iterations, p.memory, p.parallelism,
        p.keyLength)
            // store p.StringFormat(...) result in a data store...
            fmt.Printf("%s\n", p.StringFormat(salt, derivedKey))
          }

          // Verify a user's password against key
          {
            keyToCompare := argon2.IDKey(usersPassword, salt, p.iterations, p.memory, p.parallelism,
        p.keyLength)

            // Use subtle.ConstantTimeCompare(..., ...) to ensure no side channel leaks used in timing
        attacks
            if subtle.ConstantTimeCompare(derivedKey, keyToCompare) == 1 {
              fmt.Printf("Passwords match\n")
            } else {
              fmt.Printf("Passwords do not match\n")
            }
          }
        }
        ```

        For more information on password storage see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern: |
            import "crypto/sha1"
      severity: WARNING
    - id: go_crypto_rule-badtlssettings
      languages:
        - go
      message: |
        Usage of a cryptographically insecure cipher suite has been detected. It is recommended that
        alternative ciphers be used instead. It is strongly recommended that all TLS connections
        use TLS 1.3 as Go will automatically choose the most secure cipher when negotiating the
        TLS handshake with client or servers. TLS 1.3 cipher suites are configured to require Perfect
        Forward Secrecy (PFS).
        PFS is an important property as it will ensure that past encrypted transmissions could not be
        decrypted
        if the TLS certificate was compromised.

        Example using TLS 1.3 for a Go server:
        ```
        cert, err := tls.LoadX509KeyPair("server.crt", "server.key")
        if err != nil {
          log.Fatal(err)
        }

        cfg := &tls.Config{Certificates: []tls.Certificate{cert}, MinVersion: tls.VersionTLS13}
        srv := &http.Server{
          Addr:         ":8999",
          TLSConfig:    cfg,
          ReadTimeout:  time.Minute,
          WriteTimeout: time.Minute,
        }
        log.Fatal(srv.ListenAndServeTLS("", ""))
        ```

        If TLS 1.0-1.2 must be used, then the following list of ciphers should be chosen as they
        support
        Perfect Forward Secrecy (PFS):

        - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305


        Example `tls.Config` using the recommended cipher suites:
        ```
        cfg := &tls.Config{
            MinVersion: tls.VersionTLS12,
            CipherSuites: []uint16{
                tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
                tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
                tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
                tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
                tls.TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,
                tls.TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,
            },
        }
        ```

        For more information on cipher suites in Go see: https://go.dev/blog/tls-cipher-suites
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: |
                tls.Config{..., CipherSuites: []$SLICE{..., $CIPHERS, ...}, ...}
            - pattern: |
                tls.CipherSuite{..., ID: $CIPHERS, ...}
        - metavariable-regex:
            metavariable: $CIPHERS
            regex: ((?!tls.TLS_AES_128_GCM_SHA256)|(?!tls.TLS_AES_256_GCM_SHA384)|(?!tls.TLS_CHACHA20_POLY1305_SHA256)| (?!tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256)|(?!tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256)| (?!tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384)|(?!tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384)| (?!tls.TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305)|(?!tls.TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256)| (?!tls.TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305)|(?!tls.TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256)| (?!tls.TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)|(?!tls.TLS_DHE_RSA_WITH_AES_256_GCM_SHA384))
      severity: WARNING
    - id: go_crypto_rule-insecure-ignore-host-key
      languages:
        - go
      message: |
        The application was found to ignore host keys. Host keys are important as
        they provide assurance that the client can prove that the host is trusted.
        By ignoring these host keys, it is impossible for the client to validate the
        connection is to a trusted host.

        For the `ssh.ClientConfig` `HostKeyCallback` property, consider using the
        [knownhosts](https://pkg.go.dev/golang.org/x/crypto/ssh/knownhosts) package that
        parses OpenSSH's `known_hosts` key database.

        Example configuration connecting to a known, trusted host:
        ```
        knownHostCallback, err := knownhosts.New("/home/user/.ssh/known_hosts")
        if err != nil {
          log.Fatal(err)
        }

        // Create client config using the knownHost callback function
        config := &ssh.ClientConfig{
          ...
          HostKeyCallback: knownHostCallback,
        }

        // Connect to ssh server
        conn, err := ssh.Dial("tcp", "localhost:22", config)
        if err != nil {
          log.Fatal("unable to connect: ", err)
        }
        defer conn.Close()
        ```
      metadata:
        category: security
        cwe: CWE-322
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Medium
        shortDescription: Key exchange without entity authentication
      patterns:
        - pattern: ssh.InsecureIgnoreHostKey(...)
      severity: WARNING
    - id: go_crypto_rule-tlsversion
      languages:
        - go
      message: "TLS versions 1.1 and 1.0 were deprecated by the IETF in June 2018 due to \na number of attacks against the vulnerable versions. Use of a deprecated \nTLS version may result in the unauthorized retrieval of sensitive \ninformation. It is strongly recommended that all TLS connections\nuse TLS 1.3 as Go will automatically choose the most secure cipher when \nnegotiating the TLS handshake with client or servers. TLS 1.3 cipher suites \nare configured to require Perfect Forward Secrecy (PFS). PFS is an important \nproperty as it will ensure that past encrypted transmissions could not be\ndecrypted if the TLS certificate was compromised.\n\nExample using TLS 1.3 for a Go server:\n```\ncert, err := tls.LoadX509KeyPair(\"server.crt\", \"server.key\")\nif err != nil {\n  log.Fatal(err)\n}\n\ncfg := &tls.Config{Certificates: []tls.Certificate{cert}, \n                  MinVersion: tls.VersionTLS13}\n\nsrv := &http.Server{\n  Addr:         \":8999\",\n  TLSConfig:    cfg,\n  ReadTimeout:  time.Minute,\n  WriteTimeout: time.Minute,\n}\nlog.Fatal(srv.ListenAndServeTLS(\"cert.pem\", \"key.pem\"))\n```\n"
      metadata:
        category: security
        cwe: CWE-310
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of deprecated TLS version
      pattern-either:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        tls.Config{...}
                    - pattern: |
                        MinVersion: $VAL
                - patterns:
                    - pattern-inside: |
                        $VAR = uint16($VAL)
                        ...
                    - pattern-inside: |
                        tls.Config{...}
                    - pattern: |
                        MinVersion: $VAR
            - metavariable-pattern:
                metavariable: $VAL
                pattern-either:
                    - pattern: tls.VersionTLS11
                    - pattern: tls.VersionTLS10
        - patterns:
            - pattern-inside: |
                tls.Config{...}
            - pattern: |
                MaxVersion: $ANYVAL
            - pattern-not-inside: |
                tls.Config{..., MinVersion: ..., ...}
      severity: WARNING
    - id: go_filesystem_rule-decompression-bomb
      languages:
        - go
      message: |
        Directly decompressing files or buffers may lead to a potential Denial of Service (DoS)
        due to a decompression bomb. Decompression bombs are maliciously compressed files
        or data that decompresses to extremely large sizes. This can cause the process to run
        out of memory, or the disk to fill up.

        To protect against decompression bombs, an
        [io.LimitReader(...)](https://pkg.go.dev/io#LimitReader)
        should be used to limit how much can be read during the decompression routine.

        Example using `io.LimitReader` to protect against a decompression bomb:
        ```
        f, err := os.Open("some.gz")
        if err != nil {
          log.Fatal(err)
        }

        r, err := gzip.NewReader(f)
        if err != nil {
          log.Fatal(err)
        }

        const oneMegabyte = 1024 * 1024
        limitedReader := io.LimitReader(r, oneMegabyte)

        // use limitedReader to stop copying after 1 MB
        if _, err := io.Copy(os.Stdout, limitedReader); err != nil {
          log.Fatal(err)
        }
        ```
      metadata:
        category: security
        cwe: CWE-409
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper handling of highly compressed data
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: io.LimitReader($TAINTED, ...)
            - focus-metavariable: $TAINTED
      pattern-sinks:
        - patterns:
            - pattern: io.Copy($DST, $TAINTED)
            - focus-metavariable: $TAINTED
        - patterns:
            - pattern: io.CopyBuffer($DST, $TAINTED, $BUF)
            - focus-metavariable: $TAINTED
      pattern-sources:
        - pattern: gzip.NewReader(...)
        - pattern: zlib.NewReader(...)
        - pattern: bzip2.NewReader(...)
        - pattern: flate.NewReader(...)
        - pattern: lzw.NewReader(...)
        - pattern: tar.NewReader(...)
        - pattern: zip.NewReader(...)
        - pattern: zlib.NewReaderDict(...)
        - pattern: flate.NewReaderDict(...)
        - pattern: zip.OpenReader(...)
      severity: WARNING
    - id: go_filesystem_rule-fileread
      languages:
        - go
      message: |
        The application dynamically constructs file or path information. If the path
        information comes from user input, it could be abused to read sensitive files,
        access other users data or aid in exploitation to gain further system access.

        User input should never be used in constructing paths or files for interacting
        with the filesystem. This includes filenames supplied by user uploads or downloads.
        If possible, consider hashing user input or replacing it with unique values.
        Additionally, use `filepath.Base` to only use the filename and not path information.
        Always validate the full path prior to opening or writing to any file.

        Example using `filepath.Base`, generating a unique filename without using
        user input to construct filepath information:
        ```
        type userData struct {
            id           string
            userFilename string
        }

        func newUserData(userFilename string) userData {
            return userData{
                id:           randomFileID(), // random id as the filename
                userFilename: userFilename,
            }
        }

        // randomFileID generates a random id, to be used as a filename
        func randomFileID() string {
            id := make([]byte, 16)
            if _, err := io.ReadFull(rand.Reader, id); err != nil {
                log.Fatal(err)
            }
            return hex.EncodeToString(id)
        }

        func main() {

            // user input, saved only as a reference
            data := newUserData("../../possibly/malicious")

            // restrict all file access to this path
            const basePath = "/tmp/"

            // resolve the full path, but only use our random generated id
            resolvedPath, err := filepath.Join(basePath, filepath.Base(data.id))
            if err != nil {
                log.Fatal(err)
            }

            // verify the path is prefixed with our basePath
            if !strings.HasPrefix(resolvedPath, basePath) {
                log.Fatal("path does not start with basePath")
            }
            // process / work with file
        }
        ```

        For more information on path traversal issues see OWASP:
        https://owasp.org/www-community/attacks/Path_Traversal
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if !strings.HasPrefix($CLEAN, "...") {...}
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if strings.HasPrefix($CLEAN, "...") {...}
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if strings.HasPrefix($CLEAN, "...") == false {...}
            - metavariable-regex:
                metavariable: $PKG
                regex: ^((file)?path)$
      pattern-sinks:
        - pattern: os.OpenFile(...)
        - pattern: os.Open(...)
        - pattern: os.ReadFile(...)
        - pattern: ioutil.ReadFile(...)
      pattern-sources:
        - pattern: os.Getenv(...)
        - pattern: fmt.Sprintf(...)
        - pattern: filepath.Join(...)
        - pattern: path.Join(...)
        - patterns:
            - pattern-either:
                - pattern: '... + $TAINTED'
                - pattern: '... + $TAINTED + ...'
                - pattern: $TAINTED + ...
            - pattern-not: '"..." + $TAINTED'
            - pattern-not: '"..." + $TAINTED + "..."'
            - pattern-not: $TAINTED + "..."
            - pattern-not: fmt.Sprintf("...", "...")
        - patterns:
            - pattern-either:
                - pattern: |
                    ($REQUEST : *http.Request).$SOURCE_METHOD
                - pattern: |
                    ($REQUEST : http.Request).$SOURCE_METHOD
            - metavariable-regex:
                metavariable: $SOURCE_METHOD
                regex: ^(BasicAuth|Body|Cookie|Cookies|Form|FormValue|GetBody|Host|MultipartReader|ParseForm|ParseMultipartForm|PostForm|PostFormValue|Referer|RequestURI|Trailer|TransferEncoding|UserAgent|URL)$
      severity: WARNING
    - id: go_filesystem_rule-httprootdir
      languages:
        - go
      message: |
        The application is potentially exposing the entire filesystem by mounting the root
        directory `/` to an HTTP handler function. Anyone who is able to access this HTTP
        server may be able to access any file that the HTTP server has access to.

        Restrict the `http.Dir` path to only a specific folder instead of the entire
        filesystem.

        Example server only allowing directory listing on a public directory:
        ```
        const path = "/var/www/html/public"
        fs := http.FileServer(http.Dir(path))
        log.Fatal(http.ListenAndServe(":9000", fs))
        ```
      metadata:
        category: security
        cwe: CWE-552
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Files or directories accessible to external parties
      patterns:
        - pattern-either:
            - pattern: |
                import $NET "net/http"
                ...
                $NET.Dir("/")
            - pattern: |
                import "net/http"
                ...
                http.Dir("/")
      severity: WARNING
    - id: go_filesystem_rule-ziparchive
      languages:
        - go
      message: |
        The application may be vulnerable to a path traversal if it extracts untrusted archive files.
        This vulnerability is colloquially known as 'Zip Slip'. Archive files may contain folders
        which,
        when extracted, may write outside of the intended directory. This is exploited by including
        path traversal characters such as `../../other/directory` to overwrite or place files in system
        or application directories.

        Extra care must be taken when extracting archive files as there are numerous concerns:

        - Limit the size of the zip archive as it may contain "Zip Bombs", files that extract to
        extremely
        large sizes.
        - If possible, generate unique filenames instead of using the archives file names, as it may be
        possible for users to overwrite files if the filenames are the same.
        - Validate file paths are written with a prefixed, known trusted directory.
        - Only process regular files and not symbolic links, as some applications may attempt to
        read/follow
        the symbolic link, leading to arbitrary file read / write vulnerabilities.


        Example of securely processing an archive file:
        ```
        r, err := zip.OpenReader("trusted.zip")
        if err != nil {
          log.Fatal(err)
        }

        // Ensure archive contains only the expected number of files
        const expectedFileCount = 10
        if len(r.File) > expectedFileCount {
          log.Fatalf("too many files in archive: %d\n", len(r.File))
        }

        // One approach is to sum up all files before attempting to process
        // them.
        const totalAllowedSize = 1024 * 1024 * 10 // 10MB
        var totalSize uint64
        for _, f := range r.File {
          totalSize += f.UncompressedSize64
        }

        if totalSize > totalAllowedSize {
          log.Fatalf("archive exceeds total allowed size: %d\n", totalSize)
        }

        // configure a max size per file allowed
        const maxFileSize = 1024 * 1024 // 1 MB

        // set restricted basePath
        const basePath = "/var/restricted/"

        // iterate over the files in the archive
        for _, f := range r.File {

          // Ensure uncompressed size does not exceed our allowed file size
          if f.UncompressedSize64 > maxFileSize {
            log.Printf("skipping file as it exceeds maxFileSize: %s\n", f.Name)
            continue
          }

          // Ensure file is a regular file and not a symbolic link or has other mode type
          // bits set
          if !f.Mode().IsRegular() {
            log.Printf("skipping non regular file: %s\n", f.Name)
            continue
          }

          // if possible consider not using the name at all, but generating a random id instead.
          // If the filename must be used, extract the base name and not folder path information
          name := filepath.Base(f.Name)

          // Join the file name to the basePath.
          resolvedPath := filepath.Join(basePath, name)

          // Application must still verify the path is prefixed by the basePath
          if !strings.HasPrefix(resolvedPath, basePath) {
            log.Fatal("path does not start with basePath")
          }

          // process / work with file
        }
        ```

        If the application must process directory names as well, use the following code:
        ```
        // Join the cleaned name to the basePath, note if 'name' starts with `../../` it
        // will still allow for traversal, so you _must_ verify the path prefix below
        resolvedPath := filepath.Join(basePath, filepath.Clean(name))

        // Application must still verify the path is prefixed by the basePath
        if !strings.HasPrefix(resolvedPath, basePath) {
          log.Fatal("path does not start with basePath")
        }

        // process / work with file
        ```
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if !strings.HasPrefix($CLEAN, "...") {...}
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if strings.HasPrefix($CLEAN, "...") {...}
                - pattern: |
                    $CLEAN := $PKG.Clean(...)
                    ...
                    if strings.HasPrefix($CLEAN, "...") == false {...}
            - metavariable-regex:
                metavariable: $PKG
                regex: ^((file)?path)$
      pattern-sinks:
        - pattern: filepath.Join(...)
      pattern-sources:
        - pattern: zip.OpenReader(...)
        - pattern: tar.OpenReader(...)
      severity: WARNING
    - id: go_injection_rule-ssrf
      languages:
        - go
      message: |
        Server-Side-Request-Forgery (SSRF) exploits backend systems that initiate requests to third
        parties.
        If user input is used in constructing or sending these requests, an attacker could supply
        malicious
        data to force the request to other systems or modify request data to cause unwanted actions.

        Ensure user input is not used directly in constructing URLs or URIs when initiating requests
        to third party
        systems from back end systems. Care must also be taken when constructing payloads using user
        input. Where
        possible restrict to known URIs or payloads. Consider using a server side map where key's are
        used to return
        URLs such as `https://site/goto?key=1` where `{key: 1, url: 'http://some.url/', key: 2, url:
        'http://...'}`.

        If you must use user supplied input for requesting URLs, it is strongly recommended that the
        HTTP client
        chosen allows you to customize and block certain IP ranges at the network level. By blocking
        RFC 1918
        addresses or other network address ranges, you can limit the severity of a successful SSRF
        attack. Care must
        also be taken to block certain protocol or address formatting such as IPv6.

        If you can not block address ranges at the client level, you may want to run the HTTP client
        as a protected
        user, or in a protected network where you can apply IP Table or firewall rules to block access
        to dangerous
        addresses. Finally, if none of the above protections are available, you could also run a
        custom HTTP proxy
        and force all requests through it to handle blocking dangerous addresses.

        Example HTTP client that disallows access to loopback and RFC-1918 addresses
        ```
        // IsDisallowedIP parses the ip to determine if we should allow the HTTP client to continue
        func IsDisallowedIP(hostIP string) bool {
          ip := net.ParseIP(hostIP)
          return ip.IsMulticast() || ip.IsUnspecified() || ip.IsLoopback() || ip.IsPrivate()
        }

        // SafeTransport uses the net.Dial to connect, then if successful check if the resolved
        // ip address is disallowed. We do this due to hosts such as localhost.lol being resolvable to
        // potentially malicious URLs. We allow connection only for resolution purposes.
        func SafeTransport(timeout time.Duration) *http.Transport {
          return &http.Transport{
            DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) {
              c, err := net.DialTimeout(network, addr, timeout)
              if err != nil {
                return nil, err
              }
              ip, _, _ := net.SplitHostPort(c.RemoteAddr().String())
              if IsDisallowedIP(ip) {
                return nil, errors.New("ip address is not allowed")
              }
              return c, err
            },
            DialTLS: func(network, addr string) (net.Conn, error) {
              dialer := &net.Dialer{Timeout: timeout}
              c, err := tls.DialWithDialer(dialer, network, addr, &tls.Config{})
              if err != nil {
                return nil, err
              }

              ip, _, _ := net.SplitHostPort(c.RemoteAddr().String())
              if IsDisallowedIP(ip) {
                return nil, errors.New("ip address is not allowed")
              }

              err = c.Handshake()
              if err != nil {
                return c, err
              }

              return c, c.Handshake()
            },
            TLSHandshakeTimeout: timeout,
          }
        }

        func httpRequest(requestUrl string) {
          const clientConnectTimeout = time.Second * 10
          httpClient := &http.Client{
            Transport: SafeTransport(clientConnectTimeout),
          }
          resp, err := httpClient.Get(requestUrl)
          if err != nil {
            log.Fatal(err)
          }
          defer resp.Body.Close()
          // work with resp
        }
        ```

        For more information on SSRF see OWASP:
        https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A10:2021-Server-Side Request Forgery
        security-severity: Medium
        shortDescription: Server Side Request Forgery (SSRF)
      mode: taint
      pattern-propagators:
        - from: $P
          pattern: $R := $D.NewDecoder($P)
          to: $R
        - from: $S
          pattern: $S.Decode(&$P)
          to: $P
        - from: $S
          pattern: $S.Decode($P)
          to: $P
        - from: $B
          pattern: $S.Unmarshal($B, &$P)
          to: $P
        - from: $B
          pattern: $S.Unmarshal($B, $P)
          to: $P
      pattern-sinks:
        - pattern: http.Head(...)
        - pattern: http.Get(...)
        - pattern: http.Post(...)
        - pattern: http.PostForm(...)
        - pattern: http.NewRequest($METHOD,...)
        - pattern: http.DefaultClient.Head(...)
        - pattern: http.DefaultClient.Get(...)
        - pattern: http.DefaultClient.Post(...)
        - pattern: http.DefaultClient.PostForm(...)
        - pattern: http.NewRequestWithContext($CONTEXT, $METHOD, ...)
        - pattern: ftp.Dial(...)
        - pattern: ldap.DialURL(...)
        - pattern: smtp.Dial(...)
        - pattern: retryablehttp.NewRequest($METHOD, ..., $BODY)
        - patterns:
            - pattern-inside: |
                $C := retryablehttp.NewClient()
                ...
            - pattern-either:
                - pattern: $C.Get(...)
                - pattern: $C.Post(..., $BODYTYPE, $BODY)
                - pattern: $C.PostForm(..., $VALS)
                - pattern: $C.Head(...)
      pattern-sources:
        - patterns:
            - pattern-not-inside: |
                import "testing"
                ...
            - pattern-either:
                - pattern: os.Stdin
                - pattern: os.Getenv(...)
                - pattern: |
                    ($REQ: *http.Request).$ANY
                - pattern: |
                    ($REQ: http.Request).$ANY
                - patterns:
                    - pattern: '($REQ : *http.Request)'
                    - pattern-inside: |
                        func $FUNC( $W http.ResponseWriter, $R *http.Request, ...) {
                          ...
                        }
      severity: WARNING
    - id: go_injection_rule-template-injection
      languages:
        - go
      message: |
        Cross Site Scripting (XSS) is an attack which exploits a web application or system to treat
        user input
        as markup or script code. It is important to encode the data depending on the specific context
        it
        is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Use of the following template types with user input denotes a security risk:

        - [template.HTML](https://pkg.go.dev/html/template#HTML)
        - [template.JS](https://pkg.go.dev/html/template#JS)
        - [template.URL](https://pkg.go.dev/html/template#URL)
        - [template.HTMLAttr](https://pkg.go.dev/html/template#HTMLAttr)

        Either remove these types from the application or hardcode as const strings prior
        to conversion:
        ```
        testTemplate, err := template.New("testTemplate").Funcs(template.FuncMap{
          "SafeHTML": func() template.HTML {
            const safeHTML = "<div>hardcoded, safe html</div>"
            return template.HTML(safeHTML)
          },
        }).Parse(`<html><body>{{ SafeHTML }}</body>`)
        if err != nil {
          log.Fatal(err)
        }

        if err := testTemplate.Execute(os.Stdout, nil); err != nil {
          log.Fatal(err)
        }
        ```
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      patterns:
        - pattern-either:
            - patterns:
                - pattern: template.HTML($IN)
                - pattern-not: template.HTML("...")
            - patterns:
                - pattern: template.JS($IN)
                - pattern-not: template.JS("...")
            - patterns:
                - pattern: template.URL($IN)
                - pattern-not: template.URL("...")
            - patterns:
                - pattern: template.HTMLAttr($IN)
                - pattern-not: template.HTMLAttr("...")
      severity: WARNING
    - id: go_sql_rule-concat-sqli
      languages:
        - go
      message: |
        SQL Injection is a critical vulnerability that can lead to data or system compromise. By
        dynamically generating SQL query strings, user input may be able to influence the logic of
        the SQL statement. This could lead to an adversary accessing information they should
        not have access to or in some circumstances, being able to execute OS functionality or code.

        Replace all dynamically generated SQL queries with parameterized queries. In situations where
        dynamic queries must be created, never use direct user input, but instead use a map or
        dictionary of valid values and resolve them using a user supplied key.

        For example, some database drivers do not allow parameterized queries for `>` or `<` comparison
        operators. In these cases, do not use a user supplied `>` or `<` value, but rather have the
        user
        supply a `gt` or `lt` value. The alphabetical values are then used to look up the `>` and `<`
        values to be used in the construction of the dynamic query. The same goes for other queries
        where
        column or table names are required but cannot be parameterized.

        Example using parameterized queries with `sql.Query`:
        ```
        rows, err := db.Query("SELECT * FROM users WHERE userName = ?", userName)
        if err != nil {
            return nil, err
        }
        defer rows.Close()
        for rows.Next() {
          // ... process rows
        }
        ```

        For more information on SQL Injection see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL command ('SQL Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $DB.$METHOD(...)
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(Exec(Context)?|Query(Context)?|QueryRow(Context)?)$
      pattern-sources:
        - patterns:
            - pattern: fmt.Sprintf(...)
            - pattern-not: |
                fmt.Sprintf("...", "...")
        - patterns:
            - pattern: |
                "..." + $X
            - pattern-not: |
                "..." + "..."
        - pattern: |
            ($SB : strings.Builder).String()
      severity: WARNING
    - id: go_subproc_rule-subproc
      languages:
        - go
      message: |
        OS command injection is a critical vulnerability that can lead to a full system
        compromise as it may allow an adversary to pass in arbitrary commands or arguments
        to be executed.

        User input should never be used in constructing commands or command arguments
        to functions which execute OS commands. This includes filenames supplied by
        user uploads or downloads.

        Ensure your application does not:

        - Use user-supplied information in the process name to execute.
        - Use user-supplied information in an OS command execution function which does
        not escape shell meta-characters.
        - Use user-supplied information in arguments to OS commands.

        The application should have a hardcoded set of arguments that are to be passed
        to OS commands. If filenames are being passed to these functions, it is
        recommended that a hash of the filename be used instead, or some other unique
        identifier. It is strongly recommended that a native library that implements
        the same functionality be used instead of using OS system commands, due to the
        risk of unknown attacks against third party commands.

        If operating in Windows environments, when specifying the OS command, ensure
        the application uses the full path
        information, otherwise the OS may attempt to look up which process to execute
        and could be vulnerable to untrusted search path vulnerabilities (CWE-426).

        Example of safely executing an OS command:
        ```
        userData := []byte("user data")
        // create a temporary file in the application specific directory
        f, err := ioutil.TempFile("/var/app/restricted", "temp-*.dat")
        if err != nil {
          log.Fatal(err)
        }

        if _, err := f.Write(userData); err != nil {
          log.Fatal(err)
        }

        if err := f.Close(); err != nil {
          log.Fatal(err)
        }

        // pass the full path to the binary and the name of the temporary file
        // instead of any user supplied filename
        out, err := exec.Command("/bin/cat", f.Name()).Output()
        if err != nil {
          log.Fatal(err)
        }
        ```

        For more information on OS command injection, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
      patterns:
        - pattern-either:
            - patterns:
                - pattern: exec.CommandContext($CTX, $EXE, ...)
                - pattern-not: exec.CommandContext($CTX, "...", ...)
            - patterns:
                - pattern: exec.Command($EXE, ...)
                - pattern-not: exec.Command("...", ...)
            - patterns:
                - pattern: syscall.ForkExec($EXE, ...)
                - pattern-not: syscall.ForkExec("...", ...)
            - patterns:
                - pattern: syscall.StartProcess($EXE, ...)
                - pattern-not: syscall.StartProcess("...", ...)
      severity: WARNING
    - id: go_unsafe_rule-unsafe
      languages:
        - go
      message: |
        The `unsafe` package in Go allows low-level access to memory management features.
        This includes pointers and direct access to memory. The Go compiler will no longer
        be able to enforce type safety when working with the `unsafe` pointer types.

        While powerful, access to these functions can lead to many security related issues
         such as:

        - [Buffer overflows](https://owasp.org/www-community/vulnerabilities/Buffer_Overflow) which
        can lead to code execution.
        - [Use after free](https://owasp.org/www-community/vulnerabilities/Using_freed_memory) which
        can lead to code execution.
        - [Information/Memory leaks](https://owasp.org/www-community/vulnerabilities/Memory_leak)
        which can leak sensitive information, including data which can
        defeat other protection mechanisms or cause the system to run out of memory.

        Unless required, all calls to the `unsafe` package should be removed.
      metadata:
        category: security
        cwe: CWE-242
        owasp:
            - A9:2017-Using Components with Known Vulnerabilities
            - A06:2021-Vulnerable and Outdated Components
        security-severity: High
        shortDescription: Use of inherently dangerous function (unsafe package)
      patterns:
        - pattern-either:
            - pattern: unsafe.Alignof(...)
            - pattern: unsafe.Offsetof(...)
            - pattern: unsafe.Sizeof(...)
            - pattern: unsafe.Pointer(...)
      severity: INFO
    - id: java_cookie_rule-HttpResponseSplitting
      languages:
        - java
      message: |
        HTTP Response Splitting is a vulnerability where Carriage Return (CR `\r`) and Line Feed (LF
        `\n`)
        characters are introduced into an HTTP header from user-supplied input. By injecting the
        `\r\n`
        character sequence, an adversary could potentially modify how the response is interpreted by
        the
        client or any downstream caching services. This could allow an adversary to poison the cache
        data or execute Cross-Site Scripting (XSS) attacks.

        Some Java application servers such as [Apache Tomcat](https://tomcat.apache.org/) as of version
        8.0, newer versions of Jetty and other servers that implement the [RFC 6265 Standard](https://datatracker.ietf.org/doc/html/rfc6265) will
        disallow `\r' and '\n` characters characters from being set in cookies. If your application server does not
        automatically provide this functionality, user-supplied input that is used in cookie keys or
        values must be validated.

        Example of validating cookies to only allow valid characters:
        ```
        // throws an IllegalArgumentException if the provided value contains invalid characters
        public void validateRfc6265CookieValue(String value) throws IllegalArgumentException {
            char[] chars = value.toCharArray();

            // iterate over every character
            for (int i = 0; i < chars.length; i++) {
                char c = chars[i];

                // check for any characters below 0x21 as well as: '"' ',' ';' '\' and 0x7f.
                if (c < 0x21 || c == '"' || c == ',' || c == ';' || c == '\\' || c == 0x7f) {
                    throw new IllegalArgumentException("Invalid character in cookie detected:
        {0}".format(Integer.toString(c)));
                }
            }
        }
        ```

        Alternatively, you could use a string escape package such as
        [Apache Commons Text](https://commons.apache.org/proper/commons-text/) to escape the input:
        ```
        public String escapeValue(String value) {
          return StringEscapeUtils.escapeJava(value);
        }
        ```

        For more information on response splitting attacks see OWASP:
        https://owasp.org/www-community/attacks/HTTP_Response_Splitting
      metadata:
        category: security
        cwe: CWE-113
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of CRLF sequences in HTTP headers ('HTTP Response Splitting')
        technology:
            - java
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: |
                $STR.replaceAll($REPLACER, "...");
                ...
            - pattern: $STR
            - metavariable-regex:
                metavariable: $REPLACER
                regex: .*\[(?=.*\\r)(?=.*\\n).*\]\+
        - pattern: org.apache.commons.text.StringEscapeUtils.escapeJava($STR);
      pattern-sinks:
        - pattern: new javax.servlet.http.Cookie("$KEY", ...);
        - patterns:
            - pattern-inside: |
                $C = new javax.servlet.http.Cookie("$KEY", ...);
                ...
            - pattern: $C.setValue(...);
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getParameter(...);
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getParameterNames();
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getParameterValues(...);
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getParameterMap();
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getHeader(...);
        - pattern: (javax.servlet.http.HttpServletRequest $REQ).getPathInfo();
      severity: WARNING
    - id: java_cookie_rule-RequestParamToHeader
      languages:
        - java
      message: |
        HTTP Response Splitting is a vulnerability where Carriage Return (CR `\r`) and Line Feed (LF
        `\n`)
        characters are introduced into an HTTP header from user-supplied input. By injecting the
        `\r\n`
        character sequence, an adversary could potentially modify how the response is interpreted by
        the
        client or any down stream caching services. This could allow an adversary to poison the cache
        data or execute Cross-Site Scripting (XSS) attacks.

        Some Java application servers such as [Apache Tomcat](https://tomcat.apache.org/) will
        automatically encode
        characters from being set in response headers as a space `0x20` character. If your application
        server does
        not automatically provide this functionality, user-supplied input that is used in header keys
        or values must be
        validated.

        Example of validating headers to only allow valid characters:
        ```
        // throws an IllegalArgumentException if the provided value contains invalid characters
        public void validateHeader(String value) throws IllegalArgumentException {
            char[] chars = value.toCharArray();

            // iterate over every character
            for (int i = 0; i < chars.length; i++) {
                char c = chars[i];

                // check for any characters below 0x21 as well as: '"' ',' ';' '\' and 0x7f.
                if (c < 0x21 || c == '"' || c == ',' || c == ';' || c == '\\' || c == 0x7f) {
                    throw new IllegalArgumentException("Invalid character in cookie detected:
        {0}".format(Integer.toString(c)));
                }
            }
        }
        ```

        Alternatively, you could use a string escape package such as
        [Apache Commons Text](https://commons.apache.org/proper/commons-text/) to escape the input:
        ```
        public String escapeValue(String value) {
          return StringEscapeUtils.escapeJava(value);
        }
        ```

        For more information on response splitting attacks see OWASP:
        https://owasp.org/www-community/attacks/HTTP_Response_Splitting
      metadata:
        category: security
        cwe: CWE-113
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of CRLF sequences in HTTP headers ('HTTP Response Splitting')
        technology:
            - java
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: |
                $STR.replaceAll("$INPUT", "...");
                ...
            - pattern: $STR
            - metavariable-regex:
                metavariable: $INPUT
                regex: .*\[(?=.*\\r)(?=.*\\n).*\]\+
        - pattern: org.apache.commons.text.StringEscapeUtils.unescapeJava(...);
      pattern-sinks:
        - pattern: ($X.servlet.http.HttpServletResponse $RES).setHeader("$KEY", ...);
        - pattern: ($X.servlet.http.HttpServletResponse $RES).addHeader("$KEY", ...);
        - pattern: ($X.servlet.http.HttpServletResponseWrapper $WRP).setHeader("$KEY", ...);
        - pattern: ($X.servlet.http.HttpServletResponseWrapper $WRP).addHeader("$KEY", ...);
      pattern-sources:
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getParameter(...);
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getParameterNames();
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getParameterValues(...);
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getParameterMap();
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getHeader(...);
        - pattern: ($X.servlet.http.HttpServletRequest $REQ).getPathInfo();
      severity: ERROR
    - id: java_crypto_rule-CipherDESInsecure
      languages:
        - java
      message: |
        DES, TripleDES and RC2 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms  apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        public encrypt() throws Exception {
            chaChaEncryption("Secret text to encrypt".getBytes(StandardCharsets.UTF_8));
        }

        public SecureRandom getSecureRandomDRBG() throws NoSuchAlgorithmException {
            // Use DRBG according to
        http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf
            return SecureRandom.getInstance("DRBG",
                    // Security strength in bits (default is 128)
                    DrbgParameters.instantiation(256,
                        // Set prediction resistance and re-seeding
                        DrbgParameters.Capability.PR_AND_RESEED,
                        // Set the personalization string (optional, not necessary)
                        "some_personalization_string".getBytes()
                    )
            );
        }

        public Cipher getChaCha20Poly1305(int mode, byte[] ivKey, byte[] secretKey) throws
        NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
        InvalidAlgorithmParameterException  {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create a ChaCha20-Poly1305 cipher instance
            Cipher chaChaCipher = Cipher.getInstance("ChaCha20-Poly1305/None/NoPadding");
            // Create our parameterSpec using our ivKey
            AlgorithmParameterSpec parameterSpec = new IvParameterSpec(ivKey);
            // Create a SecretKeySpec using our secretKey
            SecretKeySpec secretKeySpec = new SecretKeySpec(secretKey, "ChaCha20");
            // Initialize and return the cipher for the provided mode
            chaChaCipher.init(mode, secretKeySpec, parameterSpec, random);
            return chaChaCipher;
        }

        public void chaChaEncryption(byte[] plainText) throws NoSuchAlgorithmException,
        NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create secretKey
            byte[] secretKey = new byte[32];
            random.nextBytes(secretKey);
            // Create an IV Key
            byte[] ivKey = new byte[12];
            random.nextBytes(ivKey);

            // Create a chaCha encryption cipher instance
            Cipher chaChaEncryptor = getChaCha20Poly1305(Cipher.ENCRYPT_MODE, ivKey, secretKey);

            // Encrypt the text using ChaCha20Poly1305
            byte[] cipherText = null;
            try {
                cipherText = chaChaEncryptor.doFinal(plainText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to encrypt text");
                return;
            }
            System.out.println("encrypted: " + Base64.getEncoder().encodeToString(cipherText));

             // Create a chaCha decryption cipher instance
            Cipher chaChaDecryptor = getChaCha20Poly1305(Cipher.DECRYPT_MODE, ivKey, secretKey);

            // Decrypt the text
            byte[] decryptedText = null;
            try {
                decryptedText = chaChaDecryptor.doFinal(cipherText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to decrypt text");
                return;
            }
            System.out.println("decrypted: " + new String(decryptedText, StandardCharsets.UTF_8));
        }
        ```

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-326
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Inadequate encryption strength
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: javax.crypto.Cipher.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                javax.crypto.Cipher.getInstance($PROP, ...);
        - metavariable-regex:
            metavariable: $ALG
            regex: ^DES(/|$)
      severity: WARNING
    - id: java_crypto_rule-CipherDESedeInsecure
      languages:
        - java
      message: |
        DES, TripleDES and RC2 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms  apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        public encrypt() throws Exception {
            chaChaEncryption("Secret text to encrypt".getBytes(StandardCharsets.UTF_8));
        }

        public SecureRandom getSecureRandomDRBG() throws NoSuchAlgorithmException {
            // Use DRBG according to
        http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf
            return SecureRandom.getInstance("DRBG",
                    // Security strength in bits (default is 128)
                    DrbgParameters.instantiation(256,
                        // Set prediction resistance and re-seeding
                        DrbgParameters.Capability.PR_AND_RESEED,
                        // Set the personalization string (optional, not necessary)
                        "some_personalization_string".getBytes()
                    )
            );
        }

        public Cipher getChaCha20Poly1305(int mode, byte[] nonceKey, byte[] secretKey) throws
        NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
        InvalidAlgorithmParameterException  {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create a ChaCha20-Poly1305 cipher instance
            Cipher chaChaCipher = Cipher.getInstance("ChaCha20-Poly1305/None/NoPadding");
            // Create our parameterSpec using our nonceKey
            AlgorithmParameterSpec parameterSpec = new IvParameterSpec(nonceKey);
            // Create a SecretKeySpec using our secretKey
            SecretKeySpec secretKeySpec = new SecretKeySpec(secretKey, "ChaCha20");
            // Initialize and return the cipher for the provided mode
            chaChaCipher.init(mode, secretKeySpec, parameterSpec, random);
            return chaChaCipher;
        }

        public void chaChaEncryption(byte[] plainText) throws NoSuchAlgorithmException,
        NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create secretKey
            byte[] secretKey = new byte[32];
            random.nextBytes(secretKey);
            // Create an IV nonceKey
            byte[] nonceKey = new byte[12];
            random.nextBytes(nonceKey);
            // Create a chaCha encryption cipher instance
            Cipher chaChaEncryptor = getChaCha20Poly1305(Cipher.ENCRYPT_MODE, nonceKey, secretKey);
            // Encrypt the text using ChaCha20Poly1305
            byte[] cipherText = null;
            try {
                cipherText = chaChaEncryptor.doFinal(plainText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to encrypt text");
                return;
            }
            System.out.println("encrypted: " + Base64.getEncoder().encodeToString(cipherText));
            // Create a chaCha decryption cipher instance
            Cipher chaChaDecryptor = getChaCha20Poly1305(Cipher.DECRYPT_MODE, nonceKey, secretKey);
            // Decrypt the text
            byte[] decryptedText = null;
            try {
                decryptedText = chaChaDecryptor.doFinal(cipherText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to decrypt text");
                return;
            }
            System.out.println("decrypted: " + new String(decryptedText, StandardCharsets.UTF_8));
        }
        ```

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: javax.crypto.Cipher.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                javax.crypto.Cipher.getInstance($PROP, ...);
        - metavariable-regex:
            metavariable: $ALG
            regex: DESede(/|$)
      severity: WARNING
    - id: java_crypto_rule-CipherECBMode
      languages:
        - java
      message: |
        Cryptographic algorithms provide many different modes of operation, only some of which provide
        message integrity. Without message integrity it could be possible for an adversary to attempt
        to tamper with the ciphertext which could lead to compromising the encryption key. Newer
        algorithms
        apply message integrity to validate ciphertext has not been tampered with.

        Instead of using an algorithm that requires configuring a cipher mode, an algorithm
        that has built-in message integrity should be used. Consider using `ChaCha20Poly1305` or
        `AES-256-GCM` instead.

        For older applications that don't have support for `ChaCha20Poly1305`, `AES-256-GCM` is
        recommended, however it has many drawbacks:
          - Slower than `ChaCha20Poly1305`.
          - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        public encrypt() throws Exception {
            chaChaEncryption("Secret text to encrypt".getBytes(StandardCharsets.UTF_8));
        }

        public SecureRandom getSecureRandomDRBG() throws NoSuchAlgorithmException {
            // Use DRBG according to
        http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf
            return SecureRandom.getInstance("DRBG",
                    // Security strength in bits (default is 128)
                    DrbgParameters.instantiation(256,
                        // Set prediction resistance and re-seeding
                        DrbgParameters.Capability.PR_AND_RESEED,
                        // Set the personalization string (optional, not necessary)
                        "some_personalization_string".getBytes()
                    )
            );
        }

        public Cipher getChaCha20Poly1305(int mode, byte[] ivKey, byte[] secretKey) throws
        NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
        InvalidAlgorithmParameterException  {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create a ChaCha20-Poly1305 cipher instance
            Cipher chaChaCipher = Cipher.getInstance("ChaCha20-Poly1305/None/NoPadding");
            // Create our parameterSpec using our ivKey
            AlgorithmParameterSpec parameterSpec = new IvParameterSpec(ivKey);
            // Create a SecretKeySpec using our secretKey
            SecretKeySpec secretKeySpec = new SecretKeySpec(secretKey, "ChaCha20");
            // Initialize and return the cipher for the provided mode
            chaChaCipher.init(mode, secretKeySpec, parameterSpec, random);
            return chaChaCipher;
        }

        public void chaChaEncryption(byte[] plainText) throws NoSuchAlgorithmException,
        NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create secretKey
            byte[] secretKey = new byte[32];
            random.nextBytes(secretKey);
            // Create an IV Key
            byte[] ivKey = new byte[12];
            random.nextBytes(ivKey);

            // Create a chaCha encryption cipher instance
            Cipher chaChaEncryptor = getChaCha20Poly1305(Cipher.ENCRYPT_MODE, ivKey, secretKey);

            // Encrypt the text using ChaCha20Poly1305
            byte[] cipherText = null;
            try {
                cipherText = chaChaEncryptor.doFinal(plainText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to encrypt text");
                return;
            }
            System.out.println("encrypted: " + Base64.getEncoder().encodeToString(cipherText));

             // Create a chaCha decryption cipher instance
            Cipher chaChaDecryptor = getChaCha20Poly1305(Cipher.DECRYPT_MODE, ivKey, secretKey);

            // Decrypt the text
            byte[] decryptedText = null;
            try {
                decryptedText = chaChaDecryptor.doFinal(cipherText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to decrypt text");
                return;
            }
            System.out.println("decrypted: " + new String(decryptedText, StandardCharsets.UTF_8));
        }
        ```

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: javax.crypto.Cipher.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                javax.crypto.Cipher.getInstance($PROP, ...);
        - metavariable-comparison:
            comparison: |
                $ALG in (
                  "AES/ECB/NoPadding" "AES/ECB/PKCS5Padding"
                  "DES/ECB/NoPadding" "DES/ECB/PKCS5Padding"
                  "DESede/ECB/NoPadding" "DESede/ECB/PKCS5Padding"
                  "AES/ECB/PKCS7Padding"
                )
            metavariable: $ALG
      severity: ERROR
    - id: java_crypto_rule-CipherPaddingOracle
      languages:
        - java
      message: |
        Cryptographic block ciphers can be configured to pad individual blocks if there is not enough
        input data to match the size of the block. This specific mode of CBC used in combination with
        PKCS5Padding is susceptible to padding oracle attacks. An adversary could potentially decrypt
        the message if the system exposed the difference between plaintext with invalid padding or
        valid padding. The distinction between valid and invalid padding is usually revealed through
        distinct error messages being returned for each condition.

        Consider switching to a more secure cipher that doesn't require padding and builds in message
        authentication integrity directly into the algorithm.

        Consider using `ChaCha20Poly1305` or
        `AES-256-GCM` instead.

        For older applications that don't have support for `ChaCha20Poly1305`, `AES-256-GCM` is
        recommended, however it has many drawbacks:
          - Slower than `ChaCha20Poly1305`.
          - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        public encrypt() throws Exception {
            chaChaEncryption("Secret text to encrypt".getBytes(StandardCharsets.UTF_8));
        }

        public SecureRandom getSecureRandomDRBG() throws NoSuchAlgorithmException {
            // Use DRBG according to
        http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf
            return SecureRandom.getInstance("DRBG",
                    // Security strength in bits (default is 128)
                    DrbgParameters.instantiation(256,
                        // Set prediction resistance and re-seeding
                        DrbgParameters.Capability.PR_AND_RESEED,
                        // Set the personalization string (optional, not necessary)
                        "some_personalization_string".getBytes()
                    )
            );
        }

        public Cipher getChaCha20Poly1305(int mode, byte[] ivKey, byte[] secretKey) throws
        NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
        InvalidAlgorithmParameterException  {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create a ChaCha20-Poly1305 cipher instance
            Cipher chaChaCipher = Cipher.getInstance("ChaCha20-Poly1305/None/NoPadding");
            // Create our parameterSpec using our ivKey
            AlgorithmParameterSpec parameterSpec = new IvParameterSpec(ivKey);
            // Create a SecretKeySpec using our secretKey
            SecretKeySpec secretKeySpec = new SecretKeySpec(secretKey, "ChaCha20");
            // Initialize and return the cipher for the provided mode
            chaChaCipher.init(mode, secretKeySpec, parameterSpec, random);
            return chaChaCipher;
        }

        public void chaChaEncryption(byte[] plainText) throws NoSuchAlgorithmException,
        NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create secretKey
            byte[] secretKey = new byte[32];
            random.nextBytes(secretKey);
            // Create an IV Key
            byte[] ivKey = new byte[12];
            random.nextBytes(ivKey);

            // Create a chaCha encryption cipher instance
            Cipher chaChaEncryptor = getChaCha20Poly1305(Cipher.ENCRYPT_MODE, ivKey, secretKey);

            // Encrypt the text using ChaCha20Poly1305
            byte[] cipherText = null;
            try {
                cipherText = chaChaEncryptor.doFinal(plainText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to encrypt text");
                return;
            }
            System.out.println("encrypted: " + Base64.getEncoder().encodeToString(cipherText));

             // Create a chaCha decryption cipher instance
            Cipher chaChaDecryptor = getChaCha20Poly1305(Cipher.DECRYPT_MODE, ivKey, secretKey);

            // Decrypt the text
            byte[] decryptedText = null;
            try {
                decryptedText = chaChaDecryptor.doFinal(cipherText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to decrypt text");
                return;
            }
            System.out.println("decrypted: " + new String(decryptedText, StandardCharsets.UTF_8));
        }
        ```

        For more information on padding oracle attacks see:
        https://en.wikipedia.org/wiki/Padding_oracle_attack

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: javax.crypto.Cipher.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                javax.crypto.Cipher.getInstance($PROP, ...);
        - metavariable-comparison:
            comparison: |
                $ALG in (
                  "AES/CBC/PKCS5Padding" "DES/CBC/PKCS5Padding" "DESede/CBC/PKCS5Padding" "AES/CBC/PKCS7Padding"
                )
            metavariable: $ALG
      severity: ERROR
    - id: java_crypto_rule-NullCipher
      languages:
        - java
      message: |
        The application was found creating a `NullCipher` instance. `NullCipher` implements the
        `Cipher` interface by returning ciphertext identical to the supplied plaintext. This means
        any data passed to the `doFinal(...)` or `update(...)` methods will not actually encrypt
        the input.

        Remove the NullCipher reference and replace with a legitimate `Cipher` instance such as
        `ChaCha20-Poly1305`

        Example using `ChaCha20Poly1305`:
        ```
        public encrypt() throws Exception {
            chaChaEncryption("Secret text to encrypt".getBytes(StandardCharsets.UTF_8));
        }

        public SecureRandom getSecureRandomDRBG() throws NoSuchAlgorithmException {
            // Use DRBG according to
        http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf
            return SecureRandom.getInstance("DRBG",
                    // Security strength in bits (default is 128)
                    DrbgParameters.instantiation(256,
                        // Set prediction resistance and re-seeding
                        DrbgParameters.Capability.PR_AND_RESEED,
                        // Set the personalization string (optional, not necessary)
                        "some_personalization_string".getBytes()
                    )
            );
        }

        public Cipher getChaCha20Poly1305(int mode, byte[] ivKey, byte[] secretKey) throws
        NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException,
        InvalidAlgorithmParameterException  {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create a ChaCha20-Poly1305 cipher instance
            Cipher chaChaCipher = Cipher.getInstance("ChaCha20-Poly1305/None/NoPadding");
            // Create our parameterSpec using our ivKey
            AlgorithmParameterSpec parameterSpec = new IvParameterSpec(ivKey);
            // Create a SecretKeySpec using our secretKey
            SecretKeySpec secretKeySpec = new SecretKeySpec(secretKey, "ChaCha20");
            // Initialize and return the cipher for the provided mode
            chaChaCipher.init(mode, secretKeySpec, parameterSpec, random);
            return chaChaCipher;
        }

        public void chaChaEncryption(byte[] plainText) throws NoSuchAlgorithmException,
        NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException {
            // Get a DRBG random number generator instance
            SecureRandom random = getSecureRandomDRBG();
            // Create secretKey
            byte[] secretKey = new byte[32];
            random.nextBytes(secretKey);
            // Create an IV Key
            byte[] ivKey = new byte[12];
            random.nextBytes(ivKey);

            // Create a chaCha encryption cipher instance
            Cipher chaChaEncryptor = getChaCha20Poly1305(Cipher.ENCRYPT_MODE, ivKey, secretKey);

            // Encrypt the text using ChaCha20Poly1305
            byte[] cipherText = null;
            try {
                cipherText = chaChaEncryptor.doFinal(plainText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to encrypt text");
                return;
            }
            System.out.println("encrypted: " + Base64.getEncoder().encodeToString(cipherText));

             // Create a chaCha decryption cipher instance
            Cipher chaChaDecryptor = getChaCha20Poly1305(Cipher.DECRYPT_MODE, ivKey, secretKey);

            // Decrypt the text
            byte[] decryptedText = null;
            try {
                decryptedText = chaChaDecryptor.doFinal(cipherText);
            } catch (IllegalBlockSizeException | BadPaddingException e) {
                System.out.println("failed to decrypt text");
                return;
            }
            System.out.println("decrypted: " + new String(decryptedText, StandardCharsets.UTF_8));
        }
        ```

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - java
      pattern: new javax.crypto.NullCipher()
      severity: WARNING
    - id: java_crypto_rule-RsaNoPadding
      languages:
        - java
      message: |
        The software uses the RSA algorithm but does not incorporate Optimal Asymmetric
        Encryption Padding (OAEP). By not enabling padding, the algorithm maybe vulnerable
        to [chosen plaintext attacks](https://en.wikipedia.org/wiki/Chosen-plaintext_attack).

        To enable OAEP mode, pass `RSA/ECB/OAEPWithSHA-256AndMGF1Padding` to the `Cipher.getInstance`
        method.

        Example encrypting and decrypting a message using RSA with OAEP:
        ```
        public static void encryptWithRSA() throws InvalidKeyException, NoSuchAlgorithmException,
        NoSuchPaddingException, IllegalBlockSizeException, BadPaddingException {
            // Generate an RSA Public and Private Key Pair
            KeyPair keyPair = generateRSAKeys();
            // Create a Cipher instance using RSA, ECB with OAEP
            Cipher rsaEncryptor = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
            // Initialize to ENCRYPT_MODE with the public key
            rsaEncryptor.init(Cipher.ENCRYPT_MODE, keyPair.getPublic());
            // Encrypt our secret message
            byte[] cipherText = rsaEncryptor.doFinal("Some secret
        message".getBytes(StandardCharsets.UTF_8));

            // Create a Cipher instance using RSA, ECB with OAEP
            Cipher rsaDecryptor = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
            // Initialize to DECRYPT_MODE with the private key
            rsaDecryptor.init(Cipher.DECRYPT_MODE, keyPair.getPrivate());
            // Decrypt the secret message
            byte[] plainText = rsaDecryptor.doFinal(cipherText);
            // Debug output
            System.out.println(new String(plainText));
        }
        ```
        More information on Optimal asymmetric encryption padding:
        https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding

        For more information on Java Cryptography see:
        https://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html
      metadata:
        category: security
        cwe: CWE-780
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of RSA algorithm without OAEP
      patterns:
        - pattern-either:
            - pattern: javax.crypto.Cipher.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                javax.crypto.Cipher.getInstance($PROP, ...);
        - metavariable-regex:
            metavariable: $ALG
            regex: (?i)^RSA/.*NoPadding$
      severity: WARNING
    - id: java_crypto_rule-WeakMessageDigest
      languages:
        - java
      message: |
        The application was found using an insecure or risky digest or signature algorithm. Both MD5
        and SHA1 hash algorithms have been found to be vulnerable to producing collisions.
        This means
        that two different values, when hashed, can lead to the same hash value. If the application is
        trying
        to use these hash methods for storing passwords, then it is recommended to switch to a
        password hashing
        algorithm such as Argon2id or PBKDF2.
        strongly recommended that a standard Digest algorithm be chosen instead as implementing
        a digest by hand is error-prone.

        Example of creating a SHA-384 hash:
        ```
        // Create a MessageDigest using the SHA-384 algorithm
        MessageDigest sha384Digest = MessageDigest.getInstance("SHA-384");
        // Call update with your data
        sha384Digest.update(input);
        // Only call digest once all data has been fed into the update sha384digest instance
        byte[] output = sha384Digest.digest();
        // output base64 encoded version of the hash
        System.out.println("hash: " + Base64.getEncoder().encodeToString(output));
        ```

        For more information on secure password storage see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A6:2017-Security Misconfiguration
            - A04:2021-Insecure Design
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm (SHA1/MD5)
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: java.security.MessageDigest.getInstance("$ALG", ...)
            - pattern: java.security.Signature.getInstance("$ALG", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                java.security.MessageDigest.getInstance("$ALG", ...);
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$ALG");
                ...
                java.security.Signature.getInstance("$ALG", ...);
        - metavariable-comparison:
            comparison: |
                $ALG in (
                  "MD2" "MD4" "MD5" "MD5withRSA"
                  "SHA-1" "SHA1withRSA" "SHA1withDSA"
                )
            metavariable: $ALG
      severity: WARNING
    - id: java_crypto_rule-WeakTLSProtocol-DefaultHttpClient
      languages:
        - java
      message: |
        The `org.apache.http.impl.client.DefaultHttpClient` does not verify the hostnames upon connection.

        This allows for an adversary who is in between the application and the target host to intercept
        potentially sensitive information or transmit malicious data.

        Do not use the `org.apache.http.impl.client.DefaultHttpClient();` as it is deprecated. Instead
        use the new `java.net.http.HttpClient` that was introduced in Java 9.

        Example connecting to a host that will automatically do TLS validation:
        ```
        // Create a new java.net.http.HttpClient
        HttpClient httpClient = HttpClient.newHttpClient();
        // Create a HttpRequest builder
        HttpRequest request = HttpRequest.newBuilder()
                // Create a URI for a website which requires TLS
                .uri(URI.create("https://www.example.com/"))
                // Build the request
                .build();

        // Use the httpClient to send the request and use an HttpResponse.BodyHandlers String type
        HttpResponse<String> response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());
        // Debug print
        System.out.println(response);
        ```
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Improper certificate validation
      patterns:
        - pattern: new org.apache.http.impl.client.DefaultHttpClient();
      severity: WARNING
    - id: java_crypto_rule-WeakTLSProtocol-SSLContext
      languages:
        - java
      message: |
        Avoid initializing SSLContext with insecure protocols like `SSL`, `SSLv2`, or `SSLv3`.
        These protocols are outdated and do not validate certificates by default. Additionally,
        these older `SSL` versions have many known security issues.

        Instead, use secure protocols like `TLSv1.2` or `TLSv1.3`.
        ```
        SSLContext context = SSLContext.getInstance("TLSv1.3");
        ```
        For more information on see OWASP:
           - https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/01-Testing_for_Weak_SSL_TLS_Ciphers_Insufficient_Transport_Layer_Protection
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Improper certificate validation
      patterns:
        - pattern-either:
            - pattern: javax.net.ssl.SSLContext.getInstance("$PROTO", ...)
            - pattern: |
                $PROP = (java.util.Properties $P).getProperty(..., "$PROTO");
                ...
                javax.net.ssl.SSLContext.getInstance($PROP, ...);
        - metavariable-comparison:
            comparison: |
                $PROTO not in ("TLS" "TLSv1.2" "TLSv1.3" "DTLSv1.2" "DTLSv1.3")
            metavariable: $PROTO
      severity: WARNING
    - id: java_crypto_rule-WeakTLSProtocolVersion
      languages:
        - java
      message: |
        The application was found enabling insecure TLS protocol versions. When enabling protocol
        versions for an `SSLContext`, only the following versions should be allowed:
        - TLSv1.2
        - TLSv1.3
        - DTLSv1.2
        - DTLSv1.3

        To mitigate potential security risks, it is strongly advised to enforce TLS 1.2 as the minimum
        protocol version and disallow older versions such as TLS 1.0. Do note that newer versions of
        Java do not even support TLS 1.0 and will throw `NoSuchAlgorithmException`. Versions of TLS
        prior to 1.2 could expose the connection to downgrade attacks, where an adversary intercepts
        the
        connection and alters the requested protocol version to be a less secure one.

        In many scenarios, relying on the default system configuration does not meet compliance
        standards. This is due to the application being deployed across diverse systems with varying
        configurations and Java versions. While the default value may be secure on modern and
        up-to-date systems, it may not hold true for older systems. Consequently, it is highly
        recommended to explicitly define a secure configuration in all cases.

        Example configuring an SSLContext with TLSv1.2:
        ```
        // Create an SSLContext with TLSv1.2 explicitly
        SSLContext tlsContext = SSLContext.getInstance("TLSv1.2"); // or TLSv1.3, DTLSv1.2, DTLSv1.3

        // Alternatively, set the enabled protocols
        SSLContext serverSslContext = SSLContext.getInstance("TLS");
        SSLEngine serverEngine = serverSslContext.createSSLEngine();
        // Calling setEnabledProtocols will override the original context's configured protocol version
        serverEngine.setEnabledProtocols(new String[]{ "TLSv1.2" });
        ```

        For more information on `SSLContext` see:
        - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/javax/net/ssl/SSLContext.html

        For more information on MiTM attacks see:
        - https://owasp.org/www-community/attacks/Manipulator-in-the-middle_attack
      metadata:
        category: security
        cwe: CWE-326
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Inadequate encryption strength
      patterns:
        - pattern-either:
            - pattern-inside: |
                import javax.net.ssl.*;
                ...
            - pattern-inside: |
                import javax.net.ssl.SSLContext;
                ...
        - pattern-either:
            - pattern-inside: |
                SSLContext.getInstance("$UNSAFE_VERSION");
            - pattern-inside: |
                SSLContext.getInstance(...);
                ...
                $ENGINE.setEnabledProtocols(new String[]{...,"$UNSAFE_VERSION",...});
        - pattern-not-inside: |
            $C = SSLContext.getInstance(...);
            ...
            $ENGINE.setEnabledProtocols(new String[]{...,"TLSv1.2",...});
        - pattern-not-inside: |
            $C = SSLContext.getInstance(...);
            ...
            $ENGINE.setEnabledProtocols(new String[]{...,"TLSv1.3",...});
        - pattern-not-inside: |
            $C = SSLContext.getInstance(...);
            ...
            $ENGINE.setEnabledProtocols(new String[]{...,"DTLSv1.2",...});
        - pattern-not-inside: |
            $C = SSLContext.getInstance(...);
            ...
            $ENGINE.setEnabledProtocols(new String[]{...,"DTLSv1.3",...});
        - metavariable-regex:
            metavariable: $UNSAFE_VERSION
            regex: ^(TLS|(D)?TLSv1.(0|1))$
      severity: WARNING
    - id: java_endpoint_rule-HostnameVerifier
      languages:
        - java
      message: "The `HostnameVerifier` has been set to always return `true`. This effectively \ndisables the validation of server or client certificates. This could allow an \nadversary who is in between the application and the target host to launch a Man \nin the middle attack (MITM) i.e intercept potentially sensitive information or \ninject malicious content into the communication stream.\n\nTo mitigate this vulnerability and enhance the security of your application, it is \nstrongly advised to adhere to the default HostnameVerifier settings. This ensures \nthat the validation mechanism remains intact, providing a crucial layer of security \nagainst unauthorized interception and data manipulation.\n\nImplementing the default HostnameVerifier can be achieved with the following code \nsnippet:\n```\n// Use the default HostnameVerifier\nHttpsURLConnection connection = (HttpsURLConnection) url.openConnection();\nconnection.setHostnameVerifier(HttpsURLConnection.getDefaultHostnameVerifier());\n```\nFor more information on TLS security, refer the following OWASP documentation:\nhttps://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Improper certificate validation
      patterns:
        - pattern-inside: |
            class $V implements HostnameVerifier {
              ...
            }
        - pattern-either:
            - pattern: |
                boolean verify(...) {
                  ...
                  return true;
                  ...
                }
        - pattern-not:
            patterns:
                - pattern: |
                    boolean verify(...) {
                        ...
                        return $VAR;
                        ...
                      }
                - metavariable-regex:
                    metavariable: $VAR
                    regex: ^((?!true).)*$
                - pattern-not: |
                    boolean verify(...) {
                        $VAR = true;
                        ...
                        return $VAR;
                        ...
                      }
      severity: WARNING
    - id: java_endpoint_rule-X509TrustManager
      languages:
        - java
      message: "The `X509TrustManager` has been configured to return null. This effectively disables the\nvalidation of server or client certificates. This could allow an adversary who is in \nbetween the application and the target host to launch a Man in the middle attack (MITM) i.e \nintercept potentially sensitive information or inject malicious content into the \ncommunication stream.\n\nConsider using the \ndefault `TrustManager` instead of implementing a custom one. If you must override\nthe default verification process, implement proper TrustManager verification for\n`checkServerTrusted` and `checkClientTrusted` by throwing `CertificateException` if \nthe certificate is invalid.\n\nFor most applications, using the default TrustManager provided by the Java runtime is \nsufficient and recommended. Following is an example using the built in `TrustManagerFactory` \nto manage validating certificate chains:\n```\n// Use the default TrustManagerFactory\nTrustManagerFactory trustManagerFactory =\nTrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());\n// Use default system KeyStore, alternatively pass in your own keystore.\ntrustManagerFactory.init((KeyStore) null);\n// Create SSLContext for TLS connections\nSSLContext tlsContext = SSLContext.getInstance(\"TLS\");\n// Initialize the tlsContext with our trust manager and a SecureRandom number generator.\ntlsContext.init(null, trustManagerFactory.getTrustManagers(), new SecureRandom());\n```\nFor more information on TLS security, refer the following OWASP documentation:\nhttps://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Improper certificate validation
      patterns:
        - pattern-inside: |
            class $V implements X509TrustManager {
              ...
            }
        - pattern-either:
            - pattern: public void checkClientTrusted(...) {}
            - pattern: public void checkServerTrusted(...) {}
            - patterns:
                - pattern-either:
                    - pattern: |
                        X509Certificate[] getAcceptedIssuers() {
                          ...
                          return null;
                          ...
                        }
                - pattern-not:
                    patterns:
                        - pattern: |
                            X509Certificate[] getAcceptedIssuers() {
                                ...
                                return $VAR;
                                ...
                              }
                        - metavariable-regex:
                            metavariable: $VAR
                            regex: ^((?!null).)*$
                        - pattern-not: |
                            X509Certificate[] getAcceptedIssuers() {
                                $VAR = null;
                                ...
                                return $VAR;
                                ...
                              }
      severity: WARNING
    - id: java_file_rule-FileUploadFileName
      languages:
        - java
      message: |
        The filename provided by the FileUpload API can be tampered with
        which could lead to unauthorized access or file inclusion vulnerabilities.
        To mitigate this risk, it is essential to conduct rigorous validation of the
        filenames provided by clients. This validation should ensure that the filename
        adheres to a predefined structure, is devoid of potentially dangerous characters
        (such as forward slashes / and backslashes \), and corresponds to an authorized
        file only.

        For example, as a remediation strategy, the application could:
        1. Sanitize Filenames: Create a function to sanitize filenames by removing
           or replacing unauthorized characters, including path traversal sequences (../ or ..\).
        2. Allowlist Validation: Implement a allowlist approach, allowing only filenames
           that match a specific pattern or are part of a predefined list.
        3. Use Server-Generated Filenames: Rather than relying on client-provided filenames,
           generate unique names server-side for storing files.
        4. Verify File Paths: Ensure files are being saved in the correct,
           intended directory, and prevent redirection to unauthorized directories.

        Example remediation:
        ```
          public class FileUploadHandler {

                protected void doPost(HttpServletRequest request, HttpServletResponse response)
                      throws ServletException, IOException {

                  Part filePart = request.getPart("file");
                  String fileName = filePart.getSubmittedFileName();

                  // removes any path information from the filename
                  String sanitizedFileName = sanitizeFileName(fileName);
                  if (!isFileNameAllowed(sanitizedFileName)) {
                      throw new SecurityException("Invalid file name");
                  }

                  // Generate a unique file name for storage
                  String storedFileName = UUID.randomUUID().toString() + ".txt";

                  Path targetPath = Paths.get("uploads").resolve(storedFileName);
                  Files.copy(fileContent, targetPath, StandardCopyOption.REPLACE_EXISTING);
              }

              private String sanitizeFileName(String fileName) {
                  return Paths.get(fileName).getFileName().toString();
              }

              private boolean isFileNameAllowed(String fileName) {
                  return fileName.matches("[a-zA-Z0-9._-]+");
              }
          }
        ```
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Info
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern-inside: |
                $FILES = (ServletFileUpload $SFU).parseRequest(($X.servlet.http.HttpServletRequest $REQ));
                ...
                for(FileItem $ITEM : $FILES) {
                  ...
                }
            - pattern: $ITEM.getName()
        - pattern: ($X.servlet.http.Part $PART).getSubmittedFileName()
      severity: WARNING
    - id: java_file_rule-FilenameUtils
      languages:
        - java
      message: "The filename provided by the FileUpload API can be tampered with by the client to reference\nunauthorized files. The provided filename should be properly validated to ensure it's properly\nstructured, contains no unauthorized path characters (e.g., / \\), and refers to an authorized\nfile.\n\nThe application was found to take a parameter from user input to construct a path name. If an\nunfiltered parameter is passed to this file API, files from an arbitrary filesystem location\ncould be read. When data from an unstrusted source is untrusted source is used to construct\na file path, an attacker could potentially gain access to restrcited files locations outside\nthe relevant context.\n\nFor example, if the application tries to access the users profile picture based on their user\nname by concatenating the username to the filepath:\n\n\"images/userprofiles/\" + username\n\nThe expected result of this would be \"images/userprofiles/alice\", however an attacker could\nuse a malicious input such as \"../../../etc/passwd\" to gain access to and/or manipulate\nsensitive information\n\nAssume all input is malicious. Use an \"accept known good\" input validation strategy.\n\nInputs can be sanitized by using the getName() method with concat() method to remove the \npotentially malicious path traversal and limit the scope to a restricted directory. Or \ninput can also be sanitized by using resolve() method alongwith startsWith() method to \nverify that the base path of the file is safe and expected.\n\nExample of limiting path traversal using getName:\n\n```\nprotected void doPut(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\n    String input = req.getHeader(\"input\");\n\n    input = getName(input);\n    \n    String safePath = concat(basePath, input);\n\n    // Read the contents of the file\n    File file = new File(safePath);\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Info
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - java
      mode: taint
      pattern-sanitizers:
        - pattern: |
            $NAME = org.apache.commons.io.FilenameUtils.getName(...);
            ...
            $SAFE = concat($BASE, $NAME);
        - pattern: |
            $RET $FUN(...){
              ...
              $PATH = $BP.resolve(...);
              ...
              if(!$PATH.startsWith(...)) {
                throw new $EXC(...);
              }
              ...
            }
      pattern-sinks:
        - pattern: org.apache.commons.io.FilenameUtils.concat(...)
        - pattern: org.apache.commons.io.FilenameUtils.getFullPath(...)
        - pattern: org.apache.commons.io.FilenameUtils.getFullPathNoEndSeparator(...)
        - pattern: org.apache.commons.io.FilenameUtils.getPath(...)
        - pattern: org.apache.commons.io.FilenameUtils.getPathNoEndSeparator(...)
        - pattern: org.apache.commons.io.FilenameUtils.normalize(...)
        - pattern: org.apache.commons.io.FilenameUtils.normalizeNoEndSeparator(...)
        - pattern: org.apache.commons.io.FilenameUtils.normalizeNoEndSeparator(...)
        - pattern: org.apache.commons.io.FilenameUtils.removeExtension(...)
        - pattern: org.apache.commons.io.FilenameUtils.separatorsToSystem(...)
        - pattern: org.apache.commons.io.FilenameUtils.separatorsToUnix(...)
        - pattern: org.apache.commons.io.FilenameUtils.separatorsToWindows(...)
      pattern-sources:
        - pattern: (HttpServletRequest $REQ)
      severity: WARNING
    - id: java_inject_rule-CommandInjection
      languages:
        - java
      message: |
        OS command injection is a critical vulnerability that can lead to a full system
        compromise as it may allow an adversary to pass in arbitrary commands or arguments
        to be executed.

        User input should never be used in constructing commands or command arguments
        to functions which execute OS commands. This includes filenames supplied by
        user uploads or downloads.

        Ensure your application does not:

        - Use user-supplied information in the process name to execute.
        - Use user-supplied information in an OS command execution function which does
        not escape shell meta-characters.
        - Use user-supplied information in arguments to OS commands.

        The application should have a hardcoded set of arguments that are to be passed
        to OS commands. If filenames are being passed to these functions, it is
        recommended that a hash of the filename be used instead, or some other unique
        identifier. It is strongly recommended that a native library that implements
        the same functionality be used instead of using OS system commands, due to the
        risk of unknown attacks against third party commands.

        When specifying the OS command, ensure the application uses the full path
        information, otherwise the OS may attempt to look up which process to execute
        and could be vulnerable to untrusted search path vulnerabilities (CWE-426).

        Example of safely executing an OS command:
        ```
        public static void executeCommand(String userFileData) throws java.io.IOException {
            // Generate a random filename, do not use user input
            String fileName = UUID.randomUUID().toString();
            // Create a Buffered/FileWriter
            BufferedWriter writer = new BufferedWriter(new FileWriter(fileName));
            // Write the user content to our random file
            writer.write(userFileData);
            // Close the file to flush contents
            writer.close();
            // Create the process builder with a hardcoded path to the binary, and our randomly
        generated filename
            ProcessBuilder processBuilder = new ProcessBuilder("/opt/app/path", fileName);
            // Start the process
            Process process = processBuilder.start();
            // Handle/redirect output of process here
            // ...
        }
        ```

        For more information on OS command injection, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        technology:
            - java
      mode: taint
      pattern-propagators:
        - from: $X
          pattern: $LIST.add($X)
          to: $LIST
        - from: $X
          pattern: $MAP.put(..., $X)
          to: $MAP
        - from: $X
          pattern: $STR.concat($X)
          to: $STR
        - from: $X
          pattern: $STR = String.format(..., $X, ...)
          to: $STR
        - from: $X
          pattern: $STR = String.join(..., $X, ...)
          to: $STR
      pattern-sinks:
        - pattern: (ProcessBuilder $PB).command(...)
        - pattern: new ProcessBuilder(...)
        - pattern: (Runtime $R).exec(...)
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $R).$METHOD(...)
        - pattern: (java.util.Scanner $S).$METHOD(...)
        - pattern: (java.util.stream.Stream).$METHOD(...)
        - pattern: (java.util.StringJoiner $SJ).toString(...)
        - pattern: (java.sql.ResultSet.getString $R).$METHOD(...)
        - pattern: (java.lang.System $S).getProperty(...)
        - pattern: (java.lang.System $S).getenv(...)
        - pattern: (java.lang.StringBuilder $SB).toString(...)
        - pattern: (java.io.FileInputStream $F).read(...)
        - pattern: (java.io.FileReader $F).read(...)
        - pattern: (java.net.Socket $S).getInputStream(...)
        - pattern: (java.net.Socket $S).getOutputStream(...)
        - pattern: (java.net.DatagramSocket $S).receive(...)
        - pattern: (java.net.DatagramSocket $S).getInputStream(...)
        - pattern: java.nio.file.Files.readAllBytes(...)
        - pattern: java.nio.file.Files.readAllLines(...)
        - pattern: java.nio.file.Files.lines(...)
        - pattern: java.nio.file.Files.newBufferedReader(...)
        - pattern: org.apache.commons.io.IOUtils.toString(...)
        - pattern: org.apache.commons.io.IOUtils.readLines(...)
        - pattern: org.apache.commons.io.IOUtils.toByteArray(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).readValue(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).treeToValue(...)
        - pattern: $CLASS.$METHOD(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - pattern: $FUNC(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - patterns:
            - pattern-inside: $FUNC(..., String $X, ...) { ... }
            - focus-metavariable: $X
      severity: WARNING
    - id: java_inject_rule-ELInjection
      languages:
        - java
      message: "This rule identifies potential Expression Language (EL) injection vulnerabilities within Java applications. \nThe rule targets use of `createValueExpression`, `createMethodExpression`, `ELProcessor.eval`, `getValue`, \nand `setValue` methods, particularly when input to these methods is not a hardcoded string, indicating dynamic \nevaluation of potentially untrusted input. \n\n`createValueExpression` creates a `ValueExpression` object which gets evaluated upon calling methods like \n`getValue()` and `setValue()` or a Lambda `invoke()` i.e. it evaluates the expression passed to the \n`createValueExpression` method.\n\nSimilarly, `createMethodExpression` creates a `MethodExpression` object which gets evaluated upon calling \nmethods like `invoke()` and `getMethodInfo()`.\n`ELProcessor.eval`, `getValue()`, and `setValue()` methods all evaluate their expressions which are passed \nas parameters.\n\nCalling these method directly with user-supplied input may allow an adversary to execute arbitrary Java \ncode, including OS system commands. Never call these methods directly with user-supplied input. Consider \nalternate methods such as a lookup table to take user input and resolve hardcoded values.\n\nSecure example:\n\n```\nimport javax.el.ELProcessor;\nimport java.util.Set;\n\npublic class SafeELHandling {\n    private static final Set<String> ALLOWED_VALUES = Set.of(\"value1\", \"value2\", \"value3\");\n\n    public void processInput(String userInput) {\n        // Validate user input against the allowlist\n        if (!ALLOWED_VALUES.contains(userInput)) {\n            throw new IllegalArgumentException(\"Invalid input\");\n        }\n        \n        ELProcessor elProcessor = new ELProcessor();\n        elProcessor.defineBean(\"userInput\", userInput);\n        \n        // Example EL expression using the safe, predefined input\n        String result = (String) elProcessor.eval(userInput);\n    }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-917
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Info
        shortDescription: Improper neutralization of special elements used in an expression language statement ('Expression Language Injection')
        technology:
            - java
      pattern-either:
        - patterns:
            - pattern: |
                (ExpressionFactory $EXP).createValueExpression((ELContext $CTX), $EXPR,
                ...)
            - pattern-not: |
                (ExpressionFactory $EXP).createValueExpression((ELContext $CTX), "...",
                ...)
        - patterns:
            - pattern: |
                (ExpressionFactory $EXP).createMethodExpression((ELContext $CTX), $EXPR,
                ...)
            - pattern-not: |
                (ExpressionFactory $EXP).createMethodExpression((ELContext $CTX), "...",
                ...)
        - patterns:
            - pattern: |
                ($X.el.ELProcessor $P).eval(...)
            - pattern-not: |
                ($X.el.ELProcessor $P).eval("...", ...)
        - patterns:
            - pattern: |
                ($X.el.ELProcessor $P).getValue(...)
            - pattern-not: |
                ($X.el.ELProcessor $P).getValue("...", ...)
        - patterns:
            - pattern: |
                ($X.el.ELProcessor $P).setValue(...)
            - pattern-not: "($X.el.ELProcessor $P).setValue(\"...\", \"...\")   \n"
      severity: WARNING
    - id: java_inject_rule-FileDisclosureRequestDispatcher
      languages:
        - java
      message: |
        The `HttpRequest.getRequestDispatcher()`'s `include` and `forward` methods will return
        any file that is resolvable within the web application context. This includes the `web.xml`
        file, any compiled classes, `jsp` files, and additional JAR or WAR libraries that are
        accessible.

        Never pass user-supplied input directly to any of these methods. Use a lookup table or
        hardcode
        which views or paths the user should be directed to. Another option is to use a simple HTTP
        redirect by returning an empty response body with a 301 status code and a `Location` redirect
        header. In Java servlets, this can be done by using the `response.sendRedirect(...)` method.

        Example using a redirect instead of a `RequestDispatcher`:
        ```
        // Create a look up table or pull from a data source
        HashMap<String, String> lookupTable = new HashMap<>();
        lookupTable.put("key1", "/Resource1");
        lookupTable.put("key2", "/Resource2");
        // Get user input
        String userInput = request.getParameter("key");
        // Look up resource to redirect to from the user input
        String redirectValue = lookupTable.getOrDefault(userInput, "/Resource1");
        // Redirect the user
        response.sendRedirect(redirectValue);
        ```
      metadata:
        category: security
        cwe: CWE-552
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: HIGH
        shortDescription: Files or directories accessible to external parties
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-not-inside: |
                $VAL = $MAP.getOrDefault(..., "...");
                ...
            - pattern-inside: |
                $REQ = $HTTP.getRequestDispatcher(...);
                ...
            - pattern-either:
                - pattern: $REQ.include($FST, $SND)
                - pattern: $REQ.forward($FST, $SND)
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameter(...)
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterNames();
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterValues(...);
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterMap();
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getHeader(...);
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getPathInfo();
      severity: ERROR
    - id: java_inject_rule-FileDisclosureSpringFramework
      languages:
        - java
      message: |
        The `org.springframework.web.servlet.ModelAndView` class may
        potentially allow access to restricted files if called with user-supplied input.

        The ModelAndView class looks up a view by name to resolve a `.jsp`
        file. If this view name comes from user-supplied input, it could be abused to attempt
        to return a JSP view that the user should not have access to.

        Use a lookup table or hardcode which views or paths the user should be directed to.

        Example using a lookup table to resolve a view from a Spring MVC application:
        ```
        @RequestMapping(value="/mvc", method=RequestMethod.GET)
        public ModelAndView mvc(HttpServletRequest request, HttpServletResponse response, Model model)
         {
          // Create a look up table or pull from a data source
          HashMap<String, String> lookupTable = new HashMap<>();
          lookupTable.put("key1", "view1");
          lookupTable.put("key2", "view2");
          // Get user input
          String userInput = request.getParameter("key");
          // Look up view from the user input
          String viewValue = lookupTable.getOrDefault(userInput, "Resource1");
          // return the new model and view
          return new ModelAndView(viewValue);
        }
        ```

        Example using a redirect instead of a `RequestDispatcher` in Spring:
        ```
        @RequestMapping(value="/mvc", method=RequestMethod.GET)
        public void mvc(HttpServletRequest request, HttpServletResponse response, Model model)
         {
          // Create a look up table or pull from a data source
          HashMap<String, String> lookupTable = new HashMap<>();
          lookupTable.put("key1", "view1");
          lookupTable.put("key2", "view2");
          // Get user input
          String userInput = request.getParameter("key");
          // Look up resource to redirect to from the user input
          String redirectValue = lookupTable.getOrDefault(userInput, "/Resource1");
          // return the new model and view
          response.sendRedirect(redirectValue);
        }
        ```
      metadata:
        category: security
        cwe: CWE-552
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: HIGH
        shortDescription: Files or directories accessible to external parties
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-not-inside: |
                $FST = $MAP.getOrDefault(..., "...");
                  ...
            - pattern: new org.springframework.web.servlet.ModelAndView($FST, ...);
            - focus-metavariable: $FST
        - patterns:
            - pattern-not-inside: |
                $FST = $MAP.getOrDefault(..., "...");
                ...
            - pattern-inside: |
                $MVC = new org.springframework.web.servlet.ModelAndView();
                ...
            - pattern: $MVC.setViewName(...);
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameter(...)
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterNames();
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterValues(...);
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getParameterMap();
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getHeader(...);
        - pattern: (javax.servlet.http.HttpServletRequest $VAR).getPathInfo();
      severity: ERROR
    - id: java_inject_rule-HttpParameterPollution
      languages:
        - java
      message: |
        The application was found including unvalidated user input into a URL, which could lead to
        HTTP Parameter Pollution (HPP) or worse, Server Side Request Forgery (SSRF). This could
        allow an adversary to override the value of a URL or a request parameter.  HTTP Parameter
        Pollution
        (HPP) attacks consist of injecting encoded query string delimiters into other existing
        parameters. If a web
        application does not properly sanitize the user input, an adversary may modify the logic of
        these
        requests to other applications.

        To remediate this issue, never allow user input directly into creation of a URL or URL
        parameter. Consider
        using a map to look up user-supplied information and return exact values to be used in the
        generation of
        requests.

        Example using a map to look up a key to be used in a HTTP request:
        ```
        HashMap<String, String> lookupTable = new HashMap<>();
        lookupTable.put("key1", "value1");
        lookupTable.put("key2", "value2");
        String userInput = request.getParameter("key");

        // Create a CloseableHttpClient, ideally any requests issued should be done
        // out-of-band from the servlet request itself (such as using a separate thread/scheduler
        system)
        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {
            // Lookup the value from our user input from our lookupTable
            String value = lookupTable.getOrDefault(userInput, "value1");
            // Construct the url, with the hardcoded url and only pass in the value from the
        lookupTable,
            // not direct user input
            final HttpGet httpget = new HttpGet("https://example.com/getId?key="+value);
            // Execute the request
            CloseableHttpResponse clientResponse = httpClient.execute(httpget);
            // Read the response
            byte[] responseData = clientResponse.getEntity().getContent().readAllBytes();
            // Handle the response
            // ...
        }
        ```

        If using a map is not possible, the user-supplied input must be encoded prior to use, and
        never allow full
        URLs:
        ```
        // Get user input
        String userInput = request.getParameter("key");
        // Encode the string using java.net.URLEncoder with the UTF-8 character set
        String encodedString = java.net.URLEncoder.encode(userInput, StandardCharsets.UTF_8);
        // Create a CloseableHttpClient, ideally any requests issued should be done
        // out-of-band from the servlet request itself (such as using a separate thread/scheduler
        system)
        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {
          // Construct the url, with the hardcoded url and only pass in the encoded value, never a
        full URL
          final HttpGet httpget = new HttpGet("https://example.com/getId?key="+encodedString);
          // Execute the request
          CloseableHttpResponse clientResponse = httpClient.execute(httpget);
          // Read the response
          byte[] responseData = clientResponse.getEntity().getContent().readAllBytes();
          // handle the response
        }
        ```

        For more information on SSRF see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html

        For more information on HTTP Parameter Pollution see:
        https://en.wikipedia.org/wiki/HTTP_parameter_pollution
      metadata:
        category: security
        cwe: CWE-88
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of argument delimiters in a command ('Argument Injection')
        technology:
            - java
      mode: taint
      pattern-sanitizers:
        - pattern: java.net.URLEncoder.encode(...)
        - pattern: com.google.common.net.UrlEscapers.urlPathSegmentEscaper().escape(...)
      pattern-sinks:
        - pattern: new org.apache.http.client.methods.HttpGet(...)
        - pattern: new org.apache.commons.httpclient.methods.GetMethod(...)
        - pattern: (org.apache.commons.httpclient.methods.GetMethod $GM).setQueryString(...)
      pattern-sources:
        - pattern: (HttpServletRequest $REQ).getParameter(...)
      severity: ERROR
    - id: java_inject_rule-LDAPInjection
      languages:
        - java
      message: |
        LDAP injection attacks exploit LDAP queries to influence how data is returned by
        the LDAP server.

        Later versions of Java's `InitialDirContext.search` introduced a four argument method, one of
        which is the `filterArg` parameter. The `filterArg` will be automatically encoded when
        querying
        the LDAP server. If this method signature is not available, the application must encode the
        LDAP strings manually.

        More details on the four argument `search` method can be found here:
        https://docs.oracle.com/en/java/javase/20/docs/api/java.naming/javax/naming/directory/InitialDirContext.html#search(javax.naming.Name,java.lang.String,java.lang.Object[],javax.naming.directory.SearchControls)

        To encode the string manually, it is recommended that all input passed to LDAP querying
        systems
        encode the following values:

        - Any occurrence of the null character must be escaped as \00.
        - Any occurrence of the open parenthesis character must be escaped as \28.
        - Any occurrence of the close parenthesis character must be escaped as \29.
        - Any occurrence of the asterisk character must be escaped as \2a.
        - Any occurrence of the backslash character must be escaped as \5c.

        Example function that safely encodes user-supplied input to be used in an LDAP query.
        ```
        public static String encodeLDAPString(String input) {
          // Note the \ character is replaced first
          CharSequence[] chars = new CharSequence[] { "\\", "\0", "(", ")", "*" };
          CharSequence[] encoded = new CharSequence[] { "\\5c", "\\00", "\\28", "\\29", "\\2a" };
          // Iterate over each character sequence, replacing the raw value with an encoded version of
        it
          for (int i = 0; i < chars.length; i++)
          {
              // re-assign to input
              input = input.replace(chars[i], encoded[i]);
          }
          // return our modified input string
          return input;
        }
        ```

        Example code that using the `filterArgs` parameter which automatically encodes for us:
        ```
        // Create a properties to hold the ldap connection details
        Properties props = new Properties();
        // Use the com.sun.jndi.ldap.LdapCtxFactory factory provider
        props.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
        // The LDAP server URL
        props.put(Context.PROVIDER_URL, "ldap://ldap.example.org:3889");
        // User details for the connection
        props.put(Context.SECURITY_PRINCIPAL, "cn=admin,dc=example,dc=org");
        // LDAP account password
        String ldapAccountPassword = getAccountPasswordFromSecureStoreOrKMS();
        // Pass in the LDAP password
        props.put(Context.SECURITY_CREDENTIALS, ldapAccountPassword);

        // Create the LDAPContext
        InitialDirContext ldapContext = new InitialDirContext(props);
        // Example using SUBTREE_SCOPE SearchControls
        SearchControls searchControls = new SearchControls();
        searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);

        // Get user input for query
        String userQuery = someUserInput;
        // Use searchArguments to hold the user-supplied input
        Object[] searchArguments = new Object[]{userQuery};
        // Hardcode the BaseDN, use the {0} format specifier to use the searchArguments array value,
        and pass in the search controls.
        // searchArguments automatically encode
        NamingEnumeration answer = ldapContext.search("dc=example,dc=org", "(cn={0})",
        searchArguments, searchControls);
        // Process the response answer
        while (answer.hasMoreElements()) {
          ...
        }
        ```

        For more information on LDAP Injection see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-90
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of special elements used in an LDAP query ('LDAP Injection')
        technology:
            - java
      mode: taint
      pattern-sinks:
        - pattern: javax.naming.ldap.LdapName(...)
        - pattern: (javax.naming.directory.Context $C).lookup(...)
        - pattern: (javax.naming.Context $C).lookup(...)
        - patterns:
            - pattern-inside: (com.unboundid.ldap.sdk.LDAPConnection $C).search($QUERY, ...)
            - pattern: $QUERY
        - patterns:
            - pattern-either:
                - pattern: $CTX.lookup(...)
                - patterns:
                    - pattern-inside: $CTX.search($QUERY, ...)
                    - pattern: $QUERY
                - patterns:
                    - pattern-inside: $CTX.search($NAME, $FILTER, ...)
                    - pattern: $FILTER
            - metavariable-pattern:
                metavariable: $CTX
                pattern-either:
                    - pattern: (DirContext $C)
                    - pattern: (InitialDirContext $IDC)
                    - pattern: (LdapContext $LC)
                    - pattern: (EventDirContext $EDC)
                    - pattern: (LdapCtx $LC)
                    - pattern: (javax.naming.directory.DirContext $C)
                    - pattern: (javax.naming.directory.InitialDirContext $IDC)
                    - pattern: (javax.naming.ldap.LdapContext $LC)
                    - pattern: (javax.naming.event.EventDirContext $EDC)
                    - pattern: (com.sun.jndi.ldap.LdapCtx $LC)
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: $CTX.list($QUERY, ...)
                    - pattern: $QUERY
                - patterns:
                    - pattern-inside: $CTX.lookup($QUERY, ...)
                    - pattern: $QUERY
                - patterns:
                    - pattern-inside: $CTX.search($QUERY, ...)
                    - pattern: $QUERY
                - patterns:
                    - pattern-inside: $CTX.search($NAME, $FILTER, ...)
                    - pattern: $FILTER
            - metavariable-pattern:
                metavariable: $CTX
                pattern-either:
                    - pattern: (LdapTemplate $LT)
                    - pattern: (LdapOperations $LO)
                    - pattern: (org.springframework.ldap.core.LdapTemplate $LT)
                    - pattern: (org.springframework.ldap.core.LdapOperations $LO)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $FUNC(..., $VAR, ...) {
                  ...
                }
            - pattern: $VAR
        - patterns:
            - pattern-inside: |
                $FUNC(..., $X, ...) {
                  ...
                  $VAR = ... + $X;
                  ...
                }
            - pattern: $VAR
      severity: WARNING
    - id: java_inject_rule-OgnlInjection
      languages:
        - java
      message: |
        The Object Graph Navigation Language (OGNL) is an expression language that allows access to
        Java objects and properties stored in an ActionContext. Usage of these low-level
        functions is discouraged because they can effectively execute strings as code, leading to
        remote code execution vulnerabilities. Consider using struts tags when processing
        user-supplied input and templates.

        Much like the Struts security guide recommending to not use raw `${}` EL expressions,
        do not call or use the following OGNL packages with user-supplied input:

        - `com.opensymphony.xwork2.ognl`
        - `com.opensymphony.xwork2.util`
        - `com.opensymphony.xwork2.util.reflection`
        - `org.apache.struts2.util.StrutsUtil`

        For more information on Struts2 security see:
        https://struts.apache.org/security/#do-not-use-incoming-untrusted-user-input-in-forced-expression-evaluation
      metadata:
        category: security
        cwe: CWE-917
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Expression injection (OGNL)
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-inside: com.opensymphony.xwork2.util.TextParseUtil.translateVariables($VAL, ...)
            - pattern: $VAL
        - patterns:
            - pattern-inside: com.opensymphony.xwork2.util.TextParseUtil.translateVariablesCollection($VAL, ...)
            - pattern: $VAL
        - pattern: com.opensymphony.xwork2.util.TextParseUtil.shallBeIncluded(...)
        - pattern: com.opensymphony.xwork2.util.TextParseUtil.commaDelimitedStringToSet(...)
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.TextParser $P).evaluate($VAR, $VAL, ...)
            - pattern: $VAL
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.OgnlTextParser $P).evaluate($VAR, $VAL, ...)
            - pattern: $VAL
        - pattern: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).getGetMethod($CLZ, ...)
        - pattern: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).getSetMethod($CLZ, ...)
        - pattern: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).getField($CLZ, ...)
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).setProperties($MAP, ...)
            - pattern: $MAP
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).setProperty($VAL, ...)
            - pattern: $VAL
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).getValue($VAL, ...)
            - pattern: $VAL
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlReflectionProvider $P).setValue($VAL, ...)
            - pattern: $VAL
        - pattern: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).getGetMethod($CLZ, ...)
        - pattern: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).getSetMethod($CLZ, ...)
        - pattern: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).getField($CLZ, ...)
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).setProperties($MAP, ...)
            - pattern: $MAP
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).setProperty($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).getValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.reflection.ReflectionProvider $P).setValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).setProperties($MAP, ...)
            - pattern: $MAP
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).setProperty($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).getValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).setValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).callMethod($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.ognl.OgnlUtil $P).compile($VAR, ...)
            - pattern: $VAR
        - pattern: (org.apache.struts2.util.VelocityStrutsUtil $P).evaluate(...)
        - pattern: org.apache.struts2.util.StrutsUtil.findString(...)
        - pattern: org.apache.struts2.util.StrutsUtil.findValue(..., $VAL)
        - pattern: org.apache.struts2.util.StrutsUtil.getText(...)
        - pattern: org.apache.struts2.util.StrutsUtil.translateVariables(...)
        - patterns:
            - pattern-inside: org.apache.struts2.util.StrutsUtil.makeSelectList($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (org.apache.struts2.views.jsp.ui.OgnlTool $T).findValue($VAR, ...)
            - pattern: $VAR
        - pattern: (com.opensymphony.xwork2.util.ValueStack $V).findString(...)
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.ValueStack $V).findValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.ValueStack $V).setValue($VAR, ...)
            - pattern: $VAR
        - patterns:
            - pattern-inside: (com.opensymphony.xwork2.util.ValueStack $V).setParameter($VAR, ...)
            - pattern: $VAR
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $FUNC(..., $VAR, ...) {
                  ...
                }
            - metavariable-pattern:
                metavariable: $VAR
                pattern-either:
                    - pattern: (String $S)
                    - pattern: (Map<String, ?> $M)
                    - pattern: (Map<String, String> $M)
                    - pattern: (Map<String, Object> $M)
            - pattern: $VAR
      severity: WARNING
    - id: java_inject_rule-SpotbugsPathTraversalAbsolute
      languages:
        - java
      message: |
        The application dynamically constructs file or path information. If the path
        information comes from user input, it could be abused to read sensitive files,
        access other users' data, or aid in exploitation to gain further system access.

        User input should never be used in constructing paths or files for interacting
        with the filesystem. This includes filenames supplied by user uploads or downloads.
        If possible, consider hashing user input or replacing it with unique values and
        use `Path.resolve` to resolve and validate the path information
        prior to processing any file functionality.

        Example using `Path.resolve` and not allowing direct user input:
        ```
        // Class to store our user data along with a randomly generated file name
        public static class UserData {
            private String userFileNameUnsafe;
            private String fileName;
            public UserData(String userFileName) {
                this.userFileNameUnsafe = userFileName;
                // Generate a random ID for the filename
                this.fileName = UUID.randomUUID().toString();
            }
            public String getUserFileNameUnsafe() { return userFileNameUnsafe; };
            public String getFileName() { return fileName; };
        }

        public static void main(String[] args) throws Exception {
            // User input, saved only as a reference
            UserData userData = new UserData("..\\test.txt");
            // Restrict all file processing to this directory only
            String base = "/var/app/restricted";
            Path basePath = Paths.get(base);
            // Resolve the full path, but only use our random generated filename
            Path fullPath = basePath.resolve(userData.getFileName());
            // verify the path is contained within our basePath
            if (!fullPath.startsWith(base)) {
                throw new Exception("Invalid path specified!");
            }
            // process / work with file
        }
        ```

        For more information on path traversal issues see OWASP:
        https://owasp.org/www-community/attacks/Path_Traversal
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - java
      mode: taint
      pattern-propagators:
        - from: $X
          pattern: $LIST.add($X)
          to: $LIST
        - from: $X
          pattern: $MAP.put(..., $X)
          to: $MAP
        - from: $X
          pattern: $STR.concat($X)
          to: $STR
        - from: $X
          pattern: $STR = String.format(..., $X, ...)
          to: $STR
        - from: $X
          pattern: $STR = String.join(..., $X, ...)
          to: $STR
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $U = new java.net.URI($VAR)
            - pattern-either:
                - pattern-inside: new java.io.File($U)
                - pattern-inside: java.nio.file.Paths.get($U)
            - pattern: $VAR
        - patterns:
            - pattern-inside: new java.io.RandomAccessFile($INPUT,...)
            - pattern: $INPUT
        - pattern: new java.io.FileReader(...)
        - pattern: new javax.activation.FileDataSource(...)
        - pattern: new java.io.FileInputStream(...)
        - pattern: new java.io.FileOutputStream(...)
        - pattern: new java.io.File(...)
        - pattern: java.nio.file.Paths.get(...)
        - pattern: java.io.File.createTempFile(...)
        - pattern: java.io.File.createTempDirectory(...)
        - pattern: java.nio.file.Files.createTempFile(...)
        - pattern: java.nio.file.Files.createTempDirectory(...)
        - patterns:
            - pattern: $SRC.$METHOD(...)
            - metavariable-pattern:
                metavariable: $SRC
                pattern-either:
                    - pattern: getClass()
                    - pattern: getClass().getClassLoader()
                    - pattern: (ClassLoader $C)
                    - pattern: (Class $C)
                    - pattern: $CLZ.getClassLoader()
            - metavariable-pattern:
                metavariable: $METHOD
                pattern-either:
                    - pattern: getResourceAsStream
                    - pattern: getResource
        - patterns:
            - pattern-inside: new java.io.FileWriter($PATH, ...)
            - pattern: $PATH
        - patterns:
            - pattern-inside: new java.io.FileOutputStream($PATH, ...)
            - pattern: $PATH
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $R).$METHOD(...)
        - pattern: (java.util.Scanner $S).$METHOD(...)
        - pattern: (java.util.stream.Stream).$METHOD(...)
        - pattern: (java.util.StringJoiner $SJ).toString(...)
        - pattern: (java.sql.ResultSet.getString $R).$METHOD(...)
        - pattern: (java.lang.System $S).getProperty(...)
        - pattern: (java.lang.System $S).getenv(...)
        - pattern: (java.lang.StringBuilder $SB).toString(...)
        - pattern: (java.io.FileInputStream $F).read(...)
        - pattern: (java.io.FileReader $F).read(...)
        - pattern: (java.net.Socket $S).getInputStream(...)
        - pattern: (java.net.Socket $S).getOutputStream(...)
        - pattern: (java.net.DatagramSocket $S).receive(...)
        - pattern: (java.net.DatagramSocket $S).getInputStream(...)
        - pattern: java.nio.file.Files.readAllBytes(...)
        - pattern: java.nio.file.Files.readAllLines(...)
        - pattern: java.nio.file.Files.lines(...)
        - pattern: java.nio.file.Files.newBufferedReader(...)
        - pattern: org.apache.commons.io.IOUtils.toString(...)
        - pattern: org.apache.commons.io.IOUtils.readLines(...)
        - pattern: org.apache.commons.io.IOUtils.toByteArray(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).readValue(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).treeToValue(...)
        - pattern: $CLASS.$METHOD(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - pattern: $FUNC(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - patterns:
            - pattern-inside: $FUNC(..., @RequestParam String $X, ...) { ... }
            - focus-metavariable: $X
      severity: WARNING
    - id: java_password_rule-ConstantDBPassword
      languages:
        - java
      message: |
        A potential hard-coded password was identified in a database connection string.
        Passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-259
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Critical
        shortDescription: Use of hard-coded password
        technology:
            - java
      patterns:
        - pattern: java.sql.DriverManager.getConnection($URI, $USR, "...");
      severity: ERROR
    - id: java_password_rule-EmptyDBPassword
      languages:
        - java
      message: |
        The application does not provide authentication when communicating a database
        server. It is strongly recommended that the database server be configured with
        authentication and restrict what queries users can execute.

        Please see your database server's documentation on how to configure a password.

        Additionally, passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-306
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Critical
        shortDescription: Missing authentication for critical function (database)
        technology:
            - java
      patterns:
        - pattern: java.sql.DriverManager.getConnection($URI, $USR, "");
      severity: ERROR
    - id: java_password_rule-HardcodePassword
      languages:
        - java
      message: |
        A potential hard-coded password was identified in a hard-coded string.
        Passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-259
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: High
        shortDescription: Use of hard-coded password
        technology:
            - java
      pattern-either:
        - pattern: new java.security.KeyStore.PasswordProtection("...".toCharArray())
        - pattern: java.security.KeyStore.getInstance(...).load(..., "...".toCharArray())
        - pattern: (java.security.KeyStore $KS).load(..., "...".toCharArray())
        - pattern: KeyManagerFactory.getInstance(...).init(..., "...".toCharArray())
        - pattern: (KeyManagerFactory $KMF).init(..., "...".toCharArray())
        - pattern: PBEKeySpec("...", ...)
        - pattern: PasswordAuthentication("...", "...")
        - pattern: (PasswordCallback $CB).setPassword("...")
        - pattern: KerberosKey(...,"...",...)
        - pattern: java.sql.DriverManager.getConnection(..., "...")
        - pattern: io.vertx.ext.web.handler.CSRFHandler.create(..., "...")
        - pattern: $S.setPassword("...")
      severity: ERROR
    - id: java_perm_rule-DangerousPermissions
      languages:
        - java
      message: |
        The application was found to permit the `RuntimePermission` of `createClassLoader`,
        `ReflectPermission` of `suppressAccessChecks`, or both.

        By granting the `RuntimePermission` of `createClassLoader`, a compromised application
        could instantiate their own class loaders and load arbitrary classes.

        By granting the `ReflectPermission` of `suppressAccessChecks` an application will no longer
        check Java language access checks on fields and methods of a class. This will effectively
        grant access to protected and private members.

        For more information on `RuntimePermission` see:
        https://docs.oracle.com/javase/8/docs/api/java/lang/RuntimePermission.html

        For more information on `ReflectPermission` see:
        https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/ReflectPermission.html
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-732
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Incorrect permission assignment for critical resource
      pattern-either:
        - pattern: |
            $RUNVAR = new RuntimePermission("createClassLoader");
            ...
            (PermissionCollection $PC).add($RUNVAR);
        - pattern: |
            $REFVAR = new ReflectPermission("suppressAccessChecks");
            ...
            (PermissionCollection $PC).add($REFVAR);
        - pattern: (PermissionCollection $PC).add(new ReflectPermission("suppressAccessChecks"))
        - pattern: (PermissionCollection $PC).add(new RuntimePermission("createClassLoader"))
      severity: WARNING
    - id: java_perm_rule-OverlyPermissiveFilePermissionInline
      languages:
        - java
      message: |
        The application was found setting file permissions to overly permissive values. Consider
        using the following values if the application user is the only process to access
        the file:

        - `r--` - read only access to the file
        - `w--` - write only access to the file
        - `rw-` - read/write access to the file

        Example setting read/write permissions for only the owner of a `Path`:
        ```
        // Get a reference to the path
        Path path = Paths.get("/tmp/somefile");
        // Create a PosixFilePermission set from java.nio.file.attribute
        Set<PosixFilePermission> permissions =
        java.nio.file.attribute.PosixFilePermissions.fromString("rw-------");
        // Set the permissions
        java.nio.file.Files.setPosixFilePermissions(path, permissions);
        ```

        For all other values please see:
        https://en.wikipedia.org/wiki/File-system_permissions#Symbolic_notation
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-732
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Incorrect permission assignment for critical resource
      patterns:
        - pattern-either:
            - pattern: java.nio.file.Files.setPosixFilePermissions(..., java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING"));
            - pattern: |
                $PERMISSIONS = java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING");
                ...
                java.nio.file.Files.setPosixFilePermissions(..., $PERMISSIONS);
        - metavariable-regex:
            metavariable: $PERM_STRING
            regex: '[rwx-]{6}[rwx]{1,}'
      severity: WARNING
    - id: java_script_rule-ScriptInjection
      languages:
        - java
      message: |
        The application executes an argument using a `ScriptEngine`'s `eval` method. This
        may allow for direct OS commands to be executed as it's possible to pass in strings
        such as `java.lang.Runtime.getRuntime().exec('/bin/sh ...');`.

        Never pass user-supplied input directly to the `eval` function. If possible hardcode all
        JavasScript code or use a lookup table to resolve user input to known values. If none of these
        techniques are possible, use `javax.script.Bindings` to pass input to the script engine.

        Example using `Binding` to safely pass in string values:
        ```
        // Get ECMAScript engine
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("ECMAScript");

        // User input, consisting of first and last name
        String userFirstName = "John";
        String userLastName = "Snow";

        // Create bindings to pass into our script, forcing the values to be String.
        Bindings bindings = engine.createBindings();
        bindings.put("fname", new String(userFirstName));
        bindings.put("lname", new String(userLastName));

        // Example script that concatenates a greeting with the user-supplied input first/last name
        String script = "var greeting='Hello ';" +
        // fname and lname variables will be resolved by our bindings defined above
        "greeting += fname + ' ' + lname;" +
        // prints greeting
        "greeting";

        try {
          // Execute the script, passing in the bindings
          Object bindingsResult = engine.eval(script, bindings);
          // Work with result
          // ...
        } catch (ScriptException e) {
          // Handle exception
          e.printStackTrace();
        }
        ```
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper control of generation of code ('Code Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: (javax.script.ScriptEngine $ENGINE).eval($ARG, ...);
            - pattern-not: (javax.script.ScriptEngine $ENGINE).eval("...");
            - pattern-not: (javax.script.ScriptEngine $ENGINE).eval("...", (javax.script.Bindings $BINDING));
        - patterns:
            - pattern-either:
                - pattern: (javax.script.Invocable $INVC).invokeFunction(..., $ARG)
                - pattern: (javax.script.Invocable $INVC).invokeMethod(..., $ARG)
      pattern-sources:
        - patterns:
            - pattern-inside: $FUNC(..., $VAR, ...) { ... }
            - pattern: $VAR
      severity: ERROR
    - id: java_script_rule-SpringSpelExpressionParser
      languages:
        - java
      message: |
        The application was found calling SpringFramework's `SpelExpressionParser.parseExpression`.
        Calling this method directly with user-supplied input may allow an adversary to
        execute arbitrary Java code including OS system commands.

        Never call `parseExpression` or `parseRaw` directly with user-supplied input. Consider
        alternate
        methods such as a lookup table to take user input and resolve hardcoded values.

        Later versions of SpringFramework introduced a `SimpleEvaluationContext` which can be
        used to access bound data when calling the `getValue` result of `parseExpression`. This
        `SimpleEvaluationContext` has a reduced set of functionality and can restrict data binding
        to read-only or read-write contexts. An adversary could still access public properties
        or fields on custom types that have been provided to the evaluation context. Use with caution.

        Example using `SimpleEvaluationContext` with a read-write data binding context:
        ```
        @RequestMapping(value="/spel", method=RequestMethod.POST)
        public String spel(@Validated User user, Model model)  {
          // Create the Expression Parser
          SpelExpressionParser parser = new SpelExpressionParser();
          // Parse the expression
          Expression parsedExpression = parser.parseExpression(model.getPossiblyUnsafeData());
          // Create the read-write data binding context
          SimpleEvaluationContext context = SimpleEvaluationContext.forReadWriteDataBinding().build();
          // Execute the expression, passing in the read-write context
          Object result = parsedExpression.getValue(context);
          // work with the result
          // ...
          return "user";
        }
        ```

        For more information on SimpleEvaluationContext see:
        https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/expression/spel/support/SimpleEvaluationContext.html
      metadata:
        category: security
        cwe: CWE-917
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an expression language statement ('Expression Language Injection')
      patterns:
        - pattern: ($PARSER $P).$METHOD($ARG);
        - pattern-not: ($PARSER $P).$METHOD("...");
        - metavariable-pattern:
            metavariable: $PARSER
            pattern-either:
                - pattern: org.springframework.expression.spel.standard.SpelExpressionParser
                - pattern: org.springframework.expression.ExpressionParser
        - metavariable-regex:
            metavariable: $METHOD
            regex: (parseExpression|parseRaw)
      severity: ERROR
    - id: java_smtp_rule-InsecureSmtp
      languages:
        - java
      message: |
        The Apache commons mail client by default does not enable TLS server identity.
        This allows for an adversary who is in between the application and the target host to intercept
        potentially sensitive information or transmit malicious data.

        Enable checking server identity by calling `Email.setSSLCheckServerIdentity(true)`

        Example email client that enables TLS and server identity:
        ```
        // Create an email client
        Email email = new SimpleEmail();
        // Configure the email hostname
        email.setHostName("smtp.mail.example.com");
        // Set the port
        email.setSmtpPort(465);
        // Securely retrieve username and password values
        String username = getUserNameFromKMSorSecretStore();
        String password = getPasswordFromKMSorSecretStore();
        // Configure the Authenticator
        DefaultAuthenticator auth = new DefaultAuthenticator(username, password);
        // Set the authenticator
        email.setAuthenticator(auth);
        // Ensure we use SSL on connect
        email.setSSLOnConnect(true);
        // Ensure we validate server identity
        email.setSSLCheckServerIdentity(true);
        // configure the rest of the email
        email.setFrom("x@example.com");
        email.setSubject("TestMail");
        email.setMsg("This is a test mail ... :-)");
        email.addTo("y@example.com");
        email.send();
        ```
      metadata:
        category: security
        cwe: CWE-297
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Improper validation of certificate with host mismatch
      patterns:
        - pattern-either:
            - pattern-inside: |
                $E = new org.apache.commons.mail.SimpleEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.Email(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.MultiPartEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.HtmlEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.ImageHtmlEmail(...);
                ...
        - pattern-not: |
            $E.setSSLOnConnect(true);
            ...
            $E.setSSLCheckServerIdentity(true);
      severity: ERROR
    - id: java_smtp_rule-SmtpClient
      languages:
        - java
      message: |
        The application was found calling `MimeMessage` methods without encoding
        new line characters. Much like HTTP, Simple Mail Transfer Protocol (SMTP) is a
        text based protocol that uses headers to convey additional directives for how
        email messages should be treated. An adversary could potentially cause email
        messages to be sent to unintended recipients by abusing the CC or BCC headers
        if they were able to inject them.

        To mitigate this issue, `\r\n` (CRLF) character sequences must be escaped
        or encoded prior to being used in any of the `MimeMessage` methods.

        Example that escapes values that come from user input with
        [Apache Commons Text](https://commons.apache.org/proper/commons-text/):
        ```
        // Create a MimeMessage with a javax.mail.Session
        Message message = new MimeMessage(session);
        // Set the from address
        message.setFrom(new InternetAddress("source@example.com"));
        // Set the to address
        message.setRecipients(Message.RecipientType.TO,new InternetAddress[] {new
        InternetAddress("destination@example.com")});
        // Example user input
        String subject = "potentially malicious data";
        String headerValue = "potentially malicious data";
        // Use Apache Commons Text StringEscapeUtils.escapeJava to encode \r\n to \\r\\n.
        message.setSubject(StringEscapeUtils.escapeJava(subject));
        // Use Apache Commons Text StringEscapeUtils.escapeJava to encode \r\n to \\r\\n.
        message.addHeader("HeaderName", StringEscapeUtils.escapeJava(header));
        // Use Apache Commons Text StringEscapeUtils.escapeJava to encode \r\n to \\r\\n.
        message.setDescription(StringEscapeUtils.escapeJava("some description"));
        // Use Apache Commons Text StringEscapeUtils.escapeJava to encode \r\n to \\r\\n.
        message.setDisposition(StringEscapeUtils.escapeJava("some disposition"));
        // Set the mail body text
        message.setText("Some email content.");
        // Send the message
        ```
      metadata:
        category: security
        cwe: CWE-77
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Low
        shortDescription: Improper neutralization of special elements used in a command
      patterns:
        - pattern-inside: |
            $M = new MimeMessage(...);
            ...
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $M.setSubject($VAR)
                    - pattern: $M.addHeader($ARG, $VAR)
                    - pattern: $M.addHeader($VAR, $ARG)
                    - pattern: $M.setDescription($VAR)
                    - pattern: $M.setDisposition($VAR)
                - metavariable-regex:
                    metavariable: $VAR
                    regex: ^[a-zA-Z_$][a-zA-Z0-9_$]*$
            - patterns:
                - pattern-either:
                    - pattern: $M.setSubject($OBJ.$GETTER(...))
                    - pattern: $M.setSubject($OBJ.$GETTER(...) + ...)
                    - pattern: $M.setSubject(... + $OBJ.$GETTER(...))
                    - pattern: $M.setSubject(... + $OBJ.$GETTER(...) + ...)
                    - pattern: $M.addHeader($ARG, $OBJ.$GETTER(...))
                    - pattern: $M.addHeader($ARG, $OBJ.$GETTER(...) + ...)
                    - pattern: $M.addHeader($ARG, ... + $OBJ.$GETTER(...))
                    - pattern: $M.addHeader($ARG, ... + $OBJ.$GETTER(...) + ...)
                    - pattern: $M.addHeader($OBJ.$GETTER(...), $ARG)
                    - pattern: $M.addHeader($OBJ.$GETTER(...) + ..., $ARG)
                    - pattern: $M.addHeader(... + $OBJ.$GETTER(...), $ARG)
                    - pattern: $M.addHeader(... + $OBJ.$GETTER(...) + ..., $ARG)
                    - pattern: $M.setDescription($OBJ.$GETTER(...))
                    - pattern: $M.setDisposition($OBJ.$GETTER(...) + ...)
                    - pattern: $M.setDisposition(... + $OBJ.$GETTER(...))
                    - pattern: $M.setDisposition(... + $OBJ.$GETTER(...) + ...)
                - metavariable-regex:
                    metavariable: $GETTER
                    regex: ^get
      severity: ERROR
    - id: java_ssrf_rule-SSRF
      languages:
        - java
      message: |
        Server-Side-Request-Forgery (SSRF) exploits backend systems that initiate requests to third
        parties.
        If user input is used in constructing or sending these requests, an attacker could supply
        malicious
        data to force the request to other systems or modify request data to cause unwanted actions.

        Ensure user input is not used directly in constructing URLs or URIs when initiating requests
        to third party
        systems from back end systems. Care must also be taken when constructing payloads using user
        input. Where
        possible restrict to known URIs or payloads. Consider using a server-side map where keys are
        used to return
        URLs such as `https://site/goto?key=1` where `{key: 1, url: 'http://some.url/', key: 2, url:
        'http://...'}`.

        If you must use user-supplied input for requesting URLs, it is strongly recommended that the
        HTTP client
        chosen allows you to customize and block certain IP ranges at the network level. By blocking
        RFC 1918
        addresses or other network address ranges, you can limit the severity of a successful SSRF
        attack. Care must
        also be taken to block certain protocol or address formatting such as IPv6.

        If you cannot block address ranges at the client level, you may want to run the HTTP client
        as a protected
        user, or in a protected network where you can apply IP Table or firewall rules to block access
        to dangerous
        addresses. Finally, if none of the above protections are available, you could also run a
        custom HTTP proxy
        and force all requests through it to handle blocking dangerous addresses.

        Example using a map to look up a key to be used in a HTTP request:
        ```
        HashMap<String, String> lookupTable = new HashMap<>();
        lookupTable.put("key1", "https://example.com/");
        lookupTable.put("key2", "https://safeurl.com/");
        String userInput = request.getParameter("key");

        // Create a CloseableHttpClient, ideally any requests issued should be done
        // out-of-band from the servlet request itself (such as using a separate thread/scheduler
        system)
        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {
            // Lookup the value from our user input from our lookupTable
            String value = lookupTable.getOrDefault(userInput, "https://example.com/");
            // Construct the url, with the hardcoded url and only pass in the value from the
        lookupTable,
            // not direct user input
            final HttpGet httpget = new HttpGet(value);
            // Execute the request
            CloseableHttpResponse clientResponse = httpClient.execute(httpget);
            // Read the response
            byte[] responseData = clientResponse.getEntity().getContent().readAllBytes();
            // Handle the response
            // ...
        }
        ```

        If using a map is not possible, the user-supplied input must be encoded prior to use, and
        never allow full
        URLs:
        ```
        // Get user input
        String userInput = request.getParameter("key");
        // Encode the string using java.net.URLEncoder with the UTF-8 character set
        String encodedString = java.net.URLEncoder.encode(userInput, StandardCharsets.UTF_8);
        // Create a CloseableHttpClient, ideally any requests issued should be done
        // out-of-band from the servlet request itself (such as using a separate thread/scheduler
        system)
        try (final CloseableHttpClient httpClient = HttpClients.createDefault()) {
          // Construct the url, with the hardcoded url and only pass in the encoded value, never a
        full URL
          final HttpGet httpget = new HttpGet("https://example.com/getId?key="+encodedString);
          // Execute the request
          CloseableHttpResponse clientResponse = httpClient.execute(httpget);
          // Read the response
          byte[] responseData = clientResponse.getEntity().getContent().readAllBytes();
          // handle the response
        }
        ```

        For more information on SSRF see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A10:2021-Server-Side Request Forgery
        security-severity: Medium
        shortDescription: Server-Side Request Forgery (SSRF)
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net.*;
                    ...
                - pattern-inside: |
                    import java.net.URL;
                    ...
                - pattern-inside: |
                    import java.net.URI;
                    ...
            - pattern: new $TYPE(...). ... .$FUNC
            - pattern-not: new $TYPE("..."). ... .$FUNC
            - metavariable-pattern:
                metavariable: $FUNC
                pattern-either:
                    - pattern: connect
                    - pattern: GetContent
                    - pattern: openConnection
                    - pattern: openStream
                    - pattern: getContent
            - metavariable-pattern:
                metavariable: $TYPE
                pattern-either:
                    - pattern: URL
                    - pattern: java.net.URL
                    - pattern: URI
                    - pattern: java.net.URI
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net.*;
                    ...
                - pattern-inside: |
                    import java.net.InetSocketAddress;
                    ...
            - pattern: |
                new InetSocketAddress(..., $PORT)
            - pattern-not: |
                new InetSocketAddress("...", $PORT)
      severity: ERROR
    - id: java_strings_rule-BadHexConversion
      languages:
        - java
      message: |
        The application is using `Integer.toHexString` on a digest array buffer which
        may lead to an incorrect version of values.

        Consider using the `java.util.HexFormat` object introduced in Java 17. For older Java applications
        consider using the `javax.xml.bind.DatatypeConverter`.

        Example using `HexFormat` to create a human-readable string:
        ```
        // Create a MessageDigest using the SHA-384 algorithm
        MessageDigest sha384Digest = MessageDigest.getInstance("SHA-384");
        // Call update with your data
        sha384Digest.update("some input".getBytes(StandardCharsets.UTF_8));
        // Only call digest once all data has been fed into the update sha384digest instance
        byte[] output = sha384Digest.digest();
        // Create a JDK 17 HexFormat object
        HexFormat hex = HexFormat.of();
        // Use formatHex on the byte array to create a string (note that alphabet characters are
        lowercase)
        String hexString = hex.formatHex(output);
        ```

        For more information on DatatypeConverter see:
        https://docs.oracle.com/javase/9/docs/api/javax/xml/bind/DatatypeConverter.html#printHexBinary-byte:A-
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-704
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: Info
        shortDescription: Incorrect type conversion or cast
      patterns:
        - pattern-inside: |
            $B_ARR = (java.security.MessageDigest $MD).digest(...);
            ...
        - pattern-either:
            - pattern: |
                for(...) {
                  ...
                  $B = $B_ARR[...];
                  ...
                  Integer.toHexString($B);
                }
            - pattern: |
                for(...) {
                  ...
                  Integer.toHexString($B_ARR[...]);
                }
            - pattern: |
                for(byte $B :$B_ARR) {
                  ...
                  Integer.toHexString($B);
                }
            - pattern: |
                while(...) {
                  ...
                  Integer.toHexString($B_ARR[...])
                }
            - pattern: |
                do {
                  ...
                  Integer.toHexString($B_ARR[...])
                } while(...)
            - pattern: |
                while(...) {
                  ...
                  $B = $B_ARR[...];
                  ...
                  Integer.toHexString($B);
                }
            - pattern: |
                do {
                  ...
                  $B = $B_ARR[...];
                  ...
                  Integer.toHexString($B);
                } while(...)
      severity: WARNING
    - id: java_strings_rule-FormatStringManipulation
      languages:
        - java
      message: |
        The application allows user input to control format string parameters. By passing invalid
        format
        string specifiers an adversary could cause the application to throw exceptions or possibly
        leak
        internal information depending on application logic.

        Never allow user-supplied input to be used to create a format string. Replace all format
        string
        arguments with hardcoded format strings containing the necessary specifiers.

        Example of using `String.format` safely:
        ```
        // Get untrusted user input
        String userInput = request.getParameter("someInput");
        // Ensure that user input is not included in the first argument to String.format
        String.format("Hardcoded string expecting a string: %s", userInput);
        // ...
        ```
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Use of externally-controlled format string
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    String $INPUT = (HttpServletRequest $REQ).getParameter(...);
                    ...
                - pattern-inside: |
                    String $FORMAT_STR = ... + $INPUT;
                    ...
            - patterns:
                - pattern-inside: |
                    String $INPUT = (HttpServletRequest $REQ).getParameter(...);
                    ...
                - pattern-inside: |
                    String $FORMAT_STR = ... + $INPUT + ...;
                    ...
            - pattern-inside: |
                String $FORMAT_STR = ... + (HttpServletRequest $REQ).getParameter(...) + ...;
                ...
            - pattern-inside: |
                String $FORMAT_STR = ... + (HttpServletRequest $REQ).getParameter(...);
                ...
        - pattern-either:
            - pattern: String.format($FORMAT_STR, ...);
            - pattern: String.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: (java.util.Formatter $F).format($FORMAT_STR, ...);
            - pattern: (java.util.Formatter $F).format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: (java.io.PrintStream $F).printf($FORMAT_STR, ...);
            - pattern: (java.io.PrintStream $F).printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: (java.io.PrintStream $F).format($FORMAT_STR, ...);
            - pattern: (java.io.PrintStream $F).format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: System.out.printf($FORMAT_STR, ...);
            - pattern: System.out.printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: System.out.format($FORMAT_STR, ...);
            - pattern: System.out.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
      severity: ERROR
    - id: java_strings_rule-ModifyAfterValidation
      languages:
        - java
      message: |+
        The application was found matching a variable during a regular expression
        pattern match, and then calling string modification functions after validation has occurred.
        This is usually indicative of a poor input validation strategy as an adversary may attempt to
        exploit the removal of characters.

        For example a common mistake in attempting to remove path characters to protect against path
        traversal is to match '../' and then remove any matches. However, if an adversary were to
        include in their input: '....//' then the `replace`  method would replace the first `../` but
        cause the leading `..` and trailing `/` to join into the final string of `../`, effectively
        bypassing the check.

        To remediate this issue always perform string modifications before any validation of a string.
        It is strongly recommended that strings be encoded instead of replaced or removed prior to
        validation.


        Example replaces `..` before validation. Do note this is still not a recommended method for
        protecting against directory traversal, always use randomly generated IDs or filenames instead:
        ```
        // This is ONLY for demonstration purpose, never use untrusted input
        // in paths, always use randomly generated filenames or IDs.
        String input = "test../....//dir";
        // Use replaceAll _not_ replace
        input = input.replaceAll("\\.\\.", "");
        // Input would be test///dir at this point
        // Create a pattern to match on
        Pattern pattern = Pattern.compile("\\.\\.");
        // Create a matcher
        Matcher match = pattern.matcher(input);
        // Call find to see if .. is still in our string
        if (match.find()) {
            throw new Exception(".. detected");
        }
        // Use the input (but do not modify the string)
        System.out.println(input + " safe");
        ```

        For more information see Carnegie Mellon University's Secure Coding Guide:
        https://wiki.sei.cmu.edu/confluence/display/java/IDS11-J.+Perform+any+string+modifications+before+validation

      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-182
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Info
        shortDescription: Collapse of data into unsafe value
      patterns:
        - pattern: |
            (java.util.regex.Pattern $Y).matcher($VAR);
            ...
            $VAR.$METHOD(...);
        - metavariable-regex:
            metavariable: $METHOD
            regex: (replace|replaceAll|replaceFirst|concat)
      severity: WARNING
    - id: java_strings_rule-NormalizeAfterValidation
      languages:
        - java
      message: |
        The application was found matching a variable during a regular expression
        pattern match, and then calling a Unicode normalize function after validation has occurred.
        This is usually indicative of a poor input validation strategy as an adversary may attempt to
        exploit the normalization process.

        To remediate this issue, always perform Unicode normalization before any validation of a
        string.

        Example of normalizing a string before validation:
        ```
        // User input possibly containing malicious unicode
        String userInput = "\uFE64" + "tag" + "\uFE65";
        // Normalize the input
        userInput = Normalizer.normalize(userInput, Normalizer.Form.NFKC);
        // Compile our regex pattern looking for < or > characters
        Pattern pattern = Pattern.compile("[<>]");
        // Create a matcher from the userInput
        Matcher matcher = pattern.matcher(userInput);
        // See if the matcher matches
        if (matcher.find()) {
            // It did so throw an error
            throw new Exception("found banned characters in input");
        }
        ```

        For more information see Carnegie Mellon University's Secure Coding Guide:
        https://wiki.sei.cmu.edu/confluence/display/java/IDS01-J.+Normalize+strings+before+validating+them
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-180
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Info
        shortDescription: 'Incorrect behavior order: validate before canonicalize'
      patterns:
        - pattern: |
            $Y = java.util.regex.Pattern.compile("[<>]");
            ...
            $Y.matcher($VAR);
            ...
            java.text.Normalizer.normalize($VAR, ...);
      severity: WARNING
    - id: java_templateinjection_rule-TemplateInjection
      languages:
        - java
      message: |
        The application may allow control over a template string. Providing user input directly in the
        template by
        dynamically creating template strings may allow an adversary to execute arbitrary Java code,
        including
        OS system commands.

        For Velocity, never call `evaluate` with user-supplied input in the template string. Use a
        `VelocityContext`
        object instead to data-bind user-supplied information as it will be treated as an underlying
        data type and not
        template code.

        Example using Apache Velocity's `VelocityContext` and escape tools to pass in user-supplied
        data to a template:
        ```
        // Create a tool manager
        ToolManager manager = new ToolManager(true);
        // Create a context from the tool manager
        Context context = manager.createContext();
        // For demonstration purposes, alternatively configure from a properties file
        context.put("esc", new EscapeTool());
        // For demonstration purposes, create an output buffer
        StringWriter stringWriter = new StringWriter();
        // Get userInput
        String userInput = "potentially malicious data";
        // Use the context to pass in the userInput value
        context.put("userInput", userInput);
        // Pass in the context, the output buffer, a logtag (demo), and the template with userInput
        // making sure to escape it if in the context of HTML.
        Velocity.evaluate(context, stringWriter, "demo", "Hello $esc.html($userInput)");
        // Work with the output buffer
        // ...
        ```

        For other templating engines, please see your framework's documentation.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper control of generation of code ('Code Injection')
      pattern-either:
        - patterns:
            - pattern: org.apache.velocity.app.Velocity.evaluate(..., $VAR)
            - pattern-not: org.apache.velocity.app.Velocity.evaluate(..., "...")
        - patterns:
            - pattern-not-inside: |
                $C = (freemarker.template.Configuration $CFG).getTemplate("...");
                ...
            - pattern-inside: |
                $C = (freemarker.template.Configuration $CFG).getTemplate($IN);
                ...
            - pattern: $C.process(...)
        - patterns:
            - pattern-inside: |
                import com.mitchellbosecke.pebble.PebbleEngine;
                ...
            - pattern-inside: |
                $C = $T.getTemplate($IN);
                ...
            - pattern-not-inside: |
                $C = $T.getTemplate("...");
                ...
            - pattern: $C.evaluate(...)
      severity: ERROR
    - id: java_xml_rule-SAMLIgnoreComments
      languages:
        - java
      message: "SAML parses attestations as an XML document. By processing XML comments, comment\nfields can end up modifying the interpretation of input fields. This could allow\nan adversary to insert an XML comment to break up the attestation's username\nor other fields, allowing an attacker to bypass authorization or authentication checks.\n\nTo remediate this issue, when using `org.opensaml.xml.parse.BasicParserPool` ensure\n`setIgnoreComments(false)` is not called.\n\nThe default value of `ignoreComments` is true, which is safe. \n\nRef:\n- https://javadoc.io/doc/org.opensaml/xmltooling/latest/org/opensaml/xml/parse/BasicParserPool.html#ignoreComments\n\nFor more information on how this issue can be exploited see:\nhttps://developer.okta.com/blog/2018/02/27/a-breakdown-of-the-new-saml-authentication-bypass-vulnerability\n\nFor more information on SAML security see OWASP:\nhttps://cheatsheetseries.owasp.org/cheatsheets/SAML_Security_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-1390
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Weak authentication
      pattern: (org.opensaml.xml.parse.BasicParserPool $POOL).setIgnoreComments(false);
      severity: WARNING
    - id: java_xml_rule-XmlDecoder
      languages:
        - java
      message: |
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows
        the application to specify exactly which object types are allowed to be deserialized.
        Additionally, when
        deserializing, never deserialize to base object types like `Object` and only cast to the exact
        object
        type that is expected.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Do note that `XMLEncoder` and `XMLDecoder` are not recommended. If the application must
        use this serialization method, use a custom ClassLoader to prevent loading of arbitrary
        classes:
        ```
        XMLDecoder decoder = new XMLDecoder(inputStream, null, null, new ClassLoader() {
            @Override
            protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
                if (!name.equals(NameOfBeanHere.class.getName()) &&
        !name.equals(XMLDecoder.class.getName())) {
                    throw new RuntimeException("Unauthorized deserialization attempt: " + name);
                }

                return super.loadClass(name, resolve);
            }
        });
        ```

        For more information on XML security see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java

        For more details on deserialization attacks in general, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html

        It should be noted that [tools exist](https://github.com/frohoff/ysoserial) to
        automatically create
        exploit code for these vulnerabilities.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      patterns:
        - pattern: |
            (java.beans.XMLDecoder $D).readObject();
        - pattern-not:
            pattern-either:
                - patterns:
                    - pattern-inside: |
                        java.beans.XMLDecoder $DEC = new java.beans.XMLDecoder(..., $CL);
                        ...
                    - pattern: $DEC.readObject();
                    - metavariable-pattern:
                        metavariable: $CL
                        patterns:
                            - pattern: |
                                new ClassLoader(){
                                  ...
                                  $RET loadClass(String name, boolean resolve){
                                    if($X){
                                      throw ...
                                    }
                                    ...
                                  }
                                  ...
                                }
                            - metavariable-pattern:
                                metavariable: $X
                                pattern-either:
                                    - pattern: |
                                        !name.equals(...)
                                    - pattern: |
                                        !$LIST.contains(name)
                - patterns:
                    - pattern-inside: |
                        ClassLoader $CLASS_LOADER = $CL;
                        ...
                        java.beans.XMLDecoder $DEC = new java.beans.XMLDecoder(..., $CLASS_LOADER);
                        ...
                    - pattern: $DEC.readObject();
                    - metavariable-pattern:
                        metavariable: $CL
                        patterns:
                            - pattern: |
                                new ClassLoader(){
                                  ...
                                  $RET loadClass(String name, boolean resolve){
                                    if($X){
                                      throw ...
                                    }
                                    ...
                                  }
                                  ...
                                }
                            - metavariable-pattern:
                                metavariable: $X
                                pattern-either:
                                    - pattern: |
                                        !name.equals(...)
                                    - pattern: |
                                        !$LIST.contains(name)
      severity: WARNING
    - id: java_xml_rule-XsltTransform
      languages:
        - java
      message: |
        The application performs XSLT translation with potentially malicious input. An adversary who
        is able to influence the
        loaded
        XSL document could call XSL functions or exploit External XML Entity (XXE) attacks that allow
        file
        retrieval or force the parser to connect to arbitrary servers to exfiltrate files. It is
        strongly
        recommended that an alternative approach is used to work with XML data.

        For increased security, never process user-supplied XSL style sheets. If XSLT processing is
        absolutely
        necessary, ensure that `FEATURE_SECURE_PROCESSING` is enabled prior to processing the XSLT
        file:
        ```
        // Create a new TransformerFactory instance
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        // Enable the FEATURE_SECURE_PROCESSING feature
        transformerFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
        // Read in the XML Source
        Source xmlSource = new StreamSource(new FileInputStream("hardcoded.xml"));
        // Read in the XSL template file
        Source xslSource = new StreamSource(new FileInputStream("hardcoded.xsl"));
        /// Create the transformer object to do the transformation
        Transformer transformer = transformerFactory.newTransformer(xslSource);
        // Create a Result object for output
        Result result = new StreamResult(System.out);
        // Execute the transformation process
        transformer.transform(xmlSource, result);
        ```

        For more information on XML security see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java

        For more information on the secure processing feature see:
        - https://xml.apache.org/xalan-j/features.html#secureprocessing
      metadata:
        category: security
        cwe: CWE-91
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: XML injection (aka Blind XPath injection)
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: (javax.xml.transform.TransformerFactory $T).newTransformer($SRC, ...)
                - pattern-inside: (javax.xml.transform.Transformer $T).transform($SRC, ...)
            - pattern: $SRC
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $FUNC(...,String $VAR, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: new FileInputStream(<... $VAR ...>);
                        - pattern: getClass().getResourceAsStream(<... $VAR ...>)
                - patterns:
                    - pattern-inside: |
                        class $CLZ {
                          String $X = "...";
                          ...
                        }
                    - pattern-inside: |
                        $FUNC(...,String $Y, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: new FileInputStream($X + $Y);
                        - pattern: getClass().getResourceAsStream($X + $Y)
      severity: WARNING
    - id: java_xss_rule-WicketXSS
      languages:
        - java
      message: |
        The application is disabling Wicket's string escaping functionality by calling
        `setEscapeModelStrings(false)`.
        This could lead to Cross Site Scripting (XSS) if used with user-supplied input. XSS is an
        attack which exploits
         a web application or system to treat    user input
        as markup or script code. It is important to encode the data depending on the specific context
        it
        is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as JavaScript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Use Wicket's built in escaping feature by calling `Component.setEscapeModelStrings(true);`

        For more information on Wicket components see:
        - https://nightlies.apache.org/wicket/apidocs/9.x/org/apache/wicket/Component.html

        For more information on XSS see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      patterns:
        - pattern-inside: |
            import org.apache.wicket.$A;
            ...
        - pattern: |
            $OBJ.setEscapeModelStrings(false);
      severity: WARNING
    - id: java_xss_rule-XSSReqParamToServletWriter
      languages:
        - java
      message: |
        The application is returning user-supplied data from an HTTP request directly into an HTTP
        response output
        writer. This could lead to Cross Site Scripting (XSS) if the input were malicious
        script code and the application server is not properly validating the output.

        XSS is an attack which exploits a web application or system to treat user input
        as markup or script code. It is important to encode the data depending on the specific context
        it is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        If possible do not use user input directly in the output to the response writer.

        If the application must output user-supplied input, it will need to encode the data depending
        on
        the output context.

        Consider using [Apache Commons Text](https://commons.apache.org/proper/commons-text/)
        `StringEscapeUtils` methods for various context. Please note there is no way to safely
        output script code in most circumstances, regardless of encoding. If calling the HTTP
        response writer directly, ensure that the `Content-Type` is set to `text/plain` so it will
        not be accidentally interpreted by HTML by modern browsers.
        ```
        // Get user input
        String htmlInput = request.getParameter("userInput");
        // Encode the input using the Html4 encoder
        String htmlEncoded = StringEscapeUtils.escapeHtml4(htmlInput);
        // Force the HTTP response to be content type of text/plain so it is not interpreted as HTML
        response.setContentType("text/plain");
        // Ensure UTF-8
        response.setCharacterEncoding("UTF-8");
        // Write response
        response.getWriter().write(htmlEncoded);
        ```

        For more information on XSS see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - java
      mode: taint
      pattern-propagators:
        - from: $X
          pattern: $LIST.add($X)
          to: $LIST
        - from: $X
          pattern: $MAP.put(..., $X)
          to: $MAP
        - from: $X
          pattern: $STR.concat($X)
          to: $STR
        - from: $X
          pattern: $STR = String.format(..., $X, ...)
          to: $STR
        - from: $X
          pattern: $STR = String.join(..., $X, ...)
          to: $STR
      pattern-sanitizers:
        - pattern: org.owasp.encoder.Encode.forHtml(...)
        - pattern: org.owasp.esapi.ESAPI.encoder().encodeForHTML(...)
        - pattern: org.apache.commons.text.StringEscapeUtils.escapeHtml3(...)
        - pattern: org.apache.commons.text.StringEscapeUtils.escapeHtml4(...)
        - pattern: org.owasp.benchmark.helpers.Utils.encodeForHTML(...)
      pattern-sinks:
        - pattern: (javax.servlet.http.HttpServletResponse $R).getWriter().print(...)
        - patterns:
            - pattern-inside: |
                $W = (javax.servlet.http.HttpServletResponse $R).getWriter();
                ...
            - pattern: $W.print(...);
        - pattern: (javax.servlet.http.HttpServletResponse $R).getWriter().println(...)
        - patterns:
            - pattern-inside: |
                $W = (javax.servlet.http.HttpServletResponse $R).getWriter();
                ...
            - pattern: $W.println(...);
        - pattern: (javax.servlet.http.HttpServletResponse $R).getWriter().format(...)
        - patterns:
            - pattern-inside: |
                $W = (javax.servlet.http.HttpServletResponse $R).getWriter();
                ...
            - pattern: $W.format(...);
        - pattern: (javax.servlet.http.HttpServletResponse $R).getWriter().append(...)
        - patterns:
            - pattern-inside: |
                $W = (javax.servlet.http.HttpServletResponse $R).getWriter();
                ...
            - pattern: $W.append(...);
        - pattern: (javax.servlet.http.HttpServletResponse $R).getWriter().write(...)
        - patterns:
            - pattern-inside: |
                $W = (javax.servlet.http.HttpServletResponse $R).getWriter();
                ...
            - pattern: $W.write(...);
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $R).$METHOD(...)
        - pattern: (java.util.Scanner $S).$METHOD(...)
        - pattern: (java.util.stream.Stream).$METHOD(...)
        - pattern: (java.util.StringJoiner $SJ).toString(...)
        - pattern: (java.sql.ResultSet.getString $R).$METHOD(...)
        - pattern: (java.lang.System $S).getProperty(...)
        - pattern: (java.lang.System $S).getenv(...)
        - pattern: (java.lang.StringBuilder $SB).toString(...)
        - pattern: (java.io.FileInputStream $F).read(...)
        - pattern: (java.io.FileReader $F).read(...)
        - pattern: (java.net.Socket $S).getInputStream(...)
        - pattern: (java.net.Socket $S).getOutputStream(...)
        - pattern: (java.net.DatagramSocket $S).receive(...)
        - pattern: (java.net.DatagramSocket $S).getInputStream(...)
        - pattern: java.nio.file.Files.readAllBytes(...)
        - pattern: java.nio.file.Files.readAllLines(...)
        - pattern: java.nio.file.Files.lines(...)
        - pattern: java.nio.file.Files.newBufferedReader(...)
        - pattern: org.apache.commons.io.IOUtils.toString(...)
        - pattern: org.apache.commons.io.IOUtils.readLines(...)
        - pattern: org.apache.commons.io.IOUtils.toByteArray(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).readValue(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).treeToValue(...)
        - pattern: $CLASS.$METHOD(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - pattern: $FUNC(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - patterns:
            - pattern-inside: $FUNC(..., String $X, ...) { ... }
            - focus-metavariable: $X
      severity: WARNING
    - id: java_xxe_rule-XMLRdr
      languages:
        - java
      message: |
        External XML entities are a feature of XML parsers that allow documents to contain references
        to
        other documents or data. This feature can be abused to read files, communicate with external
        hosts,
        exfiltrate data, or cause a Denial of Service (DoS).

        The XMLReaderFactory has been deprecated. It is recommended that
        [SAXParserFactory](https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html)
        be used
        instead. Additionally when using the SAXParser it must be configured to disallow doctypes,
        which will
        protect against the majority of XXE attacks.

        Example creating a SAXParser with disallowing the doctypes feature enabled:
        ```
        // Create a SAXParserFactory
        SAXParserFactory saxParserFactory = SAXParserFactory.newInstance();
        // Enable the feature which disallows <!DOCTYPE declarations which includes referencing
        external entities.
        saxParserFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
        // Create a new parser from this factory
        SAXParser parser = saxParserFactory.newSAXParser();
        // Parse the XML file, passing in a DefaultHandler (which also includes an empty entityResolve
        method)
        parser.parse(new FileInputStream(new File("bad.xml")), new DefaultHandler());
        ```

        For more information on XML security see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      patterns:
        - pattern-inside: |
            $R = XMLReaderFactory.createXMLReader();
            ...
        - pattern-not-inside: |
            $R.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
            ...
        - pattern: $R.parse(...);
      severity: ERROR
    - id: javascript_dos_rule-non-literal-regexp
      languages:
        - javascript
        - typescript
      message: "The `RegExp` constructor was called with a non-literal value. If an adversary were able to\nsupply a malicious regex, they could cause a Regular Expression Denial of Service (ReDoS)\nagainst the application. In Node applications, this could cause the entire application to no\nlonger be responsive to other users' requests.\n\nTo remediate this issue, never allow user-supplied regular expressions. Instead, the regular \nexpression should be  hardcoded. If this is not possible, consider using an alternative regular\nexpression engine such as [node-re2](https://www.npmjs.com/package/re2). RE2 is a safe alternative \nthat does not support backtracking, which is what leads to ReDoS.\n\nExample using re2 which does not support backtracking (Note: it is still recommended to\nnever use user-supplied input):\n```\n// Import the re2 module\nconst RE2 = require('re2');\n\nfunction match(userSuppliedRegex, userInput) {\n    // Create a RE2 object with the user supplied regex, this is relatively safe\n    // due to RE2 not supporting backtracking which can be abused to cause long running\n    // queries\n    var re = new RE2(userSuppliedRegex);\n    // Execute the regular expression against some userInput\n    var result = re.exec(userInput);\n    // Work with the result\n}\n```\n\nFor more information on Regular Expression DoS see:\n- https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS\n"
      metadata:
        category: security
        cwe: CWE-185
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Regular expression with non-literal value
      pattern-either:
        - patterns:
            - pattern: |
                new RegExp(...)
            - pattern-not: |
                new RegExp("...", ...)
            - pattern-not: |
                new RegExp(/.../, ...)
        - patterns:
            - pattern: |
                RegExp(...)
            - pattern-not: |
                RegExp("...", ...)
            - pattern-not: |
                RegExp(/.../, ...)
        - patterns:
            - pattern: |
                "...".$METHOD(...)
            - pattern-not: |
                "...".$METHOD("...")
            - pattern-not: |
                "...".$METHOD(/.../)
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(match|search)$
      severity: WARNING
    - id: javascript_eval_rule-eval-with-expression
      languages:
        - javascript
        - typescript
      message: |
        The application was found calling the `eval` function OR Function()
          constructor OR setTimeout() OR setInterval() methods. If the

          variables or strings or functions passed to these methods contains user-supplied input, an adversary could attempt to execute arbitrary

          JavaScript

          code. This could lead to a full system compromise in Node applications or Cross-site Scripting

          (XSS) in web applications.


          To remediate this issue, remove all calls to above methods and consider alternative methods for

          executing

          the necessary business logic. There is almost no safe method of calling `eval` or other above stated sinks with

          user-supplied input.

          Instead, consider alternative methods such as using property accessors to dynamically access

          values.


          Example using property accessors to dynamically access an object's property:

          ```

          // Define an object

          const obj = {key1: 'value1', key2: 'value2'};

          // Get key dynamically from user input

          const key = getUserInput();

          // Check if the key exists in our object and return it, or a default empty string

          const value = (obj.hasOwnProperty(key)) ? obj[key] : '';

          // Work with the value

          ```


          For more information on why not to use `eval`, and alternatives see:

          - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#never_use_eval!

          Other References:

          - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/Function

          - https://developer.mozilla.org/en-US/docs/Web/API/setTimeout

          - https://developer.mozilla.org/en-US/docs/Web/API/setInterval
      metadata:
        category: security
        cwe: CWE-95
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-eval-with-expression.js
      patterns:
        - pattern-either:
            - patterns:
                - pattern: |
                    eval($OBJ)
                - pattern-not: |
                    eval("...")
            - patterns:
                - pattern: |
                    $A.eval($OBJ)
                - pattern-not: |
                    $A.eval("...")
            - patterns:
                - pattern: |
                    (..., eval)($OBJ)
                - pattern-not: |
                    (..., eval)("...")
            - patterns:
                - pattern: |
                    $ALIAS = eval;
                    ...
                    $ALIAS($OBJ)
                - pattern-not: |
                    $ALIAS = eval;
                    ...
                    $ALIAS("...")
            - pattern: |
                new Function(..., "..." + $OBJ + "...")
            - pattern: |
                $BODY = "..." + $OBJ + "..."
                ...
                new Function(..., $BODY)
            - pattern: |
                new Function(..., `...${...}...`)
            - pattern: |
                $BODY = `...${...}...`
                ...
                new Function(..., $BODY)
            - pattern: |
                Function(..., "..." + $OBJ + "...")
            - pattern: |
                $BODY = "..." + $OBJ + "..."
                ...
                Function(..., $BODY)
            - pattern: |
                $BODY = `...${...}...`
                ...
                Function(..., $BODY)
            - pattern: |
                Function(..., `...${...}...`)
            - pattern: |
                setTimeout("..." + $OBJ + "...", ...)
            - pattern: |
                setTimeout(`...${...}...`, ...)
            - pattern: |
                setInterval("..." + $OBJ + "...", ...)
            - pattern: |
                setInterval(`...${...}...`, ...)
        - pattern-not: |
            setTimeout("...", ...)
        - pattern-not: |
            setInterval("...", ...)
      severity: WARNING
    - id: javascript_pathtraversal_rule-non-literal-fs-filename
      languages:
        - typescript
        - javascript
      message: |
        The application dynamically constructs file or path information. If the path
        information comes from user-supplied input, it could be abused to read sensitive files,
        access other users' data, or aid in exploitation to gain further system access.

        User input should never be used in constructing paths or files for interacting
        with the filesystem. This includes filenames supplied by user uploads or downloads.
        If possible, consider hashing user input or using unique values and
        use `path.normalize` to resolve and validate the path information
        prior to processing any file functionality.

        Example using `path.normalize` and not allowing direct user input:
        ```
        // User input, saved only as a reference
        // id is a randomly generated UUID to be used as the filename
        const userData = {userFilename: userSuppliedFilename, id: crypto.randomUUID()};
        // Restrict all file processing to this directory only
        const basePath = '/app/restricted/';

        // Create the full path, but only use our random generated id as the filename
        const joinedPath = path.join(basePath, userData.id);
        // Normalize path, removing any '..'
        const fullPath = path.normalize(joinedPath);
        // Verify the fullPath is contained within our basePath
        if (!fullPath.startsWith(basePath)) {
            console.log("Invalid path specified!");
        }
        // Process / work with file
        // ...
        ```

        For more information on path traversal issues see OWASP:
        https://owasp.org/www-community/attacks/Path_Traversal
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-either:
            - pattern-inside: |
                import $MOD from $IMP
                ...
            - pattern-inside: |
                $MOD = require($IMP)
                ...
        - metavariable-comparison:
            comparison: $IMP in ['fs', 'node:fs', 'fs/promises', 'node:fs/promises', 'fs-extra']
            metavariable: $IMP
        - pattern-not: $MOD.appendFile("...", ...)
        - pattern-not: $MOD.appendFileSync("...", ...)
        - pattern-not: $MOD.chmod("...", ...)
        - pattern-not: $MOD.chmodSync("...", ...)
        - pattern-not: $MOD.chown("...", ...)
        - pattern-not: $MOD.chownSync("...", ...)
        - pattern-not: $MOD.createReadStream("...", ...)
        - pattern-not: $MOD.createWriteStream("...", ...)
        - pattern-not: $MOD.exists("...", ...)
        - pattern-not: $MOD.existsSync("...", ...)
        - pattern-not: $MOD.lchmod("...", ...)
        - pattern-not: $MOD.lchmodSync("...", ...)
        - pattern-not: $MOD.lchown("...", ...)
        - pattern-not: $MOD.lchownSync("...", ...)
        - pattern-not: $MOD.link("...", "...", ...)
        - pattern-not: $MOD.linkSync("...", "...", ...)
        - pattern-not: $MOD.lstat("...", ...)
        - pattern-not: $MOD.lstatSync("...", ...)
        - pattern-not: $MOD.mkdir("...", ...)
        - pattern-not: $MOD.mkdirSync("...", ...)
        - pattern-not: $MOD.open("...", ...)
        - pattern-not: $MOD.openSync("...", ...)
        - pattern-not: $MOD.readdir("...", ...)
        - pattern-not: $MOD.readdirSync("...", ...)
        - pattern-not: $MOD.readFile("...", ...)
        - pattern-not: $MOD.readFileSync("...", ...)
        - pattern-not: $MOD.readlink("...", ...)
        - pattern-not: $MOD.readlinkSync("...", ...)
        - pattern-not: $MOD.realpath("...", ...)
        - pattern-not: $MOD.realpathSync("...", ...)
        - pattern-not: $MOD.rename("...", "...", ...)
        - pattern-not: $MOD.renameSync("...", "...", ...)
        - pattern-not: $MOD.rmdir("...", ...)
        - pattern-not: $MOD.rmdirSync("...", ...)
        - pattern-not: $MOD.stat("...", ...)
        - pattern-not: $MOD.statSync("...", ...)
        - pattern-not: $MOD.symlink("...", "...", ...)
        - pattern-not: $MOD.symlinkSync("...", "...", ...)
        - pattern-not: $MOD.truncate("...", ...)
        - pattern-not: $MOD.truncateSync("...", ...)
        - pattern-not: $MOD.unlink("...", ...)
        - pattern-not: $MOD.unlinkSync("...", ...)
        - pattern-not: $MOD.unwatchFile("...", ...)
        - pattern-not: $MOD.utimes("...", ...)
        - pattern-not: $MOD.utimesSync("...", ...)
        - pattern-not: $MOD.watch("...", ...)
        - pattern-not: $MOD.watchFile("...", ...)
        - pattern-not: $MOD.writeFile("...", ...)
        - pattern-not: $MOD.writeFileSync("...", ...)
        - pattern-either:
            - pattern: $MOD.appendFile(...)
            - pattern: $MOD.appendFileSync(...)
            - pattern: $MOD.chmod(...)
            - pattern: $MOD.chmodSync(...)
            - pattern: $MOD.chown(...)
            - pattern: $MOD.chownSync(...)
            - pattern: $MOD.createReadStream(...)
            - pattern: $MOD.createWriteStream(...)
            - pattern: $MOD.exists(...)
            - pattern: $MOD.existsSync(...)
            - pattern: $MOD.lchmod(...)
            - pattern: $MOD.lchmodSync(...)
            - pattern: $MOD.lchown(...)
            - pattern: $MOD.lchownSync(...)
            - pattern: $MOD.link(...)
            - pattern: $MOD.linkSync(...)
            - pattern: $MOD.lstat(...)
            - pattern: $MOD.lstatSync(...)
            - pattern: $MOD.mkdir(...)
            - pattern: $MOD.mkdirSync(...)
            - pattern: $MOD.open(...)
            - pattern: $MOD.openSync(...)
            - pattern: $MOD.readdir(...)
            - pattern: $MOD.readdirSync(...)
            - pattern: $MOD.readFile(...)
            - pattern: $MOD.readFileSync(...)
            - pattern: $MOD.readlink(...)
            - pattern: $MOD.readlinkSync(...)
            - pattern: $MOD.realpath(...)
            - pattern: $MOD.realpathSync(...)
            - pattern: $MOD.rename(...)
            - pattern: $MOD.renameSync(...)
            - pattern: $MOD.rmdir(...)
            - pattern: $MOD.rmdirSync(...)
            - pattern: $MOD.stat(...)
            - pattern: $MOD.statSync(...)
            - pattern: $MOD.symlink(...)
            - pattern: $MOD.symlinkSync(...)
            - pattern: $MOD.truncate(...)
            - pattern: $MOD.truncateSync(...)
            - pattern: $MOD.unlink(...)
            - pattern: $MOD.unlinkSync(...)
            - pattern: $MOD.unwatchFile(...)
            - pattern: $MOD.utimes(...)
            - pattern: $MOD.utimesSync(...)
            - pattern: $MOD.watch(...)
            - pattern: $MOD.watchFile(...)
            - pattern: $MOD.writeFile(...)
            - pattern: $MOD.writeFileSync(...)
      severity: WARNING
    - id: javascript_react_rule-dangerouslysetinnerhtml
      languages:
        - typescript
        - javascript
      message: |
        The application was found calling `dangerouslySetInnerHTML` which may lead to Cross Site
        Scripting (XSS). By default, React components will encode the data properly before rendering.
        Calling `dangerouslySetInnerHTML` disables this encoding and allows raw markup
        and JavaScript to be executed.

        XSS is an attack which exploits a web application or system to treat
        user input as markup or script code. It is important to encode the data, depending on the
        specific context it is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Remove the call to `dangerouslySetInnerHTML` or ensure that the data used in this call does
        not come from user-supplied input.

        For more information on dangerously setting inner HTML see:
        - https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      pattern-either:
        - pattern: |
            <$X dangerouslySetInnerHTML=... />
        - pattern: |
            {dangerouslySetInnerHTML: ...}
      severity: WARNING
    - id: javascript_require_rule-non-literal-require
      languages:
        - javascript
        - typescript
      message: |
        The application was found to dynamically import a module by calling `require` using a
        non-literal string. An adversary might be able to read the first line of
        arbitrary files. If they had write access to the file system, they may also be able to
        execute arbitrary code.

        To remediate this issue, use a hardcoded string literal when calling `require`. Never call it
        it with dynamically created variables or user-supplied data.
      metadata:
        category: security
        cwe: CWE-95
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Low
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-non-literal-require.js
      patterns:
        - pattern: require($OBJ)
        - pattern-not: require('...')
      severity: WARNING
    - id: javascript_xss_rule-mustache-escape
      languages:
        - javascript
        - typescript
      message: |
        Markup escaping disabled. This can be used with some template engines to escape
        disabling of HTML entities, which can lead to XSS attacks.
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation (XSS)
      patterns:
        - pattern-inside: |
            $OBJ = require('mustache')
            ...
        - pattern-either:
            - pattern: |
                $OBJ.escape = function($TEXT) {
                  ...
                  return $TEXT;
                }
            - patterns:
                - metavariable-regex:
                    metavariable: $X
                    regex: '"\{\{\{(.+?)\}\}\}"'
                - pattern: $OBJ.render($X, ... )
            - patterns:
                - metavariable-regex:
                    metavariable: $Y
                    regex: '"\{\{\&(.+?)\}\}"'
                - pattern: $OBJ.render($Y, ... )
      severity: WARNING
    - id: python_crypto_rule-crypto-cipher-des
      languages:
        - python
      message: |
        DES, TripleDES, RC2 and RC4 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example using `ChaCha20Poly1305`:
        ```
        import os
        # Import ChaCha20Poly1305 from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = ChaCha20Poly1305.generate_key()
        # Create a new ChaCha20Poly1305 instance with our secure key
        chacha = ChaCha20Poly1305(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = chacha.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        chacha.decrypt(nonce, cipher_text, aad)
        ```

        Example using `AESGCM`:
        ```
        import os
        # Import AESGCM from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = AESGCM.generate_key(bit_length=128)
        # Create a new AESGCM instance with our secure key
        aesgcm = AESGCM(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = aesgcm.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        aesgcm.decrypt(nonce, cipher_text, aad)
        ```

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Cryptodome.Cipher.DES.new(...)
            - pattern: Crypto.Cipher.DES.new(...)
      severity: WARNING
    - id: python_crypto_rule-crypto-cipher-rc2
      languages:
        - python
      message: |
        DES, TripleDES, RC2 and RC4 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example using `ChaCha20Poly1305`:
        ```
        import os
        # Import ChaCha20Poly1305 from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = ChaCha20Poly1305.generate_key()
        # Create a new ChaCha20Poly1305 instance with our secure key
        chacha = ChaCha20Poly1305(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = chacha.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        chacha.decrypt(nonce, cipher_text, aad)
        ```

        Example using `AESGCM`:
        ```
        import os
        # Import AESGCM from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = AESGCM.generate_key(bit_length=128)
        # Create a new AESGCM instance with our secure key
        aesgcm = AESGCM(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = aesgcm.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        aesgcm.decrypt(nonce, cipher_text, aad)
        ```

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Cryptodome.Cipher.ARC2.new(...)
            - pattern: Crypto.Cipher.ARC2.new
      severity: WARNING
    - id: python_crypto_rule-crypto-cipher-rc4
      languages:
        - python
      message: |
        DES, TripleDES, RC2 and RC4 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example using `ChaCha20Poly1305`:
        ```
        import os
        # Import ChaCha20Poly1305 from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = ChaCha20Poly1305.generate_key()
        # Create a new ChaCha20Poly1305 instance with our secure key
        chacha = ChaCha20Poly1305(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = chacha.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        chacha.decrypt(nonce, cipher_text, aad)
        ```

        Example using `AESGCM`:
        ```
        import os
        # Import AESGCM from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = AESGCM.generate_key(bit_length=128)
        # Create a new AESGCM instance with our secure key
        aesgcm = AESGCM(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = aesgcm.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        aesgcm.decrypt(nonce, cipher_text, aad)
        ```

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Cryptodome.Cipher.ARC4.new(...)
            - pattern: Crypto.Cipher.ARC4.new(...)
      severity: WARNING
    - id: python_crypto_rule-crypto-cipher-xor
      languages:
        - python
      message: |
        The application was found using the `xor` algorithm, which can be trivially decoded.
        Newer algorithms apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example using `ChaCha20Poly1305`:
        ```
        import os
        # Import ChaCha20Poly1305 from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = ChaCha20Poly1305.generate_key()
        # Create a new ChaCha20Poly1305 instance with our secure key
        chacha = ChaCha20Poly1305(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = chacha.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        chacha.decrypt(nonce, cipher_text, aad)
        ```

        Example using `AESGCM`:
        ```
        import os
        # Import AESGCM from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = AESGCM.generate_key(bit_length=128)
        # Create a new AESGCM instance with our secure key
        aesgcm = AESGCM(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = aesgcm.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        aesgcm.decrypt(nonce, cipher_text, aad)
        ```

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Cryptodome.Cipher.XOR.new(...)
            - pattern: Crypto.Cipher.XOR.new(...)
      severity: WARNING
    - id: python_crypto_rule-crypto-hash-md5
      languages:
        - python
      message: |
        The application was found using an insecure or risky digest or signature algorithm. MD5
        and SHA1 hash algorithms have been found to be vulnerable to producing collisions.

        This means
        that two different values, when hashed, can lead to the same hash value. If the application is
        trying
        to use these hash methods for storing passwords, then it is recommended to switch to a
        password hashing
        algorithm such as Argon2id or PBKDF2.
        It is strongly recommended that a standard digest algorithm be chosen instead as implementing
        a custom algorithm is prone to errors.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example of creating a SHA-384 hash using the `cryptography` package:
        ```
        from cryptography.hazmat.primitives import hashes
        # Create a SHA384 digest
        digest = hashes.Hash(hashes.SHA384())
        # Update the digest with some initial data
        digest.update(b"some data to hash")
        # Add more data to the digest
        digest.update(b"some more data")
        # Finalize the digest as bytes
        result = digest.finalize()
        ```

        For more information on secure password storage see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Crypto.Hash.MD5.new(...)
            - pattern: Cryptodome.Hash.MD5.new (...)
      severity: WARNING
    - id: python_crypto_rule-crypto-hash-sha1
      languages:
        - python
      message: |
        The application was found using an insecure or risky digest or signature algorithm. MD5
        and SHA1 hash algorithms have been found to be vulnerable to producing collisions.

        This means
        that two different values, when hashed, can lead to the same hash value. If the application is
        trying
        to use these hash methods for storing passwords, then it is recommended to switch to a
        password hashing
        algorithm such as Argon2id or PBKDF2.
        It is strongly recommended that a standard digest algorithm be chosen instead as implementing
        a custom algorithm is prone to errors.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example of creating a SHA-384 hash using the `cryptography` package:
        ```
        from cryptography.hazmat.primitives import hashes
        # Create a SHA384 digest
        digest = hashes.Hash(hashes.SHA384())
        # Update the digest with some initial data
        digest.update(b"some data to hash")
        # Add more data to the digest
        digest.update(b"some more data")
        # Finalize the digest as bytes
        result = digest.finalize()
        ```

        For more information on secure password storage see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Crypto.Hash.SHA.new(...)
            - pattern: Cryptodome.Hash.SHA.new (...)
      severity: WARNING
    - id: python_crypto_rule-crypto-hazmat-cipher-arc4
      languages:
        - python
      message: |
        DES, TripleDES, RC2 and RC4 are all considered broken or insecure cryptographic algorithms.
        Newer algorithms apply message integrity to validate ciphertext has not been tampered
        with. Consider using `ChaCha20Poly1305` instead as it is easier and faster than the
        alternatives such as `AES-256-GCM`.

        For older applications that don't have support for `ChaCha20Poly1305`,
        `AES-256-GCM` is recommended, however it has many drawbacks:
        - Slower than `ChaCha20Poly1305`.
        - Catastrophic failure if nonce values are reused.

        Example using `ChaCha20Poly1305`:
        ```
        import os
        # Import ChaCha20Poly1305 from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = ChaCha20Poly1305.generate_key()
        # Create a new ChaCha20Poly1305 instance with our secure key
        chacha = ChaCha20Poly1305(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = chacha.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        chacha.decrypt(nonce, cipher_text, aad)
        ```

        Example using `AESGCM`:
        ```
        import os
        # Import AESGCM from cryptography
        from cryptography.hazmat.primitives.ciphers.aead import AESGCM
        # Our plaintext to encrypt
        plain_text = b"Secret text to encrypt"
        # We do not require authenticated but unencrypted data, so set to None
        aad = None
        # Generate a secure key
        key = AESGCM.generate_key(bit_length=128)
        # Create a new AESGCM instance with our secure key
        aesgcm = AESGCM(key)
        # Note: nonce values _must_ be regenerated every time they are used.
        nonce = os.urandom(12)
        # Encrypt our plaintext
        cipher_text = aesgcm.encrypt(nonce, plain_text, aad)
        # Decrypt the plain text using the nonce and cipher_text
        aesgcm.decrypt(nonce, cipher_text, aad)
        ```

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      pattern: cryptography.hazmat.primitives.ciphers.algorithms.ARC4(...)
      severity: WARNING
    - id: python_crypto_rule-hash-md2
      languages:
        - python
      message: |
        The application was found using an insecure or risky digest or signature algorithm. MD2, MD5
        and SHA1 hash algorithms have been found to be vulnerable to producing collisions.

        This means
        that two different values, when hashed, can lead to the same hash value. If the application is
        trying
        to use these hash methods for storing passwords, then it is recommended to switch to a
        password hashing
        algorithm such as Argon2id or PBKDF2.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example of creating a SHA-384 hash using the `cryptography` package:
        ```
        from cryptography.hazmat.primitives import hashes
        # Create a SHA384 digest
        digest = hashes.Hash(hashes.SHA384())
        # Update the digest with some initial data
        digest.update(b"some data to hash")
        # Add more data to the digest
        digest.update(b"some more data")
        # Finalize the digest as bytes
        result = digest.finalize()
        ```

        For more information on secure password storage see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: Crypto.Hash.MD2.new(...)
            - pattern: Cryptodome.Hash.MD2.new (...)
      severity: WARNING
    - id: python_crypto_rule-hash-md5
      languages:
        - python
      message: |
        The application was found using an insecure or risky digest or signature algorithm. MD2, MD4,
         MD5  and SHA1 hash algorithms have been found to be vulnerable to producing collisions.

        This means
        that two different values, when hashed, can lead to the same hash value. If the application is
        trying
        to use these hash methods for storing passwords, then it is recommended to switch to a
        password hashing
        algorithm such as Argon2id or PBKDF2.

        Note that the `Crypto` and `Cryptodome` Python packages are no longer recommended for
        new applications, instead consider using the [cryptography](https://cryptography.io/) package.

        Example of creating a SHA-384 hash using the `cryptography` package:
        ```
        from cryptography.hazmat.primitives import hashes
        # Create a SHA384 digest
        digest = hashes.Hash(hashes.SHA384())
        # Update the digest with some initial data
        digest.update(b"some data to hash")
        # Add more data to the digest
        digest.update(b"some more data")
        # Finalize the digest as bytes
        result = digest.finalize()
        ```

        For more information on secure password storage see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

        For more information on the cryptography module see:
        - https://cryptography.io/en/latest/
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Use of a broken or risky cryptographic algorithm
      pattern: hashlib.md5(...)
      severity: WARNING
    - id: python_deserialization_rule-cpickle
      languages:
        - python
      message: |
        The application was found using `cPickle` which is vulnerable to deserialization attacks.
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows
        the application to specify exactly which object types are allowed to be deserialized.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Example JSON deserializer using an intermediary type that is validated against a schema to
        ensure
        it is safe from mass assignment:
        ```
        import jsonschema

        # Create a schema to validate our user-supplied input against
        # an intermediary object
        intermediary_schema = {
            "type" : "object",
            "properties" :  {
                "name": {"type" : "string"}
            },
            "required": ["name"],
            # Protect against random properties being added to the object
            "additionalProperties": False,
        }
        # If a user attempted to add "'is_admin': True" it would cause a validation error
        intermediary_object = {'name': 'test user'}

        try:
            # Validate the user supplied intermediary object against our schema
            jsonschema.validate(instance=intermediary_object, schema=intermediary_schema)
            user_object = {'user':
                {
                    # Assign the deserialized data from intermediary object
                    'name': intermediary_object['name'],
                    # Add in protected data in object definition (or set it from a class constructor)
                    'is_admin': False,
                }
            }
            # Work with the user_object
        except jsonschema.exceptions.ValidationError as ex:
            # Gracefully handle validation errors
            # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      pattern: cPickle.$FUNC(...)
      severity: WARNING
    - id: python_deserialization_rule-dill
      languages:
        - python
      message: |
        The application was found using `dill` which is vulnerable to deserialization attacks.
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows
        the application to specify exactly which object types are allowed to be deserialized.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Example JSON deserializer using an intermediary type that is validated against a schema to
        ensure
        it is safe from mass assignment:
        ```
        import jsonschema

        # Create a schema to validate our user-supplied input against
        # an intermediary object
        intermediary_schema = {
            "type" : "object",
            "properties" :  {
                "name": {"type" : "string"}
            },
            "required": ["name"],
            # Protect against random properties being added to the object
            "additionalProperties": False,
        }
        # If a user attempted to add "'is_admin': True" it would cause a validation error
        intermediary_object = {'name': 'test user'}

        try:
            # Validate the user supplied intermediary object against our schema
            jsonschema.validate(instance=intermediary_object, schema=intermediary_schema)
            user_object = {'user':
                {
                    # Assign the deserialized data from intermediary object
                    'name': intermediary_object['name'],
                    # Add in protected data in object definition (or set it from a class constructor)
                    'is_admin': False,
                }
            }
            # Work with the user_object
        except jsonschema.exceptions.ValidationError as ex:
            # Gracefully handle validation errors
            # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      patterns:
        - pattern: dill.$FUNC(...)
        - pattern-not: dill.$FUNC("...")
      severity: WARNING
    - id: python_deserialization_rule-marshal
      languages:
        - python
      message: |
        The application was found using `dill` which is vulnerable to deserialization attacks.
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows
        the application to specify exactly which object types are allowed to be deserialized.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Example JSON deserializer using an intermediary type that is validated against a schema to
        ensure
        it is safe from mass assignment:
        ```
        import jsonschema

        # Create a schema to validate our user-supplied input against
        # an intermediary object
        intermediary_schema = {
            "type" : "object",
            "properties" :  {
                "name": {"type" : "string"}
            },
            "required": ["name"],
            # Protect against random properties being added to the object
            "additionalProperties": False,
        }
        # If a user attempted to add "'is_admin': True" it would cause a validation error
        intermediary_object = {'name': 'test user'}

        try:
            # Validate the user supplied intermediary object against our schema
            jsonschema.validate(instance=intermediary_object, schema=intermediary_schema)
            user_object = {'user':
                {
                    # Assign the deserialized data from intermediary object
                    'name': intermediary_object['name'],
                    # Add in protected data in object definition (or set it from a class constructor)
                    'is_admin': False,
                }
            }
            # Work with the user_object
        except jsonschema.exceptions.ValidationError as ex:
            # Gracefully handle validation errors
            # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      pattern-either:
        - pattern: marshal.dump(...)
        - pattern: marshal.dumps(...)
        - pattern: marshal.load(...)
        - pattern: marshal.loads(...)
      severity: WARNING
    - id: python_deserialization_rule-pickle
      languages:
        - python
      message: |
        The application was found using `pickle` which is vulnerable to deserialization attacks.
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows the application to specify exactly which object types are allowed to be deserialized.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Example JSON deserializer using an intermediary type that is validated against a schema to ensure
        it is safe from mass assignment:
        ```
        import jsonschema

        # Create a schema to validate our user-supplied input against
        # an intermediary object
        intermediary_schema = {
            "type" : "object",
            "properties" :  {
                "name": {"type" : "string"}
            },
            "required": ["name"],
            # Protect against random properties being added to the object
            "additionalProperties": False,
        }
        # If a user attempted to add "'is_admin': True" it would cause a validation error
        intermediary_object = {'name': 'test user'}

        try:
            # Validate the user supplied intermediary object against our schema
            jsonschema.validate(instance=intermediary_object, schema=intermediary_schema)
            user_object = {'user':
                {
                    # Assign the deserialized data from intermediary object
                    'name': intermediary_object['name'],
                    # Add in protected data in object definition (or set it from a class constructor)
                    'is_admin': False,
                }
            }
            # Work with the user_object
        except jsonschema.exceptions.ValidationError as ex:
            # Gracefully handle validation errors
            # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      patterns:
        - pattern-either:
            - patterns:
                - pattern: pickle.$METHOD(...)
                - pattern-not: pickle.$METHOD("...")
            - patterns:
                - pattern: _pickle.$METHOD(...)
                - pattern-not: _pickle.$METHOD("...")
        - metavariable-regex:
            metavariable: $METHOD
            regex: (load|loads|Unpickler)
      severity: WARNING
    - id: python_deserialization_rule-shelve
      languages:
        - python
      message: |
        The application was found using `shelve` which is vulnerable to deserialization attacks as
        it calls `pickle` internally.
        Deserialization attacks exploit the process of reading serialized data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format
        chosen allows
        the application to specify exactly which object types are allowed to be deserialized.

        To protect against mass assignment, only allow deserialization of the specific fields that are
        required. If this is not easily done, consider creating an intermediary type that
        can be serialized with only the necessary fields exposed.

        Example JSON deserializer using an intermediary type that is validated against a schema to
        ensure
        it is safe from mass assignment:
        ```
        import jsonschema

        # Create a schema to validate our user-supplied input against
        # an intermediary object
        intermediary_schema = {
            "type" : "object",
            "properties" :  {
                "name": {"type" : "string"}
            },
            "required": ["name"],
            # Protect against random properties being added to the object
            "additionalProperties": False,
        }
        # If a user attempted to add "'is_admin': True" it would cause a validation error
        intermediary_object = {'name': 'test user'}

        try:
            # Validate the user supplied intermediary object against our schema
            jsonschema.validate(instance=intermediary_object, schema=intermediary_schema)
            user_object = {'user':
                {
                    # Assign the deserialized data from intermediary object
                    'name': intermediary_object['name'],
                    # Add in protected data in object definition (or set it from a class constructor)
                    'is_admin': False,
                }
            }
            # Work with the user_object
        except jsonschema.exceptions.ValidationError as ex:
            # Gracefully handle validation errors
            # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      pattern-either:
        - pattern: shelve.$FUNC(...)
      severity: WARNING
    - id: python_deserialization_rule-yaml-load
      languages:
        - python
      message: |
        The application was found using an unsafe version of `yaml` load which is vulnerable to
        deserialization attacks. Deserialization attacks exploit the process of reading serialized
        data and turning it back
        into an object. By constructing malicious objects and serializing them, an adversary may
        attempt to:

        - Inject code that is executed upon object construction, which occurs during the
        deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized
        data but are read in during deserialization.

        To remediate this issue, use `safe_load()` or call `yaml.load()` with the `Loader` argument
        set to
        `yaml.SafeLoader`.

        Example loading YAML using `safe_load`:
        ```
        import yaml

        # Use safe_load to load data into an intermediary object
        intermediary_object = yaml.safe_load("""user:
            name: 'test user'"""
        )
        # Create our real object, copying over only the necessary fields
        user_object = {'user': {
                # Assign the deserialized data from intermediary object
                'name': intermediary_object['user']['name'],
                # Add in protected data in object definition (or set it from a class constructor)
                'is_admin': False,
            }
        }
        # Work with user_object
        # ...
        ```

        For more details on deserialization attacks in general, see OWASP's guide:
        - https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: High
        shortDescription: Deserialization of untrusted data
      patterns:
        - pattern-inside: |
            import yaml
            ...
        - pattern-not-inside: |
            from ruamel.yaml import YAML
            ...
        - pattern-either:
            - pattern: yaml.unsafe_load(...)
            - pattern: yaml.$LD(..., Loader=yaml.$LOADER, ...)
            - pattern: yaml.$LD($DATA)
        - metavariable-regex:
            metavariable: $LOADER
            regex: (Loader|UnsafeLoader|CLoader|FullLoader)
        - metavariable-regex:
            metavariable: $LD
            regex: (load|load_all)
      severity: ERROR
    - id: python_django_rule-django-extra-used
      languages:
        - python
      message: |
        SQL Injection is a critical vulnerability that can lead to data or system compromise. By
        dynamically generating SQL query strings, user input may be able to influence the logic of
        the SQL statement. This could lead to an adversary accessing information they should
        not have access to, or in some circumstances, being able to execute OS functionality or code.

        Replace all dynamically generated SQL queries with parameterized queries. In situations where
        dynamic queries must be created, never use direct user input, but instead use a map or
        dictionary of valid values and resolve them using a user supplied key.

        For example, some database drivers do not allow parameterized queries for `>` or `<` comparison
        operators. In these cases, do not use a user supplied `>` or `<` value, but rather have the
        user
        supply a `gt` or `lt` value. The alphabetical values are then used to look up the `>` and `<`
        values to be used in the construction of the dynamic query. The same goes for other queries
        where
        column or table names are required but cannot be parameterized.

        The `QuerySet.extra` API method will be deprecated as it a source of SQL Injection
        vulnerabilities and other problems. This method is especially risky as callers
        will need to do their own escaping of any parameters that come from user-supplied
        information.

        To remediate this issue, do not use `extra` but use other `QuerySet` methods to achieve
        the same goals. If for some reason this is not feasible, consider using the `RawSQL` method
        and making sure that all arguments, including user-supplied ones, are only used in
        `params`


        While not recommended due to [potential SQL
        Injection](https://docs.djangoproject.com/en/4.2/ref/models/expressions/#raw-sql-expressions),
        below is an example using `RawSQL`,
        passing in user-supplied data as a `param` which will escape the input:
        ```
        # If dealing with integer based user input, restrict the values to integers only using the
        # path configuration: path('<int:user_supplied_id>/someview/', views.some_view,
        name='someview'),

        # views.py
        def some_view(request, user_supplied_id):
          # Never use string interpolation in the `sql` parameter.
          # Never quote the `%s` string format such as `... where id='%s'` as this could lead to SQL
        Injection.
          # Pass the user supplied data only in the `params` parameter.
          for obj in DBObject.objects.all().annotate(
              val=RawSQL(sql="select id from some_secondary_table where id=%s",
        params=[user_supplied_id])):
            # Work with the results from the query
            # ...
        ```

        For more information on QuerySet see:
        - https://docs.djangoproject.com/en/4.2/ref/models/querysets/#queryset-api

        For more information on SQL Injection see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL Command ('SQL Injection')
      patterns:
        - pattern: $X.objects. ... .extra(..., $K = $V, ...)
        - pattern-not-inside: |
            $V = ['...']
            ...
        - metavariable-pattern:
            metavariable: $V
            patterns:
                - pattern: $V
                - pattern-not: '[..., ''...'', ...]'
                - pattern-not: '{..., ''...'': ''...'', ...}'
                - pattern-not: '"..."'
                - pattern-not: '[..., "..." % "...", ...]'
                - pattern-not: '{..., $L: "..." % "...", ...}'
                - pattern-not: '{..., $L: "...".format("..."), ...}'
                - pattern-not: '[..., "...".format("..."), ...]'
      severity: WARNING
    - id: python_escaping_rule-jinja2-autoescape-false
      languages:
        - python
      message: |
        The application was found using Jinja2 `Environment` without autoescaping enabled. If using in
        the context of HTML this could lead to Cross-Site Scripting (XSS) attacks when rendering with
        user-supplied input.

        Unfortunately, Jinja2 does not support context-aware escaping, meaning it is insufficient to
        protect against
        XSS for the various web contexts. It is important to encode the data depending on the specific
        context
        it
        is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        To handle different contexts, one approach would be to write custom Jinja2 filters. Below is
        an example
        that escapes or encodes links and potentially malicious script, note this does not include
        other contexts
        such as CSS or attributes:
        ```
        from jinja2 import Environment, select_autoescape, FileSystemLoader
        from jinja2 import pass_eval_context
        from markupsafe import Markup, escape

        @pass_eval_context
        def escape_link(eval_ctx, value):
            bad_link = "#JinjatmplZ"
            # Block any values that start with // as that could be used to inject
            # links to third party pages see:
        https://en.wikipedia.org/wiki/Wikipedia:Protocol-relative_URL
            if value.startswith('//'):
                return bad_link

            # Only allow relative links
            # if you want to allow links that start with http or ws replace with below:
            # if not value.startswith('/'): and not value.startswith('http') and not
        value.startswith('ws')
            if not value.startswith('/'):
                return bad_link

            # Alternatively, you could only call escape if autoescape is true
            # if eval_ctx.autoescape:
            #    return escape(value)
            # else
            #    return value

            return escape(value)

        # Create a replacement table
        js_replacement = str.maketrans({
                '"':  "\\u0022",
                '`':  "\\u0060",
                '&':  "\\u0026",
                '\'': "\\u0027",
                '+':  "\\u002b",
                '/':  "\\/",
                '<':  "\\u003c",
                '>':  "\\u003e",
                '\\': "\\\\",
                '(': "\\u0028",
                ')': "\\u0029",
            })

        @pass_eval_context
        def escape_js(eval_ctx, value):
            """
            Escape the input for use in <script> context, USE WITH CAUTION
            It is strongly recommended to _never_ pass user-supplied input to
            the JavaScript context. This may still be unsafe depending where
            used, it does not consider characters used  in regular expressions
            for example.
            """

            #if eval_ctx.autoescape:
            #    value = escape(value)
            # Escape by default
            value = escape(value)
            # Translate any potential characters using our translation table
            return value.translate(js_replacement)

        # Create our environment, setting autoescape to use the default
        # select_autoescape function
        env = Environment(
            loader=FileSystemLoader(os.getcwd()+"/template"),
            autoescape=select_autoescape,
        )
        # Add an escape link filter to be used in our template
        env.filters["escape_link"] = escape_link
        env.filters["escape_js"] = escape_js
        # Load our template file
        template = env.get_template("mytemplate.html")
        # Render with different variables which call our filters
        print(template.render(
            html_context="<img src=x onerror=alert(1)>",
            link_context="/# onclick=alert(1)<script>alert(1)</script>",
            script_context="alert(1);alert`1`",)
        )

        # Sample template:
        """
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <title>My Webpage</title>
        </head>
        <body>
            <h1>My Webpage</h1>
            {{ html_context }}
            <a href="{{ link_context | escape_link }}">link</a>
            <script>{{ script_context | escape_js }}</script>
        </body>
        </html>
        """
        ```

        For more information on autoescape see:
        - https://jinja.palletsprojects.com/en/3.1.x/api/#autoescaping

        For more information on XSS see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-116
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper encoding or escaping of output
      patterns:
        - pattern-inside: |
            import jinja2
            ...
        - pattern-not: jinja2.Environment(..., autoescape=True, ...)
        - pattern-not: jinja2.Environment(..., autoescape=jinja2.select_autoescape(...),...)
        - pattern-not: jinja2.Environment(..., autoescape=select_autoescape(...), ...)
        - pattern: jinja2.Environment(...)
      severity: WARNING
    - id: python_escaping_rule-use-of-mako-templates
      languages:
        - python
      message: "The application was found using mako templates without `default_filters`\nbeing passed to the `Template` or `TemplateLookup` constructors. If using \nin the context of HTML, this could lead to Cross-Site Scripting (XSS) attacks \nwhen rendering with user-supplied input.\n\nUnfortunately, Jinja2 does not support context-aware escaping, meaning it\nis insufficient to protect against XSS for the various web contexts. It is \nimportant to encode the data depending on the specific context it is used in. \nThere are at least six context types:\n\n- Inside HTML tags `<div>context 1</div>`\n- Inside attributes: `<div class=\"context 2\"></div>`\n- Inside event attributes `<button onclick=\"context 3\">button</button>`\n- Inside script blocks: `<script>var x = \"context 4\"</script>`\n- Unsafe element HTML assignment: `element.innerHTML = \"context 5\"`\n- Inside URLs: \n`<iframe src=\"context 6\"></iframe><a href=\"context 6\">link</a>`\n\nScript blocks alone have multiple ways they need to be encoded. Extra care\nmust be taken if user input is ever output inside of script tags.\n\nUser input that is displayed within the application must be encoded,\nsanitized or validated to ensure it cannot be treated as HTML or executed \nas Javascript code. Care must also be taken to not mix server-side templating \nwith client-side templating, as the server-side templating will not encode things \nlike {{ 7*7 }} which may execute client-side templating features.\n\nIt is _NOT_ advised to encode user input prior to inserting into a data\nstore. The data will need to be encoded depending on context of where it is output. \nIt is much safer to force the displaying system to handle the encoding and \nnot attempt to guess how it should be encoded.\n\nTo handle different contexts, one approach would be to write custom mako\nfilters. Below is an example that escapes or encodes links and \npotentially malicious script, note this does not include other contexts \nsuch as CSS or attributes:\n```\n# filters.py module:\n\ndef escape_link(value):\n    bad_link = \"#JinjatmplZ\"\n    # Block any values that start with // as that could be used to inject\n    # links to third party pages see:\nhttps://en.wikipedia.org/wiki/Wikipedia:Protocol-relative_URL\n    if value.startswith('//'):\n        return bad_link\n\n    # Only allow relative links\n    # if you want to allow links that start with http or ws replace with below:\n    # if not value.startswith('/'): and not value.startswith('http') and not\nvalue.startswith('ws')\n    if not value.startswith('/'):\n        return bad_link\n\n    return value\n\n# Create a replacement table\njs_replacement = str.maketrans({\n    '\\0': \"\\\\u0000\",\n    '\\t': \"\\\\t\",\n    '\\n': \"\\\\n\",\n    '\\v': \"\\\\u000b\",\n    '\\f': \"\\\\f`\",\n    '\\r': \"\\\\r\",\n    '\"':  \"\\\\u0022\",\n    '`':  \"\\\\u0060\",\n    '&':  \"\\\\u0026\",\n    '\\'': \"\\\\u0027\",\n    '+':  \"\\\\u002b\",\n    '/':  \"\\\\/\",\n    '<':  \"\\\\u003c\",\n    '>':  \"\\\\u003e\",\n    '\\\\': \"\\\\\\\\\",\n    '(': \"\\\\u0028\",\n    ')': \"\\\\u0029\",\n})\n\ndef escape_js(value):\n    # Escape the input for use in <script> context, USE WITH CAUTION\n    # It is strongly recommended to never pass user-supplied input to\n    # the JavaScript context.\n\n    # Translate any potential characters using our translation table\n    return value.translate(js_replacement)\n\n#####################################################################\n# main module:                                                      #\n#####################################################################\nfrom mako.template import Template\n\n# Define our template, note the calls to our custom filters depending\n# on context\ntemplate_text = \"\"\"\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>My Webpage</title>\n</head>\n<body>\n    <h1>My Webpage</h1>\n    ${html_context}\n    <a href=\"${link_context | escape_link}\">link</a>\n    <script>${script_context | escape_js}</script>\n</body>\n</html>\n\"\"\"\n\n# Load our template with default filters and our imported filters for\n# usage in template files\nt = Template(template_text,\n            # By default enable the html filter with 'h'\n            default_filters=['h'],\n            # Import our custom filters\n            imports=[\"from filters import escape_link, escape_js\"])\n\n# Render our template\nprint(t.render(html_context=\"<img src=x onerror=alert(1)>\",\n    link_context=\"/# onclick=alert(1)<script>alert(1)</script>\",\n    script_context=\"alert(1)<img src=x onerror=alert(1)>\",)\n)\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      patterns:
        - pattern-either:
            - pattern: mako.template.Template(...)
            - pattern: mako.lookup.TemplateLookup(...)
        - pattern-not: mako.lookup.TemplateLookup(..., default_filters=["..."])
        - pattern-not: mako.template.Template(..., default_filters=["..."])
      severity: WARNING
    - id: python_eval_rule-eval
      languages:
        - python
      message: "The application was found calling the `eval` function with non-literal data. If the variable contains \nuser-controlled data, either partially or fully, an adversary could compromise the entire system by \nexecuting arbitrary Python code.\n\nTo remediate this issue, remove all calls to `eval` and consider alternative methods for executing \nthe necessary business logic. There is almost no safe method of calling `eval` with user-supplied input.\n\nIf the application only needs to convert strings into objects, consider using `json.loads`. In \nsome cases `ast.literal_eval` is recommended, but this should be avoided as it can still suffer \nfrom other issues such as the ability for malicious code to crash the python interpreter or application.\n\nExample using `json.loads`` to load in arbitrary data to create data structures:\n```\n# User supplied data as a blob of JSON\nuser_supplied_data = \"\"\"{\"user\": \"test\", \"metadata\": [1,2,3]}\"\"\"\n# Load the JSON\nuser_object = json.loads(user_supplied_data)\n# Manually add protected properties _after_ loading, never before\nuser_object[\"is_admin\"] = False\n# Work with the object\n```\n"
      metadata:
        category: security
        cwe: CWE-95
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
      patterns:
        - pattern: eval($X,...)
        - pattern-not: |
            eval("...")
        - pattern-not: |
            eval("..." % <... "..." ...>)
        - pattern-not: |
            eval(<... "...".format( "..." ) ...>)
        - pattern-not-inside: |
            def eval(...):
              ...
            ...
      severity: WARNING
    - id: python_exec_rule-exec-used
      languages:
        - python
      message: "The application was found calling the `exec` function with a non-literal variable. If the\nvariable comes from user-supplied input, an adversary could compromise the entire system by\nexecuting arbitrary python code.\n\nTo remediate this issue, remove all calls to `exec` and consider alternative methods for\nexecuting the necessary business logic. There is almost no safe method of calling `eval` \nwith user-supplied input.\n\nIf the application only needs to convert strings into objects, consider using `json.loads`.\nIn some cases `ast.literal_eval` is recommended, but this should be avoided as it can still\nsuffer from other issues such as the ability for malicious code to crash the python\ninterpreter or application.\n\nExample using `json.loads`` to load in arbitrary data to create data structures:\n```\n# User supplied data as a blob of JSON\nuser_supplied_data = \"\"\"{\"user\": \"test\", \"metadata\": [1,2,3]}\"\"\"\n# Load the JSON\nuser_object = json.loads(user_supplied_data)\n# Manually add protected properties _after_ loading, never before\nuser_object[\"is_admin\"] = False\n# Work with the object\n```\n"
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
      patterns:
        - pattern: exec(...)
        - pattern-not: exec("...")
      severity: WARNING
    - id: python_exec_rule-start-process-with-no-shell
      languages:
        - python
      message: |
        Found dynamic content when spawning a process. This is dangerous if externaldata can reach this
        function call because it allows a malicious actor toexecute commands. Ensure no external data
        reaches here.
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS Command ('OS Command Injection')
      patterns:
        - pattern-either:
            - patterns:
                - pattern-not: os.$W("...", ...)
                - pattern-either:
                    - pattern: os.execl(...)
                    - pattern: os.execle(...)
                    - pattern: os.execlp(...)
                    - pattern: os.execlpe(...)
                    - pattern: os.execv(...)
                    - pattern: os.execve(...)
                    - pattern: os.execvp(...)
                    - pattern: os.execvpe(...)
                    - pattern: os.startfile(...)
            - patterns:
                - pattern-either:
                    - pattern: os.spawnl(...)
                    - pattern: os.spawnle(...)
                    - pattern: os.spawnlp(...)
                    - pattern: os.spawnlpe(...)
                    - pattern: os.spawnv(...)
                    - pattern: os.spawnve(...)
                    - pattern: os.spawnvp(...)
                    - pattern: os.spawnvpe(...)
      severity: WARNING
    - id: python_exec_rule-subprocess-shell-TRUE
      languages:
        - python
      message: |
        subprocess call - check for execution of untrusted input
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS Command ('OS Command Injection')
      patterns:
        - pattern-not: subprocess.$FUNC(..., shell=True, ...)
        - pattern: $FOO(..., shell=True, ...)
      severity: WARNING
    - id: python_files_rule-tarfile-unsafe-members
      languages:
        - python
      message: |
        The application may be vulnerable to a path traversal if it extracts untrusted archive files.
        This vulnerability is colloquially known as 'Zip Slip'. Archive files may contain folders
        which,
        when extracted, may write outside of the intended directory. This is exploited by including
        path traversal characters such as `../../other/directory` to overwrite or place files in system
        or application directories.

        Extra care must be taken when extracting archive files as there are numerous concerns:

        - If possible, generate unique filenames instead of using the archives file names, as it may be
        possible for users to overwrite files if the filenames are the same.
        - Validate file paths are written with a prefixed, known trusted directory.
        - Only process regular files and not symbolic links, as some applications may attempt to
        read/follow
        the symbolic link, leading to arbitrary file read / write vulnerabilities.

        Example of securely processing an archive file:
        ```
        import tarfile
        import uuid
        # import os

        tar = tarfile.open('some.tar')

        # Max number of allowed files in our archive
        max_files = 10
        # Max size for all files in archive
        max_size = 1024 * 1024 * 10 # 10MB
        # Max size per file in archive
        max_file_size = 1024 * 1024 # 1MB

        # Validate number of files in archive
        if len(tar.getmembers()) > max_files:
            raise Exception("Too many files in archive")

        total_size = 0
        # Loop over all files to see if we exceed max size
        # if so, do not process any of them.
        for f in tar.getmembers():
            total_size += f.size
            if total_size >= max_size:
                raise Exception("Archive files exceeded max file size")

        # Iterate over files now that we know the total size is within limits
        for f in tar.getmembers():
            # Internally this calls TarInfo.isreg() which ensures
            # the file is a regular file and not a sym link or directory
            if not f.isfile():
                continue

            # Optional, set a limit on each file size
            if f.size > max_file_size:
                raise Exception(f"File {f.name} too large: {f.size}")

            # If original names are required, ensure that only the
            # filename is used:
            # filename = os.path.basename(f.name)

            # More secure, generate a UUID4 value instead
            filename = uuid.uuid4().hex

            # Reset the archive filename to the basename
            # Newer versions of python (3.11.4+) should use:
            # new_tar = old_tar.replace(name=...new name...)
            f.name = filename

            # Extract the file into a restricted directory, with our
            # own user's attributes, not the file from the archive
            tar.extract(f, '/opt/app/restricted/', set_attrs=False)
        ```

        For more information on tarfile see:
        - https://docs.python.org/3/library/tarfile.html
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-inside: |
            import tarfile
            ...
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $TAR = tarfile.open(...)
                    ...
                - pattern-either:
                    - pattern: $TAR.extractall(...)
                    - pattern: tarfile.extractall(..., members=$TAR)
                    - pattern: $TAR.extractall(..., members=[])
            - patterns:
                - pattern: tarfile.extractall(...)
                - pattern: tarfile.extractall(..., members=[])
      severity: WARNING
    - id: python_log_rule-logging-config-insecure-listen
      languages:
        - python
      message: |
        The application was found calling the `logging.config.listen`` function, which provides the
        ability to listen for
        external configuration files over a socket server. This listen socket parses part of the
        configuration and calls
        `eval` on the supplied configuration file. A local user, or an adversary who is able to
        exploit
        a Server Side Request Forgery (SSRF) attack to communicate over localhost, would be able to
        execute arbitrary
        code by passing in a logging config that contains python code.

        To remediate the issue, remove the call to `logging.config.listen` method.

        For more information on the listen functionality see:
        - https://docs.python.org/3/library/logging.config.html#logging.config.listen
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper control of generation of code ('Code Injection')
      patterns:
        - pattern: logging.config.listen(...)
      severity: WARNING
    - id: python_sql_rule-hardcoded-sql-expression
      languages:
        - python
      message: |
        SQL Injection is a critical vulnerability that can lead to data or system compromise. By
        dynamically generating SQL query strings, user input may be able to influence the logic of
        the SQL statement. This could lead to an adversary accessing information they should
        not have access to, or in some circumstances, being able to execute OS functionality or code.

        Replace all dynamically generated SQL queries with parameterized queries. In situations where
        dynamic queries must be created, never use direct user input, but instead use a map or
        dictionary of valid values and resolve them using a user supplied key.

        For example, some database drivers do not allow parameterized queries for `>` or `<` comparison
        operators. In these cases, do not use a user supplied `>` or `<` value, but rather have the
        user
        supply a `gt` or `lt` value. The alphabetical values are then used to look up the `>` and `<`
        values to be used in the construction of the dynamic query. The same goes for other queries
        where
        column or table names are required but cannot be parameterized.

        Example using `PreparedStatement` queries:
        ```
        import sqlite3

        # Create a new database (in memory)
        con = sqlite3.connect(":memory:")
        # Get a cursor from the connection
        cur = con.cursor()
        # Create a tuple of the value to be used in the parameterized query
        params = ('user-input',)
        # execute the statement, passing in the params for the value
        cur.execute("select name from sqlite_master where name = ?", params)
        # work with the result
        result = cur.fetchall()
        ```

        For more information on SQL Injection see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL Command ('SQL Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $DB.execute(...)
            - pattern-not:
                pattern-either:
                    - pattern: $DB.execute("...")
                    - pattern: $DB.execute("$QUERY" % "...")
                    - pattern: $DB.execute("$QUERY" + "...")
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    "$QUERY" % ...
                - pattern: |
                    "$QUERY".format(...)
                - pattern: |
                    f"$QUERY{...}..."
                - pattern: |
                    "$QUERY" + ...
                - pattern: |
                    $TMP = "$QUERY"
                    ...
                    $SQL = $TMP + "..." % ...
                - pattern: "$SQL = \"$QUERY\"\n...\n$SQL += ...              \n"
            - metavariable-regex:
                metavariable: $QUERY
                regex: (?i)^(SELECT|INSERT|UPDATE|DELETE)\s
      severity: WARNING
    - id: python_ssh_rule-ssh-nohost-key-verification
      languages:
        - python
      message: |
        The application was found to ignore host keys. Host keys are important as
        they provide assurance that the client can prove that the host is trusted.
        By ignoring these host keys, it is impossible for the client to validate the
        connection is to a trusted host.

        To remediate this issue, remove the call to `set_missing_host_key_policy(...)` which
        sets the host key policy. Instead, load key files using either `load_system_host_keys`
        or `load_host_keys` to only allow known good hosts. By not setting a host key policy
        for unknown hosts, `paramiko`'s default policy is to use `RejectPolicy`.

        Example configuration connecting to a known, trusted host, and not allowing connections
        to unknown hosts:
        ```
        import paramiko

        # Create an SSH client
        with paramiko.SSHClient() as ssh:
            # Load the system host keys so we can confirm the
            # host we are connecting to is legitimate
            ssh.load_system_host_keys('/home/appuser/.ssh/known_hosts')

            # Connect to the remote host using our SSH private key
            ssh.connect(hostname='example.org',
                        port=22,
                        username='appuser',
                        key_filename='/home/appuser/.ssh/private_key')
        ```

        For more information on `set_missing_host_key_policy` see:
        - https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.set_missing_host_key_policy
      metadata:
        category: security
        cwe: CWE-322
        owasp:
            - A5:2017-Broken Access Control
            - A07:2021-Identification and Authentication Failures
        security-severity: Medium
        shortDescription: Key exchange without entity authentication
      patterns:
        - pattern-inside: |
            $CLIENT = paramiko.client.SSHClient(...)
            ...
            $CLIENT.set_missing_host_key_policy(...)
        - pattern-either:
            - pattern: paramiko.client.AutoAddPolicy
            - pattern: paramiko.client.WarningPolicy
      severity: ERROR
    - id: python_ssl_rule-req-no-certvalid
      languages:
        - python
      message: |
        The application was found using the `requests` module without configuring a timeout value for
        connections. The `verify=False` argument has been set, which effectively disables the
        validation
        of server certificates.

        This allows for an adversary who is in between the application and the target host to intercept
        potentially sensitive information or transmit malicious data.

        To remediate this issue either remove the `verify=False` argument, or set `verify=True`to each
        `requests` call.

        Example verifying server certificates for an HTTP GET request:
        ```
        # Issue a GET request to https://example.com with a timeout of 10 seconds and verify the
        # server certificate explicitly.
        response = requests.get('https://example.com', timeout=10, verify=True)
        # Work with the response object
        # ...
        ```

        For more information on using the requests module see:
        - https://requests.readthedocs.io/en/latest/api/
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Medium
        shortDescription: Improper certificate validation
      patterns:
        - pattern-either:
            - pattern: requests.put(..., verify=False, ...)
            - pattern: requests.patch(..., verify=False, ...)
            - pattern: requests.delete(..., verify=False, ...)
            - pattern: requests.head(..., verify=False, ...)
            - pattern: requests.options(..., verify=False, ...)
            - pattern: requests.request(..., verify=False, ...)
            - pattern: requests.get(..., verify=False, ...)
            - pattern: requests.post(..., verify=False, ...)
      severity: ERROR
    - id: python_ssl_rule-ssl-with-bad-version
      languages:
        - python
      message: |
        The application was found calling an SSL module with SSL or TLS protocols that have known
        deficiencies.
        It is strongly recommended that newer applications use TLS 1.2 or 1.3 and
        `SSLContext.wrap_socket`.

        If using the `pyOpenSSL` module, please note that it has been deprecated and the Python
        Cryptographic Authority
        strongly suggests moving to use the [pyca/cryptography](https://github.com/pyca/cryptography)
        module instead.

        To remediate this issue for the `ssl` module, create a new TLS context and pass in
        `ssl.PROTOCOL_TLS_CLIENT` for clients or `ssl.PROTOCOL_TLS_SERVER` for servers to the
        `ssl.SSLContext(...)` `protocol=`
        argument. When converting the socket to a TLS socket, use the new `SSLContext.wrap_socket`
        method instead.

        Example creating a TLS 1.3 client socket connection by using a newer version of Python
        (3.11.4) and
        the SSL module:
        ```
        import ssl
        import socket

        # Create our initial socket
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
            # Connect the socket
            sock.connect(('www.example.org', 443))

            # Create a new SSLContext with protocol set to ssl.PROTOCOL_TLS_CLIENT
            # This will auto-select the highest grade TLS protocol version (1.3)
            context = ssl.SSLContext(protocol=ssl.PROTOCOL_TLS_CLIENT)
            # Load our a certificates for server certificate authentication
            context.load_verify_locations('cert.pem')
            # Create our TLS socket, and validate the server hostname matches
            with context.wrap_socket(sock, server_hostname="www.example.org") as tls_sock:
                # Send some bytes over the socket (HTTP request in this case)\
                data = bytes('GET / HTTP/1.1\r\nHost: example.org\r\n\r\n', 'utf-8')
                sent_bytes = tls_sock.send(data)
                # Validate number of sent bytes
                # ...
                # Read the response
                resp = tls_sock.recv()
                # Work with the response
                # ...
        ```

        For more information on the ssl module see:
        - https://docs.python.org/3/library/ssl.html

        For more information on pyca/cryptography and openssl see:
        - https://cryptography.io/en/latest/openssl/
      metadata:
        category: security
        cwe: CWE-326
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Medium
        shortDescription: Inadequate Encryption Strength
      patterns:
        - pattern-either:
            - pattern: ssl.PROTOCOL_SSLv2
            - pattern: ssl.PROTOCOL_SSLv3
            - pattern: ssl.PROTOCOL_TLSv1
            - pattern: ssl.PROTOCOL_TLSv1_1
            - pattern: pyOpenSSL.SSL.SSLv2_METHOD
            - pattern: pyOpenSSL.SSL.SSLv23_METHOD
            - pattern: pyOpenSSL.SSL.SSLv3_METHOD
            - pattern: pyOpenSSL.SSL.TLSv1_METHOD
            - pattern: pyOpenSSL.SSL.TLSv1_1_METHOD
      severity: ERROR
    - id: python_ssl_rule-unverified-context
      languages:
        - python
      message: |
        The application was found creating a SSL context using the `_create_unverified_context`.
        This effectively disables the validation of server certificates.

        This allows for an adversary who is in between the application and the target host to intercept
        potentially sensitive information or transmit malicious data.

        To remediate this issue remove the call to `_create_unverified_context` and either create a
        default
        context using `ssl.create_default_context` or create a context with TLS 1.3.

        Example creating a TLS 1.3 client socket connection by using a newer version of Python
        (3.11.4) and
        the SSL module:
        ```
        import ssl
        import socket

        # Create our initial socket
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
            # Connect the socket
            sock.connect(('www.example.org', 443))

            # Create a new SSLContext with protocol set to ssl.PROTOCOL_TLS_CLIENT
            # This will auto-select the highest grade TLS protocol version (1.3)
            context = ssl.SSLContext(protocol=ssl.PROTOCOL_TLS_CLIENT)
            # Load our a certificates for server certificate authentication
            context.load_verify_locations('cert.pem')
            # Create our TLS socket, and validate the server hostname matches
            with context.wrap_socket(sock, server_hostname="www.example.org") as tls_sock:
                # Send some bytes over the socket (HTTP request in this case)\
                data = bytes('GET / HTTP/1.1\r\nHost: example.org\r\n\r\n', 'utf-8')
                sent_bytes = tls_sock.send(data)
                # Validate number of sent bytes
                # ...
                # Read the response
                resp = tls_sock.recv()
                # Work with the response
                # ...
        ```

        Unverified SSL context detected. This will permit insecure connections without `verifyingSSL`
        certificates. Use `ssl.create_default_context()` instead.
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Medium
        shortDescription: Improper certificate validation
      pattern: ssl._create_unverified_context(...)
      severity: ERROR
    - id: generic_injection_rule-BiDiTrojanSource
      languages:
        - generic
      message: "Unicode bidirectional (BiDi) control characters were detected in source code.\nThese characters can be used to reorder text and hide malicious code \n(CVE-2021-42574).\n\nBiDi override characters can make code appear different from its actual logic:\n- Text that appears as a comment might actually be executable code\n- Code that appears harmless might contain hidden malicious logic\n- Variable names and string literals may not reflect their true content\n\nMitigation Steps:\n- Remove any BiDi override characters\n- Only use standard ASCII characters in source code\n- If BiDi characters are required, thoroughly review the code\n\nSecure Code Example:\n```java\npublic class DataProcessor {\n    // Use standard ASCII characters only\n    public void processData(String data) {\n        String cleanInput = data.trim();  // Clean the input\n        System.out.println(\"Processing: \" + cleanInput);  // Clear, readable code\n    }\n}\n```\n\nReferences:\n- https://nvd.nist.gov/vuln/detail/CVE-2021-42574\n- https://trojansource.codes/\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A03:2021-Injection
            - A1:2017-Injection
        security-severity: Low
        shortDescription: Improper control of generation of code ('Code Injection')
      paths:
        include:
            - '*.py'
            - '*.js'
            - '*.java'
            - '*.c'
            - '*.cpp'
            - '*.cs'
            - '*.go'
            - '*.rs'
            - '*.php'
            - '*.rb'
            - '*.scala'
            - '*.ts'
            - '*.kt'
            - '*.m'
            - '*.swift'
      pattern-regex: '[\x{202A}-\x{202E}\x{2066}-\x{2069}\x{200E}\x{200F}\x{061C}]'
      severity: WARNING
    - id: java_deserialization_rule-InsecureDeserialization
      languages:
        - java
      message: |
        Deserialization attacks exploit the process of reading serialized data and turning it back into an
        object. By constructing malicious objects and serializing them, an adversary may attempt to:

        - Inject code that is executed upon object construction, which occurs during the deserialization process.
        - Exploit mass assignment by including fields that are not normally a part of the serialized data but are
          read in during deserialization.

        Consider safer alternatives such as serializing data in the JSON format. Ensure any format chosen allows
        the application to specify exactly which object types are allowed to be deserialized. Additionally, when
        deserializing, never deserialize to base object types like `Object` and only cast to the exact object
        type that is expected.

        To protect against mass assignment, only allow deserialization of the specific fields that are required.
        If this is not easily done, consider creating an intermediary type that can be serialized with only the
        necessary fields exposed.

        For more details on deserialization attacks in general, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: Medium
        shortDescription: Deserialization of Untrusted Data
        technology:
            - java
      mode: taint
      pattern-propagators:
        - from: $X
          pattern: $V = new ObjectInputStream($X)
          to: $V
      pattern-sinks:
        - pattern: $V.readObject(...)
      pattern-sources:
        - patterns:
            - pattern-inside: "$FUNC (..., byte[] $X, ...) { \n  ... \n}\n"
            - focus-metavariable: $X
      severity: WARNING
    - id: javascript_crypto_rule-NodeLibcurlSSLVerificationDisable
      languages:
        - javascript
      message: "The application was identified disabling the `SSL_VERIFYPEER` and/or the \n`SSL_VERIFYHOST` options of the node-libcurl library. These options control \nthe verification process of SSL/TLS certificates and hostnames. \n\n- SSL_VERIFYPEER: This option, when enabled, ensures that the SSL certificate \npresented by the server is valid and trusted by a Certificate Authority (CA) \nthat the client also trusts. This is crucial for verifying that the server with \nwhich the client is connecting is authenticated and its certificate is not forged.\n- SSL_VERIFYHOST: This option, when enabled, makes sure that the certificate's \ncommon name (CN) or one of its subject alternative names (SANs) matches the \nhost name in the URL being connected . This is essential for ensuring that \nthe client is communicating with the correct server and not another server \npresenting a valid certificate.\n\nDisabling these options compromises the security of SSL/TLS connections. It \nexposes the application to MITM attacks, where an attacker could intercept, \nread, or modify the data sent and received over what is assumed to be a secure \nconnection.\n\nMitigation Strategy:\nTo mitigate this vulnerability and ensure secure communication, enable SSL/TLS \ncertificate and hostname verification by setting `SSL_VERIFYPEER` to `1` or \n`true` and `SSL_VERIFYHOST` to `2`. These options are enabled by default as \nwell. This configuration ensures that the server's SSL certificate is validated \nagainst trusted CAs and that the hostname in the certificate matches the hostname \nthe client intends to communicate with.\n\nSecure Code Example:\n```\nconst { Curl } = require('node-libcurl')\nconst curl = new Curl()\ncurl.setOpt('SSL_VERIFYPEER', 1)\ncurl.setOpt('SSL_VERIFYHOST', 2)\ncurl.setOpt('URL', 'https://yourserver.com:443')\n```\n"
      metadata:
        category: security
        cwe: CWE-599
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Missing validation of OpenSSL certificate
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    $X.setOpt($SSL, 0)
                - pattern: |
                    $X.setOpt($SSL, false)
            - metavariable-pattern:
                metavariable: $SSL
                pattern-either:
                    - pattern: |
                        "SSL_VERIFYHOST"
                    - pattern: |
                        "SSL_VERIFYPEER"
                    - pattern: |
                        $Y.option.SSL_VERIFYHOST
                    - pattern: |
                        $Y.option.SSL_VERIFYPEER
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $Y = require('node-libcurl')
                    ...
                - pattern-inside: |
                    import { $Y } from 'node-libcurl'
                    ...
                - pattern-inside: |
                    import { $K as $Y } from 'node-libcurl'
                    ...
            - pattern: |
                $X = new $Y()
      severity: WARNING
    - id: kotlin_pathtraversal_rule-FilePathTraversal
      languages:
        - kotlin
      message: "The application is found using untrusted user input with file \noperations, which can potentially lead to Path Traversal vulnerabilities. \nPath traversal (also known as directory traversal) allows attackers to \naccess files and directories outside of intended boundaries by inserting \nspecial characters or sequences (like ../, ..\\\\, or URL-encoded variants) \nto navigate to arbitrary locations in the filesystem.\nThe vulnerability can lead to unauthorized access to sensitive files \n(configuration files, credentials), code execution (if attackers can write \nto or include executable files), information disclosure, or complete system \ncompromise.\n\nWhere possible, do not send user input to file operation methods. If that \ncannot be avoided, follow the below mitigation strategy:\n1. Validate and sanitize all user inputs used in file operations \n2. Use allowlisting approaches to validate file paths where possible\n3. Apply canonicalization before validation to prevent bypass techniques\n4. Restrict operations to a specific designated directory\n5. Use application-specific user accounts with limited privileges\n\nSecure Code Example:\n```\nfun safeWrite(filename: String, content: String) {\n    val baseDir = File(\"/safe-dir/\")\n    val target = File(baseDir, filename).canonicalFile\n\n    // Ensure the target path is within the allowed directory\n    if (!target.path.startsWith(baseDir.canonicalPath)) {\n        throw SecurityException(\"Invalid file path: $filename\")\n    }\n\n    FileWriter(target).use { writer ->\n        writer.write(content)\n    }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: High
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - kotlin
      mode: taint
      pattern-sinks:
        - pattern: java.io.File(...)
        - pattern: java.io.FileInputStream(...)
        - pattern: java.io.FileReader(...)
        - patterns:
            - pattern-either:
                - pattern: java.io.FileOutputStream($TAINT, ...)
                - pattern: java.io.FileWriter($TAINT, ...)
                - pattern: java.io.RandomAccessFile($TAINT, ...)
            - focus-metavariable: $TAINT
        - pattern: kotlin.io.path.Path(...)
      pattern-sources:
        - patterns:
            - patterns:
                - pattern-inside: |
                    import $IMPORT
                    ...
                - metavariable-regex:
                    metavariable: $IMPORT
                    regex: .*springframework.*
                - focus-metavariable: $VAR
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            fun $_(..., @$REQ(...) $VAR: $TYPE,...): $_ {
                              ...
                            }
                        - pattern-inside: |
                            fun $_(..., @$REQ $VAR: $TYPE,...): $_ {
                              ...
                            }
                    - metavariable-regex:
                        metavariable: $TYPE
                        regex: ^(?!(Int|Long|Float|Double|Char|Boolean))
                    - metavariable-regex:
                        metavariable: $REQ
                        regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute|RequestPart)
        - pattern: |
            ($REQ: javax.servlet.ServletRequest)
        - pattern: "($REQ: javax.servlet.http.HttpServletRequest)                  \n"
      severity: ERROR
    - id: python_exec_rule-subprocess-call-array
      languages:
        - python
      message: |
        subprocess call - check for execution of untrusted input
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an OS Command ('OS Command Injection')
      patterns:
        - pattern: |
            subprocess.$FUNC([..., $ARG, ...])
        - metavariable-pattern:
            metavariable: $ARG
            patterns:
                - pattern-not: |
                    "..."
                - pattern-not: |
                    '...'
      severity: WARNING
    - id: java_crypto_rule-DisallowOldTLSVersion
      languages:
        - java
      message: "This application sets the `jdk.tls.client.protocols` system property to\ninclude insecure TLS or SSL versions (SSLv3, TLSv1, TLSv1.1), which are\ndeprecated due to serious security vulnerabilities like POODLE attacks and\nsusceptibility to man-in-the-middle attacks. Continuing to use these\nprotocols can expose data to interception or manipulation. \n\nTo mitigate the issue, upgrade to TLSv1.2 or higher, which provide stronger \nencryption and improved security. Refrain from using any SSL versions as they \nare entirely deprecated.\n\nSecure Code Example:\n```\npublic void safe() {\n  java.lang.System.setProperty(\"jdk.tls.client.protocols\", \"TLSv1.3\");\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-326
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://stackoverflow.com/questions/26504653/is-it-possible-to-disable-sslv3-for-all-java-applications
        security-severity: MEDIUM
        shortDescription: Inadequate encryption strength
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      patterns:
        - pattern: $VALUE. ... .setProperty("jdk.tls.client.protocols", "$PATTERNS");
        - metavariable-pattern:
            language: generic
            metavariable: $PATTERNS
            patterns:
                - pattern-either:
                    - pattern-regex: ^(.*TLSv1|.*SSLv.*)$
                    - pattern-regex: ^(.*TLSv1,.*|.*TLSv1.1.*)
      severity: WARNING
    - id: java_crypto_rule-GCMNonceReuse
      languages:
        - java
      message: "GCM is a mode of operation for symmetric-key cryptographic block ciphers. GCM allows the usage of\nan initialization vector or nonce used to provide the initial state. The IV is an arbitrary number \nthat can be used just once in a cryptographic communication. Re use of initialization vectors \nnullifies their usage, as the initial state of all GCMs with the same vector will effectively be\nthe same.\n\nInstead of hard coding an initialization vector, it is recommended to use nextBytes() method from\njava.security.SecureRandom. This generates a user specified number of random bytes.\n\nExample using `java.security.SecureRandom`:\n```\nCipher cipher = Cipher.getInstance(\"AES/GCM/NoPadding\");\nSecretKeySpec keySpec = new SecretKeySpec(secretKey.getEncoded(), \"AES\");\n\n// Generate a new, random IV for each encryption operation\nSecureRandom secureRandom = new SecureRandom();\n// GCM standard recommends a 12-byte (96-bit) IV\nbyte[] iv = new byte[12];\nsecureRandom.nextBytes(iv);\n\nGCMParameterSpec gcmParameterSpec = new GCMParameterSpec(GCM_TAG_LENGTH * 8, iv);\ncipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmParameterSpec);\n```\n\nFor more information on Java Cryptography see:\nhttps://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html\n"
      metadata:
        category: security
        cwe: CWE-323
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Reuse of cryptographic initialization vector
        technology:
            - java
      mode: taint
      pattern-sinks:
        - pattern: new GCMParameterSpec(...,$NONCE, ...)
      pattern-sources:
        - pattern-either:
            - pattern: new byte[]{...};
            - pattern: $STRING.getBytes();
      severity: WARNING
    - id: java_crypto_rule-HTTPUrlConnectionHTTPRequest
      languages:
        - java
      message: "Detected an HTTP request sent via HttpURLConnection or URLConnection.\nThis could lead to sensitive information being sent over an insecure \nchannel, as HTTP does not encrypt data. Transmitting data over HTTP \nexposes it to potential interception by attackers, risking data \nintegrity and confidentiality. Using HTTP for transmitting sensitive \ndata such as passwords, personal information, or financial details can \nlead to information disclosure.\n\nTo mitigate the issue, switch to HTTPS to ensure all data transmitted \nis securely encrypted. This helps protect against eavesdropping and \nman-in-the-middle attacks. Modify the URL in your code from HTTP to \nHTTPS and ensure the server supports HTTPS.\n\nSecure Code Example:\n```\nprivate static void safe() {\n    try {\n        URL url = new URL(\"https://example.com/api/data\"); // Changed to HTTPS\n        HttpURLConnection con = (HttpURLConnection) url.openConnection();\n        con.setRequestMethod(\"GET\");\n\n        int status = con.getResponseCode();\n        if (status == HttpURLConnection.HTTP_OK) { \n            BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream()));\n            String inputLine;\n            StringBuilder response = new StringBuilder();\n            while ((inputLine = in.readLine()) != null) {\n                response.append(inputLine);\n            }\n            in.close();\n            System.out.println(\"Response: \" + response.toString());\n        } else {\n            System.out.println(\"HTTP error code: \" + status);\n        }\n        con.disconnect();\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      patterns:
        - pattern: |
            "=~/[Hh][Tt][Tt][Pp]://.*/"
        - pattern-either:
            - pattern-inside: |
                URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);
                ...
                $CON = (HttpURLConnection) $URL.openConnection(...);
                ...
                $CON.$FUNC(...);
            - pattern-inside: |
                URL $URL = new URL ("=~/[Hh][Tt][Tt][Pp]://.*/", ...);
                ...
                $CON = $URL.openConnection(...);
                ...
                $CON.$FUNC(...);
      severity: WARNING
    - id: java_crypto_rule-HttpComponentsRequest
      languages:
        - java
      message: "Detected an HTTP GET request sent via Apache HTTP Components. Sending data\nover HTTP can expose sensitive information to interception or modification\nby attackers, as HTTP does not encrypt the data transmitted. It is critical\nto use HTTPS, which encrypts the communication, to protect the confidentiality\nand integrity of data in transit.\n\nTo mitigate the issue, ensure all data transmitted between the client and \nserver is sent over HTTPS. Update all HTTP URLs to HTTPS and configure your \nserver to redirect HTTP requests to HTTPS. Additionally, implement HSTS \n(HTTP Strict Transport Security) to enforce secure connections.\nSecure Code Example:\n```\nprivate static void safe() {\n  CloseableHttpClient httpclient = HttpClients.createDefault();\n  CloseableHttpResponse response = httpclient.execute(new HttpPost(\"https://example.com\"));\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://hc.apache.org/httpcomponents-client-ga/quickstart.html
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      mode: taint
      pattern-sinks:
        - pattern: (org.apache.http.impl.client.CloseableHttpClient $A).execute($HTTPREQ);
      pattern-sources:
        - pattern: |
            "=~/^http://.+/i"
      severity: WARNING
    - id: java_crypto_rule-HttpGetHTTPRequest
      languages:
        - java
      message: "Detected an HTTP GET request sent via HttpGet. Sending data over HTTP can\nexpose sensitive information to interception or modification by attackers,\nas HTTP does not encrypt the data transmitted. It is critical to use\nHTTPS, which encrypts the communication, to protect the confidentiality\nand integrity of data in transit.\n\nTo mitigate the issue, ensure all data transmitted between the client and \nserver is sent over HTTPS. Update all HTTP URLs to HTTPS and configure your \nserver to redirect HTTP requests to HTTPS. Additionally, implement HSTS \n(HTTP Strict Transport Security) to enforce secure connections.\n\nSecure Code Example:\n```\nprivate static void safe() throws IOException {\n  HttpGet httpGet = new HttpGet(\"https://example.com\");\n  HttpClients.createDefault().execute(httpGet);\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URLConnection.html
            - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#openConnection()
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $R = new org.apache.http.client.methods.HttpGet($PROT);
                ...
                $CLIENT. ... .execute($R, ...);
            - focus-metavariable: $PROT
      pattern-sources:
        - pattern: |
            "=~/^http:\/\/.+/i"
      severity: WARNING
    - id: java_crypto_rule_JwtDecodeWithoutVerify
      languages:
        - java
      message: Detected the decoding of a JWT token without a verify step. JWT tokens must be verified before use, otherwise the token's integrity is unknown. This means a malicious actor could forge a JWT token with any claims. Call '.verify()' before using the token.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-347
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references: https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures
        security-severity: MEDIUM
        shortDescription: Improper verification of cryptographic signature
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory: vuln
        technology: jwt
        vulnerability_class: Improper Authentication
      patterns:
        - pattern: |
            com.auth0.jwt.JWT.decode(...);
        - pattern-not-inside: |-
            class $CLASS {
              ...
              $RETURNTYPE $FUNC (...) {
                ...
                $VERIFIER.verify(...);
                ...
              }
            }
      severity: WARNING
    - id: java_crypto_rule_JwtNoneAlgorithm
      languages:
        - java
      message: |
        Detected use of the 'none' algorithm in a JWT token. The 'none'
        algorithm assumes the integrity of the token has already been verified.
        This would allow a malicious actor to forge a JWT token that will
        automatically be verified. Do not explicitly use the 'none' algorithm.
        Instead, use an algorithm such as 'HS256'.

        For more information on how to securely use JWT please see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html
      metadata:
        asvs:
            control_id: 3.5.3 Insecue Stateless Session Tokens
            control_url: https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md#v35-token-based-session-management
            section: 'V3: Session Management Verification Requirements'
            version: "4"
        category: security
        confidence: LOW
        cwe: CWE-327
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        security-severity: CRITICAL
        shortDescription: Use of a broken or risky cryptographic algorithm
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - audit
        technology:
            - jwt
        vulnerability_class:
            - Cryptographic Issues
      pattern-either:
        - patterns:
            - pattern: |
                io.jsonwebtoken.Jwts.builder()
            - pattern-not-inside: |
                $RETURNTYPE $FUNC(...) {
                  ...
                  $JWTS.signWith(...);
                  ...
                }
        - pattern: |
            $J.sign(com.auth0.jwt.algorithms.Algorithm.none())
        - pattern: |
            new com.nimbusds.jose.PlainHeader(...);
        - pattern: |
            new com.nimbusds.jose.PlainHeader.Builder(). ... .build();
      severity: ERROR
    - id: java_crypto_rule-SpringFTPRequest
      languages:
        - java
      message: "This pattern detects configurations where the Spring Integration FTP plugin \nis used to set up connections to FTP servers. FTP is an insecure protocol \nthat transmits data, including potentially sensitive information, in plaintext. \nThis can expose personal identifiable information (PII) or other sensitive data \nto interception by attackers during transmission. \n\nTo mitigate the vulnerability, switch to a secure protocol such as SFTP or FTPS \nthat encrypts the connection to prevent data exposure. Ensure that any method \nused to set the host for an FTP session does not use plaintext FTP. \n\nSecure Code Example:\n```\npublic SessionFactory<FTPFile> safe(FtpSessionFactoryProperties properties) {\n  DefaultFtpSessionFactory ftpSessionFactory = new DefaultFtpSessionFactory();\n  ftpSessionFactory.setHost(\"sftp://example.com\");\n  ftpSessionFactory.setPort(properties.getPort());\n  ftpSessionFactory.setUsername(properties.getUsername());\n  ftpSessionFactory.setPassword(properties.getPassword());\n  ftpSessionFactory.setClientMode(properties.getClientMode().getMode());\n  return ftpSessionFactory;\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://docs.spring.io/spring-integration/api/org/springframework/integration/ftp/session/AbstractFtpSessionFactory.html#setClientMode-int-
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - spring
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                (org.springframework.integration.ftp.session.DefaultFtpSessionFactory
                $SF).setHost($URL);
            - focus-metavariable: $URL
      pattern-sources:
        - pattern: |
            "=~/^ftp://.+/i"
      severity: WARNING
    - id: java_crypto_rule-SpringHTTPRequestRestTemplate
      languages:
        - java
      message: "This rule detects instances where Java Spring's RestTemplate API sends \nrequests to non-secure (http://) URLs. Sending data over HTTP is vulnerable \nas it does not use TLS encryption, exposing the data to interception, \nmodification, or redirection by attackers. \n\nTo mitigate this vulnerability, modify the request URLs to use HTTPS instead, \nwhich ensures that the data is encrypted during transit and prevents from\nMITM attacks. \n\nSecure Code Example:\n```\npublic void safe(Object obj) throws Exception {\n  RestTemplate restTemplate = new RestTemplate();\n  restTemplate.put(URI.create(\"https://example.com\"), obj);\n}\n```  \n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#delete-java.lang.String-java.util.Map-
            - https://www.baeldung.com/rest-template
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - spring
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                (org.springframework.web.client.RestTemplate $RESTTEMP).$FUNC($URL, ...);
            - focus-metavariable: $URL
            - metavariable-regex:
                metavariable: $FUNC
                regex: (delete|doExecute|exchange|getForEntity|getForObject|headForHeaders|optionsForAllow|patchForObject|postForEntity|postForLocation|postForObject|put|execute)
      pattern-sources:
        - pattern: |
            "=~/^http:\/\/.+/i"
      severity: WARNING
    - id: java_crypto_rule-TLSUnsafeRenegotiation
      languages:
        - java
      message: "This code enables unsafe renegotiation in SSL/TLS connections, which is\nvulnerable to man-in-the-middle attacks. In such attacks, an attacker\ncould inject chosen plaintext at the beginning of the secure\ncommunication, potentially compromising the security of data transmission. If \nexploited, this vulnerability can lead to unauthorized access to sensitive \ndata, data manipulation, and potentially full system compromise depending on \nthe data and operations protected by the TLS session.\n\nTo mitigate this vulnerability, disable unsafe renegotiation in the Java \napplication. Ensure that only secure renegotiation is allowed by setting the \nsystem property `sun.security.ssl.allowUnsafeRenegotiation` to `false`. \n\nSecure code example:\n```\npublic void safe() {\n  java.lang.System.setProperty(\"sun.security.ssl.allowUnsafeRenegotiation\", false);\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://www.oracle.com/java/technologies/javase/tlsreadme.html
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      patterns:
        - pattern: |
            java.lang.System.setProperty("sun.security.ssl.allowUnsafeRenegotiation", $TRUE);
        - metavariable-pattern:
            metavariable: $TRUE
            pattern-either:
                - pattern: |
                    true
                - pattern: |
                    "true"
                - pattern: |
                    Boolean.TRUE
      severity: WARNING
    - id: java_crypto_rule-TelnetRequest
      languages:
        - java
      message: "Checks for attempts to connect through telnet. Telnet is an outdated\nprotocol that transmits all data, including sensitive information like\npasswords, in clear text. This exposes it to interception and\neavesdropping on unsecured networks.\n\nTo mitigate this issue, replace Telnet usage with more secure protocols \nsuch as SSH (Secure Shell), which provides encrypted communication. Use \nthe SSH functionality provided by libraries like JSch or Apache MINA SSHD \nfor secure data transmission.\n\nSecure Code Example:\n```\nimport com.jcraft.jsch.JSch;\nimport com.jcraft.jsch.Session;\n\npublic class SecureConnector {\n    public static void main(String[] args) {\n        try {\n            JSch jsch = new JSch();\n            Session session = jsch.getSession(\"username\", \"hostname\", 22);\n            session.setPassword(\"password\");\n            session.setConfig(\"StrictHostKeyChecking\", \"no\");\n            session.connect();\n            System.out.println(\"Connected securely.\");\n        } catch (Exception e) {\n            System.err.println(\"Secure connection failed: \" + e.getMessage());\n        }\n    }\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://commons.apache.org/proper/commons-net/javadocs/api-3.6/org/apache/commons/net/telnet/TelnetClient.html
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - java
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      pattern: |
        (org.apache.commons.net.telnet.TelnetClient $TELNETCLIENT).connect(...);
      severity: WARNING
    - id: java_crypto_rule-UnirestHTTPRequest
      languages:
        - java
      message: "This application uses the Unirest library to send\nnetwork requests to URLs starting with 'http://'. Communicating over HTTP\nis considered insecure because it does not encrypt traffic with TLS\n(Transport Layer Security), exposing data to potential interception or\nmanipulation by attackers.\n\nTo mitigate the issue, modify the request URL to begin with 'https://' \ninstead of 'http://'. Using HTTPS ensures that the data is encrypted and \nsecure during transmission. Review all instances where HTTP is used and \nupdate them to use HTTPS to prevent security risks.\n\nSecure Code Example:\n```\nimport kong.unirest.core.Unirest;\n\npublic void safe() {\n  Unirest.get(\"https://httpbin.org\")\n      .queryString(\"fruit\", \"apple\")\n      .queryString(\"droid\", \"R2D2\")\n      .asString();\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://kong.github.io/unirest-java/#requests
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - vuln
        technology:
            - unirest
        vulnerability: Insecure Transport
        vulnerability_class:
            - Mishandled Sensitive Information
      patterns:
        - pattern: |
            Unirest.$METHOD("=~/[hH][tT][tT][pP]://.*/")
      severity: WARNING
    - id: java_crypto_rule-UseOfRC2
      languages:
        - java
      message: "Use of RC2, a deprecated cryptographic algorithm vulnerable to related-key\nattacks, was detected. Modern cryptographic standards recommend the\nadoption of algorithms that integrate message integrity to ensure the\nciphertext remains unaltered.\n\nTo mitigate the issue, use any of the below algorithms instead:\n1. `ChaCha20Poly1305` - Preferred for its simplicity and speed, suitable for \nenvironments where cryptographic acceleration is absent.\n2. `AES-256-GCM` - Highly recommended when hardware support is available, \ndespite being somewhat slower than `ChaCha20Poly1305`. It is crucial to avoid \nnonce reuse with AES-256-GCM to prevent security compromises.\n\nSecure code example using `ChaCha20Poly1305` in Java:\n```\npublic void encryptAndDecrypt() throws Exception {\n    SecureRandom random = new SecureRandom();\n    byte[] secretKey = new byte[32];  // 256-bit key\n    byte[] nonce = new byte[12];      // 96-bit nonce\n    random.nextBytes(secretKey);\n    random.nextBytes(nonce);\n\n    Cipher cipher = Cipher.getInstance(\"ChaCha20-Poly1305/None/NoPadding\");\n    SecretKeySpec keySpec = new SecretKeySpec(secretKey, \"ChaCha20\");\n    GCMParameterSpec spec = new GCMParameterSpec(128, nonce);\n\n    cipher.init(Cipher.ENCRYPT_MODE, keySpec, spec);\n    byte[] plaintext = \"Secret text\".getBytes(StandardCharsets.UTF_8);\n    byte[] ciphertext = cipher.doFinal(plaintext);\n    System.out.println(\"Encrypted: \" + Base64.getEncoder().encodeToString(ciphertext));\n\n    cipher.init(Cipher.DECRYPT_MODE, keySpec, spec);\n    byte[] decrypted = cipher.doFinal(ciphertext);\n    System.out.println(\"Decrypted: \" + new String(decrypted, StandardCharsets.UTF_8));\n}\n```\nFor more on Java Cryptography, refer:\nhttps://docs.oracle.com/en/java/javase/15/security/java-cryptography-architecture-jca-reference-guide.html\n"
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-327
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        security-severity: MEDIUM
        shortDescription: Use of a broken or risky cryptographic algorithm
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: |
            javax.crypto.Cipher.getInstance("RC2")
        - patterns:
            - pattern-inside: |
                class $CLS{
                  ...
                  String $ALG = "RC2";
                  ...
                }
            - pattern: |
                javax.crypto.Cipher.getInstance($ALG);
      severity: WARNING
    - id: java_crypto_rule-UseOfRC4
      languages:
        - java
      message: "Use of RC4 was detected. RC4 is vulnerable to several types of attacks,\nincluding stream cipher attacks where attackers can recover plaintexts by\nanalyzing a large number of encrypted messages, and bit-flipping attacks\nthat can alter messages without knowing the encryption key.\n\nTo mitigate the issue, use any of the below algorithms instead:\n1. `ChaCha20Poly1305` - Preferred for its simplicity and speed, suitable for \nenvironments where cryptographic acceleration is absent.\n2. `AES-256-GCM` - Highly recommended when hardware support is available, \ndespite being somewhat slower than `ChaCha20Poly1305`. It is crucial to avoid \nnonce reuse with AES-256-GCM to prevent security compromises.\n\nSecure code example using `ChaCha20Poly1305` in Java:\n```\npublic void encryptAndDecrypt() throws Exception {\n    SecureRandom random = new SecureRandom();\n    byte[] secretKey = new byte[32];  // 256-bit key\n    byte[] nonce = new byte[12];      // 96-bit nonce\n    random.nextBytes(secretKey);\n    random.nextBytes(nonce);\n\n    Cipher cipher = Cipher.getInstance(\"ChaCha20-Poly1305/None/NoPadding\");\n    SecretKeySpec keySpec = new SecretKeySpec(secretKey, \"ChaCha20\");\n    GCMParameterSpec spec = new GCMParameterSpec(128, nonce);\n\n    cipher.init(Cipher.ENCRYPT_MODE, keySpec, spec);\n    byte[] plaintext = \"Secret text\".getBytes(StandardCharsets.UTF_8);\n    byte[] ciphertext = cipher.doFinal(plaintext);\n    System.out.println(\"Encrypted: \" + Base64.getEncoder().encodeToString(ciphertext));\n\n    cipher.init(Cipher.DECRYPT_MODE, keySpec, spec);\n    byte[] decrypted = cipher.doFinal(ciphertext);\n    System.out.println(\"Decrypted: \" + new String(decrypted, StandardCharsets.UTF_8));\n}\n```\nFor more information, refer:\nhttps://owasp.org/www-community/Using_the_Java_Cryptographic_Extensions\n"
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-327
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
            - https://googleprojectzero.blogspot.com/2022/10/rc4-is-still-considered-harmful.html
        security-severity: MEDIUM
        shortDescription: Use of a broken or risky cryptographic algorithm
        subcategory:
            - vuln
        technology:
            - java
      pattern-either:
        - pattern: |
            javax.crypto.Cipher.getInstance("RC4")
        - patterns:
            - pattern-inside: |
                class $CLS{
                  ...
                  String $ALG = "RC4";
                  ...
                }
            - pattern: |
                javax.crypto.Cipher.getInstance($ALG);
      severity: WARNING
    - id: java_csrf_rule-SpringCSRFDisabled
      languages:
        - java
      message: "The application fails to protect against Cross-Site Request Forgery (CSRF)\ndue to disabling Spring's CSRF protection features.\n\nThis vulnerability may allow attackers to carry out CSRF attacks by crafting \nmalicious links or forms on external websites. Victims who are tricked into \naccessing these links while authenticated in your application could inadvertently \nperform actions that the attacker intends, such as changing user information, \ninitiating transactions, or altering permissions.\n\nTo remediate this issue, remove the call to `HttpSecurity.csrf().disable()` or \nremove the custom `CsrfConfigurer`.\n\nFor more information on CSRF protection in Spring see:\nhttps://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html#servlet-csrf\n\nAdditionally, consider setting all session cookies to have the `SameSite=Strict` \nattribute. It should be noted that this may impact usability when sharing links \nacross other mediums.\nIt is recommended that a two cookie based approach is taken, as outlined in the\n[Top level\nnavigations](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-08#section-8.8.2)\nsection of the SameSite RFC.\n\nFor more information on CSRF see OWASP's guide:\nhttps://owasp.org/www-community/attacks/csrf\n"
      metadata:
        category: security
        cwe: CWE-352
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Medium
        shortDescription: Cross-Site Request Forgery (CSRF)
      pattern-either:
        - pattern: (org.springframework.security.config.annotation.web.builders.HttpSecurity $H). ... .csrf(...). ... .requireCsrfProtectionMatcher(...)
        - pattern: (org.springframework.security.config.annotation.web.builders.HttpSecurity $H). ... .csrf(...). ... .disable(...)
        - pattern: (org.springframework.security.config.annotation.web.configurers.CsrfConfigurer<HttpSecurity> $C). ... .disable();
      severity: WARNING
    - id: java_csrf_rule-UnrestrictedRequestMapping
      languages:
        - java
      message: "Detected a method annotated with 'RequestMapping' that does not specify\nthe HTTP method. CSRF protections are not enabled for GET, HEAD, TRACE, or\nOPTIONS, and by default all HTTP methods are allowed when the HTTP method\nis not explicitly specified. This means that a method that performs state\nchanges could be vulnerable to CSRF attacks. Cross-Site Request Forgery (CSRF) \nis a security vulnerability where an attacker tricks a user into performing \nunintended actions on a web application where they are authenticated. This \ncan lead to unauthorized actions like changing user settings, transferring \nfunds, or altering passwords, all without the user's knowledge, by exploiting \nthe trust a web application has in the user's browser.\n\nTo mitigate, add the 'method' field and specify the HTTP method (such as \n'RequestMethod.POST').\n\nSecure Code Example:\n```\n@RequestMapping(value = \"/path\", method = RequestMethod.POST)\npublic void safe() {\n    // State-changing operations performed within this method.\n}\n```\n"
      metadata:
        category: security
        confidence: LOW
        cwe: CWE-352
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://find-sec-bugs.github.io/bugs.htm#SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING
        security-severity: MEDIUM
        shortDescription: Cross-site request forgery (CSRF)
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING
        subcategory:
            - audit
        technology:
            - spring
        vulnerability_class:
            - Cross-Site Request Forgery (CSRF)
      patterns:
        - pattern-inside: |
            @RequestMapping(...)
            $RETURNTYPE $METHOD(...) { ... }
        - pattern-not-inside: |
            @RequestMapping(..., method = $X, ...)
            $RETURNTYPE $METHOD(...) { ... }
        - pattern: |
            RequestMapping
      severity: WARNING
    - id: java_deserialization_rule-InsecureJmsDeserialization
      languages:
        - java
      message: "Deserialization of untrusted JMS ObjectMessage can lead to arbitrary \ncode execution. This vulnerability occurs when `ObjectMessage.getObject()` \nis called to deserialize the payload of an ObjectMessage, potentially \nallowing remote attackers to execute arbitrary code with the permissions \nof the JMS MessageListener application. \n\nTo mitigate the issue, avoid deserialization of untrusted data and \nconsider alternative message formats or explicit whitelisting of \nallowable classes for deserialization.\n\nTo implement allowlisting, override the ObjectInputStream#resolveClass() \nmethod to limit deserialization to allowed classes only. This prevents \ndeserialization of any class except those explicitly permitted, such as \nin the following example that restricts deserialization to the Bicycle \nclass only:\n\n```\n// Code from https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html\npublic class LookAheadObjectInputStream extends ObjectInputStream {\n    public LookAheadObjectInputStream(InputStream inputStream) throws IOException {\n        super(inputStream);\n    }\n    /**\n    * Only deserialize instances of our expected Bicycle class\n    */\n    @Override\n    protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {\n        if (!desc.getName().equals(Bicycle.class.getName())) {\n            throw new InvalidClassException(\"Unauthorized deserialization attempt\", desc.getName());\n        }\n        return super.resolveClass(desc);\n    }\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-502
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities-wp.pdf
        security-severity: High
        shortDescription: Deserialization of untrusted data
        subcategory:
            - vuln
        technology:
            - java
        vulnerability_class:
            - 'Insecure Deserialization '
      patterns:
        - pattern-inside: |
            class $JMS_LISTENER implements MessageListener {
              ...
              public void onMessage(Message $JMS_MSG) {
                  ...
              }
            }
        - pattern: $Y.getObject(...);
      severity: ERROR
    - id: java_deserialization_rule-ServerDangerousObjectDeserialization
      languages:
        - java
      message: "This application uses Java RMI (Remote Method Invocation) interfaces \nthat declare methods with parameters of arbitrary objects \n('$PARAMTYPE $PARAM') that could lead to insecure deserialization \nvulnerabilities. Insecure deserialization occurs when an application \ndeserializes data from untrusted sources without proper sanitization, \npotentially leading to arbitrary code execution, denial of service attacks, \nand other critical vulnerabilities.\n\nJava RMI allows for remote communication between applications by \ninvoking methods on remote objects. When complex objects are used \nas parameters in RMI method declarations, there is \na risk that a malicious actor could exploit the deserialization \nprocess to execute arbitrary code on the server. This vulnerability \nis especially significant if the parameter types are not among the safe, \nimmutable types like String, Integer, etc.\n\nTo mitigate this vulnerability, use an integer ID to look up your \nobject, or consider alternative serialization schemes such as JSON.\n\nSecure Code Example:\n```\nimport java.rmi.Remote;\nimport java.rmi.RemoteException;\n\npublic interface SafeTicketService extends Remote {\n  // Using String, which is a safe, immutable type\n  boolean registerTicket(String ticketID) throws RemoteException;\n\n  // Using primitive data types and wrappers, which are safe\n  void visitTalk(int talkID) throws RemoteException;\n  void poke(Integer attendeeID) throws RemoteException;\n}\n```\n"
      metadata:
        category: security
        confidence: LOW
        cwe: CWE-502
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://frohoff.github.io/appseccali-marshalling-pickles/
            - https://book.hacktricks.xyz/network-services-pentesting/1099-pentesting-java-rmi
            - https://youtu.be/t_aw1mDNhzI
            - https://github.com/qtc-de/remote-method-guesser
            - https://github.com/openjdk/jdk/blob/master/src/java.rmi/share/classes/sun/rmi/server/UnicastRef.java#L303C4-L331
            - https://mogwailabs.de/en/blog/2019/03/attacking-java-rmi-services-after-jep-290/
        security-severity: MEDIUM
        shortDescription: Deserialization of untrusted data
        technology:
            - rmi
        vulnerability_class:
            - 'Insecure Deserialization '
      patterns:
        - pattern-inside: |
            interface $INTERFACE extends Remote {
              ...
            }
        - pattern: |
            $RETURNTYPE $METHOD($PARAMTYPE $PARAM) throws RemoteException;
        - metavariable-pattern:
            language: generic
            metavariable: $PARAMTYPE
            patterns:
                - pattern-not: String
                - pattern-not: java.lang.String
                - pattern-not: boolean
                - pattern-not: Boolean
                - pattern-not: java.lang.Boolean
                - pattern-not: byte
                - pattern-not: Byte
                - pattern-not: java.lang.Byte
                - pattern-not: char
                - pattern-not: Character
                - pattern-not: java.lang.Character
                - pattern-not: double
                - pattern-not: Double
                - pattern-not: java.lang.Double
                - pattern-not: float
                - pattern-not: Float
                - pattern-not: java.lang.Float
                - pattern-not: int
                - pattern-not: Integer
                - pattern-not: java.lang.Integer
                - pattern-not: long
                - pattern-not: Long
                - pattern-not: java.lang.Long
                - pattern-not: short
                - pattern-not: Short
                - pattern-not: java.lang.Short
      severity: WARNING
    - id: java_deserialization_rule-SnakeYamlConstructor
      languages:
        - java
      message: "The application uses SnakeYAML org.yaml.snakeyaml.Yaml() constructor \nwith no arguments, which is vulnerable to deserialization attacks. \nWhen Yaml() (no-argument constructor) is used, SnakeYAML uses the \ndefault Constructor which can instantiate any Java object during \ndeserialization. This is risky because an attacker could craft malicious \nYAML files to execute arbitrary code or perform unauthorized actions.\n\nTo mitigate the issue and to safely use SnakeYaml to parse YAML data, \nalways make sure to only ever use a Yaml instance that is constructed \neither with a SafeConstructor or an instance constructed with a \nConstructor specifying a specific class. \n\nPlease note, if you want to use Constructor with a specific target class\nas a mitigation criteria, ensure that snakeyaml version is 2.0 or higher\nas Constructor class is vulnerable in snakeyaml versions lower than 2.0.\nRefer - https://github.com/google/security-research/security/advisories/GHSA-mjmj-j48q-9wg2\n\nSecure Code Examples:\n```\npublic void safeConstructorLoad(String toLoad) {\n  // Configure LoaderOptions for safe deserialization\n  LoaderOptions loaderOptions = new LoaderOptions();\n  loaderOptions.setAllowDuplicateKeys(false);\n  loaderOptions.setMaxAliasesForCollections(50);\n\n  Yaml yaml = new Yaml(new SafeConstructor(new LoaderOptipon()));\n  yaml.load(toLoad);\n}\n\npublic void customConstructorLoad(String toLoad, Class<?> goodClass) {\n  // Use Constructor with a specific target class\n  LoaderOptions loaderOptions = new LoaderOptions();\n  Constructor customConstructor = new Constructor(goodClass, loaderOptions);\n\n  Yaml yaml = new Yaml(customConstructor);\n  yaml.load(toLoad);\n}\n```\n"
      metadata:
        category: security
        confidence: LOW
        cwe: CWE-502
        impact: HIGH
        likelihood: LOW
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://securitylab.github.com/research/swagger-yaml-parser-vulnerability/#snakeyaml-deserialization-vulnerability
        security-severity: HIGH
        shortDescription: Deserialization of untrusted data
        technology:
            - snakeyaml
      patterns:
        - pattern: |
            $Y = new org.yaml.snakeyaml.Yaml();
            ...
            $Y.load(...);
      severity: ERROR
    - id: java_endpoint_rule-ManuallyConstructedURLs
      languages:
        - java
      message: |
        User data flows into the host portion of this manually-constructed URL.
        This could allow an attacker to send data to their own server, potentially
        exposing sensitive data such as cookies or authorization information sent
        with this request. They could also probe internal servers or other
        resources that the server running this code can access. (This is called
        server-side request forgery, or SSRF.) Do not allow arbitrary hosts.
        Instead, create an allowlist for approved hosts hardcode the correct host,
        or ensure that the user data can only affect the path or parameters.

        Example of using allowlist:
        ```
        ArrayList<String> allowlist = (ArrayList<String>)
            Arrays.asList(new String[] { "https://example.com/api/1", "https://example.com/api/2", "https://example.com/api/3"});

        if(allowlist.contains(url)){
          ...
        }
        ```
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-918
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        interfile: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A1:2017-Injection
            - A10:2021-Server-Side Request Forgery
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html
        security-severity: CRITICAL
        shortDescription: Detect manually constructed URLs
        subcategory:
            - vuln
        technology:
            - java
            - spring
        vulnerability_class:
            - Server-Side Request Forgery (SSRF)
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: "if($VALIDATION){\n  ...\n  new URL($ONEARG);\n  ...\n} \n"
                - pattern: |
                    $A = $VALIDATION;
                    ...
                    if($A){
                      ...
                      new URL($ONEARG);
                      ...
                    }
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: "$AL.contains(...)  \n"
                    - pattern: |
                        $AL.indexOf(...) != -1
      pattern-sinks:
        - pattern-either:
            - pattern: new URL($ONEARG)
            - patterns:
                - pattern-either:
                    - pattern: |
                        "$URLSTR" + ...
                    - pattern: |
                        "$URLSTR".concat(...)
                    - patterns:
                        - pattern-inside: |
                            StringBuilder $SB = new StringBuilder("$URLSTR");
                            ...
                        - pattern: $SB.append(...)
                    - patterns:
                        - pattern-inside: |
                            $VAR = "$URLSTR";
                            ...
                        - pattern: $VAR += ...
                    - patterns:
                        - pattern: String.format("$URLSTR", ...)
                        - pattern-not: String.format("$URLSTR", "...", ...)
                    - patterns:
                        - pattern-inside: |
                            String $VAR = "$URLSTR";
                            ...
                        - pattern: String.format($VAR, ...)
                - metavariable-regex:
                    metavariable: $URLSTR
                    regex: http(s?)://%(v|s|q).*
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
      severity: ERROR
    - id: java_file_rule_rule-FilePathTraversalHttpServlet
      languages:
        - java
      message: "Detected a potential path traversal. A malicious actor could control\nthe location of this file, to include going backwards in the directory\nwith '../'. \n\nTo address this, ensure that user-controlled variables in file\npaths are sanitized. You may also consider using a utility method such as\norg.apache.commons.io.FilenameUtils.getName(...) to only retrieve the file\nname from the path.\n\nExample code using FilenameUtils.getName(...)\n\n```\npublic void ok(HttpServletRequest request, HttpServletResponse response)\n        throws ServletException, IOException {\n    String image = request.getParameter(\"image\");\n    File file = new File(\"static/images/\", FilenameUtils.getName(image));\n\n    if (!file.exists()) {\n        log.info(image + \" could not be created.\");\n        response.sendError();\n    }\n\n    response.sendRedirect(\"/index.html\");\n}\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-22
        cwe2021-top25: true
        cwe2022-top25: true
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://www.owasp.org/index.php/Path_Traversal
        security-severity: CRITICAL
        shortDescription: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#PATH_TRAVERSAL_IN
        technology:
            - java
        vulnerability_class:
            - Path Traversal
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    (java.io.File $FILE) = ...
                - pattern: |
                    (java.io.FileOutputStream $FOS) = ...
                - pattern: |
                    new java.io.FileInputStream(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
                - patterns:
                    - pattern-inside: |
                        (javax.servlet.http.Cookie[] $COOKIES) = (HttpServletRequest $REQ).getCookies(...); ...
                        for (javax.servlet.http.Cookie $COOKIE: $COOKIES) {
                          ...
                        }
                    - pattern: |
                        $COOKIE.getValue(...)
                - patterns:
                    - pattern-inside: |
                        $TYPE[] $VALS = (HttpServletRequest $REQ).$GETFUNC(...);
                        ...
                    - pattern: |
                        $PARAM = $VALS[$INDEX];
      severity: ERROR
    - id: java_inject_rule-DangerousGroovyShell
      languages:
        - java
      message: "This application implements unsafe invocations of methods within the\n`groovy.lang.GroovyShell` or `groovy.lang.GroovyClassLoader` classes,\nwhich are used to evaluate or compile Groovy code dynamically. When\nuser-controlled input is directly passed to `parse`, `evaluate`, or\n`parseClass` methods, it can lead to Remote Code Execution (RCE), where an\nattacker can execute arbitrary code on the server. This could potentially\nallow an attacker to gain unauthorized access to system resources, modify\ninternal application states, or execute commands on the server depending\non the level of permissions assigned to the application process.\n\nTo mitigate this vulnerability, always validate and sanitize all user inputs \nbefore using them in dynamic code evaluations. Consider using safer alternatives \nto executing dynamic code if possible. If dynamic code execution is absolutely \nnecessary, use strict allowlists of safe inputs and context-specific validation.\n\nSecure Code Example:\n\n```\nimport groovy.lang.GroovyShell;\n\nclass SafeDynamicEvaluation {\n  private static final Set<String> ALLOWED_EXPRESSIONS = new HashSet<>(Arrays.asList(\n      \"println 'Hello World!'\",\n      \"println 'Goodbye World!'\"));\n\n  public static void test4(String[] args, ClassLoader loader) throws Exception {\n    GroovyShell shell = new GroovyShell();\n    String userInput = args[0];\n\n    // Validate the user input against the allowlist\n    if (ALLOWED_EXPRESSIONS.contains(userInput)) {\n      shell.evaluate(userInput);\n      // shell.parse(userInput);\n    } else {\n      throw new IllegalArgumentException(\"Invalid or unauthorized command.\");\n    }\n  }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-94
        cwe2022-top25: "true"
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code ('Code Injection')
        source-rule-url: https://find-sec-bugs.github.io/bugs.htm#GROOVY_SHELL
        technology:
            - groovy
        vulnerability_class:
            - Code Injection
      patterns:
        - pattern-either:
            - pattern: |
                (groovy.lang.GroovyShell $SHELL).parse(...)
            - pattern: |
                (groovy.lang.GroovyShell $SHELL).evaluate(...)
            - pattern: |
                (groovy.lang.GroovyClassLoader $SHELL).parseClass(...)
        - pattern-not: |
            $SHELL.parse("...",...)
        - pattern-not: |
            $SHELL.evaluate("...",...)
        - pattern-not: |
            $SHELL.parseClass("...",...)
        - pattern-not-inside: |
            if($ALLOWLIST.contains($INPUT)){
              ...
            }
      severity: ERROR
    - id: java_inject_rule-EnvInjection
      languages:
        - java
      message: "Detected input from a HTTPServletRequest going into the environment\nvariables of an 'exec' command. The user input is passed directly to\nthe Runtime.exec() function to set an environment variable. This allows \nmalicious input from the user to modify the command that will be executed.\nTo remediate this, do not pass user input directly to Runtime.exec().\nValidate any user input before using it to set environment variables \nor command arguments. Consider using an allow list of allowed values\nrather than a deny list. If dynamic commands must be constructed, use\na map to look up valid values based on user input instead of using \nthe input directly.\nExample of safely executing an OS command:\n```\npublic void doPost(HttpServletRequest request, HttpServletResponse response)\n      throws ServletException, IOException {\n  response.setContentType(\"text/html;charset=UTF-8\");\n\n  String param = \"\";\n  if (request.getHeader(\"UserDefined\") != null) {\n      param = request.getHeader(\"UserDefined\");\n  }\n\n  param = java.net.URLDecoder.decode(param, \"UTF-8\");\n  String cmd = \"/bin/cmd\";\n\n  String[] allowList = {\"FOO=true\",\"FOO=false\",\"BAR=true\", \"BAR=false\"}\n  if(Arrays.asList(allowList).contains(param)){\n      String[] argsEnv = {param};\n  }\n  \n  Runtime r = Runtime.getRuntime();\n\n  try {\n      Process p = r.exec(cmd, argsEnv);\n      printOSCommandResults(p, response);        \n  } catch (IOException e) {\n      System.out.println(\"Problem executing command\");\n      response.getWriter()\n              .println(org.owasp.esapi.ESAPI.encoder().encodeForHTML(e.getMessage()));\n      return;\n  }\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-78
        impact: MEDIUM
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: MEDIUM
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
        security-severity: HIGH
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        subcategory:
            - vuln
        technology:
            - java
        vulnerability_class:
            - Other
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: |
                    if($VALIDATION){
                    ...
                    }
                - patterns:
                    - pattern-inside: |
                        $A = $VALIDATION;
                        ...
                    - pattern: |
                        if($A){
                        ...
                        }
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: |
                        $AL.contains(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: (java.lang.Runtime $R).exec($CMD, $ENV_ARGS, ...);
                - focus-metavariable: $ENV_ARGS
            - patterns:
                - pattern: (ProcessBuilder $PB).environment().put($...ARGS);
                - focus-metavariable: $...ARGS
            - patterns:
                - pattern: |
                    $ENV = (ProcessBuilder $PB).environment();
                    ...
                    $ENV.put($...ARGS);
                - focus-metavariable: $...ARGS
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    (HttpServletRequest $REQ)
        - patterns:
            - pattern-inside: |
                $FUNC(..., $VAR, ...) {
                ...
                }
            - pattern: $VAR
      severity: ERROR
    - id: java_inject_rule-SqlInjection
      languages:
        - java
      message: |
        SQL Injection is a critical vulnerability that can lead to data or system compromise. By
        dynamically generating SQL query strings, user input may be able to influence the logic of
        the SQL statement. This could lead to an adversary accessing information they should
        not have access to, or in some circumstances, being able to execute OS functionality or code.

        Replace all dynamically generated SQL queries with parameterized queries. In situations where
        dynamic queries must be created, never use direct user input, but instead use a map or
        dictionary of valid values and resolve them using a user-supplied key.

        For example, some database drivers do not allow parameterized queries for `>` or `<` comparison
        operators. In these cases, do not use a user supplied `>` or `<` value, but rather have the
        user
        supply a `gt` or `lt` value. The alphabetical values are then used to look up the `>` and `<`
        values to be used in the construction of the dynamic query. The same goes for other queries
        where
        column or table names are required but cannot be parameterized.

        Example using `PreparedStatement` queries:
        ```
        // Some userInput
        String userInput = "someUserInput";
        // Your connection string
        String url = "...";
        // Get a connection from the DB via the DriverManager
        Connection conn = DriverManager.getConnection(url);
        // Create a prepared statement
        PreparedStatement st = conn.prepareStatement("SELECT name FROM table where name=?");
        // Set each parameters value by the index (starting from 1)
        st.setString(1, userInput);
        // Execute query and get the result set
        ResultSet rs = st.executeQuery();
        // Iterate over results
        while (rs.next()) {
            // Get result for this row at the provided column number (starting from 1)
            String result = rs.getString(1);
            // ...
        }
        // Close the ResultSet
        rs.close();
        // Close the PreparedStatement
        st.close();
        ```

        Example on using CriteriaBuilder to build queries
        ```
        public List<YourEntity> findBySomeCriteria(EntityManager entityManager, String criteriaValue) {
            CriteriaBuilder criteriaBuilder = entityManager.getCriteriaBuilder();
            CriteriaQuery<YourEntity> query = criteriaBuilder.createQuery(YourEntity.class);
            Root<YourEntity> root = query.from(YourEntity.class);

            query.select(root).where(criteriaBuilder.equal(root.get("someProperty"), criteriaValue));

            return entityManager.createQuery(query).getResultList();
        }
        ```

        For more information on SQL Injection see OWASP:
        https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL command ('SQL Injection')
        technology:
            - java
      mode: taint
      options:
        taint_assume_safe_booleans: true
        taint_assume_safe_numbers: true
      pattern-propagators:
        - from: $X
          pattern: $LIST.add($X)
          to: $LIST
        - from: $X
          pattern: $MAP.put(..., $X)
          to: $MAP
        - from: $X
          pattern: $STR.concat($X)
          to: $STR
        - from: $X
          pattern: $STR = String.format(..., $X, ...)
          to: $STR
        - from: $X
          pattern: $STR = String.join(..., $X, ...)
          to: $STR
        - from: $X
          pattern: $SB.append($X)
          to: $SB
      pattern-sanitizers:
        - pattern: (CriteriaBuilder $CB).$ANY(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: (javax.jdo.PersistenceManager $PM).newQuery($ARG)
                - pattern: (javax.jdo.PersistenceManager $PM).newQuery(..., $ARG)
                - pattern: (javax.jdo.Query $Q).setFilter($ARG)
                - pattern: (javax.jdo.Query $Q).setGrouping($ARG)
                - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($ARG, ...)
                - pattern: (org.hibernate.Session $S).createQuery((String $ARG), ...)
                - pattern: (org.hibernate.Session $S).createSQLQuery($ARG, ...)
                - pattern: (org.hibernate.Session $S).connection().prepareStatement($ARG)
                - pattern: (java.sql.Statement $S).executeQuery($ARG, ...)
                - pattern: (java.sql.Statement $S).execute($ARG, ...)
                - pattern: (java.sql.Statement $S).executeUpdate($ARG, ...)
                - pattern: (java.sql.Statement $S).executeLargeUpdate($ARG, ...)
                - pattern: (java.sql.Statement $S).addBatch($ARG, ...)
                - pattern: (java.sql.PreparedStatement $S).executeQuery($ARG, ...)
                - pattern: (java.sql.PreparedStatement $S).execute($ARG, ...)
                - pattern: (java.sql.PreparedStatement $S).executeUpdate($ARG, ...)
                - pattern: (java.sql.PreparedStatement $S).executeLargeUpdate($ARG, ...)
                - pattern: (java.sql.PreparedStatement $S).addBatch($ARG, ...)
                - pattern: (java.sql.Connection $S).prepareCall($ARG, ...)
                - pattern: (java.sql.Connection $S).prepareStatement($ARG, ...)
                - pattern: (java.sql.Connection $S).nativeSQL($ARG, ...)
                - pattern: new org.springframework.jdbc.core.PreparedStatementCreatorFactory($ARG, ...)
                - pattern: (org.springframework.jdbc.core.PreparedStatementCreatorFactory $F).newPreparedStatementCreator($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).batchUpdate($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).execute($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).query($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForList($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForMap($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForObject($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForObject($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForRowSet($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForInt($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).queryForLong($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcOperations $O).update($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).batchUpdate($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).execute($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).query($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForList($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForMap($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForObject($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForRowSet($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForInt($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).queryForLong($ARG, ...)
                - pattern: (org.springframework.jdbc.core.JdbcTemplate $O).update($ARG, ...)
                - pattern: (io.vertx.sqlclient.SqlClient $O).query($ARG, ...)
                - pattern: (io.vertx.sqlclient.SqlClient $O).preparedQuery($ARG, ...)
                - pattern: (io.vertx.sqlclient.SqlConnection $O).prepare($ARG, ...)
                - pattern: (org.apache.turbine.om.peer.BasePeer $O).executeQuery($ARG, ...)
                - pattern: org.apache.torque.util.BasePeer.executeQuery($ARG, ...)
                - pattern: org.apache.torque.util.BasePeer.executeStatement($ARG, ...)
                - pattern: (javax.persistence.EntityManager $O).createQuery($ARG, ...)
                - pattern: (javax.persistence.EntityManager $O).createNativeQuery($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).createQuery($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).createScript($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).createUpdate($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).execute($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).prepareBatch($ARG, ...)
                - pattern: (org.jdbi.v3.core.Handle $H).select($ARG, ...)
                - pattern: new org.jdbi.v3.core.statement.Script($H, $ARG)
                - pattern: new org.jdbi.v3.core.statement.Update($H, $ARG)
                - pattern: new org.jdbi.v3.core.statement.PreparedBatch($H, $ARG)
            - focus-metavariable: $ARG
        - patterns:
            - pattern: (java.sql.Connection $S).createStatement(...).$SQLFUNC($ARG, ...)
            - pattern-not: (java.sql.Connection $S).createStatement(...).$SQLFUNC("...")
            - metavariable-regex:
                metavariable: $SQLFUNC
                regex: execute|executeQuery|createQuery|query|addBatch|nativeSQL|create|prepare
      pattern-sources:
        - pattern: (javax.servlet.http.HttpServletRequest $R).$METHOD(...)
        - pattern: (java.util.Scanner $S).$METHOD(...)
        - pattern: (java.util.stream.Stream).$METHOD(...)
        - pattern: (java.util.StringJoiner $SJ).toString(...)
        - pattern: (java.sql.ResultSet.getString $R).$METHOD(...)
        - pattern: (java.lang.System $S).getProperty(...)
        - pattern: (java.lang.System $S).getenv(...)
        - pattern: (java.lang.StringBuilder $SB).toString(...)
        - pattern: (java.io.FileInputStream $F).read(...)
        - pattern: (java.io.FileReader $F).read(...)
        - pattern: (java.net.Socket $S).getInputStream(...)
        - pattern: (java.net.Socket $S).getOutputStream(...)
        - pattern: (java.net.DatagramSocket $S).receive(...)
        - pattern: (java.net.DatagramSocket $S).getInputStream(...)
        - pattern: java.nio.file.Files.readAllBytes(...)
        - pattern: java.nio.file.Files.readAllLines(...)
        - pattern: java.nio.file.Files.lines(...)
        - pattern: java.nio.file.Files.newBufferedReader(...)
        - pattern: org.apache.commons.io.IOUtils.toString(...)
        - pattern: org.apache.commons.io.IOUtils.readLines(...)
        - pattern: org.apache.commons.io.IOUtils.toByteArray(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).readValue(...)
        - pattern: (com.fasterxml.jackson.databind.ObjectMapper $OM).treeToValue(...)
        - pattern: $CLASS.$METHOD(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - pattern: $FUNC(..., (javax.servlet.http.HttpServletRequest $R), ...)
        - patterns:
            - pattern-inside: $FUNC(..., String $X, ...) { ... }
            - focus-metavariable: $X
      severity: ERROR
    - id: java_traversal_rule-RelativePathTraversal
      languages:
        - java
      message: "Detected user input controlling a file path. An attacker could control\nthe location of this file, to include going backwards in the directory\nwith '../'. \n\nTo address this, ensure that user-controlled variables in file\npaths are sanitized. You may also consider using a utility method such as\norg.apache.commons.io.FilenameUtils.getName(...) to only retrieve the file\nname from the path.\n\nExample of using `org.apache.commons.io.FilenameUtils.getName(...)` to \nonly retrieve the file name from the path\n```\nString fileName = org.apache.commons.io.FilenameUtils.getName(userControlledInput);\nFile file = new File(\"/path/to/directory/\" + fileName);\n```\n"
      metadata:
        category: security
        cwe: CWE-23
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A01:2021-Broken Access Control
            - A5:2017-Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        security-severity: CRITICAL
        shortDescription: Relative Path Traversal
      mode: taint
      options:
        interfile: true
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: new File(...)
                - pattern: new java.io.File(...)
                - pattern: new FileReader(...)
                - pattern: new java.io.FileReader(...)
                - pattern: new FileInputStream(...)
                - pattern: new java.io.FileInputStream(...)
                - pattern: (Paths $PATHS).get(...)
                - patterns:
                    - pattern: |
                        $CLASS.$FUNC(...)
                    - metavariable-regex:
                        metavariable: $FUNC
                        regex: ^(getResourceAsStream|getResource)$
                - patterns:
                    - pattern-either:
                        - pattern: new ClassPathResource($FILE, ...)
                        - pattern: ResourceUtils.getFile($FILE, ...)
                        - pattern: new FileOutputStream($FILE, ...)
                        - pattern: new java.io.FileOutputStream($FILE, ...)
                        - pattern: new StreamSource($FILE, ...)
                        - pattern: new javax.xml.transform.StreamSource($FILE, ...)
                        - pattern: FileUtils.openOutputStream($FILE, ...)
                    - focus-metavariable: $FILE
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $METHODNAME(..., @$REQ(...) $TYPE $SOURCE,...) {
                      ...
                    }
                - pattern-inside: |
                    $METHODNAME(..., @$REQ $TYPE $SOURCE,...) {
                      ...
                    }
            - metavariable-regex:
                metavariable: $TYPE
                regex: ^(?!(Integer|Long|Float|Double|Char|Boolean|int|long|float|double|char|boolean))
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue|ModelAttribute)
            - focus-metavariable: $SOURCE
      severity: ERROR
    - id: java_xpathi_rule-XpathInjection
      languages:
        - java
      message: "The application processes `XPath` queries with potentially malicious input.\nAn adversary who is able to control the XPath query could potentially influence the logic\nof how data is retrieved, processed or even bypass protections.\n\nTo mitigate the vulnerability, avoid using user input in XPath queries.\nIf it cannot be avoided, validate the user input against an allowlist\nof expected values before using it in the query. \n\nFollowing is an example that demonstrates how to perform an XPath query \nusing user input validated against an allowlist.\n\nSecure code example:\n```\npublic class SecureXPathWithoutResolver {\n\n  private static final List<String> ALLOWED_AUTHORS = List.of(\"Author1\", \"Author2\", \"Author3\");\n\n  public static void main(String[] args) {\n    try {\n      String userInput = \"Author1\"; // Example user input\n        if (ALLOWED_AUTHORS.contains(userInput)) {\n          // User input is safe to use\n          DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n          DocumentBuilder builder = factory.newDocumentBuilder();\n          Document doc = builder.parse(\"path/to/your/xmlfile.xml\");\n\n          XPathFactory xpathFactory = XPathFactory.newInstance();\n          XPath xpath = xpathFactory.newXPath();\n\n          // Safely embed the validated user input into the XPath expression\n          String expression = String.format(\"//books/book[author='%s']\", userInput);\n          NodeList nodes = (NodeList) xpath.evaluate(expression, doc, XPathConstants.NODESET);\n\n          for (int i = 0; i < nodes.getLength(); i++) {\n              System.out.println(nodes.item(i).getTextContent());\n          }\n        } else {\n          throw new IllegalArgumentException(\"Input is not allowed.\");\n        }\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n  }\n}\n```\n\nFor more information on XPath Injection see:\n- https://owasp.org/www-community/attacks/XPATH_Injection\n"
      metadata:
        category: security
        cwe: CWE-643
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of data within XPath expressions ('XPath Injection')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: $MAP.getOrDefault($VAR,"...");
            - pattern: $VAR
        - patterns:
            - pattern-either:
                - pattern: |
                    if($VALIDATION){
                    ...
                    }
                - patterns:
                    - pattern-inside: |
                        $A = $VALIDATION;
                        ...
                    - pattern: |
                        if($A){
                          ...
                        }
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: |
                        $AL.contains(...)
                    - pattern: |
                        $AL.equals(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    (javax.xml.xpath.XPath $XP). ... .evaluate($EXP, ...);
                - pattern: $EXP
            - patterns:
                - pattern-inside: |
                    (javax.xml.xpath.XPath $XP). ... .compile($EXP, ...);
                - pattern: $EXP
      pattern-sources:
        - pattern-either:
            - pattern: |
                (HttpServletRequest $REQ).$FUNC(...)
            - patterns:
                - pattern-inside: |
                    $FUNC(..., $VAR, ...) {
                    ...
                    }
                - pattern: $VAR
      severity: ERROR
    - id: java_xxe_rule-DisallowDoctypeDeclFalse
      languages:
        - java
      message: "DOCTYPE declarations are enabled for $DBFACTORY. Without prohibiting\nexternal entity declarations, this is vulnerable to XML external entity\nattacks. In an XXE attack, an attacker can exploit the processing of external \nentity references within an XML document to access internal files, conduct \ndenial-of-service attacks, or SSRF (Server Side Request Forgery), potentially \nleading to sensitive information disclosure or system compromise.\n\nTo mitigate this vulnerability, disable this by setting the feature\n\"http://apache.org/xml/features/disallow-doctype-decl\" to true.\nAlternatively, allow DOCTYPE declarations and only prohibit external\nentities declarations. This can be done by setting the features\n\"http://xml.org/sax/features/external-general-entities\" and\n\"http://xml.org/sax/features/external-parameter-entities\" to false.\n\nSecure Code Example: \n``` \npublic void GoodXMLInputFactory() throws  ParserConfigurationException {\n  DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n  dbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n} \n```\n"
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        technology:
            - java
            - xml
        vulnerability_class:
            - XML Injection
      patterns:
        - pattern: |
            $DBFACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
            false);
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-general-entities", false);
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
              ...
              $DBF.setFeature("http://xml.org/sax/features/external-general-entities", false);
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
              ...
            }
        - pattern-not-inside: |
            $RETURNTYPE $METHOD(...){
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
              ...
              $DBF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
              ...
            }
      severity: WARNING
    - id: java_xxe_rule-DocumentBuilderFactoryDisallowDoctypeDeclMissing
      languages:
        - java
      message: "DOCTYPE declarations are enabled for this DocumentBuilderFactory. Enabling \nDOCTYPE declarations without proper restrictions can make your application \nvulnerable to XML External Entity (XXE) attacks. \nIn an XXE attack, an attacker can exploit the processing of external entity \nreferences within an XML document to access internal files, conduct \ndenial-of-service attacks, or SSRF (Server Side Request Forgery), potentially \nleading to sensitive information disclosure or system compromise. \n\nTo mitigate this vulnerability, disable this by setting the\nfeature \"http://apache.org/xml/features/disallow-doctype-decl\" to true.\nAlternatively, allow DOCTYPE declarations and only prohibit external\nentities declarations. This can be done by setting the features\n\"http://xml.org/sax/features/external-general-entities\" and\n\"http://xml.org/sax/features/external-parameter-entities\" to false.\n\nSecure Code Example (You can do either of the following):\n```\npublic void GoodDocumentBuilderFactory() throws  ParserConfigurationException {\n  DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n  dbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n  dbf.newDocumentBuilder();\n}\n\npublic void GoodDocumentBuilderFactory2() throws  ParserConfigurationException {\n  DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n  dbf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n  dbf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n  dbf.newDocumentBuilder();\n}\n```\n"
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        subcategory:
            - vuln
        technology:
            - java
            - xml
        vulnerability_class:
            - XML Injection
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false); ... $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false); ... $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
                            true);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",false);
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: |
                $FACTORY.newDocumentBuilder();
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern: |
                $FACTORY
            - pattern-inside: |
                $FACTORY = DocumentBuilderFactory.newInstance();
            - pattern-not-inside: |
                class $C {
                  ...
                  $V $FACTORY = DocumentBuilderFactory.newInstance();
                  ...
                  static {
                    ...
                    $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                    ...
                  }
                  ...
                }
            - pattern-not-inside: |
                class $C {
                  ...
                  $V $FACTORY = DocumentBuilderFactory.newInstance();
                  ...
                  static {
                    ...
                    $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    ...
                    $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                    ...
                  }
                  ...
                }
            - pattern-not-inside: |
                class $C {
                  ...
                  $V $FACTORY = DocumentBuilderFactory.newInstance();
                  ...
                  static {
                    ...
                    $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                    ...
                    $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    ...
                  }
                  ...
                }
      severity: WARNING
    - id: java_xxe_rule-ExternalGeneralEntitiesTrue
      languages:
        - java
      message: "This rule identifies instances in the code where an XML parser is\nconfigured to allow external general entities. Allowing the processing \nof external general entities without proper validation or restriction \ncan lead to XXE attacks. An attacker can craft an XML document to \nreference sensitive files on the server or external systems under the \nattacker's control, leading to data disclosure, denial of service, or \nserver-side request forgery (SSRF).\n\nTo mitigate this vulnerability, the application should be configured to \ndisable the use of external general entities in XML parsing. This can be \nachieved by setting the feature \n\"http://xml.org/sax/features/external-general-entities\" to false.\n\nSecure Code Example:\n```\nclass GoodSAXBuilder {\n    public void GoodSAXBuilder1() throws ParserConfigurationException {\n        SAXBuilder saxBuilder = new SAXBuilder();\n        saxBuilder.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n    }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        technology:
            - java
            - xml
        vulnerability_class:
            - XML Injection
      pattern: |
        $PARSER.setFeature("http://xml.org/sax/features/external-general-entities",
        true);
      severity: WARNING
    - id: java_xxe_rule-ExternalParameterEntitiesTrue
      languages:
        - java
      message: "This rule identifies instances in the code where the XML parser is\nconfigured to allow external parameter entities. Enabling external\nentities in XML parsing can lead to XML External Entity (XXE) attacks,\nwhere an attacker could exploit the XML parser to read sensitive files\nfrom the server, perform denial of service (DoS) attacks, or achieve\nserver-side request forgery (SSRF). This vulnerability occurs when the\napplication processes XML input that includes external entity references\nwithin an XML document.\n\nTo mitigate this vulnerability, the application should be configured to disable \nthe use of external entities in XML parsing. This can be achieved by setting the \nfeature \"http://xml.org/sax/features/external-parameter-entities\" to false.\n\nSecure Code Example: \n``` \ntry {\n    DBFactory dbFactory = DocumentBuilderFactory.newInstance();\n    // Disable external entities to mitigate XXE vulnerability\n    dbFactory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n    dbFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n    // Additional configuration for secure parsing\n    dbFactory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n    dbFactory.setXIncludeAware(false);\n    dbFactory.setExpandEntityReferences(false);\n\n    // Use the configured factory to create a document builder\n    DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\n    // Parse an XML file using the secure document builder\n    Document doc = dBuilder.parse(new InputSource(new StringReader(xmlData)));\n    // Process the document as needed\n} catch (ParserConfigurationException | SAXException | IOException e) {\n    // Handle exceptions appropriately\n} \n``` \n"
      metadata:
        category: security
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        technology:
            - java
            - xml
        vulnerability_class:
            - XML Injection
      pattern: |
        $PARSER.setFeature("http://xml.org/sax/features/external-parameter-entities",
        true);
      severity: WARNING
    - id: java_xxe_rule-SAXParserFactoryDisallowDoctypeDeclMissing
      languages:
        - java
      message: "DOCTYPE declarations are enabled for this SAXParserFactory. Enabling DOCTYPE \ndeclarations without proper restrictions can make your application vulnerable to \nXML External Entity (XXE) attacks. \nIn an XXE attack, an attacker can exploit the processing of external entity \nreferences within an XML document to access internal files, conduct \ndenial-of-service attacks, or SSRF (Server Side Request Forgery), potentially \nleading to sensitive information disclosure or system compromise.\n\nTo mitigate this vulnerability, disable DOCTYPE declarations by setting the\nfeature `http://apache.org/xml/features/disallow-doctype-decl` to true.\nAlternatively, allow DOCTYPE declarations and only prohibit external\nentities declarations. This can be done by setting the features\n`http://xml.org/sax/features/external-general-entities` and\n`http://xml.org/sax/features/external-parameter-entities` to false. \nNOTE: The previous links are not meant to be clicked. They are the literal\nconfig key values that are supposed to be used to disable these features.\n\nSecure Code Example (You can do either of the following):\n```\npublic void GoodSAXParserFactory() throws  ParserConfigurationException {\n  SAXParserFactory spf = SAXParserFactory.newInstance();\n  spf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n  spf.newSAXParser();\n}\n\npublic void GoodSAXParserFactory2() throws  ParserConfigurationException {\n  SAXParserFactory spf = SAXParserFactory.newInstance();\n  spf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n  spf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n  spf.newSAXParser();\n}      \n```\nFor more information, see\nhttps://semgrep.dev/docs/cheat-sheets/java-xxe/#3a-documentbuilderfactory.\n"
      metadata:
        category: security
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        technology:
            - java
            - xml
        vulnerability_class:
            - XML Injection
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                    - pattern: |
                        $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                        ...
                        $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
                            true);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities",false);
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: $FACTORY.newSAXParser();
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    $FACTORY = SAXParserFactory.newInstance();
                - patterns:
                    - pattern: $FACTORY
                    - pattern-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = SAXParserFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-general-entities", false);
                            ...
                            $FACTORY.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
                            ...
                          }
                          ...
                        }
      severity: WARNING
    - id: java_xxe_rule-TransformerfactoryDTDNotDisabled
      languages:
        - java
      message: "This rule identifies configurations of the TransformerFactory class where\nDOCTYPE declarations are enabled. Enabling DOCTYPE declarations without\nproper restrictions can make your application vulnerable to XML External\nEntity (XXE) attacks. In an XXE attack, an attacker can exploit the\nprocessing of external entity references within an XML document to access\ninternal files, conduct denial-of-service attacks, or SSRF (Server Side\nRequest Forgery), potentially leading to sensitive information disclosure\nor system compromise.\n\nTo mitigate XXE vulnerabilities related to the TransformerFactory instance in \nJava, it is crucial to disable external DTD (Document Type Definition) and \nexternal stylesheet processing. This can be accomplished by setting the \nACCESS_EXTERNAL_DTD and ACCESS_EXTERNAL_STYLESHEET factory attributes to an \nempty string (\"\"). This approach prevents the parser from fetching and processing \nexternal references specified in the XML document.\n\nSecure Code Example:\n```\npublic static void configureTransformerFactory() throws TransformerConfigurationException {\n  TransformerFactory factory = TransformerFactory.newInstance();\n  // Disable access to external DTDs and stylesheets to prevent XXE\n  factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n  factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-611
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://blog.sonarsource.com/secure-xml-processor
            - https://xerces.apache.org/xerces2-j/features.html
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        technology:
            - java
            - xml
      mode: taint
      pattern-sanitizers:
        - by-side-effect: true
          pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: |
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, ""); ...
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                    - pattern: |
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                        ...
                        $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                    - pattern: |
                        $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", ""); ...
                        $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                    - pattern: |
                        $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                        ...
                        $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                - focus-metavariable: $FACTORY
            - patterns:
                - pattern-either:
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                          }
                          ...
                        }
                    - pattern-inside: |
                        class $C {
                          ...
                          $T $M(...) {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                          }
                          ...
                        }
                - pattern: $M($X)
                - focus-metavariable: $X
      pattern-sinks:
        - patterns:
            - pattern: $FACTORY.newTransformer(...);
      pattern-sources:
        - by-side-effect: true
          patterns:
            - pattern-either:
                - pattern: |
                    $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                - patterns:
                    - pattern: $FACTORY
                    - pattern-inside: |
                        class $C {
                          ...
                          $V $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
                            ...
                            $FACTORY.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                          }
                          ...
                        }
                    - pattern-not-inside: |
                        class $C {
                          ...
                          $V $FACTORY = javax.xml.transform.TransformerFactory.newInstance();
                          static {
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalStylesheet.*/", "");
                            ...
                            $FACTORY.setAttribute("=~/.*accessExternalDTD.*/", "");
                            ...
                          }
                          ...
                        }
      severity: WARNING
    - id: java_xxe_rule-XMLInputFactoryExternalEntitiesEnabled
      languages:
        - java
      message: "XML external entities are enabled for this XMLInputFactory. Enabling external \nentities can make the application vulnerable to XML external entity attacks. \nIn an XXE attack, an attacker can exploit the processing of external entity \nreferences within an XML document to access internal files, conduct \ndenial-of-service attacks, or SSRF (Server Side Request Forgery), potentially \nleading to sensitive information disclosure or system compromise.\n\nTo mitigate this vulnerability, disable external entities by\nsetting \"javax.xml.stream.isSupportingExternalEntities\" to false.\n\nSecure Code Example:\n```\npublic GoodXMLInputFactory() {\n  final XMLInputFactory xmlInputFactory = XMLInputFactory.newFactory();\n  xmlInputFactory.setProperty(XMLInputFactory.SUPPORT_DTD, false);\n  xmlInputFactory.setProperty(\"javax.xml.stream.isSupportingExternalEntities\", false);\n}\n```\nFor more details, refer to https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.md#xmlinputfactory-a-stax-parser\n"
      metadata:
        category: security
        confidence: LOW
        cwe: CWE-611
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: HIGH
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        references:
            - https://semgrep.dev/blog/2022/xml-security-in-java
            - https://semgrep.dev/docs/cheat-sheets/java-xxe/
            - https://www.blackhat.com/docs/us-15/materials/us-15-Wang-FileCry-The-New-Age-Of-XXE-java-wp.pdf
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference
        vulnerability_class:
            - XML Injection
      pattern: |
        $XMLFACTORY.setProperty("javax.xml.stream.isSupportingExternalEntities",
        true);
      severity: WARNING
    - id: java_xxe_rule-XMLStreamRdr
      languages:
        - java
      message: "External XML entities are a feature of XML parsers that allow \ndocuments to contain references to other documents or data. This \nfeature can be abused to read files, communicate with external\nhosts, exfiltrate data, or cause a Denial of Service (DoS).\nIn most XML parsers, the recommendation to protect against XXE is \nto disable the doctype feature.\nUnfortunately use of the `XMLInputFactory` requires that the doctypes \nfeature be enabled. Instead the application can set the `ACCESS_EXTERNAL_DTD` \nto an empty string and disable `javax.xml.stream.isSupportingExternalEntities`.\n\nSecure Code Example:\n```\n// Create an XMLInputFactory\nXMLInputFactory factory = XMLInputFactory.newFactory();\n// Set the ACCESS_EXTERNAL_DTD property to an empty string so it won't access\n// entities using protocols\n// (ref:\nhttps://docs.oracle.com/javase/8/docs/api/javax/xml/XMLConstants.html#ACCESS_EXTERNAL_DTD)\nfactory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n// Additionally, disable support for resolving external entities\nfactory.setProperty(\"javax.xml.stream.isSupportingExternalEntities\", false);\n// Continue to work with the factory/stream parser\n```\n\nFor more information on XML security see OWASP's guide:\nhttps://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java\n"
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      patterns:
        - pattern-not-inside: |
            (javax.xml.stream.XMLInputFactory $FAC).setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "");
            ...
        - pattern-not-inside:
            patterns:
                - pattern-either:
                    - pattern: |
                        (javax.xml.stream.XMLInputFactory $FAC).setProperty(XMLInputFactory.SUPPORT_DTD, $FALSE);
                        ...
                    - pattern: |
                        (javax.xml.stream.XMLInputFactory $FAC).setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, $FALSE);
                        ...
                    - pattern: |
                        (javax.xml.stream.XMLInputFactory $FAC).setProperty("javax.xml.stream.isSupportingExternalEntities", $FALSE);
                        ...
                - metavariable-pattern:
                    metavariable: $FALSE
                    pattern-either:
                        - pattern: |
                            false
                        - pattern: |
                            Boolean.FALSE
        - pattern: |
            (javax.xml.stream.XMLInputFactory $FAC).createXMLStreamReader(...)
      severity: WARNING
    - id: javascript_exec_rule-child-process
      languages:
        - javascript
        - typescript
      message: |
        OS command injection is a critical vulnerability that can lead to a full system
        compromise as it may allow an adversary to pass in arbitrary commands or arguments
        to be executed.

        User input should never be used in constructing commands or command arguments
        to functions which execute OS commands. This includes filenames supplied by
        user uploads or downloads.

        Ensure your application does not:

        - Use user-supplied information in the process name to execute.
        - Use user-supplied information in an OS command execution function which does
        not escape shell meta-characters.
        - Use user-supplied information in arguments to OS commands.

        The application should have a hardcoded set of arguments that are to be passed
        to OS commands. If filenames are being passed to these functions, it is
        recommended that a hash of the filename be used instead, or some other unique
        identifier. It is strongly recommended that a native library that implements
        the same functionality be used instead of using OS system commands, due to the
        risk of unknown attacks against third-party commands.

        When specifying the OS command, ensure the application uses the full path
        information, otherwise the OS may attempt to look up which process to execute
        and could be vulnerable to untrusted search path vulnerabilities (CWE-426).

        Example of safely executing an OS command:
        ```
        const child_process = require('child_process');
        const fs = require('fs');
        const crypto = require('node:crypto');
        const { mkdtempSync } = require('node:fs');

        function executeCommand(userFileData) {
            // Create a temporary directory, preferably in an application directory
            // that only the application has access to.
            const fileDir = mkdtempSync('/tmp/tmpdir-');
            // Generate a random filename, do not use user input
            const filePath = fileDir + path.sep + crypto.randomUUID();
            // Write the user-supplied data to the temporary file.
            fs.writeFileSync(filePath, userFileData);
            // Execute a program with a hardcoded path to the binary
            child_process.exec(`/bin/cat ${filePath}`, (error, stdout, stderr) => {
                // Delete the temporary directory and file if no longer needed
                fs.rmSync(fileDir, { recursive: true, force: true });
                if (error) {
                  console.error(`exec error: ${error}`);
                  return;
                }
                console.log(`stdout: ${stdout}`);
                console.error(`stderr: ${stderr}`);
            });
        }
        ```

        For more information on OS command injection, see OWASP's guide:
        https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html

        Detected non-literal calls to child_process.exec(). This could lead to a command
        injection vulnerability.
      metadata:
        category: security
        cwe: CWE-78
        cwe2021-top25: true
        cwe2022-top25: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html#do-not-use-dangerous-functions
        security-severity: HIGH
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        source-rule-url: https://github.com/nodesecurity/eslint-plugin-security/blob/master/rules/detect-child-process.js
        subcategory:
            - audit
        technology:
            - javascript
        vulnerability_class:
            - Command Injection
      mode: taint
      options:
        taint_unify_mvars: true
      pattern-sanitizers:
        - pattern: |
            $CMD = "..."
        - pattern: |
            $CMD = ["...",...]
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $CP = require('child_process')
                    ...
                - pattern-inside: |
                    import * as $CP from 'child_process'
                    ...
                - pattern-inside: |
                    import $CP from 'child_process'
                    ...
            - pattern-either:
                - pattern: $CP.exec($CMD,...)
                - pattern: $CP.execSync($CMD,...)
                - pattern: $CP.spawn($CMD,...)
                - pattern: $CP.spawnSync($CMD,...)
            - focus-metavariable: $CMD
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ... (...,$ARG,...) {
                  ...
                }
            - focus-metavariable: $ARG
      severity: ERROR
    - id: php_assert_rule-assert-use
      languages:
        - php
      message: Calling assert with user input is equivalent to eval'ing.
      metadata:
        category: security
        cwe: CWE-95
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://www.php.net/manual/en/function.assert
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/AssertsSniff.php
        security-severity: CRITICAL
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
        subcategory:
            - vuln
        technology:
            - php
        vulnerability_class:
            - Code Injection
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: assert($SINK, ...);
            - pattern-not: assert("...", ...);
            - pattern: $SINK
      pattern-sources:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: $_GET
                    - pattern: $_POST
                    - pattern: $_COOKIE
                    - pattern: $_REQUEST
                    - pattern: $_SERVER
            - patterns:
                - pattern: |
                    Route::$METHOD($ROUTENAME, function(..., $ARG, ...) { ... })
                - focus-metavariable: $ARG
      severity: ERROR
    - id: php_backticks_rule-backticks-use
      languages:
        - php
      message: Backticks use may lead to command injection vulnerabilities.
      metadata:
        category: security
        cwe: CWE-94
        cwe2022-top25: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://www.php.net/manual/en/language.operators.execution.php
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/BackticksSniff.php
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code ('Code Injection')
        subcategory:
            - audit
        technology:
            - php
        vulnerability_class:
            - Code Injection
      pattern: '`...`;'
      severity: ERROR
    - id: php_eval_rule-eval-use
      languages:
        - php
      message: Evaluating non-constant commands. This can lead to command injection.
      metadata:
        category: security
        cwe: CWE-78
        cwe2021-top25: true
        cwe2022-top25: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://www.php.net/manual/en/function.eval
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/NoEvalsSniff.php
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        subcategory:
            - audit
        technology:
            - php
        vulnerability_class:
            - Command Injection
      patterns:
        - pattern: eval(...);
        - pattern-not: eval('...');
      severity: ERROR
    - id: php_exec_rule-exec-use
      languages:
        - php
      message: Executing non-constant commands. This can lead to command injection.
      metadata:
        category: security
        cwe: CWE-94
        cwe2022-top25: true
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/SystemExecFunctionsSniff.php
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code ('Code Injection')
        subcategory:
            - audit
        technology:
            - php
        vulnerability_class:
            - Code Injection
      patterns:
        - pattern: $FUNC(...);
        - pattern-not: $FUNC('...', ...);
        - metavariable-regex:
            metavariable: $FUNC
            regex: exec|passthru|proc_open|popen|shell_exec|system|pcntl_exec
      severity: ERROR
    - id: php_file_rule-file-inclusion
      languages:
        - php
      message: Detected non-constant file inclusion. This can lead to local file inclusion (LFI) or remote file inclusion (RFI) if user input reaches this statement. LFI and RFI could lead to sensitive files being obtained by attackers. Instead, explicitly specify what to include. If that is not a viable solution, validate user input thoroughly.
      metadata:
        category: security
        cwe: CWE-98
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://www.php.net/manual/en/function.include.php
            - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/EasyRFISniff.php
            - https://en.wikipedia.org/wiki/File_inclusion_vulnerability#Types_of_Inclusion
        security-severity: CRITICAL
        shortDescription: Improper control of filename for include/require statement in PHP program ('PHP Remote File Inclusion')
        subcategory:
            - audit
        technology:
            - php
        vulnerability_class:
            - Code Injection
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern-inside: basename($PATH, ...)
                - pattern-inside: linkinfo($PATH, ...)
                - pattern-inside: readlink($PATH, ...)
                - pattern-inside: realpath($PATH, ...)
                - pattern-inside: include_safe(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: $FUNC(...);
            - pattern: $VAR
            - metavariable-regex:
                metavariable: $FUNC
                regex: \b(include|include_once|require|require_once)\b
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: $_GET
                - pattern: $_POST
                - pattern: $_COOKIE
                - pattern: $_REQUEST
                - pattern: $_SERVER
      severity: ERROR
    - id: properties_spring_rule-SpringActuatorFullyEnabled
      languages:
        - generic
      message: "Spring Boot Actuator is fully enabled. This exposes sensitive endpoints\nsuch as /actuator/env, /actuator/logfile, /actuator/heapdump and others.\nIf the application lacks proper security measures (e.g., authentication and \nauthorization), sensitive data could be accessed, compromising the application and \nits infrastructure. This configuration poses a serious risk in production \nenvironments or public-facing deployments.\n\nTo mitigate the risks, take the following measures:\n  - Expose only the Actuator endpoints required for your use case\n  - For production environments, restrict exposure to non-sensitive endpoints \n  like `health` or `info`\n  - Ensure Actuator endpoints are protected with authentication and authorization \n  (e.g., via Spring Security)\n  - Use environment-specific configurations to limit exposure in production\n\nSecure Code Example:\nInstead of include: \"*\", list only the endpoints you need to expose:\n```\nmanagement.endpoints.web.exposure.include=\"health,info,metrics\"\n```\n\nReferences:\n- https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.exposing\n- https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785\n- https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-497
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021-Broken Access Control
            - A3:2017-Sensitive Data Exposure
        security-severity: Medium
        shortDescription: Exposure of sensitive system information to an unauthorized control sphere
        technology:
            - java
      paths:
        include:
            - '*properties'
      pattern: management.endpoints.web.exposure.include=*
      severity: WARNING
    - id: python_crypto_rule-HTTPConnectionPool
      languages:
        - python
      message: "The application is using HTTPConnectionPool method. This method transmits\ndata in cleartext, which is vulnerable to MITM (Man in the middle)\nattacks. In MITM attacks, the data transmitted over the unencrypted\nconnection can be intercepted, read and/or modified by unauthorized\nparties which can lead to data integrity and confidentiality loss. \n\nTo mitigate this issue, use HTTPSConnectionPool instead, which encrypts \ncommunications and enhances security.\n\nSecure Code Example:\n```\nimport urllib3\nspool = urllib3.connectionpool.HTTPSConnectionPool(\"example.com\")\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-319
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://urllib3.readthedocs.io/en/1.2.1/pools.html#urllib3.connectionpool.HTTPSConnectionPool
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
        subcategory:
            - audit
        technology:
            - python
      pattern-either:
        - pattern: urllib3.HTTPConnectionPool(...)
        - pattern: urllib3.connectionpool.HTTPConnectionPool(...)
      severity: WARNING
    - id: python_django_rule-django-raw-used
      languages:
        - python
      message: "SQL Injections are a critical type of vulnerability that can lead to data \nor system compromise. By dynamically generating SQL query strings, user \ninput may be able to influence the logic of the SQL statement. \nThis could lead to an adversary accessing information they should not \nhave access to, or in some circumstances, being able to execute OS functionality\nor code.\n\nReplace all dynamically generated SQL queries with parameterized queries. \nIn situations where dynamic queries must be created, never use direct user input,\nbut instead use a map or dictionary of valid values and resolve them using a user \nsupplied key.\n\nFor example, some database drivers do not allow parameterized queries for \n`>` or `<` comparison operators. In these cases, do not use a user supplied \n`>` or `<` value, but rather have the user supply a `gt` or `lt` value. \nThe alphabetical values are then used to look up the `>` and `<` values to be used \nin the construction of the dynamic query. The same goes for other queries where \ncolumn or table names are required but cannot be parameterized.\n\nData that is possible user-controlled from a python request is passed\nto `raw()` function. To remediate this issue, use django's QuerySets, \nwhich are built with query parameterization and therefore not vulnerable \nto sql injection. For example, you could use `Entry.objects.filter(date=2006)`\n\nIf for some reason this is not feasible, ensure calls including user-supplied \ndata pass it in to the `params` parameter of the `raw()` method.\nBelow is an example using `raw()`, passing in user-supplied data as `params`. \nThis will treat the query as a parameterized query and `params` as strictly data, \npreventing any possibility of SQL Injection.\n\n```\ndef test(request):\n  uname = request.GET[\"username\"] \n  res = User.objects.raw('SELECT * FROM myapp_user WHERE username = %s', (uname,))\n```\n\nFor more information on QuerySet see:\n- https://docs.djangoproject.com/en/5.0/ref/models/querysets/\n\nFor more information on SQL Injection see OWASP:\n- https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL Command ('SQL Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-inside: $MODEL.objects.raw($QUERY, ... )
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-inside: "def $VIEW(...,$PARAM,...):\n  ...\n  return ...    \n"
      severity: ERROR
    - id: python_django_rule-django-rawsql-used
      languages:
        - python
      message: "SQL Injections are a critical type of vulnerability that can lead to data or system compromise. By \ndynamically generating SQL query strings, user input may be able to influence the logic of the SQL \nstatement. This could lead to an adversary accessing information they should not have access to, or in\nsome circumstances, being able to execute OS functionality or code.\n\nReplace all dynamically generated SQL queries with parameterized queries. In situations where dynamic \nqueries must be created, never use direct user input, but instead use a map or dictionary of valid values \nand resolve them using a user supplied key.\n\nFor example, some database drivers do not allow parameterized queries for `>` or `<` comparison operators. \nIn these cases, do not use a user supplied `>` or `<` value, but rather have the user supply a `gt` or `lt` \nvalue. The alphabetical values are then used to look up the `>` and `<` values to be used in the \nconstruction of the dynamic query. The same goes for other queries where column or table names are required \nbut cannot be parameterized.\n\nTo remediate this issue, do not use `raw` or `RawSQL` but use other `QuerySet` methods to achieve the same\ngoals. If for some reason this is not feasible, ensure calls including user-supplied data pass it in to \nthe `params` parameter of the `RawSQL` method.\n\nWhile not recommended due to [potential SQL Injection](https://docs.djangoproject.com/en/5.0/ref/models/expressions/#raw-sql-expressions), below is an example using `RawSQL`.\nPassing in user-supplied data as a `param` which will escape the input:\n\n```\n# If dealing with integer based user input, restrict the values to integers only using the\n# path configuration: path('/someview/<int:user_supplied_id>', views.some_view, name='someview'),\n\n# views.py\ndef some_view(request, user_supplied_id):\n  # Never use string interpolation in the `sql` parameter.\n  # Never quote the `%s` string format such as `... where id='%s'` as this could lead to SQL Injection.\n  # Pass the user supplied data only in the `params` parameter.\n  for obj in DBObject.objects.all().annotate(\n      val=RawSQL(sql=\"select id from some_secondary_table where id=%s\", params=[user_supplied_id])):\n    # Work with the results from the query\n    # ...\n```\n\nFor more information on QuerySets see:\n- https://docs.djangoproject.com/en/4.2/ref/models/querysets/#queryset-api\n\nFor more information on SQL Injection see OWASP:\n- https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements used in an SQL Command ('SQL Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $QUERY
            - pattern-inside: django.db.models.expressions.RawSQL($QUERY, ... )
      pattern-sources:
        - patterns:
            - pattern: $PARAM
            - pattern-inside: |
                def $VIEW(...,$PARAM,...):
                  ...
                  return ...
      severity: ERROR
    - id: python_escaping_rule-django
      languages:
        - python
      message: |
        Cross Site Scripting (XSS) is an attack which exploits a web application or system to treat
        user input
        as markup or script code. It is important to encode the data depending on the specific context
        it
        is used in. There are at least six context types:

        - Inside HTML tags `<div>context 1</div>`
        - Inside attributes: `<div class="context 2"></div>`
        - Inside event attributes `<button onclick="context 3">button</button>`
        - Inside script blocks: `<script>var x = "context 4"</script>`
        - Unsafe element HTML assignment: `element.innerHTML = "context 5"`
        - Inside URLs: `<iframe src="context 6"></iframe><a href="context 6">link</a>`

        Script blocks alone have multiple ways they need to be encoded. Extra care must be taken if
        user input
        is ever output inside of script tags.

        User input that is displayed within the application must be encoded, sanitized or validated
        to ensure it cannot be treated as HTML or executed as Javascript code. Care must also be
        taken
        to not mix server-side templating with client-side templating, as the server-side templating
        will
        not encode things like {{ 7*7 }} which may execute client-side templating features.

        It is _NOT_ advised to encode user input prior to inserting into a data store. The data will
        need to be
        encoded depending on context of where it is output. It is much safer to force the displaying
        system to
        handle the encoding and not attempt to guess how it should be encoded.

        Consider using
        [format_html](https://docs.djangoproject.com/en/4.2/ref/utils/#django.utils.html.format_html)
        instead of
        the `django.utils.safestring` methods.

        Example using `format_html`:
        ```
        # Use format_html to create an HTML link, using href as the parameter
        # which will be encoded automatically
        format_html("<li><a href='{}'>Some Link</a></li>", href)
        ```

        For more information on XSS see OWASP:
        - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      patterns:
        - pattern-not-inside: django.utils.html.format_html(...)
        - pattern-either:
            - patterns:
                - pattern: django.utils.safestring.SafeText(...)
                - pattern-not: django.utils.safestring.SafeText("...")
            - patterns:
                - pattern: django.utils.safestring.SafeUnicode(...)
                - pattern-not: django.utils.safestring.SafeUnicode("...")
            - patterns:
                - pattern: django.utils.safestring.SafeString(...)
                - pattern-not: django.utils.safestring.SafeString("...")
            - patterns:
                - pattern: django.utils.safestring.SafeBytes(...)
                - pattern-not: django.utils.safestring.SafeBytes("...")
            - patterns:
                - pattern: django.utils.safestring.mark_safe(...)
                - pattern-not: django.utils.safestring.mark_safe("...")
      severity: WARNING
    - id: python_flask_rule-path-traversal-open
      languages:
        - python
      message: "Found request data in a call to 'open'. An attacker can manipulate this input to access files outside the intended \ndirectory. This can lead to unauthorized access to sensitive files or directories. To prevent path traversal attacks, \navoid using user-controlled input in file paths. If you must use user-controlled input, validate and sanitize the \ninput to ensure it does not contain any path traversal sequences. For example, you can use the `os.path.join` function \nto safely construct file paths or validate that the absolute path starts with the directory which is whitelisted for \naccessing file. The following code snippet demonstrates how to validate a file path from user-controlled input:\n```\nimport os\n\ndef safe_open_file(filename, base_path):\n  # Resolve the absolute path of the user-supplied filename\n  absolute_path = os.path.abspath(filename)\n\n  # Check that the absolute path starts with the base path\n  if not absolute_path.startswith(base_path):\n      raise ValueError(\"Invalid file path\")\n\n  return open(absolute_path, 'r')\n```\nFor more information, see the OWASP Path Traversal page: https://owasp.org/www-community/attacks/Path_Traversal\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-22
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
        security-severity: CRITICAL
        shortDescription: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
        technology:
            - flask
      pattern-either:
        - patterns:
            - pattern: open(...)
            - pattern-either:
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      open(..., <... $ROUTEVAR ...>, ...)
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      with open(..., <... $ROUTEVAR ...>, ...) as $FD:
                        ...
                - pattern-inside: |
                    @$APP.route($ROUTE, ...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                      $INTERIM = <... $ROUTEVAR ...>
                      ...
                      open(..., <... $INTERIM ...>, ...)
        - pattern: open(..., <... flask.request.$W.get(...) ...>, ...)
        - pattern: open(..., <... flask.request.$W[...] ...>, ...)
        - pattern: open(..., <... flask.request.$W(...) ...>, ...)
        - pattern: open(..., <... flask.request.$W ...>, ...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W.get(...) ...>
                ...
                open(<... $INTERIM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W[...] ...>
                ...
                open(<... $INTERIM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W(...) ...>
                ...
                open(<... $INTERIM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W ...>
                ...
                open(<... $INTERIM ...>, ...)
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W.get(...) ...>
                ...
                with open(<... $INTERIM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W[...] ...>
                ...
                with open(<... $INTERIM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W(...) ...>
                ...
                with open(<... $INTERIM ...>, ...) as $F:
                  ...
            - pattern: open(...)
        - patterns:
            - pattern-inside: |
                $INTERIM = <... flask.request.$W ...>
                ...
                with open(<... $INTERIM ...>, ...) as $F:
                  ...
            - pattern: open(...)
      severity: ERROR
    - id: python_flask_rule-tainted-sql-string
      languages:
        - python
      message: "Detected user input used to manually construct a SQL string. This is usually\nbad practice because manual construction could accidentally result in a SQL\ninjection. An attacker could use a SQL injection to steal or modify contents\nof the database. Instead, use a parameterized query which is available\nby default in most database engines. Alternatively, consider using an\nobject-relational mapper (ORM) such as SQLAlchemy which will protect your queries.\n\nSQL Injections are a critical type of vulnerability that can lead to data \nor system compromise. By dynamically generating SQL query strings, user \ninput may be able to influence the logic of an SQL statement. \nThis could lead to an malicious parties accessing information they should not \nhave access to, or in some circumstances, being able to execute OS functionality\nor code.\n\nReplace all dynamically generated SQL queries with parameterized queries. \nIn situations where dynamic queries must be created, never use direct user input,\nbut instead use a map or dictionary of valid values and resolve them using a user \nsupplied key.\n\nFor example, some database drivers do not allow parameterized queries for \n`>` or `<` comparison operators. In these cases, do not use a user supplied \n`>` or `<` value, but rather have the user supply a `gt` or `lt` value. \nThe alphabetical values are then used to look up the `>` and `<` values to be used \nin the construction of the dynamic query. The same goes for other queries where \ncolumn or table names are required but cannot be parameterized.\nData that is possible user-controlled from a python request is passed\nto `execute()` function. To remediate this issue, use SQLAlchemy statements\nwhich are built with query parameterization and therefore not vulnerable \nto sql injection.\n\nIf for some reason this is not feasible, ensure calls including user-supplied \ndata pass it in to the `params` parameter of the `execute()` method.\nBelow is an example using `execute()`, passing in user-supplied data as `params`. \nThis will treat the query as a parameterized query and `params` as strictly data, \npreventing any possibility of SQL Injection.\n\n```\nname = request.args.get('name')\nreq = text('SELECT * FROM student WHERE firstname = :x')\nresult = db.session.execute(req, {\"x\":name})\n```\nFor more information on QuerySets see:\n- https://docs.djangoproject.com/en/4.2/ref/models/querysets/#queryset-api\nFor more information on SQL Injections see OWASP:\n- https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: High
        shortDescription: Improper neutralization of special elements used in an SQL Command ('SQL Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    <... "$QUERYLIKE" ...>
            - metavariable-regex:
                metavariable: $QUERYLIKE
                regex: .*\b(?i)(SELECT .+ FROM|WHERE|DELETE FROM|INSERT INTO| CREATE TABLE|UPDATE .+ SET|ALTER TABLE|ALTER COLUMN|DROP COLUMN|DROP TABLE|ORDER BY)\b.*
      pattern-sources:
        - pattern-either:
            - pattern: flask.request.$ANYTHING
            - patterns:
                - pattern-inside: |
                    @$APP.route(...)
                    def $FUNC(..., $ROUTEVAR, ...):
                      ...
                - pattern: $ROUTEVAR
      severity: ERROR
    - id: python_flask_rule-flask-open-redirect
      languages:
        - python
      message: |-
        Data from request is passed to redirect(). This is an open redirect and could be exploited. Consider using 'url_for()'  to generate links to known locations. If you must use a URL to unknown pages, consider using 'urlparse()' or similar  and checking if the 'netloc' property is the same as your site's host name. For example:

          Example:
          ```python
          from flask import Flask, request, redirect, url_for
          from urllib.parse import urlparse

          app = Flask(__name__)

          @app.route('/login')
          def login():
              next = request.args.get('next')
              if not next:
                  next = url_for('index')
              if urlparse(next).netloc != urlparse(request.url).netloc:
                  return redirect(url_for('index'))
              return redirect(next)
          ```
         See the references for more information.
      metadata:
        category: security
        confidence: LOW
        cwe: CWE-601
        impact: MEDIUM
        likelihood: LOW
        owasp:
            - A01:2021-Broken Access Control
            - A5:2017-Broken Access Control
        references: |
            - https://flask-login.readthedocs.io/en/latest/#login-example
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html#dangerous-url-redirect-example-1
            - https://docs.python.org/3/library/urllib.parse.html#url-parsing
        security-severity: MEDIUM
        shortDescription: URL redirection to untrusted site ('Open Redirect')
        subcategory:
            - audit
        technology:
            - flask
      patterns:
        - pattern-inside: |
            @$APP.route(...)
            def $X(...):
              ...
        - pattern-not-inside: |
            @$APP.route(...)
            def $X(...):
              ...
              if <... werkzeug.urls.url_parse($V) ...>:
                ...
        - pattern-either:
            - pattern: flask.redirect(<... flask.request.$W.get(...) ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W[...] ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W(...) ...>, ...)
            - pattern: flask.redirect(<... flask.request.$W ...>, ...)
            - pattern: |
                $V = flask.request.$W.get(...)
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W[...]
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W(...)
                ...
                flask.redirect(<... $V ...>, ...)
            - pattern: |
                $V = flask.request.$W
                ...
                flask.redirect(<... $V ...>, ...)
        - pattern-not: flask.redirect(flask.request.path)
        - pattern-not: flask.redirect(flask.request.path + ...)
        - pattern-not: flask.redirect(f"{flask.request.path}...")
      severity: WARNING
    - id: python_jwt_rule-jwt-none-alg
      languages:
        - python
      message: |
        Detected use of the 'none' algorithm in a JWT token.
        The 'none' algorithm assumes the integrity of the token has already
        been verified. This would allow a malicious actor to forge a JWT token
        that will automatically be verified. Do not explicitly use the 'none'
        algorithm. Instead, use an algorithm such as 'HS256'.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-327
        impact: MEDIUM
        likelihood: MEDIUM
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://owasp.org/Top10/A02_2021-Cryptographic_Failures
        security-severity: MEDIUM
        shortDescription: Use of a Broken or Risky Cryptographic Algorithm
        source-rule-url: https://semgrep.dev/blog/2020/hardcoded-secrets-unverified-tokens-and-other-common-jwt-mistakes/
        subcategory:
            - vuln
        technology:
            - jwt
      pattern-either:
        - pattern: jwt.encode(...,algorithm="none",...)
        - pattern: jwt.decode(...,algorithms=[...,"none",...],...)
      severity: ERROR
    - id: python_pyramid_rule-pyramid-csrf-origin-check
      languages:
        - python
      message: "Automatic check of the referrer for cross-site request forgery tokens\nhas been explicitly disabled globally, which might leave views unprotected\nwhen an unsafe CSRF storage policy is used. By passing `check_origin=False` \nto `set_default_csrf_options()` method, you opt out of checking the origin \nof the domain in the referrer header or the origin header, which can make \nthe application vulnerable to CSRF attacks, specially if CSRF token is not \nproperly implemented.\nCSRF attacks are a type of exploit where an attacker tricks a user into \nexecuting unwanted actions on a web application in which they are authenticated. \nIf a user is logged into a web application, an attacker could create a malicious \nlink or script on another site that causes the user's browser to make a request \nto the web application, carrying out an action without the user's consent.\n\nTo mitigate this vulnerability, use \n'pyramid.config.Configurator.set_default_csrf_options(check_origin=True)'\nto turn the automatic check for all unsafe methods (per RFC2616).\n\nSecure Code Example:\n```\ndef safe(config):\n  config.set_csrf_storage_policy(CookieCSRFStoragePolicy())\n  config.set_default_csrf_options(check_origin=True)\n```\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-352
        cwe2021-top25: "true"
        cwe2022-top25: "true"
        impact: LOW
        license: Commons Clause License Condition v1.0[LGPL-2.1-only]
        likelihood: LOW
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
            - https://docs.pylonsproject.org/projects/pyramid/en/latest/narr/security.html
        security-severity: MEDIUM
        shortDescription: Cross-site request forgery (CSRF)
        subcategory:
            - vuln
        technology:
            - pyramid
        vulnerability_class:
            - Cross-Site Request Forgery (CSRF)
      patterns:
        - pattern-inside: |
            $CONFIG.set_default_csrf_options(..., check_origin=$CHECK_ORIGIN, ...)
        - pattern: |
            $CHECK_ORIGIN
        - metavariable-comparison:
            comparison: $CHECK_ORIGIN == False
            metavariable: $CHECK_ORIGIN
      severity: WARNING
    - id: ruby_cookie_rule-CookieSerialization
      languages:
        - ruby
      message: "The rule warns of a significant security risk in applications that use \nRuby's Marshal module for deserializing cookies. Marshal can serialize \nand deserialize Ruby objects, which, while powerful, poses a risk if \nmisused. If an attacker crafts a malicious cookie that is deserialized, \nit could lead to remote code execution (RCE) on the server due to \nMarshal.load's ability to execute code in deserialized objects. To mitigate \nthis risk, developers are advised to switch from Marshal to JSON for cookie \nserialization. JSON is safer as it cannot execute arbitrary code, reducing \nthe threat of RCE vulnerabilities from deserialized user data. The hybrid \ncheck is just to warn users to migrate to :json for best practice.\n\nSecure code example:\n```\n# In Rails, configure the cookie serializer to :json\n# config/initializers/cookies_serializer.rb\nRails.application.config.action_dispatch.cookies_serializer = :json\n```\n\nAdditionally, always validate and sanitize user-supplied data as much \nas possible, even when using JSON, to further secure your application \nagainst various injection attacks.\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/cookie-serialization.yaml
            - https://robertheaton.com/2013/07/22/how-to-hack-a-rails-app-using-its-secret-token/
        security-severity: HIGH
        shortDescription: Improper control of generation of code ('Code Injection')
        technology:
            - ruby
      pattern-either:
        - pattern: |
            Rails.application.config.action_dispatch.cookies_serializer = :marshal
        - pattern: |
            Rails.application.config.action_dispatch.cookies_serializer = :hybrid
      severity: ERROR
    - id: ruby_crypto_rule-WeakHashesMD5
      languages:
        - ruby
      message: "The MD5 hashing algorithm is considered cryptographically weak and \nvulnerable to collision attacks, where two different inputs generate \nthe same output hash. When used for hashing sensitive data, attackers \ncan exploit this weakness to generate collisions, allowing them to bypass \nsecurity checks or masquerade malicious data as legitimate. This \nvulnerability is particularly critical in authentication mechanisms, \ndigital signatures, SSL/TLS certificates, and data integrity checks.\n\nRemediation:\nTo mitigate this vulnerability, replace the MD5 hashing algorithm with \nstronger cryptographic hash functions, such as SHA-256 or SHA-3. These \nalgorithms offer significantly improved security and are resistant to \ncollision attacks, making them suitable for cryptographic purposes in \nmodern applications.\n\nSecure Code example:\n```\nrequire 'openssl'\n\ndata = \"sensitive information\"\n# Using SHA-256\ndigest = OpenSSL::Digest::SHA256.new\nhash = digest.digest(data)\nhex_hash = digest.hexdigest(data)\n\n# Using SHA-3 (256 bits)\ndigest = OpenSSL::Digest::SHA3.new(256)\nhash2 = digest.digest(data)\nhex_hash2 = digest.hexdigest(data)\n```\n"
      metadata:
        category: security
        cwe: CWE-328
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/weak-hashes-md5.yaml
            - https://www.ibm.com/support/pages/security-bulletin-vulnerability-md5-signature-and-hash-algorithm-affects-sterling-integrator-and-sterling-file-gateway-cve-2015-7575
        security-severity: MEDIUM
        shortDescription: Use of weak hash
        technology:
            - ruby
      pattern-either:
        - pattern: Digest::MD5.base64digest $X
        - pattern: Digest::MD5.hexdigest $X
        - pattern: Digest::MD5.digest $X
        - pattern: Digest::MD5.new
        - pattern: OpenSSL::Digest::MD5.base64digest $X
        - pattern: OpenSSL::Digest::MD5.hexdigest $X
        - pattern: OpenSSL::Digest::MD5.digest $X
        - pattern: OpenSSL::Digest::MD5.new
      severity: WARNING
    - id: ruby_crypto_rule-WeakHashesSHA1
      languages:
        - ruby
      message: "The SHA-1 hashing algorithm is no longer considered secure for\ncryptographic applications due to its vulnerability to collision attacks,\nwhere two different inputs produce the same output hash. SHA-1's\nsusceptibility to collision attacks undermines the security of\ncryptographic operations, allowing attackers to forge signatures or\nmanipulate data without detection. This poses significant risks in\nauthentication systems, data integrity validations, and secure\ncommunications. \n\nRemediation: To mitigate this vulnerability, replace the SHA1 hashing \nalgorithm with stronger cryptographic hash functions, such as SHA-256 \nor SHA-3. These algorithms offer significantly improved security and \nare resistant to collision attacks, making them suitable for cryptographic \npurposes in modern applications.\n\nSecure Code example : \n``` \nrequire 'openssl'\n\ndata = \"sensitive information\"\n# Using SHA-256\ndigest = OpenSSL::Digest::SHA256.new\nhash = digest.digest(data)\nhex_hash = digest.hexdigest(data)\n\n# Using SHA-3 (256 bits)\ndigest = OpenSSL::Digest::SHA3.new(256)\nhash2 = digest.digest(data)\nhex_hash2 = digest.hexdigest(data)\n```\n"
      metadata:
        category: security
        cwe: CWE-328
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/weak-hashes-sha1.yaml
            - https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html
            - https://shattered.io/
        security-severity: MEDIUM
        shortDescription: Use of weak hash
        technology:
            - ruby
      pattern-either:
        - pattern: Digest::SHA1.$FUNC
        - pattern: OpenSSL::Digest::SHA1.$FUNC
        - pattern: OpenSSL::HMAC.$FUNC("sha1",...)
      severity: WARNING
    - id: ruby_csrf_rule-MissingCSRFProtection
      languages:
        - ruby
      message: "Detected controller which does not enable cross-site request forgery\nprotections using `protect_from_forgery`. When a Rails application does \nnot use `protect_from_forgery` in its controllers, it is vulnerable to \nCSRF attacks. This vulnerability can allow attackers to submit unauthorized \nrequests on behalf of authenticated users, potentially leading to \nunauthorized actions being performed. \nTo mitigate this risk, Rails offers the `protect_from_forgery` method, \nwhich integrates CSRF token verification in every form submitted to \nyour application, ensuring that requests are legitimate. \nAdd `protect_from_forgery with: :exception` to your controller class. \nThe `with: :exception` option configures Rails to raise an exception \nif a CSRF token cannot be verified, providing an additional layer of security. \nThis approach ensures that unverified requests do not proceed silently, \nallowing for appropriate error handling and response measures.\n\nSecure Code Example:\n```\nclass YourController < ApplicationController\n  protect_from_forgery with: :exception\n  # Your controller actions here\nend\n```\nFor more information on CSRF, see OWASP guide:\nhttps://owasp.org/www-community/attacks/csrf\n"
      metadata:
        category: security
        cwe: CWE-352
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/missing-csrf-protection.yaml
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control
        security-severity: MEDIUM
        shortDescription: Cross-site request forgery (CSRF)
        technology:
            - ruby
      patterns:
        - pattern: |
            class $CONTROLLER < ActionController::Base
              ...
            end
        - pattern-not: |
            class $CONTROLLER < ActionController::Base
              ...
              protect_from_forgery
            end
      severity: WARNING
    - id: ruby_deserialization_rule-BadDeserialization
      languages:
        - ruby
      message: "In Ruby, objects can be serialized into strings using various methods \nand later reconstituted into objects. The `load` and `object_load` \nmethods, associated with modules like Marshal and CSV, is particularly \nrisky when used to deserialize data from untrusted sources. \nIf an attacker is able to manipulate the serialized data, they could \nexecute arbitrary code on the system when the data is deserialized. \nThis vulnerability can lead to remote code execution (RCE), where an \nattacker gains the ability to execute commands on the host machine. \nThe Marshal and CSV modules are often used for serialization and \ndeserialization in Ruby but they do not inherently sanitize or validate \nthe data being processed. This makes them unsafe for handling input from \nuntrusted sources.\n\nTo mitigate the risks associated with unsafe deserialization, it is \nrecommended to:\n- Avoid deserializing from untrusted sources\n- Use JSON for serialization/deserialization as JSON is considered \nsafer for data interchange between systems. However, it's crucial \nto use JSON securely by validating and sanitizing the input before \ndeserialization.\n\nSecure Code Example:\n```\nrequire 'json'\n\ndef safe_deserialize(json_data)\n  # Validate and sanitize json_data before parsing\n  begin\n    parsed_data = JSON.parse(json_data)\n    return parsed_data\n  rescue JSON::ParserError => e\n    puts \"Error parsing JSON data: #{e.message}\"\n    return nil\n  end\nend\n\n# Example usage\n# Example of input JSON string\njson_input = '{\"name\": \"John Doe\", \"age\": 30}' \nuser_data = safe_deserialize(json_input)\nputs user_data.inspect if user_data\n```\n\nAlways ensure that any data deserialized from JSON (or any format) is \nvalidated and sanitized according to the context of your application \nto prevent injection attacks or other security issues.\n"
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/bad-deserialization.yaml
        security-severity: HIGH
        shortDescription: Deserialization of untrusted data
        technology:
            - ruby
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: |
                Marshal.load(...)
            - pattern: |
                Marshal.restore(...)
            - pattern: |
                Oj.object_load(...)
            - pattern: |
                Oj.load($X)
      pattern-sources:
        - pattern-either:
            - pattern: params
            - pattern: cookies
      severity: ERROR
    - id: ruby_deserialization_rule-BadDeserializationEnv
      languages:
        - ruby
      message: "In Ruby, objects can be serialized into strings using various methods \nand later reconstituted into objects. The `load` and `object_load` \nmethods, associated with modules like Marshal and CSV, is particularly \nrisky when used to deserialize data from untrusted sources. \nIf an attacker is able to manipulate the serialized data, they could \nexecute arbitrary code on the system when the data is deserialized. \nThis vulnerability can lead to remote code execution (RCE), where an \nattacker gains the ability to execute commands on the host machine. \nThe Marshal and CSV modules are often used for serialization and \ndeserialization in Ruby but they do not inherently sanitize or validate \nthe data being processed. This makes them unsafe for handling input from \nuntrusted sources.\n\nTo mitigate the risks associated with unsafe deserialization, it is \nrecommended to:\n- Avoid deserializing from untrusted sources\n- Use JSON for serialization/deserialization as JSON is considered \nsafer for data interchange between systems. However, it's crucial \nto use JSON securely by validating and sanitizing the input before \ndeserialization.\n\nSecure Code Example:\n```\nrequire 'json'\n\ndef safe_deserialize(json_data)\n  # Validate and sanitize json_data before parsing\n  begin\n    parsed_data = JSON.parse(json_data)\n    return parsed_data\n  rescue JSON::ParserError => e\n    puts \"Error parsing JSON data: #{e.message}\"\n    return nil\n  end\nend\n\n# Example usage\n# Example of input JSON string\njson_input = '{\"name\": \"John Doe\", \"age\": 30}' \nuser_data = safe_deserialize(json_input)\nputs user_data.inspect if user_data\n```\n\nAlways ensure that any data deserialized from JSON (or any format) is \nvalidated and sanitized according to the context of your application \nto prevent injection attacks or other security issues.\n"
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/bad-deserialization-env.yaml
        security-severity: HIGH
        shortDescription: Deserialization of untrusted data
        technology:
            - ruby
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: |
                Marshal.load(...)
            - pattern: |
                Marshal.restore(...)
            - pattern: |
                Oj.object_load(...)
            - pattern: |
                Oj.load($X)
      pattern-sources:
        - pattern-either:
            - pattern: request.env
      severity: ERROR
    - fix: Psych.safe_load($...ARGS)
      id: ruby_deserialization_rule-BadDeserializationYAML
      languages:
        - ruby
      message: "Unsafe deserialization from YAML. \nYAML is a popular format for configuration files in Ruby applications \ndue to its readability and simplicity. However, the `load` method \nprovided by Ruby's YAML module can be dangerous when used to deserialize \ndata from untrusted sources. The method can instantiate objects based \non the YAML input, which can lead to remote code execution (RCE) if the \ninput contains malicious code. \n\nTo mitigate the risk of RCE through unsafe deserialization practices, \nconsider the following recommendations:\n- Prefer JSON for untrusted data: JSON is generally safer for \ndeserializing untrusted data because, by design, it does not support \nthe execution of arbitrary code. Ensure that any JSON deserialization \nis performed with caution, validating and sanitizing the input before \nuse.\n- Use safe YAML loading methods: If you must use YAML, prefer safe \nloading methods like `safe_load` instead of `load`. The `safe_load` method \nlimits the objects that can be deserialized, reducing the risk of \nexecuting arbitrary code.\n- Static YAML files: Loading YAML from static, trusted files (like \nconfiguration files that are not exposed to user input) is generally \nsafe. Ensure these files are securely managed and not modifiable by \nuntrusted sources.\n\nSecure Code Example:\n```\nrequire 'yaml'\nrequire 'json'\n\n# Safe YAML deserialization\ndef safe_load_yaml(file_path)\n    YAML.safe_load(File.read(file_path), [Date, Time], [], true)\nend\n\n# Example of safely loading a static YAML file\nconfig_data = safe_load_yaml('config.yml')\nputs config_data.inspect\n\n# Safe JSON deserialization\ndef safe_load_json(json_input)\n    # Always validate and sanitize input before deserialization\n    JSON.parse(json_input)\nend\n\n# Example JSON input\njson_input = '{\"name\": \"Jack Monroe\", \"age\": 30}'\nuser_data = safe_load_json(json_input)\nputs user_data.inspect\n```\n"
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://groups.google.com/g/rubyonrails-security/c/61bkgvnSGTQ/m/nehwjA8tQ8EJ
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/bad-deserialization-yaml.yaml
        security-severity: HIGH
        shortDescription: Deserialization of untrusted data
        technology:
            - ruby
            - yaml
      patterns:
        - pattern: |
            YAML.$LOAD($...ARGS)
        - pattern-not: |
            YAML.$LOAD(..., safe: true, ...)
        - pattern-not: |
            YAML.$LOAD("...", ...)
        - pattern-not-inside: |
            $FILE = File.read("...", ...)
            ...
            YAML.$LOAD(..., $FILE, ...)
        - pattern-not-inside: |
            $FILENAME = "..."
            ...
            $FILE = File.read($FILENAME, ...)
            ...
            YAML.$LOAD(..., $FILE, ...)
        - pattern-not-inside: |
            YAML.$LOAD(..., File.read("...", ...), ...)
        - metavariable-regex:
            metavariable: $LOAD
            regex: load(?:_stream)?\b|parse_stream
      severity: ERROR
    - id: ruby_escaping_rule-JSONEntityEscape
      languages:
        - ruby
      message: "This rule checks if HTML escaping is globally disabled for JSON output, \nwhich can lead to Cross-Site Scripting (XSS) vulnerabilities. \nXSS attacks allow attackers to inject malicious scripts into web pages \nviewed by other users, compromising the integrity and confidentiality \nof user data. When HTML escaping is disabled, special HTML characters \nin JSON output are not converted to their entity equivalents, making \nit possible for an attacker to inject executable scripts into the web \napplication's output. \n\nTo mitigate this risk, ensure that HTML escaping is enabled when \ngenerating JSON output, particularly in web applications \nthat dynamically insert user-generated content into the DOM.\n\nSecure Code Example:\n```\n# For an initializer configuration (e.g., in config/initializers/active_support.rb)\n# Enable HTML entity escaping in JSON to prevent XSS\nActiveSupport.escape_html_entities_in_json = true\n\n# For application-wide configuration (e.g., in config/application.rb)\nmodule YourApplication\n  class Application < Rails::Application\n    # Enable HTML entity escaping in JSON to prevent XSS\n    config.active_support.escape_html_entities_in_json = true\n  end\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/json-entity-escape.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - rails
      pattern-either:
        - pattern: |
            ActiveSupport.escape_html_entities_in_json = false
        - pattern: |
            config.active_support.escape_html_entities_in_json = false
      severity: WARNING
    - id: ruby_eval_rule-NoEval
      languages:
        - ruby
      message: "The `eval` method in Ruby executes a string argument as Ruby code. When \n`eval` is used with input that can be controlled or manipulated by an \nexternal user, it can allow arbitrary code execution. This \nmeans an attacker could potentially execute malicious code on the server, \nleading to unauthorized access, data leakage, or server compromise.\n\nRemediation Steps:\n- Validate and sanitize input: If there's an absolute necessity to use \n`eval`, ensure that any user input is rigorously validated and sanitized \nto remove potentially harmful code. However, this is generally not \nrecommended due to the difficulty of securely sanitizing code.\n- Use safer alternatives: Depending on the requirement, consider using \nsafer alternatives to `eval`, such as `send` for calling methods dynamically \nor employing DSLs (Domain-Specific Languages) and safe parsing libraries \ndesigned for specific tasks.\n\nSecure Code Example:\n```\nclass Calculator\n  def add(a, b)\n    a + b\n  end\nend\n\n# Safer alternative using send\ncalculator = Calculator.new\nmethod = params[:operation] # Example: 'add' or 'subtract'\na = params[:a].to_i\nb = params[:b].to_i\n\nif calculator.respond_to?(method)\n  result = calculator.send(method, a, b)\nelse\n  puts \"Invalid operation\"\nend\n```\n\nIn this example, `send` is used to dynamically call a method on the \nCalculator object based on user input. This approach is safer than \neval because it strictly limits the operations to those defined in \nthe class, preventing arbitrary code execution.\n"
      metadata:
        category: security
        cwe: CWE-95
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://owasp.org/Top10/A03_2021-Injection
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/no-eval.yaml
        security-severity: HIGH
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $X.eval
                - pattern: $X.class_eval
                - pattern: $X.instance_eval
                - pattern: $X.module_eval
                - pattern: $X.eval(...)
                - pattern: $X.class_eval(...)
                - pattern: $X.instance_eval(...)
                - pattern: $X.module_eval(...)
                - pattern: eval(...)
                - pattern: class_eval(...)
                - pattern: module_eval(...)
                - pattern: instance_eval(...)
            - pattern-not: $M("...",...)
      pattern-sources:
        - pattern-either:
            - pattern: params
            - pattern: cookies
            - patterns:
                - pattern: |
                    RubyVM::InstructionSequence.compile(...)
                - pattern-not: |
                    RubyVM::InstructionSequence.compile("...")
      severity: ERROR
    - id: ruby_file_rule-AvoidTaintedFileAccess
      languages:
        - ruby
      message: "The application dynamically constructs file or path information with user input. When an application uses data from \nuntrusted sources (like `params`, `cookies`, or `request.env`) to perform \nactions on the file system, it opens up potential vulnerabilities. \nA malicious actor could exploit this to access, modify, or delete \nfiles they shouldn't have access to, leading to information disclosure, \ndata loss, or server compromise. This type of vulnerability is often \nreferred to as a File Inclusion vulnerability or Path Traversal attack, \ndepending on the nature of the exploit.\n\nTo mitigate these risks, follow these best practices:\n- Validate and sanitize input: Ensure all user inputs are strictly \nvalidated and sanitized to prevent path traversal characters (like `../`) \nor other malicious patterns. Only allow filenames or paths that match \nspecific, safe patterns.\n- Use secure libraries: Utilize libraries or frameworks that abstract \nfile access in a secure manner, automatically handling the risks \nassociated with raw user input.\n- Least privilege principle: Run your application with the minimum \nnecessary file system permissions. Restrict the application's access \nto only those directories and files it absolutely needs.\n- Directory whitelisting: Maintain an allow list of permitted directories \nfor file operations, rejecting any requests for paths outside of these \ndirectories.\n\nSecure Code Example:\n```\ndef safe_file_read(filename)\n  # Define a list of allowed files or use regex to validate the filename format\n  allowed_files = ['allowed_file.txt', 'another_safe_file.txt']\n  \n  if allowed_files.include?(filename)\n    file_path = Rails.root.join('safe_directory', filename)\n    content = File.read(file_path)\n    return content\n  else\n    raise \"Access to the requested file is not allowed.\"\n  end\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/avoid-tainted-file-access.yaml
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: Dir.$X(...)
                - pattern: File.$X(...)
                - pattern: IO.$X(...)
                - pattern: Kernel.$X(...)
                - pattern: PStore.$X(...)
                - pattern: Pathname.$X(...)
            - metavariable-pattern:
                metavariable: $X
                patterns:
                    - pattern-either:
                        - pattern: chdir
                        - pattern: chroot
                        - pattern: delete
                        - pattern: entries
                        - pattern: foreach
                        - pattern: glob
                        - pattern: install
                        - pattern: lchmod
                        - pattern: lchown
                        - pattern: link
                        - pattern: load
                        - pattern: load_file
                        - pattern: makedirs
                        - pattern: move
                        - pattern: new
                        - pattern: open
                        - pattern: read
                        - pattern: readlines
                        - pattern: rename
                        - pattern: rmdir
                        - pattern: safe_unlink
                        - pattern: symlink
                        - pattern: syscopy
                        - pattern: sysopen
                        - pattern: truncate
                        - pattern: unlink
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby_file_rule-CheckRenderLocalFileInclude
      languages:
        - ruby
      message: "The application dynamically constructs file or path information with user input when calling the `render` function. This can allow end\nusers to request arbitrary local files which may result in leaking\nsensitive information persisted on disk. Where possible, avoid letting\nusers specify template paths for `render`. If you must allow user input,\nuse an allow-list of known templates or normalize the user-supplied value\nwith `File.basename(...)`.\n\nTo mitigate this vulnerability, follow these steps:\n- Avoid direct user input: If possible, do not use user input \nto determine file paths. Use a mapping of user input to server-side \ndefined file paths instead.\n- Use `File.basename`: If user input must be used to specify a file, \nensure that the input is normalized using `File.basename` to extract \nthe filename without any directory path. This prevents directory \ntraversal attacks.\n- Path allow listing: Implement an allow list of permitted files or \ndirectories and check user input against this list before processing.\n\nSecure Code Example:\n```\nclass PagesController < ApplicationController\n  # Allowlist\n  def show\n    valid_pages = ['home', 'about_us', 'contact']\n    if valid_pages.include?(params[:page])\n      render params[:page]\n    else\n      render 'not_found'\n    end\n  end\n\n  # Sanitizing User Input\n  def show\n      # Sanitize the user input to extract just the file name\n      page = File.basename(params[:page])\n      # Optionally, further validate the sanitized input against an allow-list or other criteria\n      render page\n  end\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-render-local-file-include.yaml
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: $MAP[...]
            - metavariable-pattern:
                metavariable: $MAP
                patterns:
                    - pattern-not-regex: params
        - pattern: File.basename(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: |
                    render ..., file: $X
                - pattern: |
                    render ..., inline: $X
                - pattern: |
                    render ..., template: $X
                - pattern: |
                    render ..., action: $X
                - pattern: |
                    render $X, ...
            - focus-metavariable: $X
      pattern-sources:
        - patterns:
            - pattern: params[...]
      severity: WARNING
    - id: ruby_file_rule-CheckSendFile
      languages:
        - ruby
      message: "The application dynamically constructs file or path information with user input when calling\nthe `send_file` method in Ruby. This practice can lead to a serious \nsecurity vulnerability known as Local File Inclusion (LFI), allowing \nattackers to read arbitrary files on the server. \nLFI vulnerabilities can lead to the exposure of sensitive information, \nsuch as configuration files, source code, or even data files, \nwhich could be exploited to gain further access or to mount more \nsevere attacks.\n\nTo mitigate this vulnerability, follow these steps:\n- Avoid direct user input: If possible, do not use user input \nto determine file paths. Use a mapping of user input to server-side \ndefined file paths instead.\n- Use `File.basename`: If user input must be used to specify a file, \nensure that the input is normalized using `File.basename` to extract \nthe filename without any directory path. This prevents directory \ntraversal attacks.\n- Path allow listing: Implement an allow list of permitted files or \ndirectories and check user input against this list before processing.\n\nSecure Code Example:\n```\ndef download\n  filename = params[:filename]\n  filepath = \"path/to/secure/directory/#{File.basename(filename)}\"\n\n  # Optionally, further validate the resolved filepath against a whitelist\n\n  if File.exist?(filepath) && !File.directory?(filepath)\n    send_file filepath, x_sendfile: true\n  else\n    render plain: \"File not found\", status: :not_found\n  end\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-73
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://owasp.org/www-community/attacks/Path_Traversal
            - https://owasp.org/Top10/A01_2021-Broken_Access_Control/
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-send-file.yaml
        security-severity: MEDIUM
        shortDescription: External control of file name or path
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                send_file ...
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: WARNING
    - id: ruby_find_rule-CheckUnscopedFind
      languages:
        - ruby
      message: "The application was found calling the `find(...)` method with user-controlled input. If the \nActiveRecord model being searched against is sensitive, this may lead to \nInsecure Direct Object Reference (IDOR) behavior and allow users to read \narbitrary records. This could lead to data breaches, including the \nexposure of personal information, account takeovers, and other security \nissues.\n\nTo mitigate this risk, it's essential to scope queries to the current \nuser or another appropriate scope that ensures users can only access \ndata they are authorized to see. This is done by using ActiveRecord \nassociations and scopes to limit the records that can be retrieved. \n\nSecure Code Example:\n```\n# Secure way to scope the find to the current user's accounts\ndef show\n  @account = current_user.accounts.find(params[:id])\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-639
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        references:
            - https://brakemanscanner.org/docs/warning_types/unscoped_find/
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-unscoped-find.yaml
        security-severity: MEDIUM
        shortDescription: Authorization bypass through user-controlled key
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: $MODEL.find(...)
                - pattern: $MODEL.find_by_id(...)
                - pattern: $MODEL.find_by_id!(...)
            - metavariable-regex:
                metavariable: $MODEL
                regex: '[A-Z]\S+'
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: WARNING
    - id: ruby_ftp_rule-AvoidTaintedFTPCall
      languages:
        - ruby
      message: "The application was found calling the Net::FTP modules methods with\nuser supplied input. A malicious actor could use this to modify or access files\nthey should not have access to.\n\nDirectly incorporating user-controlled input from `params`, `cookies`, \nor `request.env` into FTP commands or connection setups can lead to \nvarious security vulnerabilities, including Remote Code Execution \n(RCE), unauthorized file access, and data exfiltration. It's crucial \nto validate, sanitize, and, where possible, avoid using user-controlled \ndata in sensitive operations like FTP transactions. Ensure that any input \nused in FTP operations is strictly controlled and validated against \nexpected patterns.\n\nRemediation Strategy:\nTo mitigate these risks, ensure that all user-provided input is strictly \nvalidated and sanitized before being used in FTP operations. \n- Verify the format and content of the input to ensure it meets expected \ncriteria.\n- Use allowlists to restrict the input to known safe values.\n- Employ built-in security features of the programming language or \nframework to escape or safely handle user input.\n\nSecure Code Example:\n```\nfilename = params[:filename]\n# Validate the filename to ensure it's a known, safe file\nraise \"Invalid filename\" unless filename =~ /\\A[\\w]+\\.\\w+\\z/\n\nNet::FTP.open('example.com', 'user', 'password') do |ftp|\n  # Proceed with the FTP operation using the validated and sanitized filename\n  ftp.getbinaryfile(filename, \"local_#{filename}\", 1024)\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-76
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/avoid-tainted-ftp-call.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of equivalent special elements
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - pattern-either:
            - pattern: Net::FTP.$X(...)
            - patterns:
                - pattern-inside: |
                    $FTP = Net::FTP.$OPEN(...)
                    ...
                    $FTP.$METHOD(...)
                - pattern: $FTP.$METHOD(...)
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby_http_rule-AvoidTaintedHTTPRequest
      languages:
        - ruby
      message: "The application was found including unvalidated user input into `Net::HTTP` methods, \nwhich could lead to HTTP Parameter Pollution (HPP) or worse, Server Side Request Forgery (SSRF).\nSpecifically, it looks for methods like GET, POST, DELETE, etc., \nbeing called with parameters that could be controlled by an end-user. \nUsing untrusted input in such a manner without proper validation and \nsanitization can lead to a variety of security vulnerabilities, including \nSSRF, injection attacks, unintended data leaks, and unauthorized actions \nbeing performed on behalf of the attacker.\n\nEnsure all user-controlled input is validated against a strict set of rules \n(e.g., expected data types, patterns, and lengths) and sanitized to remove \nor encode potentially harmful characters before being used in HTTP requests. \nAdditionally, consider using higher-level abstractions or frameworks that \nautomatically handle some of these concerns.\n\nSecure Code Example:\n```\nrequire 'uri'\n\n# Validate and sanitize the user input before using it in the HTTP request\nbegin\n  user_input = params[:url]\n  uri = URI.parse(user_input)\n\n  # Ensure the URI is HTTP/HTTPS and refers to a trusted domain\n  if uri.scheme.match?(/\\Ahttps?\\z/) && uri.host == 'www.abc.com'\n    response = Net::HTTP.get(uri)\n  else\n    raise \"Invalid URL\"\n  end\nrescue URI::InvalidURIError\n  puts \"Provided URL is not valid\"\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A10:2021-Server-Side Request Forgery
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/avoid-tainted-http-request.yaml
        security-severity: MEDIUM
        shortDescription: Server side request forgery (SSRF)
        technology:
            - rails
      mode: taint
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern: Net::HTTP::$METHOD.new(...)
                - metavariable-pattern:
                    metavariable: $METHOD
                    patterns:
                        - pattern-either:
                            - pattern: Copy
                            - pattern: Delete
                            - pattern: Get
                            - pattern: Head
                            - pattern: Lock
                            - pattern: Mkcol
                            - pattern: Move
                            - pattern: Options
                            - pattern: Patch
                            - pattern: Post
                            - pattern: Propfind
                            - pattern: Proppatch
                            - pattern: Put
                            - pattern: Trace
                            - pattern: Unlock
            - patterns:
                - pattern: Net::HTTP.$X(...)
                - metavariable-pattern:
                    metavariable: $X
                    patterns:
                        - pattern-either:
                            - pattern: get
                            - pattern: get2
                            - pattern: head
                            - pattern: head2
                            - pattern: options
                            - pattern: patch
                            - pattern: post
                            - pattern: post2
                            - pattern: post_form
                            - pattern: put
                            - pattern: request
                            - pattern: request_get
                            - pattern: request_head
                            - pattern: request_post
                            - pattern: send_request
                            - pattern: trace
                            - pattern: get_print
                            - pattern: get_response
                            - pattern: start
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
      severity: WARNING
    - id: ruby_injection_rule-AvoidTaintedShellCall
      languages:
        - ruby
      message: "User input should never be used in constructing commands or command arguments\nto functions which execute OS related functionality. Using external \ninput without validation in functions like `Kernel.system`, `exec`, or any \noperations that interact with the shell or file system (`cat`, `delete` \netc.) poses a severe security risk. These patterns can lead to command \ninjection vulnerabilities, where an attacker could execute arbitrary \ncommands on the system the application is hosted on, leading to data \nbreaches, unauthorized access, or worse.\n\nTo prevent command injection vulnerabilities, validate and sanitize all \nuser input before using it in any system or shell operation. Additionally, \nconsider using safer alternatives for executing system commands that don't \ndirectly pass user input to the shell, such as parameterized APIs or \nfunctions that handle arguments safely.\n\nSecure Code Example:\n```\nuser_filename_key = params[:filename_key]\n\nallowed_filenames = {\n  'file1' => 'allowed_file_1.txt',\n  'file2' => 'allowed_file_2.txt',\n}\n\n# Validate and select the filename from the lookup table\nif allowed_filenames.has_key?(user_filename_key)\n  safe_filename = allowed_filenames[user_filename_key]\n\n  # Use a safer API to read file content without invoking the shell\n  content = File.read(safe_filename)\nelse\n  puts \"Invalid filename.\"\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/avoid-tainted-shell-call.yaml
        security-severity: HIGH
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        technology:
            - rails
            - ruby
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: Kernel.$X(...)
                - patterns:
                    - pattern-either:
                        - pattern: Shell.$X(...)
                        - patterns:
                            - pattern-inside: |
                                $SHELL = Shell.$ANY(...)
                                ...
                                $SHELL.$X(...)
                            - pattern: $SHELL.$X(...)
            - metavariable-pattern:
                metavariable: $X
                patterns:
                    - pattern-either:
                        - pattern: cat
                        - pattern: chdir
                        - pattern: chroot
                        - pattern: delete
                        - pattern: entries
                        - pattern: exec
                        - pattern: foreach
                        - pattern: glob
                        - pattern: install
                        - pattern: lchmod
                        - pattern: lchown
                        - pattern: link
                        - pattern: load
                        - pattern: load_file
                        - pattern: makedirs
                        - pattern: move
                        - pattern: new
                        - pattern: open
                        - pattern: read
                        - pattern: readlines
                        - pattern: rename
                        - pattern: rmdir
                        - pattern: safe_unlink
                        - pattern: symlink
                        - pattern: syscopy
                        - pattern: sysopen
                        - pattern: system
                        - pattern: truncate
                        - pattern: unlink
      pattern-sources:
        - pattern-either:
            - pattern: params[...]
            - pattern: cookies
            - pattern: request.env
      severity: ERROR
    - id: ruby_injection_rule-BadSend
      languages:
        - ruby
      message: "The application was found calling dynamic method invocations in Ruby. \nIn particular one of the methods of: `Object#send`, `Object#try`, `Object#__send__`, \nor `Object#public_send`. These methods are powerful Ruby features that allow \ncalling another method on an object \nby name, where the method's name is passed as a string or symbol. \nHowever, when combined with untrusted input, such as parameters from \nweb requests, they can lead to severe security vulnerabilities, including \narbitrary method execution and potentially arbitrary code execution.\n\nTo mitigate these risks, it's crucial to validate and sanitize any user \ninput that might determine which methods are invoked. Moreover, consider \nusing safer alternatives to direct method invocation based on user input, \nsuch as explicitly whitelisting allowed methods or using conditional logic \nto determine method calls.\n\nSecure Code Example:\n```\n# Secure method invocation with validation and allow lists\nmethod_name = params[:method].to_sym\nallowed_methods = [:allowed_method_1, :allowed_method_2, :safe_method]\n\nif allowed_methods.include?(method_name)\n  result = object.public_send(method_name)\nelse\n  raise \"Unauthorized method call\"\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/no-send.yaml
            - https://the.igreque.info/posts/2016/01-object-send-considered-harmful-en.html
        security-severity: HIGH
        shortDescription: Improper control of generation of code ('Code Injection')
        technology:
            - ruby
      pattern-either:
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.send($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.try($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.__send__($PARAM.$FUNC)
        - pattern: |
            $PARAM = params[...]
            ...
            $RES = $MOD.public_send($PARAM.$FUNC)
      severity: ERROR
    - id: ruby_injection_rule-DangerousExec
      languages:
        - ruby
      message: "OS command injection is a critical vulnerability that can lead to a full system\ncompromise as it may allow an adversary to pass in arbitrary commands or arguments\nto be executed.\n\nUser input should never be used in constructing commands or command arguments\nto functions which execute OS commands. This includes filenames supplied by\nuser uploads or downloads.\n\nTo mitigate this vulnerability, follow these best practices:\n- Validate input: Ensure that all user inputs are validated against a \nstrict pattern that only allows safe characters for the context. Reject \nany input that does not meet these criteria.\n- Sanitize input: When validation is not feasible, sanitize the input \nby escaping or removing potentially dangerous characters.\n- Use secure methods: Prefer using secure methods or libraries designed \nto execute system commands with parameters, which automatically handle \nproper escaping of user inputs, such as `Open3.capture3` in Ruby.\n- Least privilege: Run your application with the least privileges \nnecessary, limiting what an attacker can do if they manage to execute a \ncommand.\n\nSecure Code Example:\nInstead of directly interpolating user input into system commands, validate \nuser input against an allowlist, then use parameterized execution or safer \nAPIs like Open3:\n```\nrequire 'open3'\n\nuser_input = params[:user_input]\n# Define an allow list of permitted arguments\nallowed_arguments = ['allowed_argument1', 'allowed_argument2', 'allowed_argument3']\n\n# Validate user_input against the list\nif allowed_arguments.include?(user_input)\n  # Using Open3 to safely execute system commands with allowed arguments\n  stdout, stderr, status = Open3.capture3('grep', user_input, 'my_file.txt')\n  if status.success?\n    puts stdout\n  else\n    warn \"Error: #{stderr}\"\n  end\nelse\n  warn \"Error: Unpermitted argument.\"\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://guides.rubyonrails.org/security.html#command-line-injection
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/dangerous-exec.yaml
        security-severity: HIGH
        shortDescription: Improper control of generation of code ('Code Injection')
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: |
                $EXEC(...)
            - pattern-not: |
                $EXEC("...","...","...",...)
            - pattern-not: |
                $EXEC(["...","...","...",...],...)
            - pattern-not: |
                $EXEC({...},"...","...","...",...)
            - pattern-not: |
                $EXEC({...},["...","...","...",...],...)
            - metavariable-regex:
                metavariable: $EXEC
                regex: ^(system|exec|spawn|Process.exec|Process.spawn|Open3.capture2|Open3.capture2e|Open3.capture3|Open3.popen2|Open3.popen2e|Open3.popen3|IO.popen|Gem::Util.popen|PTY.spawn)$
      pattern-sources:
        - patterns:
            - pattern: |
                def $F(...,$ARG,...)
                    ...
                end
            - focus-metavariable: $ARG
        - pattern: params
        - pattern: cookies
      severity: ERROR
    - id: ruby_mass_assignment_rule-ModelAttrAccessible
      languages:
        - ruby
      message: "The application was found permitting attributes which could lead to mass assignment\nvulnerabilities. Permitting attributes such as `admin`, `role`, `banned` etc, \nwithout proper authorization checks can lead to security issues like unauthorized \naccess or privilege escalation.\n\nRemediation Strategy\n- Explicitly permit attributes: Carefully review which attributes are \npermissible and avoid including sensitive ones in the list.\n- Role-based permissions: Implement checks that allow only authorized \nusers (e.g., administrators) to modify sensitive attributes.\n- Avoid using `params.permit!`: Use specific permit statements instead of \npermitting all parameters to ensure only expected attributes are allowed \nfor mass assignment.\n\nSecure Code Example:\n```\n# Secure: Conditionally permit sensitive attributes based on user role\ndef user_params\npermitted = params.require(:user).permit(:name, :email)\npermitted[:role] = params[:user][:role] if current_user.admin? && params[:user][:role].present?\npermitted\nend\n\ndef user_params2\n  permitted_attributes = [:username, :email]\n  # Only allow 'admin' attribute to be updated by users with admin role\n  permitted_attributes << :admin if current_user.admin?\n  params.require(:user).permit(*permitted_attributes)\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-915
        owasp:
            - A6:2017-Security Misconfiguration
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/model-attr-accessible.yaml
        security-severity: MEDIUM
        shortDescription: Improperly controlled modification of dynamically-determined object attributes
        technology:
            - ruby
            - rails
      pattern-either:
        - pattern: |
            ....permit(..., :admin, ...)
        - pattern: |
            ....permit(..., :role, ...)
        - pattern: |
            ....permit(..., :banned, ...)
        - pattern: |
            ....permit(..., :account_id, ...)
        - pattern: |
            attr_accessible ..., :admin, ...
        - pattern: |
            attr_accessible ..., :role, ...
        - pattern: |
            attr_accessible ..., :banned, ...
        - pattern: |
            attr_accessible ..., :account_id, ...
        - pattern: |
            params.permit!
      severity: WARNING
    - id: ruby_mass_assignment_rule-UnprotectedMassAssign
      languages:
        - ruby
      message: "Checks for calls to `without_protection` during mass assignment (which \nallows record creation from hash values). This can lead to users bypassing \npermissions protections. Using `:without_protection => true` makes your \napplication vulnerable to attackers who may craft malicious requests to \nmodify sensitive attributes, leading to unauthorized access or data \nmanipulation. For Rails 4 and higher, mass protection is on by default.\n\nTo mitigate this issue, don't use :without_protection => true. Instead, \nconfigure attr_accessible to control attribute access.\n\nSecure Code Example:\n```\nclass User < ActiveRecord::Base\n  # Only name and email can be updated via mass assignment\n  attr_accessible :name, :email\n\n  # admin and account_id are not listed here, so they cannot be mass-assigned\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-915
        owasp:
            - A6:2017-Security Misconfiguration
            - A08:2021-Software and Data Integrity Failures
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/unprotected-mass-assign.yaml
        security-severity: MEDIUM
        shortDescription: Improperly controlled modification of dynamically-determined object attributes
        technology:
            - ruby
            - rails
      patterns:
        - pattern-either:
            - pattern: |
                $MOD.new(params[$CODE])
            - pattern: |
                $MOD.new(..., params[$CODE], :without_protection => true, ...)
        - pattern-not-inside: |
            attr_accessible $VAR
            ...
            $MOD.new(params[$CODE])
      severity: WARNING
    - id: ruby_redirect_rule-CheckRedirectTo
      languages:
        - ruby
      message: "The application was found handling redirect behavior with user-supplied input.  \nDo not pass `params` to `redirect_to` without the `:only_path => true` \nhash value. Using `:only_path => true` ensures that the URL is interpreted \nas a relative path, not allowing redirection to an arbitrary external URL, \nthus mitigating the risk of open redirects. Alternatively, validate or \nsanitize the input to ensure it's safe and intended.\n\nSecure Code Example:\n```\n# Secure - Ensuring redirection is only to internal paths\ndef secure_redirect\n  redirect_to params[:redirect_url], only_path: true\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-601
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-redirect-to.yaml
        security-severity: LOW
        shortDescription: URL redirection to untrusted site 'open redirect'
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: |
                        $F(...)
                    - metavariable-pattern:
                        metavariable: $F
                        patterns:
                            - pattern-not-regex: (params|url_for|cookies|request.env|permit|redirect_to)
                - pattern: |
                    params.merge! :only_path => true
                    ...
                - pattern: |
                    params.slice(...)
                    ...
                - pattern: |
                    redirect_to [...]
                - patterns:
                    - pattern: |
                        $MODEL. ... .$M(...)
                        ...
                    - metavariable-regex:
                        metavariable: $MODEL
                        regex: '[A-Z]\w+'
                    - metavariable-regex:
                        metavariable: $M
                        regex: (all|create|find|find_by|find_by_sql|first|last|new|from|group|having|joins|lock|order|reorder|select|where|take)
                - patterns:
                    - pattern: |
                        params.$UNSAFE_HASH.merge(...,:only_path => true,...)
                        ...
                    - metavariable-regex:
                        metavariable: $UNSAFE_HASH
                        regex: to_unsafe_h(ash)?
                - patterns:
                    - pattern: params.permit(...,$X,...)
                    - metavariable-pattern:
                        metavariable: $X
                        patterns:
                            - pattern-not-regex: (host|port|(sub)?domain)
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-inside: |
                redirect_to $X, ...
            - pattern-not-regex: params\.\w+(?<!permit)\(.*?\)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: params
                - pattern: cookies
                - pattern: request.env
                - pattern: url_for(params[...],...,:only_path => false,...)
      severity: INFO
    - id: ruby_reflection_rule-CheckUnsafeReflection
      languages:
        - ruby
      message: "The application was found calling a reflection method with user-controllable\ninput. Reflection in Ruby allows a program to examine and modify its own \nstructure and behavior at runtime. When user input is used unsafely \nwith reflection methods (like `constantize`, `safe_constantize`, `const_get`, \n`qualified_const_get`), it poses a significant security risk, potentially \nleading to arbitrary code execution.\n\nTo mitigate these risks:\n- Avoid direct user input in reflection: Never use user-controllable input \ndirectly with reflection methods.\n- Validate and sanitize input: If user input must influence program behavior, \nrigorously validate and sanitize the input against a whitelist of allowed \nvalues.\n- Use indirect references: Instead of allowing direct specification of class \nor method names, map user inputs to a predefined set of allowed actions or \nclasses.\n- Do not provide user-controllable input to reflection functionality. \n- Do not call symbol conversion on user-controllable input.\n\nSecure Code Example:\n```\nclass SafeClassHandler\n  ALLOWED_CLASSES = {\n    'user' => User,\n    'product' => Product\n  }.freeze\n\n  def self.handle_class_action(class_key)\n    klass = ALLOWED_CLASSES[class_key]\n    raise ArgumentError, \"Invalid class key\" unless klass\n\n    klass.some_method\n  end\nend\n\n# Example usage\nSafeClassHandler.handle_class_action(params[:class_key])\n```\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-unsafe-reflection.yaml
        security-severity: HIGH
        shortDescription: Improper control of generation of code ('Code Injection')
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-either:
                - pattern-inside: |
                    $X.constantize
                - pattern-inside: |
                    $X. ... .safe_constantize
                - pattern-inside: |
                    const_get(...)
                - pattern-inside: |
                    qualified_const_get(...)
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby_reflection_rule-CheckUnsafeReflectionMethods
      languages:
        - ruby
      message: "The application was found calling a reflection method with user-controllable\ninput. This practice can lead to unauthorized alteration of program behavior, \nincluding the potential execution of arbitrary code. Reflection methods \nallow dynamic execution of code, which is powerful but risky if not properly \nsanitized, as it could enable attackers to execute unintended methods or \nblocks.\n\nRemediation:\n- Validate and sanitize input: Ensure that any user input is strictly \nvalidated against a whitelist of allowed values before being passed to \nreflection methods. Avoid direct mapping of user input to method names \nor proc conversions.\n- Limit reflection use: Minimize the use of reflection with user input. \nPrefer direct method calls or other non-reflective approaches whenever \npossible.\n- Use safer alternatives: When dynamic behavior is necessary, use controlled \nmethods like `public_send` with proper input validation to reduce risk.\n\nSecure Code Example:\n```\n# Assume user input is to invoke a method on an object\nuser_method = params[:method_name]\n\n# Define an allow list of permissible methods\nallowed_methods = ['safe_method_1', 'safe_method_2']\n\nif allowed_methods.include?(user_method)\n    # Using public_send for controlled method invocation\n    result = my_object.public_send(user_method)\nelse\n    raise 'Unauthorized method access'\nend\n```\n"
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-unsafe-reflection-methods.yaml
        security-severity: HIGH
        shortDescription: Improper control of generation of code ('Code Injection')
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-either:
                - pattern-inside: |
                    $X. ... .to_proc
                - patterns:
                    - pattern-inside: |
                        $Y.method($Z)
                    - focus-metavariable: $Z
                - patterns:
                    - pattern-inside: |
                        $Y.tap($Z)
                    - focus-metavariable: $Z
                - patterns:
                    - pattern-inside: |
                        $Y.tap{ |$ANY| $Z }
                    - focus-metavariable: $Z
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - id: ruby_sql_rule-CheckSQL
      languages:
        - ruby
      message: "SQL Injection is a critical vulnerability that can lead to data or system compromise. By\ndynamically generating SQL query strings, user input may be able to influence the logic of\nthe SQL statement. This could lead to an adversary accessing information they should\nnot have access to, or in some circumstances, being able to execute OS functionality or code.\n\nTo mitigate this issue, always use parameterized queries or the \nActiveRecord query interface, which ensures that inputs are properly \nescaped, preventing SQL injection attacks. Avoid string interpolation \nor concatenation with user-controlled input for constructing SQL queries.\n\nSecure Code Example:\n```\n# Secure: Using parameterized queries with ActiveRecord\nuser_id = params[:id]\nUser.where(\"id = ?\", user_id)\n\n# Secure: Using ActiveRecord's query methods, which automatically handle parameterization\n# Converting to integer as an additional layer of input sanitization\nuser_id = params[:id].to_i  \nUser.where(id: user_id)\n```\n"
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        references:
            - https://owasp.org/www-community/attacks/SQL_Injection
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-sql.yaml
        security-severity: HIGH
        shortDescription: Improper neutralization of special elements used in a SQL command ('SQL Injection')
        technology:
            - ruby
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: $X
                    - pattern-either:
                        - pattern-inside: |
                            :$KEY => $X
                        - pattern-inside: |
                            ["...",$X,...]
                - pattern: |
                    params[...].to_i
                - pattern: |
                    params[...].to_f
                - patterns:
                    - pattern: |
                        params[...] ? $A : $B
                    - metavariable-pattern:
                        metavariable: $A
                        patterns:
                            - pattern-not: |
                                params[...]
                    - metavariable-pattern:
                        metavariable: $B
                        patterns:
                            - pattern-not: |
                                params[...]
      pattern-sinks:
        - patterns:
            - pattern: $X
            - pattern-not-inside: |
                $P.where("...",...)
            - pattern-not-inside: |
                $P.where(:$KEY => $VAL,...)
            - pattern-either:
                - pattern-inside: |
                    $P.$M(...)
                - pattern-inside: |
                    $P.$M("...",...)
            - pattern-inside: |
                class $P < ActiveRecord::Base
                  ...
                end
            - metavariable-regex:
                metavariable: $M
                regex: (where|find|first|last|select|minimum|maximum|calculate|sum|average)
      pattern-sources:
        - pattern-either:
            - pattern: |
                cookies[...]
            - patterns:
                - pattern: |
                    cookies. ... .$PROPERTY[...]
                - metavariable-regex:
                    metavariable: $PROPERTY
                    regex: (?!signed|encrypted)
            - pattern: |
                params[...]
            - pattern: |
                request.env[...]
      severity: ERROR
    - fix-regex:
        regex: VERIFY_NONE
        replacement: VERIFY_PEER
      id: ruby_ssl_rule-SSLModeNoVerify
      languages:
        - ruby
      message: "The application was found using `OpenSSL::SSL::VERIFY_NONE`.\nThis effectively disables the validation of TLS certificates.\n\nThis allows for an adversary who is in between the application and the \ntarget host to intercept potentially sensitive information or transmit \nmalicious data.\n\nTo remediate this issue, use 'OpenSSL::SSL::VERIFY_PEER' instead.\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A07:2021-Identification and Authentication Failures
        references:
            - https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/lang/security/ssl-mode-no-verify.yaml
        security-severity: MEDIUM
        shortDescription: Improper certificate validation
        technology:
            - ruby
      pattern: OpenSSL::SSL::VERIFY_NONE
      severity: WARNING
    - id: ruby_xss_rule-AvoidLinkTo
      languages:
        - ruby
      message: "This code includes user input in `link_to`. In Rails, the body of \n`link_to` is not escaped. This means that user input which reaches the \nbody will be executed when the HTML is rendered. Even in other versions, \nvalues starting with `javascript:` or `data:` are not escaped. \n\nMitigation Strategy:\nAlways sanitize user input used within `link_to` method calls. For versions of \nRails where `link_to` does not automatically escape the body, or when dealing \nwith schemes that are not escaped (`javascript:`, `data:`), manually escape or \nvalidate the input against a list of safe values. Consider using the `sanitize` \nhelper method or other Rails sanitization helpers to clean user input before \nrendering.\n\nSecure Code Example:\n```\nuser_input = params[:user_link_text]\n\n# This example uses the `sanitize` helper to ensure any HTML tags or JavaScript in the user input are escaped\nsafe_link_text = sanitize(user_input)\n\n# Use the sanitized text as the body of the `link_to` method\n<%= link_to safe_link_text, some_safe_path %>\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        references:
            - https://brakemanscanner.org/docs/warning_types/link_to/
            - https://brakemanscanner.org/docs/warning_types/link_to_href/
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/xss/avoid-link-to.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - rails
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern: |
                "...#{...}..."
            - pattern-not: |
                "#{...}..."
      pattern-sinks:
        - pattern: link_to(...)
      pattern-sources:
        - pattern: params
        - pattern: cookies
        - pattern: request.env
        - pattern-either:
            - pattern: $MODEL.url(...)
            - pattern: $MODEL.uri(...)
            - pattern: $MODEL.link(...)
            - pattern: $MODEL.page(...)
            - pattern: $MODEL.site(...)
      severity: WARNING
    - id: ruby_xss_rule-AvoidRenderInline
      languages:
        - ruby
      message: "The application was found calling `render inline: ...` which renders an entire ERB template inline and is potentially dangerous.\nIf user supplied input is used, the application can be exploited by malicious \nactors via server-side template injection (SSTI) or cross-site scripting (XSS) attacks.\nInstead, consider using a partial or another safe rendering method.\n\nSecure Code Example:\n```\n# In your controller or view\nuser_input = params[:user_input]\nrender partial: 'users/user_input', locals: { user_input: user_input }\n\n# erb file\n<!-- app/views/users/_user_input.html.erb -->\n<!-- Display user input safely -->\n<div>\n  <%= sanitize(user_input) %>\n</div>\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        references:
            - https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#inline-renders---even-worse-than-xss
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/xss/avoid-render-inline.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - rails
      pattern: 'render inline: ...'
      severity: WARNING
    - fix-regex:
        regex: 'text:'
        replacement: 'plain:'
      id: ruby_xss_rule-AvoidRenderText
      languages:
        - ruby
      message: "The application was found calling `render text: ...` which actually sets the \ncontent-type to 'text/html'. If external data can reach here, this exposes your \napplication to cross-site scripting (XSS) attacks. Instead, use `render plain: ...` to\nrender non-HTML text.\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        references:
            - https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#inline-renders---even-worse-than-xss
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/xss/avoid-render-text.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - rails
      pattern: 'render text: ...'
      severity: WARNING
    - id: ruby_xss_rule-ManualTemplateCreation
      languages:
        - ruby
      message: "The application was identified manually creating ERB templates. Manual creation of templates\nmay expose your application to server-side template injection (SSTI) or\ncross-site scripting (XSS) attacks if user input is used to create the\ntemplate. Instead, create a '.erb' template file and use 'render'.\n\nSecure Code Example:\n```\n# Controller: messages_controller.rb\nclass MessagesController < ApplicationController\n  def show\n    # Safely assign user input to an instance variable\n    @message_content = sanitize(params[:user_content])\n    \n    # Render the static .erb template\n    render 'messages/show'\n  end\nend\n\n<!-- Static ERB Template Example - app/views/messages/show.html.erb -->\n<div>\n  Message: <%= @message_content %>\n</div>\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        references:
            - https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/xss/manual-template-creation.yaml
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - rails
      pattern: ERB.new(...)
      severity: WARNING
    - id: yaml_spring_rule-SpringActuatorFullyEnabled
      languages:
        - yaml
      message: "Spring Boot Actuator is fully enabled. This exposes sensitive endpoints\nsuch as /actuator/env, /actuator/logfile, /actuator/heapdump and others.\nIf the application lacks proper security measures (e.g., authentication and \nauthorization), sensitive data could be accessed, compromising the application and \nits infrastructure. This configuration poses a serious risk in production \nenvironments or public-facing deployments.\n\nTo mitigate the risks, take the following measures:\n  - Expose only the Actuator endpoints required for your use case\n  - For production environments, restrict exposure to non-sensitive endpoints \n  like `health` or `info`\n  - Ensure Actuator endpoints are protected with authentication and authorization \n  (e.g., via Spring Security)\n  - Use environment-specific configurations to limit exposure in production\n\nSecure Code Example:\nInstead of include: \"*\", list only the endpoints you need to expose:\n```\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: \"health,info,metrics\"\n```\n\nReferences:\n- https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.exposing\n- https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785\n- https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators\n"
      metadata:
        category: security
        confidence: MEDIUM
        cwe: CWE-497
        impact: HIGH
        likelihood: MEDIUM
        owasp:
            - A01:2021-Broken Access Control
            - A3:2017-Sensitive Data Exposure
        security-severity: Medium
        shortDescription: Exposure of sensitive system information to an unauthorized control sphere
        technology:
            - java
      patterns:
        - pattern: |
            management:
              ...
              endpoints:
                ...
                web:
                  ...
                  exposure:
                    ...
                    include: "*"
                    ...
      severity: WARNING
    - id: rules_lgpl_java_webview_rule-ignore-ssl-certificate-errors
      languages:
        - java
      message: "Insecure WebView Implementation. leading to a security problem known as SSL certificate \nvalidation bypass. This occurs when the app fails to properly validate SSL certificates, \nallowing potentially malicious or spoofed certificates to be accepted, leading to a \nMan-in-the-Middle (MitM) attack where an attacker intercepts and manipulates communication \nbetween the app and the server. \n\nTo fix this security issue, you should properly handle SSL errors and only proceed with \nthe connection if the SSL certificate is valid and trusted. Here's an example code in Java:\n```      \npublic class MyWebViewClient extends WebViewClient {      \n  @Override\n  public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) {\n    // Check the SSL error type\n    switch (error.getPrimaryError()) {\n      case SslError.SSL_UNTRUSTED:\n        // Certificate is untrusted\n        // Handle the error appropriately, such as showing an error message\n        break;\n      case SslError.SSL_EXPIRED:\n        // Certificate has expired\n        // Handle the error appropriately\n        break;\n      case SslError.SSL_IDMISMATCH:\n        // Certificate hostname mismatch\n        // Handle the error appropriately\n        break;\n      case SslError.SSL_NOTYETVALID:\n        // Certificate is not yet valid\n        // Handle the error appropriately\n        break;\n    }\n    // Cancel the connection\n    // This prevents the WebView from loading the content\n    handler.cancel();\n  }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Improper certificate validation"
      pattern: |
        $RET onReceivedSslError(WebView $W, SslErrorHandler $H, SslError $E) {
          ...
          $H.proceed();
        }
      severity: WARNING
    - id: rules_lgpl_java_webview_rule-webview-debugging
      languages:
        - java
      message: "Remote WebView debugging is enabled. This allows an attacker with\ndebugging access to interact with the webview and steal or corrupt data.\nTo fix these security issues, it is recommended to disable remote \ndebugging and restrict file access in the WebView. \nHere's how you can do it:\n```\nWebView webView = new WebView(context);\n\n// Disable remote debugging\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n    WebView.setWebContentsDebuggingEnabled(false);\n}\n\n// Restrict file access from file URLs\nwebView.getSettings().setAllowFileAccessFromFileURLs(false);\n\n// Load a web page\nwebView.loadUrl(\"https://example.com\");\n```\n"
      metadata:
        category: security
        cwe: CWE-489
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Active debug code
      patterns:
        - pattern-either:
            - pattern: |
                $WB.setWebContentsDebuggingEnabled(true);
            - pattern: |
                $X = true;
                ...
                $WB.setWebContentsDebuggingEnabled($X);
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-insecure-random-generator
      languages:
        - javascript
      message: "This rule identifies use of cryptographically weak random number generators.\nUsing cryptographically weak random number generators like `crypto.pseudoRandomBytes()` \nand `Math.random()` for security-critical tasks can expose systems to significant \nvulnerabilities. Attackers might predict the generated random numbers, compromising \nthe integrity and confidentiality of cryptographic operations. This could lead to \nbreaches where sensitive data is accessed or manipulated, authentication mechanisms \nare bypassed, or secure communications are intercepted, ultimately undermining the \nsecurity of the entire system or application.\n\nMitigation strategy:\nReplace the use of these cryptographically weak random number generators with \n`crypto.randomBytes()`, a method provided by Node.js's `crypto` module that \ngenerates cryptographically secure random numbers. This method should be used \nfor all operations requiring secure randomness, such as generating keys, tokens, \nor any cryptographic material.\n\nSecure Code Example:\n```\nconst crypto = require('crypto');\nconst secureBytes = crypto.randomBytes(256);\nconsole.log(`Secure random bytes: ${secureBytes.toString('hex')}`);\n```\n"
      metadata:
        category: security
        cwe: CWE-338
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Use of cryptographically weak pseudo-random number generator (PRNG)
      pattern-either:
        - patterns:
            - pattern-inside: |
                require('crypto')
                ...
            - pattern: |
                $X.pseudoRandomBytes(...)
        - pattern: |
            Math.random(...)
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-md5
      languages:
        - javascript
      message: "The MD5 hashing algorithm is considered cryptographically weak and \nvulnerable to collision attacks, where two different inputs generate \nthe same output hash. When used for hashing sensitive data, attackers \ncan exploit this weakness to generate collisions, allowing them to bypass \nsecurity checks or masquerade malicious data as legitimate. This \nvulnerability is particularly critical in authentication mechanisms, \ndigital signatures, SSL/TLS certificates, and data integrity checks.\n\nRemediation:\nTo mitigate this vulnerability, replace the MD5 hashing algorithm with \nstronger cryptographic hash functions, such as SHA-256 or SHA-3. These \nalgorithms offer significantly improved security and are resistant to \ncollision attacks, making them suitable for cryptographic purposes in \nmodern applications.\n\nSecure Code example :\n```\nconst crypto = require('crypto');\nconst hash = crypto.createHash('sha256').update('sensitive data').digest('hex');\nconsole.log(hash); \n```\n"
      metadata:
        category: security
        cwe: CWE-328
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Use of weak hash
      pattern-either:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $Y = $X.createHash('md5')
                        ...
                    - pattern: |
                        $Y.update("...")
                - pattern: |
                    $X.createHash('md5').update("...")
        - patterns:
            - pattern-inside: |
                require('crypto-js')
                ...
            - pattern: |
                $X.MD5("...")
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $M = require('md5')
                    ...
                - pattern-inside: |
                    $M = require('blueimp-md5')
                    ...
                - pattern-inside: |
                    $M = require('js-md5')
                    ...
            - pattern: |
                $M("...")
        - patterns:
            - pattern-inside: |
                require('node-forge')
                ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $Y = $X.md.md5.create()
                        ...
                    - pattern: |
                        $Y.update("...")
                - pattern: |
                    $X.md.md5.create().update("...")
        - patterns:
            - pattern-inside: |
                $X = require('jshashes')
                ...
                $Y = new $X.MD5()
                ...
            - pattern: |
                $Y.$METHOD("...")
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $X = require('create-hash')
                        ...
                        $Y = $X('md5')
                        ...
                    - pattern: |
                        $Y.update("...")
                - patterns:
                    - pattern-inside: |
                        $X = require('create-hash')
                        ...
                    - pattern: "$X('md5').update(\"...\")      \n"
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-sha1
      languages:
        - javascript
      message: "The SHA-1 hashing algorithm is no longer considered secure for\ncryptographic applications due to its vulnerability to collision attacks,\nwhere two different inputs produce the same output hash. SHA-1's\nsusceptibility to collision attacks undermines the security of\ncryptographic operations, allowing attackers to forge signatures or\nmanipulate data without detection. This poses significant risks in\nauthentication systems, data integrity validations, and secure\ncommunications. \n\nRemediation: To mitigate this vulnerability, replace the SHA1 hashing \nalgorithm with  stronger cryptographic hash functions, such as SHA-256 \nor SHA-3. These  algorithms offer significantly improved security and \nare resistant to  collision attacks, making them suitable for cryptographic \npurposes in  modern applications.\n\nSecure Code example:  \n```  \nconst crypto = require('crypto');  \nconst hash = crypto.createHash('sha256').update('sensitive data').digest('hex');  \nconsole.log(hash);   \n```\n"
      metadata:
        category: security
        cwe: CWE-328
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Use of weak hash
      pattern-either:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $Y = $X.createHash('sha1')
                        ...
                    - pattern: |
                        $Y.update("...")
                - pattern: |
                    $X.createHash('sha1').update("...")
        - patterns:
            - pattern-inside: |
                require('crypto-js')
                ...
            - pattern: |
                $X.SHA1("...")
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $M = require('sha1')
                    ...
                - pattern-inside: |
                    $M = require('js-sha1')
                    ...
            - pattern: |
                $M("...")
        - patterns:
            - pattern-inside: |
                require('node-forge')
                ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $Y = $X.md.sha1.create()
                        ...
                    - pattern: |
                        $Y.update("...")
                - pattern: |
                    $X.md.sha1.create().update("...")
        - patterns:
            - pattern-inside: |
                $X = require('jshashes')
                ...
                $Y = new $X.SHA1()
                ...
            - pattern: |
                $Y.$METHOD("...")
        - patterns:
            - pattern-inside: |
                require('hash.js')
                ...
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $Y = $X.sha1()
                        ...
                    - pattern: |
                        $Y.update("...")
                - pattern: |
                    $X.sha1().update("...")
        - patterns:
            - pattern-inside: |
                $X = require('jssha')
                ...
            - pattern-either:
                - pattern: |
                    new $X('SHA-1', ...).update("...")
                - patterns:
                    - pattern-inside: |
                        $Y = new $X('SHA-1', ...)
                        ...
                    - pattern: |
                        $Y.update("...")
        - patterns:
            - pattern-either:
                - pattern: |
                    $X('sha1').update("...")
                - patterns:
                    - pattern-inside: |
                        $Y = $X('sha1')
                        ...
                    - pattern: |
                        $Y.update("...")
        - pattern: |
            $X.subtle.digest('SHA-1', ...)
        - patterns:
            - pattern-either:
                - pattern: |
                    $X.SHA1.digest(...)
                - patterns:
                    - pattern-inside: |
                        $Y = $X.SHA1
                        ...
                    - pattern: "$Y.digest(...)  \n"
        - patterns:
            - pattern-either:
                - pattern: |
                    $X.codec.hex.fromBits($SJCL)
                - patterns:
                    - pattern-inside: |
                        $Y = $SJCL
                        ...
                    - pattern: |
                        $X.codec.hex.fromBits($Y)
            - metavariable-pattern:
                metavariable: $SJCL
                pattern: |
                    $K.hash.sha1.hash("...")
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-timing-attack
      languages:
        - javascript
      message: |
        'String comparisons using ''==='', ''!=='', ''!='' and ''=='' is vulnerable to timing attacks. More info: https://snyk.io/blog/node-js-timing-attack-ccc-ctf/'
      metadata:
        category: security
        cwe: CWE-208
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Observable timing discrepancy
      patterns:
        - pattern-not: if ($Z == null) { ... };
        - pattern-not: if ($Z === null) { ... };
        - pattern-not: if ($Z != null) { ... };
        - pattern-not: if ($Z !== null) { ... };
        - pattern-not: if ($Q != undefined) { ... };
        - pattern-not: if ($Q !== undefined) { ... };
        - pattern-not: if ($Q == undefined) { ... };
        - pattern-not: if ($Q === undefined) { ... };
        - pattern-not: return $Y == null;
        - pattern-not: return $Y === null;
        - pattern-not: return $Y != null;
        - pattern-not: return $Y !== null;
        - pattern-not: return $Y == undefined;
        - pattern-not: return $Y === undefined;
        - pattern-not: return $Y != undefined;
        - pattern-not: return $Y !== undefined;
        - pattern-either:
            - pattern: |
                if (password == $X) {
                    ...
                }
            - pattern: |
                if ($X == password) {
                    ...
                }
            - pattern: |
                if (password === $X) {
                    ...
                }
            - pattern: |
                if ($X === password) {
                    ...
                }
            - pattern: |
                if (pass == $X) {
                    ...
                }
            - pattern: |
                if ($X == pass) {
                    ...
                }
            - pattern: |
                if (pass === $X) {
                    ...
                }
            - pattern: |
                if ($X === pass) {
                    ...
                }
            - pattern: |
                if (secret == $X) {
                    ...
                }
            - pattern: |
                if ($X == secret) {
                    ...
                }
            - pattern: |
                if (secret === $X) {
                    ...
                }
            - pattern: |
                if ($X === secret) {
                    ...
                }
            - pattern: |
                if (api == $X) {
                    ...
                }
            - pattern: |
                if ($X == api) {
                    ...
                }
            - pattern: |
                if (api === $X) {
                    ...
                }
            - pattern: |
                if ($X === api) {
                    ...
                }
            - pattern: |
                if (apiKey == $X) {
                    ...
                }
            - pattern: |
                if ($X == apiKey) {
                    ...
                }
            - pattern: |
                if (apiKey === $X) {
                    ...
                }
            - pattern: |
                if ($X === apiKey) {
                    ...
                }
            - pattern: |
                if (apiSecret == $X) {
                    ...
                }
            - pattern: |
                if ($X == apiSecret) {
                    ...
                }
            - pattern: |
                if (apiSecret === $X) {
                    ...
                }
            - pattern: |
                if ($X === apiSecret) {
                    ...
                }
            - pattern: |
                if (token == $X) {
                    ...
                }
            - pattern: |
                if ($X == token) {
                    ...
                }
            - pattern: |
                if (token === $X) {
                    ...
                }
            - pattern: |
                if ($X === token) {
                    ...
                }
            - pattern: |
                if (hash == $X) {
                    ...
                }
            - pattern: |
                if ($X == hash) {
                    ...
                }
            - pattern: |
                if (hash === $X) {
                    ...
                }
            - pattern: |
                if ($X === hash) {
                    ...
                }
            - pattern: |
                if (auth_token == $X) {
                    ...
                }
            - pattern: |
                if ($X == auth_token) {
                    ...
                }
            - pattern: |
                if (auth_token === $X) {
                    ...
                }
            - pattern: |
                if ($X === auth_token) {
                    ...
                }
            - pattern: |
                if (password != $X) {
                    ...
                }
            - pattern: |
                if ($X != password) {
                    ...
                }
            - pattern: |
                if (password !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== password) {
                    ...
                }
            - pattern: |
                if (pass != $X) {
                    ...
                }
            - pattern: |
                if ($X != pass) {
                    ...
                }
            - pattern: |
                if (pass !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== pass) {
                    ...
                }
            - pattern: |
                if (secret != $X) {
                    ...
                }
            - pattern: |
                if ($X != secret) {
                    ...
                }
            - pattern: |
                if (secret !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== secret) {
                    ...
                }
            - pattern: |
                if (api != $X) {
                    ...
                }
            - pattern: |
                if ($X != api) {
                    ...
                }
            - pattern: |
                if (api !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== api) {
                    ...
                }
            - pattern: |
                if (apiKey != $X) {
                    ...
                }
            - pattern: |
                if ($X != apiKey) {
                    ...
                }
            - pattern: |
                if (apiKey !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== apiKey) {
                    ...
                }
            - pattern: |
                if (apiSecret != $X) {
                    ...
                }
            - pattern: |
                if ($X != apiSecret) {
                    ...
                }
            - pattern: |
                if (apiSecret !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== apiSecret) {
                    ...
                }
            - pattern: |
                if (token != $X) {
                    ...
                }
            - pattern: |
                if ($X != token) {
                    ...
                }
            - pattern: |
                if (token !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== token) {
                    ...
                }
            - pattern: |
                if (hash != $X) {
                    ...
                }
            - pattern: |
                if ($X != hash) {
                    ...
                }
            - pattern: |
                if (hash !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== hash) {
                    ...
                }
            - pattern: |
                if (auth_token != $X) {
                    ...
                }
            - pattern: |
                if ($X != auth_token) {
                    ...
                }
            - pattern: |
                if (auth_token !== $X) {
                    ...
                }
            - pattern: |
                if ($X !== auth_token) {
                    ...
                }
            - pattern: |
                return $X === auth_token;
            - pattern: |
                return auth_token === $X;
            - pattern: |
                return $X === token;
            - pattern: |
                return token === $X;
            - pattern: |
                return $X === hash;
            - pattern: |
                return hash === $X;
            - pattern: |
                return $X === password;
            - pattern: |
                return password === $X;
            - pattern: |
                return $X === pass;
            - pattern: |
                return pass === $X;
            - pattern: |
                return $X === apiKey;
            - pattern: |
                return apiKey === $X;
            - pattern: |
                return $X === apiSecret;
            - pattern: |
                return apiSecret === $X;
            - pattern: |
                return $X === api_key;
            - pattern: |
                return api_key === $X;
            - pattern: |
                return $X === api_secret;
            - pattern: |
                return api_secret === $X;
            - pattern: |
                return $X === secret;
            - pattern: |
                return secret === $X;
            - pattern: |
                return $X === api;
            - pattern: |
                return api === $X;
            - pattern: |
                return $X == auth_token;
            - pattern: |
                return auth_token == $X;
            - pattern: |
                return $X == token;
            - pattern: |
                return token == $X;
            - pattern: |
                return $X == hash;
            - pattern: |
                return hash == $X;
            - pattern: |
                return $X == password;
            - pattern: |
                return password == $X;
            - pattern: |
                return $X == pass;
            - pattern: |
                return pass == $X;
            - pattern: |
                return $X == apiKey;
            - pattern: |
                return apiKey == $X;
            - pattern: |
                return $X == apiSecret;
            - pattern: |
                return apiSecret == $X;
            - pattern: |
                return $X == api_key;
            - pattern: |
                return api_key == $X;
            - pattern: |
                return $X == api_secret;
            - pattern: |
                return api_secret == $X;
            - pattern: |
                return $X == secret;
            - pattern: |
                return secret == $X;
            - pattern: |
                return $X == api;
            - pattern: |
                return api == $X;
            - pattern: |
                return $X !== auth_token;
            - pattern: |
                return auth_token !== $X;
            - pattern: |
                return $X !== token;
            - pattern: |
                return token !== $X;
            - pattern: |
                return $X !== hash;
            - pattern: |
                return hash !== $X;
            - pattern: |
                return $X !== password;
            - pattern: |
                return password !== $X;
            - pattern: |
                return $X !== pass;
            - pattern: |
                return pass !== $X;
            - pattern: |
                return $X !== apiKey;
            - pattern: |
                return apiKey !== $X;
            - pattern: |
                return $X !== apiSecret;
            - pattern: |
                return apiSecret !== $X;
            - pattern: |
                return $X !== api_key;
            - pattern: |
                return api_key !== $X;
            - pattern: |
                return $X !== api_secret;
            - pattern: |
                return api_secret !== $X;
            - pattern: |
                return $X !== secret;
            - pattern: |
                return secret !== $X;
            - pattern: |
                return $X !== api;
            - pattern: |
                return api !== $X;
            - pattern: |
                return $X != auth_token;
            - pattern: |
                return auth_token != $X;
            - pattern: |
                return $X != token;
            - pattern: |
                return token != $X;
            - pattern: |
                return $X != hash;
            - pattern: |
                return hash != $X;
            - pattern: |
                return $X != password;
            - pattern: |
                return password != $X;
            - pattern: |
                return $X != pass;
            - pattern: |
                return pass != $X;
            - pattern: |
                return $X != apiKey;
            - pattern: |
                return apiKey != $X;
            - pattern: |
                return $X != apiSecret;
            - pattern: |
                return apiSecret != $X;
            - pattern: |
                return $X != api_key;
            - pattern: |
                return api_key != $X;
            - pattern: |
                return $X != api_secret;
            - pattern: |
                return api_secret != $X;
            - pattern: |
                return $X != secret;
            - pattern: |
                return secret != $X;
            - pattern: |
                return $X != api;
            - pattern: |
                return api != $X;
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-tls-reject
      languages:
        - javascript
      message: "The application sets NODE_TLS_REJECT_UNAUTHORIZED to '0', which instructs Node.js to disable TLS/SSL certificate validation. \nThis configuration allows the application to accept self-signed certificates or certificates from untrusted authorities, \nundermining the TLS security model. Disabling TLS/SSL certificate validation compromises the integrity and confidentiality \nof data in transit between the client and server. It makes the application vulnerable to man-in-the-middle (MITM) attacks, \nwhere an attacker could intercept or alter the data being exchanged.\n\nMitigation Strategy:\nDo not disable TLS/SSL certificate validation in production environments. Ensure that NODE_TLS_REJECT_UNAUTHORIZED is \nset to '1' or is removed entirely from the production configuration (as the default configuration of validating SSL \ncertificate is safe).\n\nSecure Code Example:\n```\nconst https = require('https')\nprocess.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '1'\nconst req = https.request(options, res => {\n  let data = ''\n  res.on('data', chunk => {\n    data += chunk\n  })\n  res.on('end', () => {\n    console.log('Response Body:', data)\n  })\n})\nreq.end()\n```\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Improper Certificate Validation
      patterns:
        - pattern-either:
            - pattern: |
                $X.env.NODE_TLS_REJECT_UNAUTHORIZED = $VAL
            - pattern: |
                $X.env['NODE_TLS_REJECT_UNAUTHORIZED']= $VAL
        - metavariable-pattern:
            metavariable: $VAL
            pattern-either:
                - pattern: |
                    '0'
                - pattern: |
                    0
      severity: WARNING
    - id: rules_lgpl_javascript_crypto_rule-node-weak-crypto
      languages:
        - javascript
      message: |
        A weak or broken cryptographic algorithm was identified. Using these functions will introduce vulnerabilities or downgrade the security of your application.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Use of a broken or risky cryptographic algorithm
      patterns:
        - pattern-either:
            - pattern: |
                $X.createCipher('des', ...)
      severity: WARNING
    - id: rules_lgpl_javascript_database_rule-node-knex-sqli-injection
      languages:
        - javascript
      message: |
        Untrusted input concatinated with raw SQL query using knex raw()  or whereRaw() functions can result in SQL Injection.
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements used in an SQL command (SQL Injection)
      patterns:
        - pattern-either:
            - pattern-inside: |
                $KNEX = require('knex')
                ...
            - pattern-inside: |
                $KNEX = require('knex')(...)
                ...
        - pattern-either:
            - pattern: |
                $K.raw(<... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $K.raw(<... $REQ.$QUERY ...>, ...)
            - pattern: |
                $SQL = <... $REQ.$QUERY.$VAR ...>;
                ...
                $K.raw(<... $SQL ...>, ...)
            - pattern: |
                $SQL = <... $REQ.$QUERY ...>;
                ...
                $K.raw(<... $SQL ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                $SQL = <... $INP ...>;
                ...
                $K.raw(<... $SQL ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                $SQL = <... $INP ...>;
                ...
                $K.raw(<... $SQL ...>, ...)
            - pattern: |
                $K.whereRaw(<... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $K.whereRaw(<... $REQ.$QUERY ...>, ...)
            - pattern: |
                $SQL = <... $REQ.$QUERY.$VAR ...>;
                ...
                $K.whereRaw(<... $SQL ...>, ...)
            - pattern: |
                $SQL = <... $REQ.$QUERY ...>;
                ...
                $K.whereRaw(<... $SQL ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                $SQL = <... $INP ...>;
                ...
                $K.whereRaw(<... $SQL ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                $SQL = <... $INP ...>;
                ...
                $K.whereRaw(<... $SQL ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_database_rule-node-nosqli-injection
      languages:
        - javascript
      message: |
        Untrusted user input in findOne() function can result in NoSQL Injection.
      metadata:
        category: security
        cwe: CWE-943
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements in data query logic
      patterns:
        - pattern-not-inside: |
            $SANITIZE = require('mongo-sanitize')
            ...
            $SANITIZE(...)
            ...
        - pattern-not-inside: |
            import $SANITIZE from 'mongo-sanitize'
            ...
            $SANITIZE(...)
            ...
        - pattern-not: |
            $OBJ.findOne({$KEY : String(...).$FUNC()}, ...)
        - pattern-not: |
            $OBJ.findOne({$KEY : String(...).$FUNC}, ...)
        - pattern-not: |
            $OBJ.findOne({$KEY : String(...)}, ...)
        - pattern-either:
            - pattern: |
                $OBJ.findOne({$KEY : <... $REQ.$FOO.$BAR ...> }, ...)
            - pattern: |
                $OBJ.findOne({$KEY: <... $REQ.$FOO ...> }, ...)
            - pattern: |
                $INP = <... $REQ.$FOO.$BAR ...>;
                ...
                $OBJ.findOne({$KEY : <... $INP ...> }, ...)
            - pattern: |
                $INP = <... $REQ.$FOO ...>;
                ...
                $OBJ.findOne({$KEY: <... $INP ...> }, ...)
            - pattern: |
                $QUERY = {$KEY: <... $REQ.$FOO.$BAR ...>};
                ...
                $OBJ.findOne($QUERY, ...)
            - pattern: |
                $QUERY = {$KEY: <... $REQ.$FOO ...>};
                ...
                $OBJ.findOne($QUERY, ...)
            - pattern: |
                $INP = <... $REQ.$FOO.$BAR ...>;
                ...
                $QUERY = {$KEY : <... $INP ...> };
                ...
                $OBJ.findOne(<... $QUERY  ...>, ...)
            - pattern: |
                $INP = <... $REQ.$FOO ...>;
                ...
                $QUERY = {$KEY : <... $INP ...> };
                ...
                $OBJ.findOne(<... $QUERY  ...>, ...)
            - pattern: |
                $QUERY[$KEY] = <... $REQ.$FOO.$BAR ...>;
                ...
                $OBJ.findOne($QUERY, ...)
            - pattern: |
                $QUERY[$KEY] = <... $REQ.$FOO ...>;
                ...
                $OBJ.findOne($QUERY, ...)
            - pattern: |
                $INP = <... $REQ.$FOO.$BAR ...>;
                ...
                $QUERY[$KEY] = <... $INP ...>;
                ...
                $OBJ.findOne(<... $QUERY  ...>, ...)
            - pattern: |
                $INP = <... $REQ.$FOO ...>;
                ...
                $QUERY[$KEY] = <... $INP ...>;
                ...
                $OBJ.findOne(<... $QUERY  ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_database_rule-node-nosqli-js-injection
      languages:
        - javascript
      message: |
        Untrusted user input in MongoDB $where operator can result in NoSQL JavaScript Injection.
      metadata:
        category: security
        cwe: CWE-943
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements in data query logic
      patterns:
        - pattern-either:
            - pattern: |
                $OBJ.$FUNC({$where: <... $REQ.$FOO.$BAR ...>}, ...)
            - pattern: |
                $OBJ.$FUNC({$where: <... $REQ.$QUERY ...>}, ...)
            - pattern: |
                $NSQL = <... $REQ.$QUERY.$...>;
                ...
                $OBJ.$FUNC({$where: <... $NSQL ...>}, ...)
            - pattern: |
                $NSQL = <... $REQ.$QUERY ...>;
                ...
                $OBJ.$FUNC({$where: <... $NSQL ...>}, ...)
            - pattern: |
                $INP = $REQ.$FOO.$BAR;
                ...
                $QRY = {$where: <... $INP ...>};
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
            - pattern: |
                $INP = $REQ.$FOO;
                ...
                $QRY = {$where: <... $INP ...>};
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
            - pattern: |
                $QRY["$where"] = <... $REQ.$FOO ...>;
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
            - pattern: |
                $QRY["$where"] = <... $REQ.$FOO.$BAR ...>;
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
            - pattern: |
                $INP = $REQ.$FOO;
                ...
                $QRY["$where"] = <... $INP ...>;
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
            - pattern: |
                $INP = $REQ.$FOO.$BAR;
                ...
                $QRY["$where"] = <... $INP ...>;
                ...
                $OBJ.$FUNC(<... $QRY ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_database_rule-node-sqli-injection
      languages:
        - javascript
      message: |
        Untrusted input concatinated with raw SQL query can result in SQL Injection.
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements used in an SQL command (SQL Injection)
      patterns:
        - pattern-inside: |
            require('$LIB')
            ...
        - metavariable-regex:
            metavariable: $LIB
            regex: \b(sql-client|mysql|pg|mssql|oracledb|sequelize)\b
        - pattern-not: |
            $CON.query("..." + "...", ...)
        - pattern-not: |
            $SQL = "...";
            ...
            $CON.query(<... $SQL ...>, ...)
        - pattern-either:
            - pattern: |
                $CON.query(<... $REQ.$QUERY ...>, ...)
            - pattern: |
                $SQL = <... $REQ.$QUERY ...>;
                ...
                $CON.query(<... $SQL ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                $SQL = <... $INP ...>;
                ...
                $CON.query(<... $SQL ...>, ...)
            - pattern: |
                $CON.query(`...${...}...`, ...)
            - pattern: |
                $CON.query("..."+...+"...", ...)
            - pattern: |
                $SQL = <... $INP ...>;
                ...
                $CON.query(<... $SQL ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_database_rule-sequelize-tls
      languages:
        - javascript
      message: |
        'The Sequelize connection string indicates that database server does not use TLS. Non TLS connections are susceptible to man in the middle (MITM) attacks.'
      metadata:
        category: security
        cwe: CWE-319
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Cleartext transmission of sensitive information
      patterns:
        - pattern: |
            {
              host: $HOST,
              database: $DATABASE,
              dialect: $DIALECT
             }
        - pattern-not: |
            {
              host: $HOST,
              database: $DATABASE,
              dialect: "postgres",
              dialectOptions: {
                  ssl: true
              }
            }
        - pattern-not: |
            {
              host: $HOST,
              database: $DATABASE,
              dialect: $DIALECT,
              dialectOptions: {
                ssl: { ... }
              }
            }
        - metavariable-regex:
            metavariable: $DIALECT
            regex: '[''"](mariadb|mysql|postgres|oracle)[''"]'
      severity: WARNING
    - id: rules_lgpl_javascript_database_rule-sequelize-tls-cert-validation
      languages:
        - javascript
      message: "The Sequelize connection string indicates that TLS certificate validation \nof database server is disabled. This is equivalent to not having TLS. An \nattacker can present any invalid certificate and Sequelize will make database \nconnection ignoring certificate errors. This setting make the connection\nsusceptible to man in the middle (MITM) attacks. Not applicable to SQLite database.\n"
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: HIGH
        shortDescription: Improper certificate validation
      patterns:
        - pattern: |
            {
              host: $HOST,
              database: $DATABASE,
              dialect: $DIALECT,
              dialectOptions: {
                ssl: {
                  rejectUnauthorized: false
                }
              }
             }
        - metavariable-regex:
            metavariable: $DIALECT
            regex: '[''"](mariadb|mysql|postgres)[''"]'
      severity: ERROR
    - id: rules_lgpl_javascript_electronjs_rule-electron-disable-websecurity
      languages:
        - javascript
      message: |
        Disabling webSecurity will disable the same-origin policy and allows the execution of insecure code from any domain.
      metadata:
        category: security
        cwe: CWE-346
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: CRITICAL
        shortDescription: Origin validation error
      patterns:
        - pattern-either:
            - pattern: |
                new BrowserWindow({webPreferences: {webSecurity: false}})
            - pattern: |
                var $X = {webPreferences: {webSecurity: false}};
      severity: ERROR
    - id: rules_lgpl_javascript_electronjs_rule-electron-nodejs-integration
      languages:
        - javascript
      message: |
        Node integration exposes node.js APIs to the electron app and this can introduce remote code execution vulnerabilities to the application if the app is vulnerable to Cross Site Scripting (XSS).
      metadata:
        category: security
        cwe: CWE-272
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Least privilege violation
      patterns:
        - pattern-either:
            - pattern: |
                new BrowserWindow({webPreferences: {nodeIntegration: true}})
            - pattern: |
                var $X = {webPreferences: {nodeIntegration: true}};
      severity: WARNING
    - id: rules_lgpl_javascript_eval_rule-eval-nodejs
      languages:
        - javascript
      message: |
        User controlled data in eval() or similar functions may result in Server Side Injection or Remote Code Injection
      metadata:
        category: security
        cwe: CWE-95
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: HIGH
        shortDescription: Improper neutralization of directives in dynamically evaluated code ('Eval Injection')
      patterns:
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                new Function(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                new Function(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                eval(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                eval(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                setTimeout(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                setTimeout(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                setInterval(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                setInterval(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                new Function(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                new Function(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                eval(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                eval(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                setTimeout(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                setTimeout(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                setInterval(..., <... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                setInterval(..., <... $INP ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-eval-require
      languages:
        - javascript
      message: "Passing untrusted user input directly into the require() function without proper \nvalidation or sanitization can possibly cause a vulnerability known as remote code execution (RCE). \nAn attacker could manipulate the input to load and execute arbitrary code from external sources, \npotentially leading to severe security breaches such as data theft, system compromise, \nor unauthorized access.\nTo mitigate this risk, it's crucial to validate and sanitize user input\nthoroughly before passing it to functions like require(), ensuring that only trusted and safe inputs are utilized.\n\nFollowing is an example of secure validation against allowlist to prevent the vulnerability:\n```\n// Define a list of explicitly allowed packages for require\nconst allowedPkgs = [\n    'package1',\n    'package2',\n    'package3'\n];\n\napp.get(\"/eval/require/7\", async (req, res) => {\n    var isAllowed = allowedPkgs.includes(req.query.name);  \n    if (isAllowed) {\n        // ok: rules_lgpl_javascript_eval_rule-eval-require\n        var cp = require(req.query.name);\n        cp.exec('ls', (error, stdout, stderr) => {\n            console.log(\"exec output : \\n\", stdout)\n        });        \n    }\n    res.send(\"Please check console logs.\");\n});\n```\n"
      metadata:
        category: security
        cwe: CWE-706
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Use of incorrectly-resolved name or reference
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: "if($VALIDATION){\n...\nrequire($REQ, ...) \n...\n} \n"
                - pattern: |
                    $A = $VALIDATION
                    ...
                    if($A){
                    ...
                    require($REQ, ...)
                    ...
                    }
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: "$AL.includes(...)  \n"
                    - pattern: |
                        $AL.indexOf(...) !== -1
                    - pattern: |
                        $AL.find(...) !== undefined
                    - pattern: |
                        $ALS.has(...)
      pattern-sinks:
        - patterns:
            - pattern: |
                require($REQ, ...)
            - focus-metavariable: $REQ
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ($REQ, $RES, ...) {...}
            - focus-metavariable: $REQ
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-grpc-insecure-connection
      languages:
        - javascript
        - typescript
      message: |
        Found an insecure gRPC connection. This creates a connection without encryption to a gRPC client/server. A malicious attacker could  tamper with the gRPC message, which could compromise the machine.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: CRITICAL
        shortDescription: Deserialization of Untrusted Data
      patterns:
        - pattern-either:
            - pattern-inside: |
                require('grpc')
                ...
            - pattern-inside: |
                import $MOD from 'grpc'
                ...
        - pattern: $CREDENTIALS.createInsecure()
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-node-deserialize
      languages:
        - javascript
        - typescript
      message: |
        User controlled data in 'unserialize()' or 'deserialize()' function can result in Object Injection or Remote Code Injection.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: CRITICAL
        shortDescription: Deserialization of Untrusted Data
      patterns:
        - pattern-either:
            - pattern: |
                require('node-serialize').unserialize(...)
            - pattern-inside: |
                $MOD = require('node-serialize')
                ...
            - pattern-inside: |
                import $MOD from 'node-serialize'
                ...
        - pattern: |
            $MOD.unserialize(...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-sandbox-code-injection
      languages:
        - javascript
      message: |
        Unrusted data in `sandbox` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('sandbox')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $S.run(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $CODE = <... $REQ.$QUERY.$FOO ...>;
                ...
                $S.run(<... $CODE ...>,...)
            - pattern: |
                new $SANDBOX(...).run(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $CODE = <... $REQ.$QUERY.$FOO ...>;
                ...
                new $SANDBOX(...).run(<... $CODE ...>,...)
            - pattern: |
                $S.run(<... $REQ.$BODY ...>,...)
            - pattern: |
                $CODE = <... $REQ.$BODY ...>;
                ...
                $S.run(<... $CODE ...>,...)
            - pattern: |
                new $SANDBOX(...).run(<... $REQ.$BODY ...>,...)
            - pattern: |-
                $CODE = <... $REQ.$BODY ...>;
                ...
                new $SANDBOX(...).run(<... $CODE ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-serializetojs-deserialize
      languages:
        - javascript
        - typescript
      message: |
        User controlled data in 'unserialize()' or 'deserialize()' function can result in Object Injection or Remote Code Injection.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: CRITICAL
        shortDescription: Deserialization of Untrusted Data
      patterns:
        - pattern-either:
            - pattern: |
                require('serialize-to-js').deserialize(...)
            - pattern-inside: |
                $MOD = require('serialize-to-js')
                ...
            - pattern-inside: |
                import $MOD from 'serialize-to-js'
                ...
        - pattern: |
            $MOD.deserialize(...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-server-side-template-injection
      languages:
        - javascript
      message: |
        Untrusted user input in templating engine's compile() function can result in Remote Code Execution via server side template injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-either:
            - pattern-inside: |
                require('handlebars')
                ...
            - pattern-inside: |
                require('pug')
                ...
            - pattern-inside: |
                require('hamljs')
                ...
            - pattern-inside: |
                require('ejs')
                ...
            - pattern-inside: |
                require('squirrelly')
                ...
            - pattern-inside: |
                require('eta')
                ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $HB.compile(..., <... $REQ.$FOO ...>, ...)
            - pattern: |
                $HB.compile(..., <... $REQ.$FOO.$BAR ...>, ...)
            - pattern: |
                $X = <... $REQ.$FOO ...>;
                ...
                $HB.compile(..., <... $X ...>, ...)
            - pattern: |
                $X = <... $REQ.$FOO.$BAR ...>;
                ...
                $HB.compile(..., <... $X ...>, ...)
            - pattern: |
                $X = $SOURCE.replace('...', <... $REQ.$FOO ...>, ...)
                ...
                $HB.compile(..., <... $X ...>, ...)
            - pattern: |
                $X = $SOURCE.replace('...', <... $REQ.$FOO.$BAR ...>, ...)
                ...
                $HB.compile(..., <... $X ...>, ...)
            - pattern: |
                $HB.Compile(..., <... $REQ.$FOO ...>, ...)
            - pattern: |
                $HB.Compile(..., <... $REQ.$FOO.$BAR ...>, ...)
            - pattern: |
                $X = <... $REQ.$FOO ...>;
                ...
                $HB.Compile(..., <... $X ...>, ...)
            - pattern: |
                $X = <... $REQ.$FOO.$BAR ...>;
                ...
                $HB.Compile(..., <... $X ...>, ...)
            - pattern: |
                $X = $SOURCE.replace('...', <... $REQ.$FOO ...>, ...)
                ...
                $HB.Compile(..., <... $X ...>, ...)
            - pattern: |
                $X = $SOURCE.replace('...', <... $REQ.$FOO.$BAR ...>, ...)
                ...
                $HB.Compile(..., <... $X ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-vm2-code-injection
      languages:
        - javascript
      message: |
        Untrusted user input reaching `vm2` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('vm2')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $VM.run(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $CODE = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.run(<... $CODE ...>,...)
            - pattern: |
                new VM(...).run(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                new NodeVM(...).run(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $CODE = <... $REQ.$QUERY.$FOO ...>;
                ...
                new NodeVM(...).run(<... $CODE ...>,...)
            - pattern: |
                $CODE = <... $REQ.$QUERY.$FOO ...>;
                ...
                new VMScript(<... $CODE ...>,...)
            - pattern: |
                $VM.run(<... $REQ.$BODY ...>,...)
            - pattern: |
                $CODE = <... $REQ.$BODY ...>;
                ...
                $VM.run(<... $CODE ...>,...)
            - pattern: |
                new VM(...).run(<... $REQ.$BODY ...>,...)
            - pattern: |
                $CODE = <... $REQ.$BODY ...>;
                ...
                new VM(...).run($CODE,...)
            - pattern: |
                new NodeVM(...).run(<... $REQ.$BODY ...>,...)
            - pattern: |
                $CODE = <... $REQ.$BODY ...>;
                ...
                new NodeVM(...).run(<... $CODE ...>,...)
            - pattern: |
                $CODE = <... $REQ.$BODY ...>;
                ...
                new VMScript(<... $CODE ...>,...)
      severity: WARNING
    - id: rules_lgpl_javascript_eval_rule-vm2-context-injection
      languages:
        - javascript
      message: |
        Untrusted user input reaching `vm2` sandbox can result in context injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('vm2')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                new VM({sandbox: <... $REQ.$QUERY.$FOO ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$QUERY.$FOO} ...>;
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {sandbox: <... $REQ.$QUERY.$FOO ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                new NodeVM({sandbox: <... $REQ.$QUERY.$FOO ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$QUERY.$FOO} ...>;
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {sandbox: <... $REQ.$QUERY.$FOO ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                new VM({sandbox: <... $REQ.$BODY ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$BODY} ...>;
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                new VM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {sandbox: <... $REQ.$BODY ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new VM($OPTS,...)
            - pattern: |
                new NodeVM({sandbox: <... $REQ.$BODY ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$BODY} ...>;
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                new NodeVM({sandbox: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {sandbox: <... $REQ.$BODY ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
            - pattern: |-
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {sandbox: <... $CONTEXT ...>};
                ...
                new NodeVM($OPTS,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-vm-code-injection
      languages:
        - javascript
      message: |
        Untrusted user input reaching `vm` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            $VM = require('vm')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: $VM.runInContext(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $VM.runInContext(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.runInContext($INPUT,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $VM.runInContext($INPUT,...)
            - pattern: $VM.runInNewContext(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $VM.runInNewContext(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.runInNewContext($INPUT,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $VM.runInNewContext($INPUT,...)
            - pattern: $VM.runInThisContext(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $VM.runInThisContext(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.runInThisContext($INPUT,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $VM.runInThisContext($INPUT,...)
            - pattern: $VM.compileFunction(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $VM.compileFunction(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.compileFunction($INPUT,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $VM.compileFunction($INPUT,...)
            - pattern: new $VM.Script(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: new $VM.Script(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                new $VM.Script($INPUT,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                new $VM.Script($INPUT,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-vm-compilefunction-injection
      languages:
        - javascript
      message: |
        Untrusted user input in `vm.compileFunction()` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('vm')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $REQ.$QUERY.$FOO ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$QUERY.$FOO} ...>; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>}; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>; ... $CONTEXT = {$NAME: <... $VAR ...>}; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {parsingContext: <... $REQ.$QUERY.$FOO ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $REQ.$BODY ...>},...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$BODY} ...>; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>}; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>; ... $CONTEXT = {$NAME: <... $VAR ...>}; ... $VM.compileFunction($CODE,$PARAMS,{parsingContext: <... $CONTEXT ...>},...)
            - pattern: |
                $OPTS = {parsingContext: <... $REQ.$BODY ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $OPTS = {parsingContext: <... $CONTEXT ...>};
                ...
                $VM.compileFunction($CODE,$PARAMS,$OPTS,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-vm-runincontext-injection
      languages:
        - javascript
      message: |
        Untrusted user input in `vm.runInContext()` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('vm')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$QUERY.$FOO} ...>;
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$BODY} ...>;
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $VM.runInContext($CODE,<... $CONTEXT ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-vm-runinnewcontext-injection
      languages:
        - javascript
      message: |
        Untrusted user input in `vm.runInNewContext()` can result in code injection.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code (Code Injection)
      patterns:
        - pattern-inside: |
            require('vm')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $VM.runInNewContext($CODE,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $CONTEXT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$QUERY.$FOO ...>};
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$QUERY.$FOO} ...>;
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $VM.runInNewContext($CODE,<... $REQ.$BODY ...>,...)
            - pattern: |
                $CONTEXT = <... $REQ.$BODY ...>;
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = {$NAME: <... $REQ.$BODY ...>};
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $CONTEXT = <... {$NAME:$REQ.$BODY} ...>;
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $CONTEXT = {$NAME: <... $VAR ...>};
                ...
                $VM.runInNewContext($CODE,<... $CONTEXT ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_eval_rule-yaml-deserialize
      languages:
        - javascript
        - typescript
      message: |
        User controlled data in 'yaml.load()' function can result in Remote Code Injection.
      metadata:
        category: security
        cwe: CWE-502
        owasp:
            - A8:2017-Insecure Deserialization
            - A08:2021-Software and Data Integrity Failures
        security-severity: CRITICAL
        shortDescription: Deserialization of Untrusted Data
      patterns:
        - pattern-either:
            - pattern: |
                require('js-yaml').load(...)
            - pattern-inside: |
                $MOD = require('js-yaml')
                ...
            - pattern-inside: |
                import $MOD from 'js-yaml'
                ...
        - pattern: |
            $MOD.load(...)
      severity: ERROR
    - id: rules_lgpl_javascript_exec_rule-shelljs-os-command-exec
      languages:
        - javascript
      message: |
        User controlled data in 'shelljs.exec()' can result in Remote OS Command Execution.
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
      patterns:
        - pattern-inside: |
            require('shelljs')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $EXEC.exec(<... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $EXEC.exec( <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY.$VAR ...>;
                ...
                $EXEC.exec(<... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                $EXEC.exec(<... $INP ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_headers_rule-generic-header-injection
      languages:
        - javascript
      message: |
        Untrusted user input in response header will result in HTTP Header Injection or Response Splitting Attacks.
      metadata:
        category: security
        cwe: CWE-644
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of HTTP headers for scripting syntax
      patterns:
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $INP = $REQ.$QUERY;
                ...
                $RES.set(..., <... $INP ...>, ...)
            - pattern: |
                $INP = $REQ.$QUERY.$VAR;
                ...
                $RES.set(..., <... $INP ...>, ...)
            - pattern: |
                $INP = $REQ.$VAR;
                ...
                $RES.set(..., { $X: <... $INP ...>}, ...)
            - pattern: |
                $INP = $REQ.$QUERY.$FOO;
                ...
                $RES.set(..., { $X: <... $INP ...>}, ...)
            - pattern: |
                $INP = $REQ.$VAR;
                ...
                $RES.writeHead(..., { $X: <... $INP ...> }, ...)
            - pattern: |
                $INP = $REQ.$QUERY.$FOO;
                ...
                $RES.writeHead(..., { $X: <... $INP ...> }, ...)
            - pattern: |
                $RES.set(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $RES.set(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $RES.set(..., { $X: <... $REQ.$VAR ...>}, ...)
            - pattern: |
                $RES.set(..., { $X: <... $REQ.$QUERY.$FOO ...>}, ...)
            - pattern: |
                $RES.writeHead(..., { $X: <... $REQ.$VAR ...> }, ...)
            - pattern: |
                $RES.writeHead(..., { $X: <... $REQ.$QUERY.$FOO ...> }, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_headers_rule-host-header-injection
      languages:
        - javascript
      message: |
        Using untrusted Host header for generating dynamic URLs can result in web cache and or password reset poisoning.
      metadata:
        category: security
        cwe: CWE-348
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Use of less trusted source
      patterns:
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $X = <... "=~/.*http[s]*:///i" + $REQ.host ...>;
            - pattern: |
                $X = <... "=~/.*http[s]*:///i" + $REQ["host"] ...>;
            - pattern: |
                $X = <... "=~/.*http[s]*:///i" + $REQ("host") ...>;
            - pattern: |
                $X = { $Y: <... "=~/.*http[s]*:///i" + $REQ.host ...>};
            - pattern: |
                $X = { $Y: <... "=~/.*http[s]*:///i" + $REQ["host"] ...>};
            - pattern: |
                $X = { $Y: <... "=~/.*http[s]*:///i" + $REQ("host") ...>};
            - pattern: |
                $Z = $REQ.host;
                ...
                $X = <... "=~/.*http[s]*:///i" + $Z ...>;
            - pattern: |
                $Z = $REQ["host"];
                ...
                $X = <... "=~/.*http[s]*:///i" + $Z ...>;
            - pattern: |
                $Z = $REQ("host")
                ...
                $X = <... "=~/.*http[s]*:///i" + $Z ...>;
            - pattern: |
                $Z = $REQ.host;
                ...
                $X = { $Y: <... "=~/.*http[s]*:///i" + $REQ.host ...>};
            - pattern: |
                $Z = $REQ["host"];
                ...
                $X = { $Y: <... "=~/.*http[s]*:///i" + $Z ...>};
            - pattern: |
                $Z = $REQ("host")
                ...
                $X = { $Y: <... "=~/.*http[s]*:///i" + $REQ("host") ...>};
      severity: WARNING
    - id: rules_lgpl_javascript_jwt_rule-hardcoded-jwt-secret
      languages:
        - javascript
      message: "Hardcoded JWT secret or private key was found. Hardcoding secrets like JWT signing keys poses a significant security risk. \nIf the source code ends up in a public repository or is compromised, the secret is exposed. Attackers could then use the secret to \ngenerate forged tokens and access the system. Store it properly in an environment variable.\n\nHere are some recommended safe ways to access JWT secrets:\n  - Use environment variables to store the secret and access it in code instead of hardcoding. This keeps it out of source control.\n  - Use a secrets management service to securely store and tightly control access to the secret. Applications can request the secret at runtime.\n  - For local development, use a .env file that is gitignored and access the secret from process.env.\n\nsample code snippet of accessing JWT secret from env variables\n```\n const token = jwt.sign(payload, process.env.SECRET, { algorithm: 'HS256' });\n```\n"
      metadata:
        category: security
        cwe: CWE-798
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: HIGH
        shortDescription: Use of hard-coded credentials
      patterns:
        - pattern-either:
            - pattern-inside: |
                const $JWT = require("jsonwebtoken");
                ...
            - pattern-inside: |
                const $JOSE = require("jose");
                ...
            - pattern-inside: |
                import $JWT from "jsonwebtoken"
                ...
            - pattern-inside: |
                import $JOSE from "jose"
                ...
        - pattern-either:
            - pattern: $JWT.sign($PAYLOAD, "...", ...)
            - pattern: $JWT.verify($PAYLOAD, "...", ...)
            - pattern: new $JOSE.SignJWT(...). ... .sign("...")
            - pattern: |
                var $TOKEN = new $JOSE.SignJWT(...). ...
                ...
                $TOKEN. ... .sign("...")
            - pattern: $JOSE.jwtVerify( $TKN, "...", ... )
            - patterns:
                - pattern-either:
                    - patterns:
                        - pattern-inside: |
                            var $KEY = $X
                              ...
                        - pattern-either:
                            - pattern: new $JOSE.SignJWT(...). ... .sign($KEY)
                            - patterns:
                                - pattern: |
                                    var $TOKEN = new $JOSE.SignJWT(...). ...
                                    ...
                                    $TOKEN. ... .sign($KEY)
                                - pattern: $TOKEN. ... .sign($KEY)
                            - pattern: $JOSE.jwtVerify( $TKN, $KEY, ... )
                    - pattern: new $JOSE.SignJWT(...). ... .sign($X)
                    - patterns:
                        - pattern: |
                            var $TOKEN = new $JOSE.SignJWT(...). ...
                            ...
                            $TOKEN. ... .sign($X)
                        - pattern: $TOKEN. ... .sign($X)
                    - pattern: $JOSE.jwtVerify( $TKN, $X, ... )
                - metavariable-pattern:
                    metavariable: $X
                    pattern-either:
                        - pattern: new TextEncoder().encode( "...",... )
                        - pattern: Uint8Array.from("...", ...)
      severity: ERROR
    - id: rules_lgpl_javascript_jwt_rule-jwt-express-hardcoded
      languages:
        - javascript
      message: "Hardcoded JWT secret or private key was found. Hardcoding secrets like JWT signing keys poses a significant security risk. \nIf the source code ends up in a public repository or is compromised, the secret is exposed. Attackers could then use the secret to \ngenerate forged tokens and access the system. Store it properly in an environment variable.\n\nHere are some recommended safe ways to access JWT secrets:\n  - Use environment variables to store the secret and access it in code instead of hardcoding. This keeps it out of source control.\n  - Use a secrets management service to securely store and tightly control access to the secret. Applications can request the secret at runtime.\n  - For local development, use a .env file that is gitignored and access the secret from process.env.\n\nsample code snippet of accessing JWT secret from env variables\n```\nrouter.route(\"/auth-route-1\").get(\n  jwt({ secret: process.env.secret, algorithms: ['HS256'] }),\n    (req, res) => {\n        res.send('Token is valid');\n    }\n);\n```\n"
      metadata:
        category: security
        cwe: CWE-522
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: CRITICAL
        shortDescription: Insufficiently protected credentials
      patterns:
        - pattern-either:
            - pattern-inside: |
                import { ..., $JWT,... } from 'express-jwt';
                ...
            - pattern-inside: |
                var {..., expressjwt: $JWT,... } = require('express-jwt');
                ...
        - pattern-either:
            - pattern: $JWT(<...{...,secret:"...",...}...>)
            - patterns:
                - pattern-inside: |
                    $OPTS = <... {secret: "..."} ...>;
                    ...
                - pattern: $JWT(<... $OPTS ...>,...)
            - patterns:
                - pattern-inside: |
                    $OPTS = <... {secret: "..."} ...>;
                    ...
                    $OPTS2 = <... $OPTS ...>;
                    ...
                - pattern: $JWT(<... $OPTS2 ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_jwt_rule-node-jwt-none-algorithm
      languages:
        - javascript
      message: "Use of `{algorithm:'none'}` detected with `jsonwebtoken`. \nUsing none as the algorithm for jsonwebtoken can directly impact the integrity of the information transfer through the JWT token.\nConsider using a secure algorithm to sign your JWT token such as HMAC or RSA.\nSome safe usage examples:\n```\nlet token = jwt.sign({user:\"user1\"}, 'secret', {algorithm: 'HS256'});  \n```\nUsing a secure algorithm can protect the integrity of the token information. \nAvoid using none as the algorithm when signing jwt tokens since it can violate the integrity of the JWT information.\n"
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: CRITICAL
        shortDescription: Use of a broken or risky cryptographic algorithm
      mode: taint
      pattern-sinks:
        - pattern: $JWT.verify($P, $X, {...,algorithms:[...,'none',...],...},...)
        - pattern: $JWT.sign($P, $X, {...,algorithm:'none',...},...)
      pattern-sources:
        - pattern: $JWT = require("jsonwebtoken")
        - pattern: import $JWT from "jsonwebtoken"
      severity: ERROR
    - id: rules_lgpl_javascript_redirect_rule-express-open-redirect
      languages:
        - javascript
      message: "Passing untrusted user input in `redirect()` can result in an open redirect\nvulnerability. This could be abused by malicious actors to trick users into \nbeing redirected to websites under their control to capture authentication\ninformation.  \nTo prevent open redirect vulnerabilities:\n\n- Always validate and sanitize user inputs, especially URL parameters\n or query strings that may influence the flow of the application.\n- Use allowlists (lists of permitted URLs) to validate redirect targets \n against known, trusted URLs before performing the redirect.\n- Avoid directly using user input for redirecting. If unavoidable, ensure\n strict validation against an allowlist.\n\nFollowing is an example of secure validation against allowlist to prevent the vulnerability:\n ```\n // Define a list of explicitly allowed URLs for redirection\n const allowedUrls = [\n     'https://www.example.com/page1',\n     'https://www.example.com/page2',\n     'https://secure.example.com/page3'\n ];\n\n app.get('/redirect/:url', (req, res) => {\n     const url = decodeURIComponent(req.params.url);\n     const isAllowed = allowedUrls.includes(url);\n     if (isAllowed) {\n         // If the URL is allowed, proceed with the redirect\n         res.redirect(url);\n     } else {\n         res.status(400).send('Invalid redirect URL');\n     }\n });\n ```\n"
      metadata:
        category: security
        cwe: CWE-601
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: URL redirection to untrusted site 'open redirect'
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: "if($VALIDATION){\n  ...\n  $RES.redirect(...)\n  ...\n} \n"
                    - pattern: |
                        $A = $VALIDATION
                        ...
                        if($A){
                          ...
                          $RES.redirect(...)
                          ...
                        }
                - metavariable-pattern:
                    metavariable: $VALIDATION
                    pattern-either:
                        - pattern: "$AL.includes(...)  \n"
                        - pattern: |
                            $AL.indexOf(...) !== -1
                        - pattern: |
                            $AL.find(...) !== undefined
                        - pattern: |
                            $ALS.has(...)
            - patterns:
                - pattern: |
                    $RES.redirect("$DOM" + ...)
                - metavariable-regex:
                    metavariable: $DOM
                    regex: (http(s)?:\/\/.*\/)
      pattern-sinks:
        - pattern: |
            $RES.redirect(...)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ($REQ, $RES, ...) {...}
            - focus-metavariable: $REQ
      severity: ERROR
    - id: rules_lgpl_javascript_redirect_rule-express-open-redirect2
      languages:
        - javascript
      message: "Passing untrusted user input in `redirect()` can result in an open redirect\nvulnerability. This could be abused by malicious actors to trick users into \nbeing redirected to websites under their control to capture authentication\ninformation.  \nTo prevent open redirect vulnerabilities:\n\n- Always validate and sanitize user inputs, especially URL parameters\n or query strings that may influence the flow of the application.\n- Use allowlists (lists of permitted URLs) to validate redirect targets \n against known, trusted URLs before performing the redirect.\n- Avoid directly using user input for redirecting. If unavoidable, ensure\n strict validation against an allowlist.\n\nFollowing is an example of secure validation against allowlist to prevent the vulnerability:\n ```\n // Define a list of explicitly allowed URLs for redirection\n const allowedUrls = [\n     'https://www.example.com/page1',\n     'https://www.example.com/page2',\n     'https://secure.example.com/page3'\n ];\n\n app.get('/redirect/:url', (req, res) => {\n     const url = decodeURIComponent(req.params.url);\n     const isAllowed = allowedUrls.includes(url);\n     if (isAllowed) {\n         // If the URL is allowed, proceed with the redirect\n          res.location(url).status(302).end();\n     } else {\n         res.status(400).send('Invalid redirect URL');\n     }\n });\n ```\n"
      metadata:
        category: security
        cwe: CWE-601
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: URL redirection to untrusted site 'open redirect'
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - patterns:
                - pattern-either:
                    - pattern: "if($VALIDATION){\n  ...\n} \n"
                    - pattern: |
                        $A = $VALIDATION
                        ...
                        if($A){
                          ...
                        }
                - metavariable-pattern:
                    metavariable: $VALIDATION
                    pattern-either:
                        - pattern: "$AL.includes(...)  \n"
                        - pattern: |
                            $AL.indexOf(...) !== -1
                        - pattern: |
                            $AL.find(...) !== undefined
                        - pattern: |
                            $ALS.has(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-not: |
                    $RES.$METHOD("=~/location/i", "=~/http(s)?:\/\/.*\//" + ...)
                - pattern-not-inside: |
                    $VAR = "=~/http(s)?:\/\/.*\//" + ...;
                    ...
                - pattern: |
                    $RES.$METHOD("=~/location/i", $VAR)
                - metavariable-regex:
                    metavariable: $METHOD
                    regex: (header|set|append|setHeader)
            - patterns:
                - pattern-not-inside: |
                    $V = "=~/http(s)?:\/\/.*\//" + ...;
                    ...
                - pattern-not:
                    patterns:
                        - pattern: "$RES.writeHead(..., { \n    ..., \n    location: $V,\n    ...\n})\n"
                        - metavariable-pattern:
                            metavariable: $V
                            patterns:
                                - pattern: |
                                    "=~/http(s)?:\/\/.*\//" + ...
                - pattern: "$RES.writeHead(..., { \n            ..., \n            location: $V,\n            ...\n        })\n"
                - focus-metavariable: $V
            - patterns:
                - pattern-not: |
                    $RES.location("=~/http(s)?:\/\/.*\//" + ...)
                - pattern-not-inside: |
                    $VAR = "=~/http(s)?:\/\/.*\//" + ...;
                    ...
                - pattern: |
                    $RES.location($VAR)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                function ($REQ, $RES, ...) {...}
            - focus-metavariable: $REQ
      severity: ERROR
    - id: rules_lgpl_javascript_ssrf_rule-node-ssrf
      languages:
        - javascript
      message: "This application allows user-controlled URLs to be passed directly to HTTP client libraries. \nThis can result in Server-Side Request Forgery (SSRF).\nSSRF refers to an attack where the attacker can abuse functionality on \nthe server to force it to make requests to other internal systems within your \ninfrastructure that are not directly exposed to the internet. \nThis allows the attacker to access internal resources they do not have direct access to.\n\nSome risks of SSRF are:\n\n- Access and manipulation of internal databases, APIs, or administrative panels\n- Ability to scan internal network architecture and services\n- Can be used to pivot attacks into the internal network\n- Circumvent network segregation and firewall rules\n\nTo avoid this, try using hardcoded HTTP request calls or a whitelisting object to \ncheck whether the user input is trying to access allowed resources or not.\n\nHere is an example:\n```\nvar whitelist = [\n  \"https://example.com\", \n  \"https://example.com/sample\"\n]\n\napp.get('/ssrf/node-ssrf/axios/safe/3', function (req, res) {\n  if(whitelist.includes(req.query.url)){\n      axios.get(url, {})\n          .then(function (response) {\n              console.log(response);\n          })\n          .catch(function (response) {\n              console.log(response);  \n          })\n  }\n});\n``` \nFor more information on SSRF see OWASP:\nhttps://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html\n"
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: HIGH
        shortDescription: Server-side request forgery (SSRF)
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: "if($VALIDATION){\n...\n} \n"
                - pattern: |
                    $A = $VALIDATION
                    ...
                    if($A){
                    ...
                    }
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: "$AL.includes(...)  \n"
                    - pattern: |
                        $AL.indexOf(...) !== -1
                    - pattern: |
                        $AL.find(...) !== undefined
                    - pattern: |
                        $ALS.has(...)
      pattern-sinks:
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    $NEEDLE = require('needle');
                    ...
                - pattern-inside: |
                    import $NEEDLE from 'needle'
                    ...
            - pattern-either:
                - pattern: $NEEDLE('$VERB', $REQ, ...)
                - pattern: $NEEDLE.$VERB($REQ, ...)
            - metavariable-regex:
                metavariable: $VERB
                regex: ^(get|put|post|patch|delete|head)$
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    $AXIOS = require('axios');
                    ...
                - pattern-inside: |
                    import $AXIOS from 'axios'
                    ...
            - pattern-either:
                - patterns:
                    - metavariable-regex:
                        metavariable: $URL
                        regex: ^(url|baseURL)$
                    - pattern-either:
                        - pattern: |
                            $AXIOS({ ..., $URL: $REQ, ...})
                        - pattern: |
                            $AXIOS.create({ ..., $URL: $REQ, ...})
                - patterns:
                    - pattern: $AXIOS.$VERB($REQ, ...)
                    - metavariable-regex:
                        metavariable: $VERB
                        regex: ^(get|put|post|patch|delete|head)$
                - patterns:
                    - pattern: axios($REQ)
                    - pattern-not-inside: axios({...})
                - pattern: |
                    axios.defaults.baseURL = $REQ
        - patterns:
            - focus-metavariable: $URL
            - pattern-either:
                - pattern-inside: |
                    {..., request, ... } = require('urllib');
                    ...
                - pattern-inside: |
                    import {..., request, ... } from 'urllib'
                    ...
            - pattern: request($URL, ...)
        - patterns:
            - focus-metavariable: $URL
            - pattern-either:
                - pattern-inside: |
                    {..., HttpClient, ... } = require('urllib');
                    ...
                - pattern-inside: |
                    import {..., HttpClient, ... } from 'urllib'
                    ...
                - pattern: |
                    $HTTPCLIENT = new HttpClient({
                                        allowH2: true,
                                      });
                    ...
                    $HTTPCLIENT.request($URL, ...)
        - patterns:
            - focus-metavariable: $URL
            - pattern-either:
                - pattern-inside: |
                    $URLLIIB = require('urllib');
                    ...
                - pattern-inside: |
                    import $URLLIIB from 'urllib'
                    ...
            - pattern: $URLLIIB.request($URL, ...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $SA = require('superagent');
                     ...
                - pattern-inside: |
                    import $SA from 'superagent'
                    ...
            - patterns:
                - pattern: $SA.$VERB(...)
                - metavariable-regex:
                    metavariable: $VERB
                    regex: ^(get|put|post|patch|delete|head)$
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern: fetch($REQ,...)
                    - focus-metavariable: $REQ
                    - pattern-not: fetch(new Request(...))
                - patterns:
                    - pattern: fetch(new Request($REQ,...))
                    - focus-metavariable: $REQ
            - pattern-not-inside: |
                $REQUEST_OBJ = new Request(...)
                ...
                fetch($REQUEST_OBJ)
        - patterns:
            - pattern: new Request($REQ,...)
            - focus-metavariable: $REQ
            - pattern-inside: |
                $REQUEST_OBJ = new Request($REQ,...)
                ...
                fetch($REQUEST_OBJ)
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    $HTTP = require('$PKG');
                    ...
                - pattern-inside: |
                    import $HTTP from $PKG
                    ...
            - metavariable-regex:
                metavariable: $PKG
                regex: ^(http|https)$
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(get|request)$
            - pattern-either:
                - patterns:
                    - pattern: $HTTP.$METHOD($REQ, ...)
                    - pattern-not-inside: |
                        $HTTP.$METHOD({...}, ...)
                    - pattern-not-inside: |
                        $OPTS = {...}
                        ...
                        $HTTP.$METHOD($OPTS, ...)
                - pattern: |
                    $HTTP.$METHOD({..., hostname: $REQ}, ...)
                - pattern: |
                    $OPTS = {..., hostname: $REQ, ...}
                    ...
                    $HTTP.$METHOD($OPTS, ...)
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    { ..., io, ... } = require('socket.io-client');
                    ...
                - pattern-inside: |
                    import { ..., io, ... } from 'socket.io-client'
                    ...
            - pattern: io($REQ, ...)
        - patterns:
            - focus-metavariable: $HOST
            - pattern-either:
                - pattern-inside: |
                    $NET = require('net');
                    ...
                - pattern-inside: |
                    import $NET from 'net'
                    ...
            - metavariable-regex:
                metavariable: $METHOD
                regex: ^(connect|createConnection)$
            - pattern-either:
                - pattern: $NET.$METHOD($PORT, $HOST, ...)
                - pattern: |
                    $NET.$METHOD({..., host: $HOST, ...}, ...)
                - pattern: |
                    $OPTS = {..., host: $HOST, ...}
                    ...
                    $NET.$METHOD($OPTS, ...)
                - pattern: |
                    $CLIENT = new $NET.Socket()
                    ...
                    $CLIENT.$METHOD($PORT, $HOST, ...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $BENT = require('bent');
                    ...
                - pattern-inside: |
                    import $BENT from 'bent';
                    ...
            - pattern: $BENT(...)
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    $BENT = require('bent');
                    ...
                    $MTD = $BENT(...)
                - pattern-inside: |
                    import $BENT from 'bent';
                    ...
                    $MTD = $BENT(...)
            - pattern: $MTD($REQ, ...)
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $BENT = require('bent');
                    ...
                    $GETBENT = $BENT('$PKG')
                    ...
                - pattern-inside: |
                    import $BENT from 'bent';
                    ...
                    $GETBENT = $BENT('$PKG')
                    ...
            - pattern: $GETBENT(...)
            - metavariable-regex:
                metavariable: $PKG
                regex: ^(json|buffer)$
        - patterns:
            - focus-metavariable: $REQ
            - pattern-either:
                - pattern-inside: |
                    import $GOT from 'got';
                    ...
            - pattern: $GOT.$VERB($REQ, ...)
            - metavariable-regex:
                metavariable: $VERB
                regex: ^(get|put|post|patch|delete|head)$
        - patterns:
            - focus-metavariable: $URL
            - pattern-either:
                - pattern-inside: |
                    $REQUEST = require('request');
                    ...
                - pattern-inside: |
                    import $REQUEST from 'request';
                    ...
            - pattern: $REQUEST($URL, ...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $REQ
            - pattern: function ($REQ, $RES, ...) {...}
        - patterns:
            - focus-metavariable: $REQ
            - pattern: function $FUNC($REQ, $RES, ...) {...}
      severity: ERROR
    - id: rules_lgpl_javascript_ssrf_rule-phantom-ssrf
      languages:
        - javascript
      message: |
        'If unverified user data can reach the `phantom` methods it can result in Server-Side Request Forgery vulnerabilities.

        '
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Server-side request forgery (SSRF)
      patterns:
        - pattern-inside: |
            require('phantom')
            ...
        - pattern-either:
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: $PAGE.open(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.setContent(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.open(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.setContent(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.openUrl(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.openUrl(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluateJavaScript(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluateJavaScript(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.property("content",<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.property("content",<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.open(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.open(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.openUrl(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.openUrl(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateJavaScript(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateJavaScript(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.property("content",<... $INPUT ...>,...)
            - pattern: |-
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.property("content",<... $INPUT ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_ssrf_rule-playwright-ssrf
      languages:
        - javascript
      message: |
        If unverified user data can reach the `puppeteer` methods it can result in Server-Side Request Forgery vulnerabilities.
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Server-side request forgery (SSRF)
      patterns:
        - pattern-inside: |
            require('playwright')
            ...
        - pattern-either:
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: $PAGE.goto(<... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.goto(<... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.setContent(<... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.setContent(<... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluate(<... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.evaluate(<... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluate($CODE,..., <... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.evaluate($CODE,..., <... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluateHandle(<... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.evaluateHandle(<... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluateHandle($CODE,..., <... $REQ.$QUERY.$FOO ...>, ...)
            - pattern: $PAGE.evaluateHandle($CODE,..., <... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluateOnNewDocument(<... $REQ.$BODY ...>, ...)
            - pattern: $PAGE.evaluateOnNewDocument(<... $REQ.$BODY.$FOO ...>, ...)
            - pattern: $CONTEXT.addInitScript(<... $REQ.$BODY ...>,...)
            - pattern: $CONTEXT.addInitScript(<... $REQ.$BODY.$FOO ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.goto(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.goto(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluate($CODE,..., <... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluate($CODE,..., <... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluate(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluate(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateHandle(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateHandle(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateHandle($CODE,..., <... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateHandle($CODE,..., <... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateOnNewDocument(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateOnNewDocument(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $CONTEXT.addInitScript($INPUT,...)
      severity: ERROR
    - id: rules_lgpl_javascript_ssrf_rule-puppeteer-ssrf
      languages:
        - javascript
      message: |
        If unverified user data can reach the `puppeteer` methods it can result in Server-Side Request Forgery vulnerabilities.
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Server-side request forgery (SSRF)
      patterns:
        - pattern-inside: |
            require('puppeteer')
            ...
        - pattern-either:
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: $PAGE.goto(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.goto(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.setContent(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.setContent(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluate(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluate(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluateHandle(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluateHandle(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluateOnNewDocument(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluateOnNewDocument(<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluate($CODE,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluate($CODE,<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluateHandle($CODE,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluateHandle($CODE,<... $REQ.$BODY ...>,...)
            - pattern: $PAGE.evaluateOnNewDocument($CODE,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PAGE.evaluateOnNewDocument($CODE,<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.goto(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.goto(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.setContent(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluate(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluate(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateHandle(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateHandle(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateOnNewDocument(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateOnNewDocument(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluate($CODE,<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluate($CODE,<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateHandle($CODE,<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateHandle($CODE,<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PAGE.evaluateOnNewDocument($CODE,<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PAGE.evaluateOnNewDocument($CODE,<... $INPUT ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_ssrf_rule-wkhtmltopdf-ssrf
      languages:
        - javascript
      message: |
        User controlled URL reached to `wkhtmltopdf` can result in Server Side Request Forgery (SSRF).
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Server-side request forgery (SSRF)
      patterns:
        - pattern-inside: |
            require('wkhtmltopdf')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $INP = <... $REQ.$VAR ...>;
                ...
                wkhtmltopdf(<... $INP ...>, ...)
            - pattern: |
                $INP = <... $REQ.$VAR.$FOO ...>;
                ...
                wkhtmltopdf(<... $INP ...>, ...)
            - pattern: |
                wkhtmltopdf(<... $REQ.$VAR ...>, ...)
            - pattern: |
                wkhtmltopdf(<... $REQ.$VAR.$FOO ...>, ...)
      severity: ERROR
    - id: rules_lgpl_javascript_traversal_rule-admzip-path-overwrite
      languages:
        - javascript
      message: |
        Insecure ZIP archive extraction using adm-zip can result in arbitrary path over write and can result in code injection.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-inside: |
            $X = require('adm-zip')
            ...
        - pattern-not: |
            if ($FILENAME.indexOf('..'))
        - pattern-not: |
            $FS.createWriteStream($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-not: |
            $FS.writeFile($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-not: |
            $FS.writeFileSync($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-either:
            - pattern: $ZIPENTZ.forEach(function $FUNC($ENTRY, ...) { $FS.createWriteStream(...) }, ...)
            - pattern: $ZIPENTZ.forEach(function $FUNC($ENTRY, ...) { $FS.writeFile(...) }, ...)
            - pattern: $ZIPENTZ.forEach(function $FUNC($ENTRY, ...) { $FS.writeFileSync(...) }, ...)
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-express-lfr
      languages:
        - javascript
      message: "This application is using untrusted user input in express render() function.\nRendering templates with untrusted user input enables arbitrary file read \nvulnerabilities when using templating engines like Handlebars (hbs). \n\nAn attacker can craft malicious input that traverses the filesystem and exposes sensitive files. \nConsider sanitizing and validating all user input before passing it to render() to prevent arbitrary file reads. \n\nSample safe use of express.render function\n```\napp.get(\"/traversal/2\", async (req, res) => {\n    var indexPath = \"index\";\n    res.render(indexPath, { title: \"Index Page\" })\n});\n```\n\nFor more details see: \nhttps://owasp.org/www-community/attacks/Path_Traversal\n"
      metadata:
        category: security
        cwe: CWE-23
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Relative path traversal
      mode: taint
      pattern-sinks:
        - pattern: $RES.render(..., $VAR)
      pattern-sources:
        - patterns:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern: $REQ.$FUNC. ...
            - metavariable-regex:
                metavariable: $FUNC
                regex: ^(body|params|query|cookies|hostname|subdomains|ip|ips|originalUrl|path)$
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-express-lfr-warning
      languages:
        - javascript
      message: |
        Untrusted user input in express render() function can result in arbitrary file read if hbs templating is used.
      metadata:
        category: security
        cwe: CWE-23
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Relative path traversal
      patterns:
        - pattern-not-inside: |
            require('hbs')
            ...
        - pattern-inside: |
            require('express')
            ...
        - pattern-either:
            - pattern: |
                $INP = <... $REQ.$QUERY ...>;
                ...
                $RES.render($VIEW, <... $INP ...>)
            - pattern: |
                $INP = <... $REQ.$QUERY.$FOO ...>;
                ...
                $RES.render($VIEW, <... $INP ...>)
            - pattern: $RES.render($VIEW, <... $REQ.$QUERY.$FOO ...>)
            - pattern: $RES.render($VIEW, <... $REQ.$BODY ...>)
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-generic-path-traversal
      languages:
        - javascript
      message: "This application is using untrusted user input with the readFile() and\nreadFileSync() functions. \nThis can lead to directory traversal attacks, as reading files with untrusted input enables arbitrary file access.\nAn attacker could craft malicious input that traverses the file system and exposes sensitive files. \nPlease consider sanitizing and validating all user input before passing it to readFile() or readFileSync() to prevent unwanted file reads.\nHere is an example of a safer usage in readFileAsync():\n```\napp.get('/foo', function (req, res) {\n    var fileName = config.dirName + '/' + data;\n    fs.readFileAsync(\"fileName\")\n        .then(function (data) {\n            res.download(fileName, downloadFileName);\n        })\n    })\n```\nFor more details see: \nhttps://owasp.org/www-community/attacks/Path_Traversal\n"
      metadata:
        category: security
        cwe: CWE-23
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Relative path traversal
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $FS = require('fs')
                    ...
                - pattern-inside: |
                    import $FS from 'fs'
                    ...
            - pattern-either:
                - pattern: $FS.createReadStream(...)
                - patterns:
                    - pattern: $FS.readFile($REQ, ...)
                    - focus-metavariable: $REQ
                - patterns:
                    - pattern: $FS.readFileSync($REQ,...)
                    - focus-metavariable: $REQ
                - patterns:
                    - pattern: $FS.readFileAsync($REQ,...)
                    - focus-metavariable: $REQ
      pattern-sources:
        - patterns:
            - focus-metavariable: $REQ
            - pattern: function ($REQ, $RES, ...) {...}
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-join-resolve-path-traversal
      languages:
        - javascript
      message: |
        'Path constructed with user input can result in Path Traversal. Ensure that user input does not reach `join()` or `resolve()`. '
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-inside: |
            require('path')
            ...
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: $PATH.join(...,<... $REQ.$BODY ...>,...)
            - pattern: $PATH.join(...,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $PATH.join(...,<... $VAR ...>,...)
            - pattern: |
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PATH.join(...,<... $VAR ...>,...)
            - pattern: $PATH.resolve(...,<... $REQ.$BODY ...>,...)
            - pattern: $PATH.resolve(...,<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: |
                $VAR = <... $REQ.$BODY ...>;
                ...
                $PATH.resolve(...,<... $VAR ...>,...)
            - pattern: |-
                $VAR = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PATH.resolve(...,<... $VAR ...>,...)
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-tar-path-overwrite
      languages:
        - javascript
      message: |
        Insecure TAR archive extraction can result in arbitrary path over write and can result in code injection.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-inside: |
            $X = require('tar-stream')
            ...
        - pattern-not-inside: |
            $Y.pipe($UNZIP.Parse(...)).on('entry', function $FUNC(...) {
                ...
            }, ...)
        - pattern-inside: |
            $EXTRACT.on('entry', function $FUNC(...) {
              ...
            }, ...)
        - pattern-not: |
            if ($FILENAME.indexOf('..'))
        - pattern-not: |
            $FS.createWriteStream($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-not: |
            $FS.writeFile($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-not: |
            $FS.writeFileSync($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern-either:
            - pattern: |
                $FS.createWriteStream($FIL, ...)
            - pattern: |
                $FS.writeFile($FIL, ...)
            - pattern: |
                $FS.writeFileSync($FIL, ...)
      severity: WARNING
    - id: rules_lgpl_javascript_traversal_rule-zip-path-overwrite
      languages:
        - javascript
      message: "This application is extracting ZIP archives without sanitizing paths or writing files to a dedicated extraction directory. \nThis allows attackers to overwrite sensitive files or inject malicious code by manipulating TAR archive contents.\n\nTo fix, sanitize all paths from ZIP archives before writing extracted files using path.basename and path.join.\n\nExample  of extracting tar files safely:\n```\napp.get(\"/extract\", async (req, res) => {\n        fs.createReadStream(zipPath)\n        .pipe(unzipper.Parse())\n        .on('entry', entry => {\n            const directory = 'assets/tar/extracted/';\n            const filename = entry.path;\n            entry.pipe(fs.createWriteStream(path.join(directory, filename)));\n        });\n});\n```\n\nWrite extracted files only to a dedicated extraction directory, not the global filesystem. Limit extracts to allowed file type.\n\nSee OWASP Path Traversal (https://owasp.org/www-community/attacks/Path_Traversal) and Unrestricted Upload of File with \nDangerous Type (https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload) for more details.\n"
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
      patterns:
        - pattern-either:
            - pattern-inside: |
                import $X from 'unzipper'
                ...
            - pattern-inside: |
                $X = require('unzipper')
                ...
        - pattern-inside: |
            $Y.pipe($X.Parse(...)).on('entry', function $FUNC(...) {
                ...
            }, ...)
        - pattern-not-inside: "if (<... $FILENAME.indexOf(...) ...>){ \n...\n}\n"
        - pattern-not-inside: |
            $BASE = $PATH.basename($FILENAME, ...)
            ...
            $JOIN = $PATH.join(..., $BASE)
            ...
        - pattern-not: |
            $FS.$MTD($PATH.join(..., $PATH.basename($FILENAME, ...)))
        - pattern: |
            $FS.$MTD($FIL, ...)
        - metavariable-regex:
            metavariable: $MTD
            regex: ^(writeFileSync|writeFile|createWriteStream)$
      severity: WARNING
    - id: rules_lgpl_javascript_xml_rule-node-xpath-injection
      languages:
        - javascript
      message: "Passing untrusted user input in `xpath.parse()` can result in XPATH injection\nvulnerability. This could be abused by malicious actors to execute expressions on\non XML files to capture unauthorized information.\nTo prevent XPATH injection vulnerabilities:\n\n- Always validate and sanitize user inputs, especially parameters\nor query strings that may influence the flow of the application.\n- Avoid directly using user input for parsing. If unavoidable, ensure\nstrict validation against an allowlist. \n- Use allowlists (lists of permitted expressions) to validate user input \nagainst known, trusted expressions before performing the parse.\n\n\nFollowing is an example of secure validation against allowlist to prevent the vulnerability:\n```\n// Define a list of explicitly allowed expressions for parsing\nconst allowedExpr = [\n    'expression1',\n    'expression2',\n    'expression3'\n];\n\napp.get('/xml/xpath/1', (req, res) => {\n    var expression = req.params.exp;\n    var isAllowed = allowedExpr.includes(expression);\n    let xml_string = fs.readFileSync(\"books.xml\", \"utf8\");\n    var doc = new dom().parseFromString(xml_string, 'text/xml');\n    if (isAllowed) {\n        // If the expression is allowed, proceed with the parsing\n        var evaluator = xpath.parse(\"//\"+expression);\n        var nodes = evaluator.select({ node: doc });            \n        res.send(nodes[0].firstChild.data);\n    } else {\n        res.status(400).send('Invalid expression');\n    }\n});\n```\n"
      metadata:
        category: security
        cwe: CWE-643
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of data within XPath expressions (XPath Injection)
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-either:
                - pattern: "if($VALIDATION){\n...\n$XPATH.parse($REQ, ...) \n...\n} \n"
                - pattern: "$A = $VALIDATION\n...\nif($A){\n...\n$XPATH.parse($REQ, ...) \n...\n}\n"
            - metavariable-pattern:
                metavariable: $VALIDATION
                pattern-either:
                    - pattern: "$AL.includes(...)  \n"
                    - pattern: |
                        $AL.indexOf(...) !== -1
                    - pattern: |
                        $AL.find(...) !== undefined
                    - pattern: |
                        $ALS.has(...)
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $XPATH = require('xpath')
                    ...
                - pattern-inside: |
                    import { $XPATH } from 'xpath'
                    ...
                - pattern-inside: |
                    import { $K as $XPATH } from 'xpath'
                    ...
            - pattern: "$XPATH.parse($REQ, ...)    \n"
            - focus-metavariable: $REQ
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    function ($REQ, $RES, ...) {...}
                - pattern: |
                    function $FUNC($REQ, $RES, ...) {...}
            - focus-metavariable: $REQ
      severity: ERROR
    - id: rules_lgpl_javascript_xml_rule-node-xxe
      languages:
        - javascript
      message: |
        User controlled data in XML parsers can result in XML External or Internal Entity (XXE) Processing vulnerabilities
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        security-severity: CRITICAL
        shortDescription: Improper restriction of XML external entity reference
      patterns:
        - pattern-either:
            - pattern-inside: function ($REQ, $RES, ...) {...}
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern: |
                $LIBXML.parseXmlString(..., <... $REQ.$QUERY.$VAR.$FILE ...>, ...)
            - pattern: |
                $LIBXML.parseXmlString(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $LIBXML.parseXmlString(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY.$VAR.$FILE ...>; ... $LIBXML.parseXmlString(..., <... $FOO ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY.$VAR ...>; ... $LIBXML.parseXmlString(..., <... $FOO ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY ...>; ... $LIBXML.parseXmlString(..., <... $FOO ...>, ...)
            - pattern: |
                $LIBXML.parseXml(..., <... $REQ.$QUERY.$VAR.$FILE ...>, ...)
            - pattern: |
                $LIBXML.parseXml(..., <... $REQ.$QUERY.$VAR ...>, ...)
            - pattern: |
                $LIBXML.parseXml(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY.$VAR.$FILE ...>; ... $LIBXML.parseXml(..., <... $FOO ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY.$VAR ...>; ... $LIBXML.parseXml(..., <... $FOO ...>, ...)
            - pattern: |
                $FOO = <... $REQ.$QUERY ...>;
                ...
                $LIBXML.parseXml(..., <... $FOO ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $PARSER.parseString(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $PARSER.parseString(..., <... $REQ.$QUERY.$BAR ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $PARSER.parseString(..., <... $REQ.$QUERY.$BAR.$FILE ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $PARSER.push(..., <... $REQ.$QUERY ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $PARSER.push(..., <... $REQ.$QUERY.$FOO ...> , ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $PARSER.push(..., <... $REQ.$QUERY.$FOO.$FILE ...> , ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $FOO = <... $REQ.$QUERY ...>;
                ...
                $PARSER.parseString(..., <... $FOO ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $FOO = <... $REQ.$QUERY.$BAR ...>;
                ...
                $PARSER.parseString(..., <... $FOO ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxParser()
                ...
                $FOO = <... $REQ.$QUERY.$BAR.$FILE ...>;
                ...
                $PARSER.parseString(..., <... $FOO ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $FOO = <... $REQ.$QUERY ...>;
                ...
                $PARSER.push(..., <... $FOO ...>, ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $FOO = <... $REQ.$QUERY.$BAR ...>;
                ...
                $PARSER.push(..., <... $FOO ...> , ...)
            - pattern: |
                $PARSER = new libxmljs.SaxPushParser()
                ...
                $FOO = <... $REQ.$QUERY.$BAR.$FILE ...>;
                ...
                $PARSER.push(..., <... $FOO ...> , ...)
      severity: ERROR
    - id: rules_lgpl_javascript_xml_rule-xxe-expat
      languages:
        - javascript
      message: |
        Make sure that unverified user data can not reach the XML Parser, as it can result in XML External or Internal Entity (XXE) Processing vulnerabilities.
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A4:2017-XML External Entities (XXE)
            - A05:2021-Security Misconfiguration
        security-severity: CRITICAL
        shortDescription: Improper restriction of XML external entity reference
      patterns:
        - pattern-inside: |
            require('node-expat')
            ...
        - pattern-either:
            - pattern-inside: function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: $X = function $FUNC($REQ, $RES, ...) {...}
            - pattern-inside: var $X = function $FUNC($REQ, $RES, ...) {...};
            - pattern-inside: $APP.$METHOD(..., function $FUNC($REQ, $RES, ...) {...})
        - pattern-either:
            - pattern-inside: |
                $PARSER = new $EXPAT.Parser(...)
                ...
            - pattern-inside: |
                $PARSER = new Parser(...)
                ...
        - pattern-either:
            - pattern: $PARSER.parse(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PARSER.parse(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PARSER.parse(<... $INPUT ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PARSER.parse(<... $INPUT ...>,...)
            - pattern: $PARSER.write(<... $REQ.$QUERY.$FOO ...>,...)
            - pattern: $PARSER.write(<... $REQ.$BODY ...>,...)
            - pattern: |
                $INPUT = <... $REQ.$QUERY.$FOO ...>;
                ...
                $PARSER.write(<... $INPUT ...>,...)
            - pattern: |-
                $INPUT = <... $REQ.$BODY ...>;
                ...
                $PARSER.write(<... $INPUT ...>,...)
      severity: ERROR
    - id: rules_lgpl_javascript_xss_rule-express-xss
      languages:
        - javascript
      message: "This application accepts user input directly from the client side without validation. \nThis could lead to Cross Site Scripting (XSS) if the input contains malicious script code and \nthe application server does not properly escape or sanitize the output.  \nConsider encoding input data before sending it to the client side.  \n\n```\n// safe method of sending user input data\nrouter.get('/safe/1', (req, res) => {\n  var name = encodeURI(req.query.name); \n  res.send(name);\n})\n```\n\nXSS is an attack that exploits a web application or system to treat user input as markup or script code. \nIt is important to encode the data depending on the specific context in which it is used. \n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      mode: taint
      options:
        taint_unify_mvars: true
      pattern-propagators:
        - from: $IN
          pattern: $ARR.push($IN)
          to: $ARR
      pattern-sanitizers:
        - pattern: encodeURI(...)
        - pattern: encodeURIComponent(...)
      pattern-sinks:
        - patterns:
            - focus-metavariable: $INPUT
            - pattern-either:
                - pattern: $RES. ... .send($INPUT)
                - pattern: $RES. ... .write($INPUT)
      pattern-sources:
        - patterns:
            - patterns:
                - metavariable-regex:
                    metavariable: $LIB
                    regex: (?<!\s)\bexpress(?:\/.*)?\b
                - pattern-either:
                    - pattern-inside: |
                        import { ... } from '$LIB'
                        ...
                    - pattern-inside: |
                        import $IMPORT from '$LIB'
                        ...
                    - pattern-inside: |
                        require('$LIB')
                        ...
            - pattern-either:
                - patterns:
                    - focus-metavariable: $REQ
                    - pattern: function ($REQ, $RES, ...) {...}
                - patterns:
                    - focus-metavariable: $REQ
                    - pattern: function $FUNC($REQ, $RES, ...) {...}
      severity: WARNING
    - id: rules_lgpl_javascript_xss_rule-handlebars-safestring
      languages:
        - javascript
      message: "This application is using a vulnerable method `Handlebars.SafeString(...)`.\nHandlebars SafeString method does not escape the data passed through it. \nUntrusted user input passing through SafeString method can make the application \nvulnerable to Cross-Site Scripting (XSS) attacks.\n\nXSS attacks are a type of security breach that occurs when an attacker manages to \ninject malicious scripts into web pages viewed by other users. These scripts can then \nexecute in the context of the victim's session, allowing the attacker to bypass access \ncontrols and potentially access sensitive information or perform actions on behalf of the    \nuser. It is important to encode the data depending on the specific context it is used in. \n\nConsider using the `Handlebars.escapeExpression` method to escape user input while \nconstructing SafeString to avoid potential security concerns. Following is a secure code \nexample.\n```\n  var returnObj = new Handlebars.SafeString(\"<h1>Handlebars safe string</h1>\" +  Handlebars.escapeExpression(req.query.message))\n  res.send(returnObj.string)\n```\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation (Cross-site Scripting)
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $HB = require('handlebars')
                    ...
                - pattern: $HB.escapeExpression(...)
            - patterns:
                - pattern-inside: |
                    import $HB from "handlebars";
                    ...
                - pattern: $HB.escapeExpression(...)
      pattern-sinks:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $HB = require('handlebars')
                    ...
                - pattern: new $HB.SafeString(...)
            - patterns:
                - pattern-inside: |
                    import $HB from "handlebars";
                    ...
                - pattern: new $HB.SafeString(...)
      pattern-sources:
        - patterns:
            - focus-metavariable: $REQ
            - pattern: function ($REQ, $RES, ...) {...}
      severity: WARNING
    - id: rules_lgpl_javascript_xss_rule-squirrelly-autoescape
      languages:
        - javascript
      message: "This application is rendering HTML with vulnerable \nconfigurations by setting Sqrl.autoEscaping(false) in squirrelly.\n\nThis could lead to Cross Site Scripting (XSS) if the input is malicious \nscript code and the application server is not properly validating the output.\n\n```\n// safe use of squirrelly render\nvar myTemplate = \"<p>My Message is: {{message}}</p>\"\nSqrl.Render(myTemplate, {message: req.query.message})\n```\n\nXSS is an attack that exploits a web application or system to treat user input as markup or script code. \nIt is important to encode the data depending on the specific context it is used in.\n\nBy default, squirrelly autoEscaping(true) escapes input values to prevent XSS attacks. \nConsider using squirrelly with default autoEscaping settings.\n"
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      pattern-either:
        - patterns:
            - pattern-inside: |
                $SQLY = require('squirrelly')
                ...
            - pattern: $SQLY.autoEscaping(false)
        - patterns:
            - pattern-inside: |
                import $SQLY from 'squirrelly';
                ...
            - pattern: $SQLY.autoEscaping(false)
      severity: WARNING
    - id: rules_lgpl_javascript_xss_rule-xss-disable-mustache-escape
      languages:
        - javascript
      message: |
        Markup escaping disabled. This can be used with some template engines to escape disabling of HTML entities, which can lead to XSS attacks.
      metadata:
        category: security
        cwe: CWE-116
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper encoding or escaping of output
      pattern: $OBJ.escapeMarkup = false
      severity: WARNING
    - id: rules_lgpl_javascript_xss_rule-xss-serialize-javascript
      languages:
        - javascript
      message: "This application is serializing Javascript objects with vulnerable \nconfigurations by setting `{unsafe: true}` in serialize-javascript. \n\nThis could lead to Cross Site Scripting (XSS) if the input was malicious \nscript code and the application server is not properly validating the output.\n\n```\n// safe use of serialize-javascript\nconst jsObj = serialize({\n  foo: htmlResponse\n  }\n);\n```\n\nXSS is an attack which exploits a web application or system to treat user input as markup or script code. \nIt is important to encode the data depending on the specific context it is used in. \n\nBy default, serialize-javascript encodes input values to prevent XSS attacks. \nConsider using serialize-javascript with default settings or set `{unsafe: false}` to encode\ninput data.\n"
      metadata:
        category: security
        cwe: CWE-80
        owasp:
            - A7:2017-Cross-Site Scripting (XSS)
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of script-related HTML tags in a web page (basic XSS)
      pattern-either:
        - patterns:
            - pattern-inside: |
                $S = require('serialize-javascript')
                ...
            - pattern: '$S(..., {...,unsafe: true,...})'
        - patterns:
            - pattern-inside: |
                import serialize from "serialize-javascript";
                ...
            - pattern: 'serialize(..., {...,unsafe: true,...})'
      severity: WARNING
    - id: kotlin_cookie_rule-HttpResponseSplitting
      languages:
        - kotlin
      message: |
        When an HTTP request contains unexpected CR and LF characters, the server may respond with an
        output stream that is interpreted as two different HTTP responses (instead of one). An attacker
        can control the second response and mount attacks such as cross-site scripting and cache
        poisoning attacks.
      metadata:
        category: security
        cwe: CWE-113
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of CRLF sequences in HTTP headers ('HTTP Response Splitting')
        technology:
            - kotlin
      mode: taint
      pattern-sanitizers:
        - patterns:
            - metavariable-pattern:
                metavariable: $S0
                pattern-either:
                    - pattern: '...'
                    - pattern: '""'
            - metavariable-pattern:
                metavariable: $PATTERN
                patterns:
                    - pattern: '...'
                    - pattern-regex: .*\[\]?(?=[^]]*\\r)(?=[^]]*\\n)[^]]*\]\+
            - pattern-inside: |
                $STR.replace($PATTERN, $S0)
                ...
        - pattern: org.apache.commons.text.StringEscapeUtils.escapeJava(...)
      pattern-sinks:
        - pattern: javax.servlet.http.Cookie("$KEY", ...)
        - patterns:
            - pattern-inside: |
                $C = javax.servlet.http.Cookie("$KEY", ...)
                ...
            - pattern: $C.setValue(...)
      pattern-sources:
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getParameter(...)'
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getParameterNames()'
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getParameterValues(...)'
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getParameterMap()'
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getHeader(...)'
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getPathInfo()'
      severity: WARNING
    - id: kotlin_cookie_rule-RequestParamToHeader
      languages:
        - kotlin
      message: |
        This code directly writes an HTTP parameter to an HTTP header, which allows for a HTTP
        response splitting vulnerability. See http://en.wikipedia.org/wiki/HTTP_response_splitting for
        more information.
      metadata:
        category: security
        cwe: CWE-113
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of CRLF sequences in HTTP headers ('HTTP Response Splitting')
        technology:
            - kotlin
      mode: taint
      pattern-sanitizers:
        - patterns:
            - metavariable-pattern:
                metavariable: $S0
                pattern-either:
                    - pattern: '...'
                    - pattern: '""'
            - metavariable-pattern:
                metavariable: $PATTERN
                patterns:
                    - pattern: '...'
                    - pattern-regex: .*\[\]?(?=[^]]*\\r)(?=[^]]*\\n)[^]]*\]\+
            - pattern-inside: |
                $STR.replace($PATTERN, $S0);
                ...
        - pattern: org.apache.commons.text.StringEscapeUtils.unescapeJava(...);
      pattern-sinks:
        - pattern: '($RES: $X.servlet.http.HttpServletResponse).setHeader("$KEY", ...);'
        - pattern: '($RES: $X.servlet.http.HttpServletResponse).addHeader("$KEY", ...);'
        - pattern: '($WRP: $X.servlet.http.HttpServletResponseWrapper).setHeader("$KEY", ...);'
        - pattern: '($WRP: $X.servlet.http.HttpServletResponseWrapper).addHeader("$KEY", ...);'
      pattern-sources:
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getParameter(...);'
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getParameterNames();'
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getParameterValues(...);'
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getParameterMap();'
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getHeader(...);'
        - pattern: '($REQ: $X.servlet.http.HttpServletRequest).getPathInfo();'
      severity: ERROR
    - id: kotlin_cors_rule-PermissiveCORSInjection
      languages:
        - kotlin
      message: |
        Prior to HTML5, Web browsers enforced the Same Origin Policy which ensures that in order for
        JavaScript to access the contents of a Web page, both the JavaScript and the Web page must
        originate from the same domain. Without the Same Origin Policy, a malicious website could serve
        up JavaScript that loads sensitive information from other websites using a client's
        credentials, cull through it, and communicate it back to the attacker. HTML5 makes it possible
        for JavaScript to access data across domains if a new HTTP header called
        Access-Control-Allow-Origin is defined. With this header, a Web server defines which other
        domains are allowed to access its domain using cross-origin requests. However, caution should
        be taken when defining the header because an overly permissive CORS policy will allow a
        malicious application to communicate with the victim application in an inappropriate way,
        leading to spoofing, data theft, relay and other attacks.
      metadata:
        category: security
        cwe: CWE-942
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Permissive cross-domain policy with untrusted domains
        technology:
            - kotlin
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: '($RES: HttpServletResponse).setHeader("$HEADER", ...)'
                - pattern: '($RES: HttpServletResponse).addHeader("$HEADER", ...)'
            - metavariable-regex:
                metavariable: $HEADER
                regex: (?i)(Access-Control-Allow-Origin)
      pattern-sources:
        - pattern: '($REQ: HttpServletRequest).getParameter(...)'
        - pattern: '($REQ: HttpServletRequest).getHeader(...)'
        - pattern: '($REQ: HttpServletRequest).getPathInfo()'
        - pattern: '($REQ: HttpServletRequest).getQueryString()'
        - pattern: '($REQ: HttpServletRequest).getAttribute(...)'
        - pattern: '($REQ: HttpServletRequest).getSession().getAttribute(...)'
        - pattern: '($REQ: HttpServletRequest).getServletContext().getAttribute(...)'
        - pattern: '($REQ: HttpServletRequest).getParameterValues(...)'
        - pattern: '($REQ: HttpServletRequest).getParameterNames()'
        - pattern: '($REQ: HttpServletRequest).getParameterMap()'
      severity: ERROR
    - id: kotlin_crypto_rule-CipherECBMode
      languages:
        - kotlin
      message: |
        An authentication cipher mode which provides better confidentiality of the encrypted data
        should be used instead of Electronic Code Book (ECB) mode, which does not provide good
        confidentiality. Specifically, ECB mode produces the same output for the same input each time.
        This allows an attacker to intercept and replay the data.
      metadata:
        category: security
        cwe: CWE-326
        security-severity: CRITICAL
        shortDescription: Inadequate Encryption Strength
        technology:
            - kotlin
      patterns:
        - pattern: javax.crypto.Cipher.getInstance($TRANSFORMATION, ...)
        - metavariable-regex:
            metavariable: $TRANSFORMATION
            regex: ^"[^/]*/ECB(/.*)?"$
      severity: ERROR
    - id: kotlin_crypto_rule-CipherIntegrity
      languages:
        - kotlin
      message: |
        The ciphertext produced is susceptible to alteration by an adversary. This mean that the
        cipher provides no way to detect that the data has been tampered with. If the ciphertext can be
        controlled by an attacker, it could be altered without detection.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: CRITICAL
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - kotlin
      patterns:
        - pattern: |
            javax.crypto.Cipher.getInstance($TRANSFORMATION, ...)
        - metavariable-pattern:
            metavariable: $TRANSFORMATION
            patterns:
                - pattern-regex: ^"[^/]*(/(CBC|OFB|CTR|ECB)(/.*)?)?"$
                - pattern-not-regex: ^"(ECIES|RSA)(/|"$)
      severity: ERROR
    - id: kotlin_crypto_rule-CipherPaddingOracle
      languages:
        - kotlin
      message: |
        This specific mode of CBC with PKCS5Padding is susceptible to padding oracle attacks. An
        adversary could potentially decrypt the message if the system exposed the difference between
        plaintext with invalid padding or valid padding. The distinction between valid and invalid
        padding is usually revealed through distinct error messages being returned for each condition.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: CRITICAL
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - java
      patterns:
        - pattern: javax.crypto.Cipher.getInstance($TRANSFORMATION)
        - metavariable-regex:
            metavariable: $TRANSFORMATION
            regex: ^"[^/]*/CBC/PKCS5Padding
        - metavariable-pattern:
            metavariable: $TRANSFORMATION
            patterns:
                - pattern-not-regex: ^"(RSA|ECIES)/
      severity: ERROR
    - id: kotlin_crypto_rule-NullCipher
      languages:
        - kotlin
      message: |
        The NullCipher implements the Cipher interface by returning ciphertext identical to the
        supplied plaintext. In a few contexts, such as testing, a NullCipher may be appropriate. Avoid
        using the NullCipher. Its accidental use can introduce a significant confidentiality risk.
      metadata:
        category: security
        cwe: CWE-327
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Use of a broken or risky cryptographic algorithm
        technology:
            - kotlin
      pattern: javax.crypto.NullCipher()
      severity: WARNING
    - id: kotlin_crypto_rule-WeakTLSProtocol
      languages:
        - kotlin
      message: |
        A HostnameVerifier that accept any host are often use because of certificate
        reuse on many hosts. As a consequence, this is vulnerable to Man-in-the-middleattacks
        attacks since the client will trust any certificate.
      metadata:
        category: security
        cwe: CWE-295
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Improper certificate validation
      patterns:
        - pattern-either:
            - pattern: org.apache.http.impl.client.DefaultHttpClient()
            - pattern: javax.net.ssl.SSLContext.getInstance("SSL")
      severity: WARNING
    - id: kotlin_crypto_rule-WeakTLSProtocolVersion
      languages:
        - kotlin
      message: |
        The application was found enabling insecure TLS protocol versions. When enabling protocol
        versions for an `SSLContext`, only the following versions should be allowed:
        - TLSv1.2
        - TLSv1.3
        - DTLSv1.2
        - DTLSv1.3

        To mitigate potential security risks, it is strongly advised to enforce TLS 1.2 as the minimum
        protocol version and disallow older versions such as TLS 1.0. Do note that newer versions of
        Java do not even support TLS 1.0 and will throw `NoSuchAlgorithmException`. Versions of TLS
        prior to 1.2 could expose the connection to downgrade attacks, where an adversary intercepts
        the
        connection and alters the requested protocol version to be a less secure one.

        In many scenarios, relying on the default system configuration does not meet compliance
        standards. This is due to the application being deployed across diverse systems with varying
        configurations and Java versions. While the default value may be secure on modern and
        up-to-date systems, it may not hold true for older systems. Consequently, it is highly
        recommended to explicitly define a secure configuration in all cases.

        Example configuring an SSLContext with TLSv1.2:
        ```
        // Create an SSLContext with TLSv1.2 explicitly
        SSLContext tlsContext = SSLContext.getInstance("TLSv1.2"); // or TLSv1.3, DTLSv1.2, DTLSv1.3

        // Alternatively, set the enabled protocols
        SSLContext serverSslContext = SSLContext.getInstance("TLS");
        SSLEngine serverEngine = serverSslContext.createSSLEngine();
        // Calling setEnabledProtocols will override the original context's configured protocol version
        serverEngine.setEnabledProtocols(new String[]{ "TLSv1.2" });
        ```

        For more information on `SSLContext` see:
        - https://docs.oracle.com/en/java/javase/11/docs/api/java.base/javax/net/ssl/SSLContext.html

        For more information on MiTM attacks see:
        - https://owasp.org/www-community/attacks/Manipulator-in-the-middle_attack
      metadata:
        category: security
        cwe: CWE-326
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: MEDIUM
        shortDescription: Inadequate encryption strength
      patterns:
        - pattern-either:
            - pattern-inside: |
                import javax.net.ssl.*;
                ...
            - pattern-inside: |
                import javax.net.ssl.SSLContext;
                ...
        - pattern-either:
            - pattern-inside: |
                SSLContext.getInstance("$UNSAFE_VERSION");
            - pattern-inside: |
                SSLContext.getInstance(...);
                ...
                $ENGINE.setEnabledProtocols(arrayOf(...,"$UNSAFE_VERSION",...));
        - pattern-not:
            patterns:
                - pattern-inside: |
                    $C = SSLContext.getInstance(...);
                    ...
                    $ENGINE.setEnabledProtocols(arrayOf(...,"$DT_GOODNESS",...));
                - metavariable-regex:
                    metavariable: $DT_GOODNESS
                    regex: ^D?TLSv1\.[23]$
        - pattern-not:
            patterns:
                - pattern-inside: |
                    $C = SSLContext.getInstance(...);
                    ...
                    $E = $C.createSSLEngine()
                    ...
                    $E.enabledProtocols = arrayOf(...,"$DT_GOODNESS",...)
                - metavariable-regex:
                    metavariable: $DT_GOODNESS
                    regex: ^DTLSv1\.[23]$
        - metavariable-regex:
            metavariable: $UNSAFE_VERSION
            regex: ^(TLS|(D)?TLSv1.(0|1))$
      severity: WARNING
    - id: kotlin_csrf_rule-SpringCSRFDisabled
      languages:
        - kotlin
      message: |
        The application fails to protect against Cross-Site Request Forgery (CSRF)
        due to disabling Spring's CSRF protection features.
      metadata:
        category: security
        cwe: CWE-352
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Cross-Site Request Forgery (CSRF)
      pattern-either:
        - pattern: '($H: org.springframework.security.config.annotation.web.builders.HttpSecurity). ... .csrf().disable()'
        - pattern: '($C: CsrfConfigurer<HttpSecurity>).disable()'
      severity: WARNING
    - id: kotlin_endpoint_rule-UnvalidatedRedirect
      languages:
        - kotlin
      message: |
        Unvalidated redirects occur when an application redirects a user to a
        destination URL specified by a user supplied parameter that is not validated.
        Such vulnerabilities can be used to facilitate phishing attacks.
      metadata:
        category: security
        cwe: CWE-601
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: URL redirection to untrusted site ('Open Redirect')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: |
                if ($SAFE.contains($URL)){
                  ...
                }
            - pattern-either:
                - pattern: |
                    ($RES: $X.servlet.http.HttpServletResponse).sendRedirect($URL)
                - pattern: |
                    ($RES: $X.servlet.http.HttpServletResponse).addHeader("Location", $URL)
      pattern-sinks:
        - pattern-either:
            - pattern: |
                ($RES: $X.servlet.http.HttpServletResponse).sendRedirect($URL)
            - pattern: |
                ($RES: $X.servlet.http.HttpServletResponse).addHeader("Location", $URL)
      pattern-sources:
        - patterns:
            - pattern: |
                $URL = ($REQ: $X.servlet.http.HttpServletRequest).$M(...);
            - metavariable-regex:
                metavariable: $M
                regex: (getParameter|getCookies|getHeader|getHeaders|getHeaderNames|getPathInfo|getPathTranslated|getContextPath|getQueryString|getRemoteUser|getRequestedSessionId|getRequestURI|getRequestURL|getServletPath|getParts|getPart|getReader)
      severity: ERROR
    - id: kotlin_endpoint_rule-WeakHostNameVerification
      languages:
        - kotlin
      message: |
        A HostnameVerifier that accept any host are often use because of certificate
        reuse on many hosts. As a consequence, this is vulnerable to Man-in-the-middle
        attacks since the client will trust any certificate.
      metadata:
        category: security
        cwe: CWE-295
        security-severity: MEDIUM
        shortDescription: Improper Certificate Validation
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    class $V : HostnameVerifier {
                      ...
                    }
                - pattern: |
                    fun verify(...): Boolean {
                      return true
                    }
            - patterns:
                - pattern-inside: |
                    class $V : X509TrustManager {
                      ...
                    }
                - pattern-either:
                    - pattern: fun checkClientTrusted(...) {}
                    - pattern: fun checkServerTrusted(...) {}
                    - pattern: 'fun getAcceptedIssuers(): Array<X509Certificate>? {return null}'
      severity: WARNING
    - id: kotlin_file_rule-FilenameUtils
      languages:
        - kotlin
      message: |
        A file is opened to read its content. The filename comes from an input
        parameter. If an unfiltered parameter is passed to this file API, files from an
        arbitrary filesystem location could be read.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - kotlin
      patterns:
        - pattern-inside: |
            import org.apache.commons.io.FilenameUtils
            ...
        - pattern-either:
            - pattern: normalize(...)
            - pattern: getExtension(...)
            - pattern: isExtensions(...)
            - pattern: getName(...)
            - pattern: getBaseName(...)
            - pattern: org.apache.commons.io.FilenameUtils.normalize(...)
            - pattern: org.apache.commons.io.FilenameUtils.getExtension(...)
            - pattern: org.apache.commons.io.FilenameUtils.isExtensions(...)
            - pattern: org.apache.commons.io.FilenameUtils.getName(...)
            - pattern: org.apache.commons.io.FilenameUtils.getBaseName(...)
      severity: WARNING
    - id: kotlin_inject_rule-CommandInjection
      languages:
        - kotlin
      message: |
        The highlighted API is used to execute a system command. If unfiltered input is passed to this
        API, it can lead to arbitrary command execution.
      metadata:
        category: security
        cwe: CWE-78
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of special elements used in an OS command ('OS Command Injection')
        technology:
            - kotlin
      pattern-either:
        - patterns:
            - pattern-inside: |
                fun $FUNC(..., $PARAM: String, ...) {
                  ...
                }
            - pattern-inside: |
                $R = Runtime.getRuntime()
                ...
            - pattern-either:
                - pattern: $R.exec(<...$PARAM...>,...)
                - patterns:
                    - pattern-either:
                        - pattern: |
                            $CMDARR = arrayOf("$SHELL",...,<...$PARAM...>,...)
                            ...
                            $R.exec($CMDARR,...)
                        - pattern: $R.exec(arrayOf("$SHELL",...,<...$PARAM...>,...), ...)
                        - pattern: $R.exec(java.util.String.format("...", ...,<...$PARAM...>,...))
                        - pattern: '$R.exec(($A: String) + ($B: String))'
                    - metavariable-regex:
                        metavariable: $SHELL
                        regex: (/.../)?(sh|bash|ksh|csh|tcsh|zsh)$
            - pattern-not: $R.exec("...","...","...",...)
            - pattern-not: |
                $R.exec(arrayOf("...","...","...",...),...)
        - patterns:
            - pattern-inside: |
                fun $FUNC(..., $PARAM: String, ...) {
                  ...
                }
            - pattern-inside: |
                $PB = ProcessBuilder()
                ...
            - pattern-either:
                - pattern: $PB.command(<...$PARAM...>,...)
                - patterns:
                    - pattern-inside: $VAL = <...$PARAM...>; ...
                    - pattern: $PB.command(<...$VAL...>,...)
                - patterns:
                    - pattern-either:
                        - pattern: $PB.command("$SHELL",...,<...$PARAM...>,...)
                        - pattern: |
                            $CMDARR = java.util.Arrays.asList("$SHELL",...,<...$PARAM...>,...)
                            ...
                            $PB.command($CMDARR,...)
                        - pattern: $PB.command(java.util.Arrays.asList("$SHELL",...,<...$PARAM...>,...),...)
                        - pattern: $PB.command(java.util.String.format("...", ...,<...$PARAM...>,...))
                        - pattern: '$PB.command(($A: String) + ($B: String))'
                    - metavariable-regex:
                        metavariable: $SHELL
                        regex: (/.../)?(sh|bash|ksh|csh|tcsh|zsh)$
            - pattern-not: $PB.command("...","...","...",...)
            - pattern-not: |
                $PB.command(java.util.Arrays.asList("...","...","...",...))
      severity: WARNING
    - id: kotlin_inject_rule-FileDisclosure
      languages:
        - kotlin
      message: |
        Constructing a server-side redirect path with user input could allow an
        attacker to download application binaries (including application classes or
        jar files) or view arbitrary files within protected directories.
      metadata:
        category: security
        cwe: CWE-552
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Files or directories accessible to external parties
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: org.springframework.web.servlet.ModelAndView($FST);
            - pattern: $FST
        - patterns:
            - pattern: org.springframework.web.servlet.ModelAndView($FST, $SND);
            - pattern: $FST
        - patterns:
            - pattern: org.springframework.web.servlet.ModelAndView($FST, $SND, $TRD);
            - pattern: $FST
        - patterns:
            - pattern: org.apache.struts.action.ActionForward($FST)
            - pattern: $FST
        - patterns:
            - pattern: org.apache.struts.action.ActionForward($FST, $SND)
            - pattern: $FST
        - patterns:
            - pattern: org.apache.struts.action.ActionForward($FST, $SND, $TRD)
            - pattern: $SND
        - patterns:
            - pattern: org.apache.struts.action.ActionForward($FST, $SND, $TRD)
            - pattern: $TRD
        - patterns:
            - pattern-inside: |
                $ACTION = org.apache.struts.action.ActionForward();
                ...
            - pattern: $ACTION.setPath(...)
        - patterns:
            - pattern-inside: |
                $MVC = org.springframework.web.servlet.ModelAndView();
                ...
            - pattern: $MVC.setViewName(...);
        - patterns:
            - pattern-inside: |
                $REQ = $HTTP.getRequestDispatcher(...);
                ...
            - pattern-either:
                - pattern: $REQ.include($FST, $SND)
                - pattern: $REQ.forward($FST, $SND)
      pattern-sources:
        - pattern: '($VAR: javax.servlet.http.HttpServletRequest).getParameter(...)'
      severity: ERROR
    - id: kotlin_inject_rule-SpotbugsPathTraversalAbsolute
      languages:
        - kotlin
      message: |
        The software uses an HTTP request parameter to construct a pathname that should be within a
        restricted directory, but it does not properly neutralize absolute path sequences such as
        "/abs/path" that can resolve to a location that is outside of that directory. See
        http://cwe.mitre.org/data/definitions/36.html for more information.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - kotlin
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $U = java.net.URI($VAR)
            - pattern-either:
                - pattern-inside: java.io.File($U)
                - pattern-inside: java.nio.file.Paths.get($U)
            - pattern: $VAR
        - patterns:
            - pattern-inside: java.io.RandomAccessFile($INPUT,...)
            - pattern: $INPUT
        - pattern: java.io.FileReader(...)
        - pattern: javax.activation.FileDataSource(...)
        - pattern: java.io.FileInputStream(...)
        - pattern: java.io.File(...)
        - pattern: java.nio.file.Paths.get(...)
        - pattern: java.io.File.createTempFile(...)
        - pattern: java.io.File.createTempDirectory(...)
        - pattern: java.nio.file.Files.createTempFile(...)
        - pattern: java.nio.file.Files.createTempDirectory(...)
        - patterns:
            - pattern: $SRC.$METHOD(...)
            - metavariable-pattern:
                metavariable: $SRC
                pattern-either:
                    - pattern: getClass()
                    - pattern: getClass().getClassLoader()
                    - pattern: '($C: ClassLoader)'
                    - pattern: '($C: Class)'
                    - pattern: $CLZ.getClassLoader()
            - metavariable-pattern:
                metavariable: $METHOD
                pattern-either:
                    - pattern: getResourceAsStream
                    - pattern: getResource
        - patterns:
            - pattern-inside: java.io.FileWriter($PATH, ...)
            - pattern: $PATH
        - patterns:
            - pattern-inside: java.io.FileOutputStream($PATH, ...)
            - pattern: $PATH
      pattern-sources:
        - pattern: '($REQ: HttpServletRequest).getParameter(...)'
        - patterns:
            - pattern-inside: fun $FUNC(..., @RequestParam $REQ:$TYPE, ...) {...}
            - focus-metavariable: $REQ
      severity: WARNING
    - id: kotlin_inject_rule-SqlInjection
      languages:
        - kotlin
      message: |
        The input values included in SQL queries need to be passed in safely. Bind
        variables in prepared statements can be used to easily mitigate the risk of
        SQL injection.
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
        technology:
            - java
      mode: taint
      options:
        taint_assume_safe_functions: true
      pattern-propagators:
        - from: $SRC
          pattern: $SB.append($SRC)
          to: $SB
        - from: $SRC
          patterns:
            - pattern: $F(..., $SRC, ...)
            - focus-metavariable: $F
            - pattern-either:
                - pattern: String.format
                - pattern: StringBuilder
          to: $F
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: '($PM: javax.jdo.PersistenceManager).newQuery($ARG)'
                - pattern: '($PM: javax.jdo.PersistenceManager).newQuery(..., $ARG)'
                - pattern: '($Q: javax.jdo.Query).setFilter($ARG)'
                - pattern: '($Q: javax.jdo.Query).setGrouping($ARG)'
                - pattern: org.hibernate.criterion.Restrictions.sqlRestriction($ARG, ...)
                - pattern: '($S: org.hibernate.Session).createQuery($ARG, ...)'
                - pattern: '($S: org.hibernate.Session).createSQLQuery($ARG, ...)'
                - pattern: '($S: java.sql.Statement).executeQuery($ARG, ...)'
                - pattern: '($S: java.sql.Statement).execute($ARG, ...)'
                - pattern: '($S: java.sql.Statement).executeUpdate($ARG, ...)'
                - pattern: '($S: java.sql.Statement).executeLargeUpdate($ARG, ...)'
                - pattern: '($S: java.sql.Statement).addBatch($ARG, ...)'
                - pattern: '($S: java.sql.PreparedStatement).executeQuery($ARG, ...)'
                - pattern: '($S: java.sql.PreparedStatement).execute($ARG, ...)'
                - pattern: '($S: java.sql.PreparedStatement).executeUpdate($ARG, ...)'
                - pattern: '($S: java.sql.PreparedStatement).executeLargeUpdate($ARG, ...)'
                - pattern: '($S: java.sql.PreparedStatement).addBatch($ARG, ...)'
                - pattern: '($S: java.sql.Connection).prepareCall($ARG, ...)'
                - pattern: '($S: java.sql.Connection).prepareStatement($ARG, ...)'
                - pattern: '($S: java.sql.Connection).nativeSQL($ARG, ...)'
                - pattern: org.springframework.jdbc.core.PreparedStatementCreatorFactory($ARG, ...)
                - pattern: '($F: org.springframework.jdbc.core.PreparedStatementCreatorFactory).newPreparedStatementCreator($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).batchUpdate($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).execute($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).query($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForList($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForMap($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForRowSet($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForInt($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForLong($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).update($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).batchUpdate($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).execute($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).query($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForList($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForMap($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForObject($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForRowSet($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForInt($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForLong($ARG, ...)'
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).update($ARG, ...)'
                - pattern: '($O: io.vertx.sqlclient.SqlClient).query($ARG, ...)'
                - pattern: '($O: io.vertx.sqlclient.SqlClient).preparedQuery($ARG, ...)'
                - pattern: '($O: io.vertx.sqlclient.SqlConnection).prepare($ARG, ...)'
                - pattern: '($O: org.apache.turbine.om.peer.BasePeer).executeQuery($ARG, ...)'
                - pattern: '($O: org.apache.torque.util.BasePeer).executeQuery($ARG, ...)'
                - pattern: '($O: javax.persistence.EntityManager).createQuery($ARG, ...)'
                - pattern: '($O: javax.persistence.EntityManager).createNativeQuery($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).createQuery($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).createScript($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).createUpdate($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).execute($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).prepareBatch($ARG, ...)'
                - pattern: '($H: org.jdbi.v3.core.Handle).select($ARG, ...)'
                - pattern: org.jdbi.v3.core.statement.Script($H, $ARG)
                - pattern: org.jdbi.v3.core.statement.Update($H, $ARG)
                - pattern: org.jdbi.v3.core.statement.PreparedBatch($H, $ARG)
            - focus-metavariable: $ARG
      pattern-sources:
        - patterns:
            - pattern-inside: 'fun $FUNC(..., $SRC: String, ...) { ... }'
            - pattern: $SRC
      severity: ERROR
    - id: kotlin_password_rule-ConstantDBPassword
      languages:
        - kotlin
      message: |
        A potential hard-coded password was identified in a database connection string.
        Passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-259
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Critical
        shortDescription: Use of hard-coded password
        technology:
            - kotlin
      pattern: java.sql.DriverManager.getConnection($URI, $USR, "...")
      severity: ERROR
    - id: kotlin_password_rule-EmptyDBPassword
      languages:
        - kotlin
      message: |
        The application does not provide authentication when communicating a database
        server. It is strongly recommended that the database server be configured with
        authentication and restrict what queries users can execute.

        Please see your database server's documentation on how to configure a password.

        Additionally, passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-306
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: Critical
        shortDescription: Missing authentication for critical function (database)
        technology:
            - kotlin
      pattern: java.sql.DriverManager.getConnection($URI, $USR, "");
      severity: ERROR
    - id: kotlin_perm_rule-DangerousPermissions
      languages:
        - kotlin
      message: |
        Do not grant dangerous combinations of permissions.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-277
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Insecure inherited permissions
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $PC = $X.getPermissions(...)
                    ...
                - pattern: $PC.add($PERMISSION)
            - pattern: |
                $REFVAR = $PERMISSION
                ...;
                ($PC: PermissionCollection).add($REFVAR)
            - pattern: '($PC: PermissionCollection).add($PERMISSION)'
        - metavariable-pattern:
            metavariable: $PERMISSION
            pattern-either:
                - pattern: ReflectPermission("suppressAccessChecks")
                - pattern: RuntimePermission("createClassLoader")
      severity: WARNING
    - id: kotlin_perm_rule-OverlyPermissiveFilePermissionInline
      languages:
        - kotlin
      message: |
        Overly permissive file permission
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-732
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Incorrect permission assignment for critical resource
      patterns:
        - pattern-either:
            - pattern: java.nio.file.Files.setPosixFilePermissions(..., java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING"));
            - pattern: |
                $PERMISSIONS = java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING");
                ...
                java.nio.file.Files.setPosixFilePermissions(..., $PERMISSIONS);
        - metavariable-regex:
            metavariable: $PERM_STRING
            regex: '[rwx-]{6}[rwx]{1,}'
      severity: WARNING
    - id: kotlin_script_rule-ScriptInjection
      languages:
        - kotlin
      message: |
        The software constructs all or part of a code segment using externally-influenced
        input from an upstream component, but it does not neutralize or incorrectly
        neutralizes special elements that could modify the syntax or behavior of the
        intended code segment.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code ('Code Injection')
      mode: taint
      pattern-sinks:
        - patterns:
            - patterns:
                - pattern-inside: |
                    $ENGINE = $F.getEngineByExtension(...)
                    ...
                - pattern: $ENGINE.eval($ARG, ...);
                - pattern-not: $ENGINE.eval("...");
                - pattern-not: '$ENGINE.eval("...", ($BINDING: javax.script.Bindings));'
        - patterns:
            - pattern: '($ENGINE: javax.script.ScriptEngine).eval($ARG, ...);'
            - pattern-not: '($ENGINE: javax.script.ScriptEngine).eval("...");'
            - pattern-not: '($ENGINE: javax.script.ScriptEngine).eval("...", ($BINDING: javax.script.Bindings));'
        - pattern: '($INVC: javax.script.Invocable).invokeFunction(..., $ARG)'
        - pattern: '($INVC: javax.script.Invocable).invokeMethod(..., $ARG)'
      pattern-sources:
        - patterns:
            - pattern-inside: 'fun $FUNC(..., $VAR: String, ...) { ... }'
            - pattern: $VAR
      severity: ERROR
    - id: kotlin_smtp_rule-InsecureSmtp
      languages:
        - kotlin
      message: |
        Server identity verification is disabled when making SSL connections.
      metadata:
        category: security
        cwe: CWE-297
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: CRITICAL
        shortDescription: Improper validation of certificate with host mismatch
      patterns:
        - pattern-either:
            - pattern-inside: |
                $E = org.apache.commons.mail.SimpleEmail(...)
                ...
            - pattern-inside: |
                $E = org.apache.commons.mail.Email(...)
                ...
            - pattern-inside: |
                $E = org.apache.commons.mail.MultiPartEmail(...)
                ...
            - pattern-inside: |
                $E = org.apache.commons.mail.HtmlEmail(...)
                ...
            - pattern-inside: |
                $E = org.apache.commons.mail.ImageHtmlEmail(...)
                ...
        - pattern-not: |
            $E.setSSLOnConnect(true)
            ...
            $E.setSSLCheckServerIdentity(true)
      severity: ERROR
    - id: kotlin_ssrf_rule-SSRF
      languages:
        - kotlin
      message: |
        Server-Side Request Forgery occur when a web server executes a request to a user supplied
        destination parameter that is not validated. Such vulnerabilities could allow an attacker to
        access internal services or to launch attacks from your web server.
      metadata:
        category: security
        cwe: CWE-918
        owasp:
            - A1:2017-Injection
            - A10:2021-Server-Side Request Forgery
        security-severity: CRITICAL
        shortDescription: Server-Side Request Forgery (SSRF)
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net.*;
                    ...
                - pattern-inside: |
                    import java.net.URL;
                    ...
                - pattern-inside: |
                    import java.net.URI;
                    ...
            - pattern: $TYPE(...). ... .$FUNC
            - pattern-not: $TYPE("..."). ... .$FUNC
            - metavariable-pattern:
                metavariable: $FUNC
                pattern-either:
                    - pattern: connect
                    - pattern: GetContent
                    - pattern: openConnection
                    - pattern: openStream
                    - pattern: getContent
                    - pattern: content
            - metavariable-pattern:
                metavariable: $TYPE
                pattern-either:
                    - pattern: URL
                    - pattern: java.net.URL
                    - pattern: URI
                    - pattern: java.net.URI
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net.*;
                    ...
                - pattern-inside: |
                    import java.net.InetSocketAddress;
                    ...
            - pattern: |
                InetSocketAddress(..., $PORT)
            - pattern-not: |
                InetSocketAddress("...", $PORT)
      severity: ERROR
    - id: kotlin_strings_rule-BadHexConversion
      languages:
        - kotlin
      message: |
        When converting a byte array containing a hash signature to a human readable string, a
        conversion mistake can be made if the array is read byte by byte.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-704
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Incorrect type conversion or cast
      patterns:
        - pattern-inside: |
            $B_ARR = ($MD: java.security.MessageDigest).digest(...);
            ...
        - pattern-either:
            - pattern: |
                for($B in $B_ARR) {
                  ...
                  $B_TOSTR
                }
            - pattern: |
                while(...) {
                  ...
                  $B_TOSTR
                }
            - pattern: |
                do {
                  ...
                  $B_TOSTR
                } while(...)
        - metavariable-pattern:
            metavariable: $B_TOSTR
            patterns:
                - pattern-either:
                    - pattern: java.lang.Integer.toHexString($B_TOINT)
                    - pattern: Integer.toHexString($B_TOINT)
                    - pattern: $B_TOINT.toHexString(...)
                - metavariable-pattern:
                    metavariable: $B_TOINT
                    pattern-either:
                        - pattern: $B_ARR[...].toInt()
                        - pattern: $B_ARR[...]
                        - pattern: $B.toInt()
                        - pattern: $B
      severity: WARNING
    - id: kotlin_strings_rule-FormatStringManipulation
      languages:
        - kotlin
      message: |
        Allowing user input to control format parameters could enable an attacker to cause exceptions
        to be thrown or leak information.Attackers may be able  to modify the format string argument,
        such that an exception is thrown. If this exception is left uncaught, it may crash the
        application. Alternatively, if sensitive information is used within the unused arguments,
        attackers may change the format string to reveal this information.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-134
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Use of externally-controlled format string
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $INPUT = ($REQ: HttpServletRequest).getParameter(...)
                    ...
                - pattern-inside: |
                    $FORMAT_STR = ... + $INPUT
                    ...
            - patterns:
                - pattern-inside: |
                    $INPUT = ($REQ: HttpServletRequest).getParameter(...)
                    ...
                - pattern-inside: |
                    $FORMAT_STR = ... + $INPUT + ...
                    ...
            - pattern-inside: |
                $FORMAT_STR = ... + ($REQ: HttpServletRequest).getParameter(...) + ...
                ...
            - pattern-inside: |
                $FORMAT_STR = ... + ($REQ: HttpServletRequest).getParameter(...)
                ...
        - pattern-either:
            - pattern: String.format($FORMAT_STR, ...)
            - pattern: String.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...)
            - patterns:
                - pattern-inside: |
                    $F = java.util.Formatter(...)
                    ...
                - pattern-either:
                    - pattern: $F.format($FORMAT_STR, ...)
                    - pattern: $F.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...)
            - pattern: '($F: java.io.PrintStream).printf($FORMAT_STR, ...)'
            - pattern: '($F: java.io.PrintStream).printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...)'
            - pattern: '($F: java.io.PrintStream).format($FORMAT_STR, ...)'
            - pattern: '($F: java.io.PrintStream).format(java.util.Locale.$LOCALE, $FORMAT_STR, ...)'
            - pattern: System.out.printf($FORMAT_STR, ...)
            - pattern: System.out.printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...)
            - pattern: System.out.format($FORMAT_STR, ...)
            - pattern: System.out.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...)
      severity: ERROR
    - id: kotlin_strings_rule-ModifyAfterValidation
      languages:
        - kotlin
      message: |
        CERT: IDS11-J. Perform any string modifications before validation
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-182
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Collapse of data into unsafe value
      patterns:
        - pattern-inside: |
            $PATTERN = Pattern.compile(...)
            ...
        - pattern-inside: |
            $PATTERN.matcher($VAR)
            ...
        - pattern-either:
            - pattern: |
                $VAR + $OTHER
            - patterns:
                - pattern: |
                    $VAR.$METHOD(...)
                - metavariable-regex:
                    metavariable: $METHOD
                    regex: (replace|replaceAll|replaceFirst|concat)
      severity: WARNING
    - id: kotlin_strings_rule-NormalizeAfterValidation
      languages:
        - kotlin
      message: |
        IDS01-J. Normalize strings before validating them
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-180
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: 'Incorrect behavior order: validate before canonicalize'
      patterns:
        - pattern: |
            $Y = java.util.regex.Pattern.compile("[<>]");
            ...
            $Y.matcher($VAR);
            ...
            java.text.Normalizer.normalize($VAR, ...);
      severity: WARNING
    - id: kotlin_templateinjection_rule-TemplateInjection
      languages:
        - kotlin
      message: |
        A malicious user in control of a template can run malicious code on the
        server-side. Velocity templates should be seen as scripts.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper control of generation of code ('Code Injection')
      pattern-either:
        - patterns:
            - pattern: org.apache.velocity.app.Velocity.evaluate(..., $VAR)
            - pattern-not: org.apache.velocity.app.Velocity.evaluate(..., "...")
        - patterns:
            - pattern-not-inside: |
                $C = ($CFG: freemarker.template.Configuration).getTemplate("...");
                ...
            - pattern-inside: |
                $C = ($CFG: freemarker.template.Configuration).getTemplate($IN);
                ...
            - pattern: $C.process(...)
        - patterns:
            - pattern-inside: |
                import com.mitchellbosecke.pebble.PebbleEngine;
                ...
            - pattern-inside: |
                $C = $T.getTemplate($IN);
                ...
            - pattern-not-inside: |
                $C = $T.getTemplate("...");
                ...
            - pattern: $C.evaluate(...)
      severity: ERROR
    - id: kotlin_xml_rule-SAMLIgnoreComments
      languages:
        - kotlin
      message: |
        Ignoring XML comments in SAML may lead to authentication bypass
      metadata:
        category: security
        cwe: CWE-1390
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: MEDIUM
        shortDescription: Weak authentication
      pattern: '($POOL: org.opensaml.xml.parse.BasicParserPool).setIgnoreComments(false);'
      severity: WARNING
    - id: kotlin_xml_rule-XsltTransform
      languages:
        - kotlin
      message: |
        It is possible to attach malicious behavior to those style sheets. Therefore, if an attacker
        can control the content or the source of the style sheet, he might be able to trigger remote
        code execution.
      metadata:
        category: security
        cwe: CWE-91
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: XML injection (aka Blind XPath injection)
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: '($T: javax.xml.transform.TransformerFactory).newTransformer($SRC, ...)'
                - pattern-inside: '($T: javax.xml.transform.Transformer).transform($SRC, ...)'
                - patterns:
                    - pattern-inside: |-
                        $FACTORY = javax.xml.transform.TransformerFactory.newInstance(...)
                        ...
                    - pattern-inside: $FACTORY.newTransformer($SRC, ...)
                - patterns:
                    - pattern-inside: |-
                        $FACTORY = javax.xml.transform.TransformerFactory(...)
                        ...
                    - pattern-inside: |-
                        $T = $FACTORY.newTransformer(...)
                        ...
                    - pattern-inside: $T.transform($SRC, ...)
            - pattern: $SRC
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        fun $FUNC(...,$VAR: String, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: FileInputStream(<... $VAR ...>);
                        - pattern: javaClass.getResourceAsStream(<... $VAR ...>)
                - patterns:
                    - pattern-inside: |
                        class $CLZ {
                          var $X = "...";
                          ...
                        }
                    - pattern-inside: |
                        fun $FUNC(...,$Y: String, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: FileInputStream($X + $Y);
                        - pattern: javaClass.getResourceAsStream($X + $Y)
      severity: WARNING
    - id: kotlin_xpathi_rule-XpathInjection
      languages:
        - kotlin
      message: |
        The input values included in SQL queries need to be passed in safely. Bind
        variables in prepared statements can be used to easily mitigate the risk of
        SQL injection.
      metadata:
        category: security
        cwe: CWE-643
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper neutralization of data within XPath expressions ('XPath Injection')
      mode: taint
      pattern-sanitizers:
        - pattern-either:
            - pattern-inside: |
                $X.xPathVariableResolver = ...;
                ...;
                $X.compile("...");
            - pattern-inside: |
                $X.setXPathVariableResolver(...);
                ...;
                $X.compile("...");
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: "import javax.xml.xpath.*; \n...\n"
                - pattern-inside: "import javax.xml.xpath.XPath; \n...\n"
            - patterns:
                - pattern-either:
                    - patterns:
                        - pattern: $X.compile($VAR)
                        - pattern-not: $X.compile("...")
                    - patterns:
                        - pattern: $X.evaluate($VAR, ...)
                        - pattern-not: $X.evaluate("...", ...)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                fun $FUNC(..., $VAR: $T, ...) {
                  ...
                }
            - pattern: $VAR
      severity: ERROR
    - id: kotlin_xss_rule-WicketXSS
      languages:
        - kotlin
      message: |
        Disabling HTML escaping put the application at risk for Cross-Site Scripting (XSS).
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
      patterns:
        - pattern-inside: |
            import org.apache.wicket.$A
            ...
        - pattern: |
            $OBJ.setEscapeModelStrings(false);
      severity: WARNING
    - id: kotlin_xss_rule-XSSReqParamToServletWriter
      languages:
        - kotlin
      message: |
        Servlet reflected cross site scripting vulnerability
      metadata:
        category: security
        cwe: CWE-79
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: MEDIUM
        shortDescription: Improper neutralization of input during web page generation ('Cross-site Scripting')
        technology:
            - kotlin
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: org.owasp.encoder.Encode.forHtml($TAINTED);
            - pattern: $TAINTED
      pattern-sinks:
        - patterns:
            - pattern-inside: 'fun $FUNC(..., $RES: HttpServletResponse , ...) {...}'
            - pattern-inside: |
                $WRITER = $RES.getWriter();
                ...
            - pattern: $WRITER.write($DATA,...);
            - pattern: $DATA
        - patterns:
            - pattern-inside: 'fun $FUNC(..., $RES: HttpServletResponse , ...) {...}'
            - pattern: $RES.getWriter().write($DATA,...);
            - pattern: $DATA
      pattern-sources:
        - patterns:
            - pattern-inside: 'fun $FUNC(..., $REQ: HttpServletRequest , ...) {...}'
            - pattern: $REQ.getParameter(...);
      severity: WARNING
    - id: kotlin_xxe_rule-SaxParserXXE
      languages:
        - kotlin
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      patterns:
        - pattern-inside: |
            $SF = SAXParserFactory.newInstance()
            ...
        - pattern-not-inside: |
            $SF.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
            ...
        - pattern-not-inside: |
            $SF.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
            ...
        - pattern-inside: |
            $P = $SFP.newSAXParser();
            ...
        - pattern: $P.parse(...);
      severity: ERROR
    - id: kotlin_xxe_rule-XMLRdr
      languages:
        - kotlin
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      patterns:
        - pattern-inside: |
            $R = XMLReaderFactory.createXMLReader()
            ...
        - pattern-not-inside: |
            $R.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)
            ...
        - pattern: $R.parse(...)
      severity: ERROR
    - id: kotlin_xxe_rule-XMLStreamRdr
      languages:
        - kotlin
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: CRITICAL
        shortDescription: Improper restriction of XML external entity reference ('XXE')
      patterns:
        - pattern-inside: |
            $SF = XMLInputFactory.newFactory();
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.SUPPORT_DTD, false);
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false);
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.SUPPORT_DTD, Boolean.FALSE);
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);
            ...
        - pattern: $SF.createXMLStreamReader(...)
      severity: ERROR
    - id: rules_lgpl_swift_other_rule-ios-dtls1-used
      languages:
        - swift
      message: "DTLS 1.2 should be used. Detected old version - DTLS 1.0.\nDTLS (Datagram Transport Layer Security) 1.0 suffers from \nvarious security vulnerabilities and weaknesses, as it is \nan outdated and less secure protocol compared to newer \nversions such as DTLS 1.2 or 1.3.\n\nHere's an example of how to use DTLS 1.2:\n```\nimport Network\n\n// Create a NWConnection instance with DTLS 1.2\nlet connection = NWConnection(host: NWEndpoint.Host(\"example.com\"), port: NWEndpoint.Port(\"443\"), using: .dtls)\n\n// Start the connection\nconnection.start(queue: .main)\n\n// Handle connection state changes\nconnection.stateUpdateHandler = { newState in\n  switch newState {\n  case .ready:\n    print(\"Connection ready.\")\n  // Perform data transfer or other operations\n  case .failed(let error):\n    print(\"Connection failed with error: \\(error)\")\n  default:\n    break\n  }\n}\n```\n"
      metadata:
        category: security
        cwe: CWE-757
        owasp:
            - A6:2017-Security Misconfiguration
            - A05:2021-Security Misconfiguration
        security-severity: MEDIUM
        shortDescription: Selection of less-secure algorithm during negotiation ('algorithm downgrade')
      patterns:
        - pattern: $Y.TLSMinimumSupportedProtocolVersion
        - pattern-inside: |
            ...
            $X = "tls_protocol_version_t.DTLSv10"
            ...
      severity: WARNING
    - id: scala_cookie_rule-HttpResponseSplitting
      languages:
        - scala
      message: |
        When an HTTP request contains unexpected CR and LF characters, the server may respond with an
        output stream that is interpreted as two different HTTP responses (instead of one). An attacker
        can control the second response and mount attacks such as cross-site scripting and cache
        poisoning attacks.
      metadata:
        category: security
        cwe: CWE-113
        security-severity: High
        shortDescription: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: $STR.replaceAll("$REPLACE_CHAR", "$REPLACE");
            - pattern: $STR
            - metavariable-regex:
                metavariable: $REPLACE_CHAR
                regex: (.*\\r\\n.*)
            - metavariable-regex:
                metavariable: $REPLACE
                regex: (?!(\\r\\n))
        - pattern: org.owasp.encoder.Encode.forUriComponent(...)
        - pattern: org.owasp.encoder.Encode.forUri(...)
        - pattern: java.net.URLEncoder.encode(..., $CHARSET)
      pattern-sinks:
        - pattern: new javax.servlet.http.Cookie("$KEY", ...)
        - pattern: ($C:javax.servlet.http.Cookie).setValue(...)
      pattern-sources:
        - pattern: '($REQ: javax.servlet.http.HttpServletRequest).getParameter(...)'
      severity: WARNING
    - id: scala_cookie_rule-RequestParamToCookie
      languages:
        - scala
      message: |
        This code constructs an HTTP Cookie using an untrusted HTTP parameter. If this cookie is added
        to an HTTP response, it will allow a HTTP response splitting vulnerability. See
        http://en.wikipedia.org/wiki/HTTP_response_splitting for more information.
      metadata:
        category: security
        cwe: CWE-113
        security-severity: Info
        shortDescription: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: $STR.replaceAll("$REPLACE_CHAR", "$REPLACE");
            - pattern: $STR
            - metavariable-regex:
                metavariable: $REPLACE_CHAR
                regex: (.*\\r\\n.*)
            - metavariable-regex:
                metavariable: $REPLACE
                regex: (?!(\\r\\n))
        - pattern: org.owasp.encoder.Encode.forUriComponent(...)
        - pattern: org.owasp.encoder.Encode.forUri(...)
        - pattern: java.net.URLEncoder.encode(..., $CHARSET)
      pattern-sinks:
        - pattern: new javax.servlet.http.Cookie("$KEY", ...);
        - patterns:
            - pattern-inside: |
                $C = new javax.servlet.http.Cookie("$KEY", ...);
                ...
            - pattern: $C.setValue(...);
      pattern-sources:
        - pattern: '($REQ: HttpServletRequest).getParameter(...);'
      severity: ERROR
    - id: scala_cookie_rule-RequestParamToHeader
      languages:
        - scala
      message: |
        This code directly writes an HTTP parameter to an HTTP header, which allows for a HTTP
        response splitting vulnerability. See http://en.wikipedia.org/wiki/HTTP_response_splitting for
        more information.
      metadata:
        category: security
        cwe: CWE-113
        security-severity: High
        shortDescription: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: $STR.replaceAll("$REPLACE_CHAR", "$REPLACE");
            - pattern: $STR
            - metavariable-regex:
                metavariable: $REPLACE_CHAR
                regex: (.*\\r\\n.*)
            - metavariable-regex:
                metavariable: $REPLACE
                regex: (?!(\\r\\n))
        - pattern: org.owasp.encoder.Encode.forUriComponent(...)
        - pattern: org.owasp.encoder.Encode.forUri(...)
        - pattern: java.net.URLEncoder.encode(..., $CHARSET)
      pattern-sinks:
        - pattern: '($RES: HttpServletResponse).setHeader("$KEY", ...);'
        - pattern: '($RES: HttpServletResponse).addHeader("$KEY", ...);'
        - pattern: '($WRP: HttpServletResponseWrapper).setHeader("$KEY", ...);'
        - pattern: '($WRP: HttpServletResponseWrapper).addHeader("$KEY", ...);'
      pattern-sources:
        - pattern: '($REQ: HttpServletRequest).getParameter(...);'
      severity: ERROR
    - id: scala_cors_rule-PermissiveCORS
      languages:
        - scala
      message: |
        Prior to HTML5, Web browsers enforced the Same Origin Policy which ensures that in order for
        JavaScript to access the contents of a Web page, both the JavaScript and the Web page must
        originate from the same domain. Without the Same Origin Policy, a malicious website could serve
        up JavaScript that loads sensitive information from other websites using a client's
        credentials, cull through it, and communicate it back to the attacker. HTML5 makes it possible
        for JavaScript to access data across domains if a new HTTP header called
        Access-Control-Allow-Origin is defined. With this header, a Web server defines which other
        domains are allowed to access its domain using cross-origin requests. However, caution should
        be taken when defining the header because an overly permissive CORS policy will allow a
        malicious application to communicate with the victim application in an inappropriate way,
        leading to spoofing, data theft, relay and other attacks.
      metadata:
        category: security
        cwe: CWE-942
        security-severity: Info
        shortDescription: Permissive Cross-domain Policy with Untrusted Domains
        technology:
            - scala
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern: ($RESP:javax.servlet.http.HttpServletResponse).setHeader("$HEADER", "$VAL")
                - pattern: ($RESP:javax.servlet.http.HttpServletResponse).addHeader("$HEADER", "$VAL")
            - metavariable-regex:
                metavariable: $HEADER
                regex: (?i)(Access-Control-Allow-Origin)
            - metavariable-regex:
                metavariable: $VAL
                regex: (\*|null)
        - patterns:
            - pattern-inside: |
                $REQVAL = ($REQ: javax.servlet.http.HttpServletRequest).getParameter(...)
                ...
            - pattern-either:
                - pattern-inside: ($RESP:javax.servlet.http.HttpServletResponse).setHeader("$HEADER", $REQVAL)
                - pattern-inside: ($RESP:javax.servlet.http.HttpServletResponse).addHeader("$HEADER", $REQVAL)
        - patterns:
            - pattern-either:
                - pattern-inside: '($RESP:javax.servlet.http.HttpServletResponse).setHeader("$HEADER",($REQ: javax.servlet.http.HttpServletRequest).getParameter(...))'
                - pattern-inside: '($RESP:javax.servlet.http.HttpServletResponse).addHeader("$HEADER",($REQ: javax.servlet.http.HttpServletRequest).getParameter(...))'
      severity: ERROR
    - id: scala_cors_rule-PermissiveCORSInjection
      languages:
        - java
      message: |
        Prior to HTML5, Web browsers enforced the Same Origin Policy which ensures that in order for
        JavaScript to access the contents of a Web page, both the JavaScript and the Web page must
        originate from the same domain. Without the Same Origin Policy, a malicious website could serve
        up JavaScript that loads sensitive information from other websites using a client's
        credentials, cull through it, and communicate it back to the attacker. HTML5 makes it possible
        for JavaScript to access data across domains if a new HTTP header called
        Access-Control-Allow-Origin is defined. With this header, a Web server defines which other
        domains are allowed to access its domain using cross-origin requests. However, caution should
        be taken when defining the header because an overly permissive CORS policy will allow a
        malicious application to communicate with the victim application in an inappropriate way,
        leading to spoofing, data theft, relay and other attacks.
      metadata:
        category: security
        cwe: CWE-942
        security-severity: Low
        shortDescription: Permissive Cross-domain Policy with Untrusted Domains
        technology:
            - java
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern: (HttpServletResponse $RES).setHeader("$HEADER", ...)
                - pattern: (HttpServletResponse $RES).addHeader("$HEADER", ...)
            - metavariable-regex:
                metavariable: $HEADER
                regex: (?i)(Access-Control-Allow-Origin)
      pattern-sources:
        - pattern: (HttpServletRequest $REQ).getParameter(...)
      severity: ERROR
    - id: scala_crypto_rule-CipherIntegrity
      languages:
        - scala
      message: |
        The ciphertext produced is susceptible to alteration by an adversary. This mean that the
        cipher provides no way to detect that the data has been tampered with. If the ciphertext can be
        controlled by an attacker, it could be altered without detection.
      metadata:
        category: security
        cwe: CWE-353
        security-severity: Medium
        shortDescription: Missing Support for Integrity Check
        technology:
            - scala
      patterns:
        - pattern-inside: javax.crypto.Cipher.getInstance("...")
        - pattern-either:
            - pattern-regex: (/CBC/PKCS5Padding)
            - pattern-regex: (AES|DES(ede)?)(/ECB/*)
            - pattern-regex: (AES|DES(ede)?)(/CBC/*)
            - pattern-regex: (AES|DES(ede)?)(/OFB/*)
            - pattern-regex: (AES|DES(ede)?)(/CTR/*)
        - pattern-not-regex: .*/(CCM|CWC|OCB|EAX|GCM)/.*
        - pattern-not-regex: ^(RSA)/.*
        - pattern-not-regex: ^(ECIES)$
      severity: ERROR
    - id: scala_crypto_rule-CipherPaddingOracle
      languages:
        - scala
      message: |
        This specific mode of CBC with PKCS5Padding is susceptible to padding oracle attacks. An
        adversary could potentially decrypt the message if the system exposed the difference between
        plaintext with invalid padding or valid padding. The distinction between valid and invalid
        padding is usually revealed through distinct error messages being returned for each condition.
      metadata:
        category: security
        cwe: CWE-696
        security-severity: Medium
        shortDescription: Incorrect Behavior Order
        technology:
            - scala
      patterns:
        - pattern-inside: javax.crypto.Cipher.getInstance("...")
        - pattern-regex: (/CBC/PKCS5Padding)
        - pattern-not-regex: ^(RSA)/.*
        - pattern-not-regex: ^(ECIES)$
      severity: ERROR
    - id: scala_crypto_rule-WeakTLSProtocol
      languages:
        - scala
      message: |
        A HostnameVerifier that accept any host are often use because of certificate
        reuse on many hosts. As a consequence, this is vulnerable to Man-in-the-middleattacks
        attacks since the client will trust any certificate.
      metadata:
        category: security
        cwe: CWE-295
        security-severity: Medium
        shortDescription: Improper Certificate Validation
      patterns:
        - pattern-either:
            - pattern: new org.apache.http.impl.client.DefaultHttpClient()
            - pattern: javax.net.ssl.SSLContext.getInstance("SSL")
            - patterns:
                - pattern-inside: |
                    import javax.net.ssl._
                    ...
                - pattern: SSLContext.getInstance("SSL")
      severity: WARNING
    - id: scala_endpoint_rule-UnencryptedSocket
      languages:
        - scala
      message: |
        Beyond using an SSL socket, you need to make sure your use of SSLSocketFactory
        does all the appropriate certificate validation checks to make sure you are not
        subject to man-in-the-middle attacks. Please read the OWASP Transport Layer
        Protection Cheat Sheet for details on how to do this correctly.
      metadata:
        category: security
        cwe: CWE-319
        owasp:
            - A3:2017-Sensitive Data Exposure
            - A02:2021-Cryptographic Failures
        security-severity: Info
        shortDescription: Cleartext transmission of sensitive information
      patterns:
        - pattern: new java.net.Socket(...)
      severity: WARNING
    - id: scala_endpoint_rule-WeakHostNameVerification
      languages:
        - scala
      message: |
        A HostnameVerifier that accept any host are often use because of certificate
        reuse on many hosts. As a consequence, this is vulnerable to Man-in-the-middle
        attacks since the client will trust any certificate.
      metadata:
        category: security
        cwe: CWE-295
        security-severity: Info
        shortDescription: Improper Certificate Validation
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    class $V extends HostnameVerifier {
                      ...
                    }
                - pattern-either:
                    - pattern: def verify(...) = true
                    - pattern: |
                        def verify(...) = {
                          return true
                        }
            - patterns:
                - pattern-inside: |
                    class $V extends X509TrustManager {
                      ...
                    }
                - pattern-either:
                    - pattern: 'def checkClientTrusted(...): Unit = {}'
                    - pattern: 'def checkServerTrusted(...): Unit = {}'
                    - pattern: def checkClientTrusted(...) = {}
                    - pattern: def checkServerTrusted(...) = {}
                    - pattern: 'def getAcceptedIssuers(): Array[X509Certificate] = null'
                    - pattern: 'def getAcceptedIssuers(): Array[X509Certificate] = {}'
      severity: WARNING
    - id: scala_file_rule-FileUploadFileName
      languages:
        - scala
      message: |
        The filename provided by the FileUpload API can be tampered with by the client to reference
        unauthorized files. The provided filename should be properly validated to ensure it's properly
        structured, contains no unauthorized path characters (e.g., / \), and refers to an authorized
        file.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Info
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - scala
      patterns:
        - pattern: |
            def $FUNC (..., $REQ: HttpServletRequest, ... ) = {
              ...
              val $FILES = ($SFU: ServletFileUpload).parseRequest($REQ)
              ...
              for ($FILE <- $FILES.asScala) {
                ...
              }
            }
        - pattern: $ITEM.getName()
      severity: WARNING
    - id: scala_inject_rule-AWSQueryInjection
      languages:
        - scala
      message: |
        Constructing SimpleDB queries containing user input can allow an attacker to view unauthorized
        records.
      metadata:
        category: security
        cwe: CWE-943
        security-severity: Info
        shortDescription: Improper Neutralization of Special Elements in Data Query Logic
        technology:
            - scala
      mode: taint
      pattern-sinks:
        - pattern: new com.amazonaws.services.simpledb.model.SelectRequest($QUERY, ...);
        - patterns:
            - pattern-inside: |
                $DB.select(($SR: com.amazonaws.services.simpledb.model.SelectRequest).withSelectExpression($QUERY,...));
            - pattern: $QUERY
            - metavariable-pattern:
                metavariable: $DB
                pattern-either:
                    - pattern: '($DB: com.amazonaws.services.simpledb.AmazonSimpleDB)'
                    - pattern: '($DB: com.amazonaws.services.simpledb.AmazonSimpleDBClient)'
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $REQ: HttpServletRequest, ...): $TYPE = {
                  ...
                }
            - pattern: $REQ
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $X: $TYPE, ...): $RET_TYPE = {
                  ...
                  $QUERY = <...$X...>
                  ...
                }
            - pattern: $QUERY
      severity: ERROR
    - id: scala_inject_rule-BeanPropertyInjection
      languages:
        - scala
      message: |
        An attacker can set arbitrary bean properties that can compromise system integrity. An
        attacker can leverage this functionality to access special bean properties like
        class.classLoader that will allow them to override system properties and potentially execute
        arbitrary code.
      metadata:
        category: security
        cwe: CWE-15
        security-severity: Info
        shortDescription: External Control of System or Configuration Setting
        technology:
            - scala
      patterns:
        - pattern-inside: 'def $FUNC(..., $REQ: HttpServletRequest, ...): $TYPE = { ... }'
        - pattern-either:
            - pattern: |
                $MAP.put(..., $REQ.getParameter(...))
                ...
                $BEAN_UTIL.populate(..., $MAP)
            - pattern: |
                while (...) {
                    ...
                    $MAP.put(..., $REQ.getParameterValues(...). ...)
                }
                ...
                $BEAN_UTIL.populate(..., $MAP)
        - metavariable-pattern:
            metavariable: $BEAN_UTIL
            pattern-either:
                - pattern: (BeanUtilsBean $B)
                - pattern: new BeanUtilsBean()
                - pattern: org.apache.commons.beanutils.BeanUtils
      severity: ERROR
    - id: scala_inject_rule-CommandInjection
      languages:
        - scala
      message: |
        The highlighted API is used to execute a system command. If unfiltered input is passed to this
        API, it can lead to arbitrary command execution.
      metadata:
        category: security
        cwe: CWE-78
        security-severity: Info
        shortDescription: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')
        technology:
            - scala
      pattern-either:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $PARAM: String, ...): $TYPE = {
                  ...
                }
            - pattern-inside: |
                val $RT = Runtime.getRuntime
                ...
            - pattern-either:
                - pattern: $RT.exec($PARAM)
                - pattern: |
                    var $CMDARR = new Array[String]("$SHELL",...,$PARAM,...)
                    ...
                    $RT.exec($CMDARR,...)
                - pattern: $RT.exec(Array[String]("$SHELL",...,$PARAM,...), ...)
                - pattern: $RT.exec(java.util.String.format("...", ...,$PARAM,...))
                - pattern: '$RT.exec(($A: String) + ($B: String))'
            - metavariable-regex:
                metavariable: $SHELL
                regex: (/.../)?(sh|bash|ksh|csh|tcsh|zsh)$
            - pattern-not: $RT.exec("...","...","...",...)
            - pattern-not: $RT.exec(new Array[String]("...","...","...",...),...)
        - patterns:
            - pattern-inside: |
                def $FUNC(...,$PARAM: String, ...): $TYPE = {
                  ...
                }
            - pattern-inside: |
                val $PB = new ProcessBuilder()
                ...
            - pattern-either:
                - pattern: $PB.command($PARAM,...)
                - patterns:
                    - pattern-either:
                        - pattern: $PB.command("$SHELL",...,$PARAM,...)
                        - pattern: |
                            var $CMDARR = java.util.Arrays.asList("$SHELL",...,$PARAM,...)
                            ...
                            $PB.command($CMDARR,...)
                        - pattern: $PB.command(java.util.Arrays.asList("$SHELL",...,$PARAM,...),...)
                        - pattern: $PB.command(java.util.String.format("...", ...,$PARAM,...))
                        - pattern: '$PB.command(($A: String) + ($B: String))'
                    - metavariable-regex:
                        metavariable: $SHELL
                        regex: (/.../)?(sh|bash|ksh|csh|tcsh|zsh)$
            - pattern-not: $PB.command("...","...","...",...)
            - pattern-not: |
                $PB.command(java.util.Arrays.asList("...","...","...",...))
      severity: WARNING
    - id: scala_inject_rule-CustomInjection
      languages:
        - scala
      message: |
        The method identified is susceptible to injection. The input should be validated and properly
        escaped.
      metadata:
        category: security
        cwe: CWE-89
        security-severity: Low
        shortDescription: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern-inside: |
                val $ST = connection.createStatement
                ...
        - pattern-either:
            - pattern: |
                val $QUERY = ... + $VAR + ...
                ...
                $ST.executeQuery($QUERY)
            - pattern: |
                val $QUERY = ... + $VAR
                ...
                $ST.executeQuery($QUERY)
            - pattern: |
                val $QUERY = String.format("...",...,$VAR,...)
                ...
                $ST.executeQuery($QUERY)
            - pattern: '$ST.executeQuery(($SB: StringBuilder).toString())'
            - pattern: $ST.executeQuery(... + $VAR + ...)
            - pattern: $ST.executeQuery(... + $VAR)
            - pattern: $ST.executeQuery(...,String.format("...",...,$VAR,...), ...)
      severity: WARNING
    - id: scala_inject_rule-CustomInjectionSQLString
      languages:
        - scala
      message: |
        The method identified is susceptible to injection. The input should be validated and properly
        escaped.
      metadata:
        category: security
        cwe: CWE-89
        security-severity: High
        shortDescription: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
        technology:
            - scala
      patterns:
        - pattern-inside: |
            def $FOO(..., $SQLIN: String, ...): $TYPE = {
              ...
            }
        - pattern-either:
            - pattern: |
                "$SQL_STR" + $SQLIN
            - pattern: String.format("$SQL_STR", ... + $SQLIN + ...)
            - pattern: |
                "$SQL_STR".concat(...)
            - pattern: (StringBuilder $BUILDER). ... .append("$SQL_STR")
            - patterns:
                - pattern-inside: |
                    StringBuilder $BUILDER = new StringBuilder(... + "$SQL_STR" + ...);
                    ...
                - pattern: $BUILDER.append(...)
                - pattern-not: $BUILDER.append("...")
            - patterns:
                - pattern-inside: |
                    $QUERY = "$SQL_STR";
                    ...
                - pattern: $QUERY += ...
        - metavariable-regex:
            metavariable: $SQL_STR
            regex: (?i)(select|insert|create|update|alter|delete|drop)\b
      severity: WARNING
    - id: scala_inject_rule-FileDisclosure
      languages:
        - scala
      message: |
        Constructing a server-side redirect path with user input could allow an
        attacker to download application binaries (including application classes or
        jar files) or view arbitrary files within protected directories.
      metadata:
        category: security
        cwe: CWE-552
        security-severity: Info
        shortDescription: Files or Directories Accessible to External Parties
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern: new org.springframework.web.servlet.ModelAndView($FST)
            - pattern: $FST
        - patterns:
            - pattern: new org.springframework.web.servlet.ModelAndView($FST, $SND)
            - pattern: $FST
        - patterns:
            - pattern: new org.springframework.web.servlet.ModelAndView($FST, $SND, $TRD)
            - pattern: $FST
        - patterns:
            - pattern: new org.apache.struts.action.ActionForward($FST)
            - pattern: $FST
        - patterns:
            - pattern: new org.apache.struts.action.ActionForward($FST, $SND)
            - pattern: $FST
        - patterns:
            - pattern: new org.apache.struts.action.ActionForward($FST, $SND, $TRD)
            - pattern: $SND
        - patterns:
            - pattern: new org.apache.struts.action.ActionForward($FST, $SND, $TRD)
            - pattern: $TRD
        - patterns:
            - pattern-inside: |
                $ACTION = new org.apache.struts.action.ActionForward()
                ...
            - pattern: $ACTION.setPath(...)
        - patterns:
            - pattern-inside: |
                $MVC = new org.springframework.web.servlet.ModelAndView()
                ...
            - pattern: $MVC.setViewName(...);
        - patterns:
            - pattern-inside: |
                $REQ = $HTTP.getRequestDispatcher(...)
                ...
            - pattern-either:
                - pattern: $REQ.include($FST, $SND)
                - pattern: $REQ.forward($FST, $SND)
      pattern-sources:
        - pattern: '($VAR: javax.servlet.http.HttpServletRequest).getParameter(...)'
      severity: ERROR
    - id: scala_inject_rule-LDAPInjection
      languages:
        - scala
      message: |
        Just like SQL, all inputs passed to an LDAP query need to be passed in safely. Unfortunately,
        LDAP doesn't have prepared statement interfaces like SQL. Therefore, the primary defense
        against LDAP injection is strong input validation of any untrusted data before including it in
        an LDAP query.
      metadata:
        category: security
        cwe: CWE-90
        security-severity: Medium
        shortDescription: Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $VAR: String, ...): $TYPE = {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $X: String, ...): $TYPE = {
                  ...
                  $VAR = ... + $X;
                  ...
                }
        - pattern-either:
            - pattern: '($P: java.util.Properties).put($KEY, $VAR)'
            - pattern: $CTX.lookup(..., $VAR, ...)
            - pattern: $CTX.search(..., $VAR, ...)
            - pattern: $CTX.list(..., $VAR, ...)
        - metavariable-pattern:
            metavariable: $CTX
            pattern-either:
                - pattern: '($CTX: javax.naming.directory.DirContext)'
                - pattern: '($CTX: javax.naming.directory.Context)'
                - pattern: '($CTX: javax.naming.Context)'
                - pattern: '($CTX: javax.naming.directory.InitialDirContext)'
                - pattern: '($CTX: javax.naming.ldap.LdapContext)'
                - pattern: '($CTX: com.unboundid.ldap.sdk.LDAPConnection)'
                - pattern: '($CTX: javax.naming.event.EventDirContext)'
                - pattern: '($CTX: com.sun.jndi.ldap.LdapCtx)'
                - pattern: '($CTX: org.springframework.ldap.core.LdapTemplate)'
                - pattern: '($CTX: org.springframework.ldap.core.LdapOperations)'
      severity: WARNING
    - id: scala_inject_rule-OgnlInjection
      languages:
        - scala
      message: |
        "A expression is built with a dynamic value. The source of the value(s) should be verified to
        avoid that unfiltered values fall into this risky code evaluation."
      metadata:
        category: security
        cwe: CWE-917
        security-severity: Medium
        shortDescription: Expression injection (OGNL)
        technology:
            - scala
      patterns:
        - pattern-either:
            - pattern-inside: |
                def $FUNC(..., $VAR: String, ...): $TYPE = {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $VAR: Map[$K,$V], ...): $TYPE = {
                  ...
                }
            - pattern-inside: |
                def $FUNC(..., $VAR: java.util.HashMap[$K,$V], ...): $TYPE = {
                  ...
                }
        - pattern-either:
            - pattern: com.opensymphony.xwork2.util.TextParseUtil.translateVariables(..., $VAR, ...)
            - pattern: com.opensymphony.xwork2.util.TextParseUtil.translateVariablesCollection(..., $VAR, ...)
            - pattern: com.opensymphony.xwork2.util.TextParseUtil.shallBeIncluded(..., $VAR, ...)
            - pattern: com.opensymphony.xwork2.util.TextParseUtil.commaDelimitedStringToSet(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.TextParser).evaluate(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.OgnlTextParser).evaluate(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).getGetMethod(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).getSetMethod(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).getField(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).setProperties(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).setProperty(...,$VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).getValue(...,$VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlReflectionProvider).setValue(...,$VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).getGetMethod(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).getSetMethod(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).getField(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).setProperties(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).setProperty(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).getValue(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.util.reflection.ReflectionProvider).setValue(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).setProperties(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).setProperty(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).getValue(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).setValue(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).callMethod(..., $VAR, ...)
            - pattern: ($P:com.opensymphony.xwork2.ognl.OgnlUtil).compile(..., $VAR, ...)
            - pattern: ($P:org.apache.struts2.util.VelocityStrutsUtil).evaluate(...)
            - pattern: org.apache.struts2.util.StrutsUtil.findString(...)
            - pattern: org.apache.struts2.util.StrutsUtil.findValue(..., $VAL)
            - pattern: org.apache.struts2.util.StrutsUtil.getText(...)
            - pattern: org.apache.struts2.util.StrutsUtil.translateVariables(...)
            - pattern: org.apache.struts2.util.StrutsUtil.makeSelectList(..., $VAR, ...)
            - pattern: ($T:org.apache.struts2.views.jsp.ui.OgnlTool).findValue(..., $VAR, ...)
            - pattern: ($V:com.opensymphony.xwork2.util.ValueStack).findString(...)
            - pattern: ($V:com.opensymphony.xwork2.util.ValueStack).findValue(..., $VAR, ...)
            - pattern: ($V:com.opensymphony.xwork2.util.ValueStack).setValue(..., $VAR, ...)
            - pattern: ($V:com.opensymphony.xwork2.util.ValueStack).setParameter(..., $VAR, ...)
      severity: WARNING
    - id: scala_inject_rule-PathTraversalOut
      languages:
        - scala
      message: |
        A file is opened to write to its contents. The filename comes from an input parameter. If an
        unfiltered parameter is passed to this file API, files at an arbitrary filesystem location
        could be modified. This rule identifies potential path traversal vulnerabilities. In many
        cases, the constructed file path cannot be controlled by the user.
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: High
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: new java.io.FileWriter($PATH, ...)
            - pattern: $PATH
        - patterns:
            - pattern-inside: new java.io.FileOutputStream($PATH, ...)
            - pattern: $PATH
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $ARGS: Array[String], ...): $TYPE = {
                  ...
                }
            - pattern: $ARGS[$IDX]
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $VAR: String, ...): $TYPE = {
                  ...
                }
            - pattern: $VAR
      severity: WARNING
    - id: scala_inject_rule-SpotbugsPathTraversalAbsolute
      languages:
        - scala
      message: |
        "The software uses an HTTP request parameter to construct a pathname that should be within a
        restricted directory, but it does not properly neutralize absolute path sequences such as
        "/abs/path" that can resolve to a location that is outside of that directory. See
        http://cwe.mitre.org/data/definitions/36.html for more information."
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Info
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $U = new java.net.URI($VAR)
            - pattern-either:
                - pattern-inside: new java.io.File($U)
                - pattern-inside: java.nio.file.Paths.get($U)
            - pattern: $VAR
        - patterns:
            - pattern-inside: new java.io.RandomAccessFile($INPUT,...)
            - pattern: $INPUT
        - pattern: new java.io.FileReader(...)
        - pattern: new javax.activation.FileDataSource(...)
        - pattern: new java.io.FileInputStream(...)
        - pattern: new java.io.File(...)
        - pattern: java.nio.file.Paths.get(...)
        - pattern: java.io.File.createTempFile(...)
        - pattern: java.io.File.createTempDirectory(...)
        - pattern: java.nio.file.Files.createTempFile(...)
        - pattern: java.nio.file.Files.createTempDirectory(...)
        - patterns:
            - pattern-inside: new java.io.FileWriter($PATH, ...)
            - pattern: $PATH
        - patterns:
            - pattern-inside: new java.io.FileOutputStream($PATH, ...)
            - pattern: $PATH
      pattern-sources:
        - pattern: '($REQ: HttpServletRequest ).getParameter(...)'
      severity: WARNING
    - id: scala_inject_rule-SpotbugsPathTraversalRelative
      languages:
        - scala
      message: |
        "The software uses an HTTP request parameter to construct a pathname that should be within a
        restricted directory, but it does not properly neutralize sequences such as ".." that can
        resolve to a location that is outside of that directory. See
        http://cwe.mitre.org/data/definitions/23.html for more information."
      metadata:
        category: security
        cwe: CWE-22
        owasp:
            - A5:2017-Broken Access Control
            - A01:2021-Broken Access Control
        security-severity: Info
        shortDescription: Improper limitation of a pathname to a restricted directory ('Path Traversal')
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - pattern: org.apache.commons.io.FilenameUtils.getName(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: |
                $U = new java.net.URI($VAR)
            - pattern-either:
                - pattern-inside: new java.io.File($U)
                - pattern-inside: java.nio.file.Paths.get($U)
            - pattern: $VAR
        - patterns:
            - pattern-inside: new java.io.RandomAccessFile($INPUT,...)
            - pattern: $INPUT
        - pattern: new java.io.FileReader(...)
        - pattern: new javax.activation.FileDataSource(...)
        - pattern: new java.io.FileInputStream(...)
        - pattern: new java.io.File(...)
        - pattern: java.nio.file.Paths.get(...)
        - pattern: java.io.File.createTempFile(...)
        - pattern: java.io.File.createTempDirectory(...)
        - pattern: java.nio.file.Files.createTempFile(...)
        - pattern: java.nio.file.Files.createTempDirectory(...)
        - patterns:
            - pattern-inside: new java.io.FileWriter($PATH, ...)
            - pattern: $PATH
        - patterns:
            - pattern-inside: new java.io.FileOutputStream($PATH, ...)
            - pattern: $PATH
      pattern-sources:
        - patterns:
            - pattern-inside: |
                $P = ($REQ: HttpServletRequest ).getParameter(...);
                ...
            - pattern-either:
                - pattern: $P + ...
                - pattern: '... + $P'
      severity: WARNING
    - id: scala_inject_rule-SqlInjection
      languages:
        - scala
      message: |
        The input values included in SQL queries need to be passed in safely. Bind
        variables in prepared statements can be used to easily mitigate the risk of
        SQL injection.
      metadata:
        category: security
        cwe: CWE-89
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
      patterns:
        - pattern-not-inside: |
            $ARG = ...
            ...
        - pattern-not-inside: |
            object $CLAZZ {
              ...
              $ARG = ...
              ...
            }
        - pattern-not-inside: |
            class $CLAZZ {
              ...
              $ARG = ...
              ...
            }
        - pattern-either:
            - patterns:
                - pattern: ($PM:javax.jdo.PersistenceManager).newQuery(<...$ARG...>)
                - pattern-not: ($PM:javax.jdo.PersistenceManager).newQuery("...")
            - patterns:
                - pattern: ($PM:javax.jdo.PersistenceManager).newQuery(..., <...$ARG...>)
                - pattern-not: ($PM:javax.jdo.PersistenceManager).newQuery(..., "...")
            - patterns:
                - pattern: '($Q: javax.jdo.Query).setFilter(<...$ARG...>)'
                - pattern-not: '($Q: javax.jdo.Query).setFilter("...")'
            - patterns:
                - pattern: '($Q: javax.jdo.Query).setGrouping(<...$ARG...>)'
                - pattern-not: '($Q: javax.jdo.Query).setGrouping("...")'
            - patterns:
                - pattern: '($Q: javax.jdo.Query).setGrouping(<...$ARG...>)'
                - pattern-not: '($Q: javax.jdo.Query).setGrouping("...")'
            - patterns:
                - pattern: '($H: org.hibernate.criterion.Restrictions).sqlRestriction(<...$ARG...>, ...)'
                - pattern-not: '($H: org.hibernate.criterion.Restrictions).sqlRestriction("...", ...)'
            - patterns:
                - pattern: '($S: org.hibernate.Session).createQuery(<...$ARG...>, ...)'
                - pattern-not: '($S: org.hibernate.Session).createQuery("...", ...)'
            - patterns:
                - pattern: '($S: org.hibernate.Session).createSQLQuery(<...$ARG...>, ...)'
                - pattern-not: '($S: org.hibernate.Session).createSQLQuery("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Statement).executeQuery(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Statement).createSQLQuery("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Statement).execute(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Statement).execute("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Statement).executeUpdate(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Statement).executeUpdate("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Statement).executeLargeUpdate(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Statement).executeLargeUpdate("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Statement).addBatch(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Statement).addBatch("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.PreparedStatement).executeQuery(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.PreparedStatement).executeQuery("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.PreparedStatement).execute(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.PreparedStatement).execute("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.PreparedStatement).executeUpdate(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.PreparedStatement).executeUpdate("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.PreparedStatement).executeLargeUpdate(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.PreparedStatement).executeLargeUpdate("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.PreparedStatement).addBatch(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.PreparedStatement).addBatch("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Connection).prepareCall(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Connection).prepareCall("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Connection).prepareStatement(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Connection).prepareStatement("...", ...)'
            - patterns:
                - pattern: '($S: java.sql.Connection).nativeSQL(<...$ARG...>, ...)'
                - pattern-not: '($S: java.sql.Connection).nativeSQL("...", ...)'
            - patterns:
                - pattern: new org.springframework.jdbc.core.PreparedStatementCreatorFactory(<...$ARG...>, ...)
                - pattern-not: new org.springframework.jdbc.core.PreparedStatementCreatorFactory("...", ...)
            - patterns:
                - pattern: (org.springframework.jdbc.core.PreparedStatementCreatorFactory $F).newPreparedStatementCreator(<...$ARG...>, ...)
                - pattern-not: (org.springframework.jdbc.core.PreparedStatementCreatorFactory $F).newPreparedStatementCreator("...", ...)
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).batchUpdate(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).batchUpdate("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).execute(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).execute("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).query(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).query("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForList(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForList("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForMap(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForMap("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForObject("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForRowSet(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForRowSet("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForInt(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForInt("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).queryForLong(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).queryForLong("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcOperations).update(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcOperations).update("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).batchUpdate(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).batchUpdate("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).execute(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).execute("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).query(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).query("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForList(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForList("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForMap(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForMap("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForObject(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForObject("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForRowSet(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForRowSet("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForInt(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForInt("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForLong(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).queryForLong("...", ...)'
            - patterns:
                - pattern: '($O: org.springframework.jdbc.core.JdbcTemplate).update(<...$ARG...>, ...)'
                - pattern-not: '($O: org.springframework.jdbc.core.JdbcTemplate).update("...", ...)'
            - patterns:
                - pattern: '($O: io.vertx.sqlclient.SqlClient).query(<...$ARG...>, ...)'
                - pattern-not: '($O: io.vertx.sqlclient.SqlClient).query("...", ...)'
            - patterns:
                - pattern: '($O: io.vertx.sqlclient.SqlClient).preparedQuery(<...$ARG...>, ...)'
                - pattern-not: '($O: io.vertx.sqlclient.SqlClient).preparedQuery("...", ...)'
            - patterns:
                - pattern: '($O: io.vertx.sqlclient.SqlConnection).prepare(<...$ARG...>, ...)'
                - pattern-not: '($O: io.vertx.sqlclient.SqlConnection).prepare("...", ...)'
            - patterns:
                - pattern: '($O: org.apache.turbine.om.peer.BasePeer).executeQuery(<...$ARG...>, ...)'
                - pattern-not: '($O: org.apache.turbine.om.peer.BasePeer).executeQuery("...", ...)'
            - patterns:
                - pattern: '($O: org.apache.torque.util.BasePeer).executeQuery(<...$ARG...>, ...)'
                - pattern-not: '($O: org.apache.torque.util.BasePeer).executeQuery("...", ...)'
            - patterns:
                - pattern: '($O: javax.persistence.EntityManager).createQuery(<...$ARG...>, ...)'
                - pattern-not: '($O: javax.persistence.EntityManager).createQuery("...", ...)'
            - patterns:
                - pattern: '($O: javax.persistence.EntityManager).createNativeQuery(<...$ARG...>, ...)'
                - pattern-not: '($O: javax.persistence.EntityManager).createNativeQuery("...", ...)'
            - patterns:
                - pattern: anorm.SQL(<...$ARG...>)
                - pattern-not: anorm.SQL("...")
            - patterns:
                - pattern-inside: |
                    import anorm._
                    ...
                - pattern: SQL(<...$ARG...>)
                - pattern-not: SQL("...")
      severity: ERROR
    - id: scala_password_rule-HardcodePassword
      languages:
        - scala
      message: |
        A potential hard-coded password was identified in the source code.
        Passwords should not be stored directly in code
        but loaded from secure locations such as a Key Management System (KMS).

        The purpose of using a Key Management System is so access can be audited and keys easily
        rotated
        in the event of a breach. By hardcoding passwords, it will be extremely difficult to determine
        when or if, a key is compromised.

        The recommendation on which KMS to use depends on the environment the application is running
        in:

        - For Google Cloud Platform consider [Cloud Key Management](https://cloud.google.com/kms/docs)
        - For Amazon Web Services consider [AWS Key Management](https://aws.amazon.com/kms/)
        - For on premise or other alternatives to cloud providers, consider [Hashicorp's
        Vault](https://www.vaultproject.io/)
        - For other cloud providers, please see their documentation
      metadata:
        category: security
        cwe: CWE-259
        security-severity: High
        shortDescription: Use of Hard-coded Password
        technology:
            - scala
      pattern-either:
        - pattern: java.security.KeyStore.PasswordProtection("...".toCharArray())
        - pattern: java.security.KeyStore.getInstance(...).load(..., "...".toCharArray())
        - pattern: '($KS: java.security.KeyStore).load(..., "...".toCharArray())'
        - pattern: KeyManagerFactory.getInstance(...).init(..., "...".toCharArray())
        - pattern: '($KMF: KeyManagerFactory).init(..., "...".toCharArray())'
        - pattern: PBEKeySpec("...", ...)
        - pattern: PasswordAuthentication("...", "...")
        - pattern: '($CB: PasswordCallback).setPassword("...")'
        - pattern: KerberosKey(...,"...",...)
        - pattern: java.sql.DriverManager.getConnection(..., "...")
        - pattern: io.vertx.ext.web.handler.CSRFHandler.create(..., "...")
        - pattern: $S.setPassword("...")
      severity: ERROR
    - id: scala_perm_rule-DangerousPermissions
      languages:
        - scala
      message: |
        Do not grant dangerous combinations of permissions.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-277
        security-severity: Info
        shortDescription: Insecure inherited permissions
      pattern-either:
        - pattern: |
            $RUNVAR = new RuntimePermission("createClassLoader");
            ...
            ($PC: PermissionCollection).add($RUNVAR);
        - pattern: |
            $REFVAR = new ReflectPermission("suppressAccessChecks");
            ...
            ($PC: PermissionCollection).add($REFVAR);
        - pattern: '($PC: PermissionCollection).add(new ReflectPermission ("suppressAccessChecks"))'
        - pattern: '($PC: PermissionCollection).add(new RuntimePermission("createClassLoader"))'
      severity: WARNING
    - id: scala_perm_rule-OverlyPermissiveFilePermissionInline
      languages:
        - scala
      message: |
        Overly permissive file permission
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-732
        security-severity: High
        shortDescription: Incorrect Permission Assignment for Critical Resource
      patterns:
        - pattern-either:
            - pattern: java.nio.file.Files.setPosixFilePermissions(..., java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING"));
            - pattern: |
                $PERMISSIONS = java.nio.file.attribute.PosixFilePermissions.fromString("$PERM_STRING");
                ...
                java.nio.file.Files.setPosixFilePermissions(..., $PERMISSIONS);
        - metavariable-regex:
            metavariable: $PERM_STRING
            regex: '[rwx-]{6}[rwx]{1,}'
      severity: WARNING
    - id: scala_perm_rule-OverlyPermissiveFilePermissionObj
      languages:
        - scala
      message: |
        Overly permissive file permission
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-732
        security-severity: Medium
        shortDescription: Incorrect Permission Assignment for Critical Resource
      patterns:
        - pattern-inside: |
            ...
            java.nio.file.Files.setPosixFilePermissions(..., $PERMS);
        - pattern-either:
            - pattern: $PERMS.add($P);
            - pattern: $A = $B + $P;
        - metavariable-regex:
            metavariable: $P
            regex: (PosixFilePermission.){0,1}(OTHERS_)
      severity: WARNING
    - id: scala_script_rule-ScriptInjection
      languages:
        - scala
      message: |
        The software constructs all or part of a code segment using externally-influenced
        input from an upstream component, but it does not neutralize or incorrectly
        neutralizes special elements that could modify the syntax or behavior of the
        intended code segment.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Info
        shortDescription: Improper Control of Generation of Code ('Code Injection')
      patterns:
        - pattern: '($ENGINE: javax.script.ScriptEngine).eval($ARG)'
        - pattern-not: '($ENGINE: javax.script.ScriptEngine).eval("...")'
      severity: ERROR
    - id: scala_script_rule-SpelView
      languages:
        - scala
      message: |
        The software constructs all or part of a code segment using externally-influenced
        input from an upstream component, but it does not neutralize or incorrectly
        neutralizes special elements that could modify the syntax or behavior of the
        intended code segment.
      metadata:
        category: security
        cwe: CWE-94
        owasp:
            - A1:2017-Injection
            - A03:2021-Injection
        security-severity: Medium
        shortDescription: Improper Control of Generation of Code ('Code Injection')
      patterns:
        - pattern: '($P: org.springframework.expression.spel.standard.SpelExpressionParser).parseExpression($ARG);'
        - pattern-not: '($P: org.springframework.expression.spel.standard.SpelExpressionParser ).parseExpression("...");'
      severity: ERROR
    - id: scala_smtp_rule-InsecureSmtp
      languages:
        - scala
      message: |
        Server identity verification is disabled when making SSL connections.
      metadata:
        category: security
        cwe: CWE-297
        owasp:
            - A2:2017-Broken Authentication
            - A07:2021-Identification and Authentication Failures
        security-severity: High
        shortDescription: Improper Validation of Certificate with Host Mismatch
      patterns:
        - pattern-either:
            - pattern-inside: |
                $E = new org.apache.commons.mail.SimpleEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.Email(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.MultiPartEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.HtmlEmail(...);
                ...
            - pattern-inside: |
                $E = new org.apache.commons.mail.ImageHtmlEmail(...);
                ...
        - pattern-not: |
            $E.setSSLOnConnect(true);
            ...
            $E.setSSLCheckServerIdentity(true);
      severity: ERROR
    - id: scala_ssrf_rule-PlaySSRF
      languages:
        - scala
      message: |
        Server-Side Request Forgery occur when a web server executes a request to a user supplied
        destination parameter that is not validated. Such vulnerabilities could allow an attacker to
        access internal services or to launch attacks from your web server.
      metadata:
        category: security
        cwe: CWE-918
        security-severity: Medium
        shortDescription: Server-Side Request Forgery (SSRF)
      patterns:
        - pattern-not-inside: |
            object $CLAZZ {
              ...
              $ARG = ...
              ...
            }
        - pattern-not-inside: |
            class $CLAZZ {
              ...
              $ARG = ...
              ...
            }
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    import play.api.libs.ws._
                    ...
                - pattern-not: ($W:WSClient).url("...")
                - pattern-not: ($W:WSClient).url("..." + "...")
                - pattern: ($W:WSClient).url(<...$ARG...>)
            - patterns:
                - pattern: ($W:play.api.libs.ws.WSClient).url(<...$ARG...>)
                - pattern-not: ($W:play.api.libs.ws.WSClient).url("...")
                - pattern-not: ($W:play.api.libs.ws.WSClient).url("..." + "...")
      severity: ERROR
    - id: scala_ssrf_rule-SSRF
      languages:
        - scala
      message: |
        Server-Side Request Forgery occur when a web server executes a request to a user supplied
        destination parameter that is not validated. Such vulnerabilities could allow an attacker to
        access internal services or to launch attacks from your web server.
      metadata:
        category: security
        cwe: CWE-918
        security-severity: Low
        shortDescription: Server-Side Request Forgery (SSRF)
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net._
                    ...
                - pattern-inside: |
                    import java.net.URL
                    ...
                - pattern-inside: |
                    import java.net.URI
                    ...
            - pattern: new $TYPE(...). ... .$FUNC
            - pattern-not: new $TYPE("..."). ... .$FUNC
            - metavariable-pattern:
                metavariable: $FUNC
                pattern-either:
                    - pattern: connect
                    - pattern: GetContent
                    - pattern: openConnection
                    - pattern: openStream
                    - pattern: getContent
            - metavariable-pattern:
                metavariable: $TYPE
                pattern-either:
                    - pattern: URL
                    - pattern: java.net.URL
                    - pattern: URI
                    - pattern: java.net.URI
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    import java.net.*;
                    ...
                - pattern-inside: |
                    import java.net.InetSocketAddress;
                    ...
            - pattern: |
                new InetSocketAddress(..., $PORT)
            - pattern-not: |
                new InetSocketAddress("...", $PORT)
      severity: ERROR
    - id: scala_strings_rule-BadHexConversion
      languages:
        - scala
      message: |
        When converting a byte array containing a hash signature to a human readable string, a
        conversion mistake can be made if the array is read byte by byte.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-704
        security-severity: Medium
        shortDescription: Incorrect Type Conversion or Cast
      pattern-either:
        - pattern: |
            $B_ARR = ($MD: java.security.MessageDigest).digest(...);
            ...
            for(...) {
              ...
              Integer.toHexString(...);
            }
        - pattern: |
            $B_ARR = ($MD: java.security.MessageDigest).digest(...);
            ...
            while(...) {
              ...
              Integer.toHexString(...);
            }
      severity: WARNING
    - id: scala_strings_rule-FormatStringManipulation
      languages:
        - scala
      message: |
        Allowing user input to control format parameters could enable an attacker to cause exceptions
        to be thrown or leak information.Attackers may be able  to modify the format string argument,
        such that an exception is thrown. If this exception is left uncaught, it may crash the
        application. Alternatively, if sensitive information is used within the unused arguments,
        attackers may change the format string to reveal this information.
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-134
        security-severity: Info
        shortDescription: Use of Externally-Controlled Format String
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    $INPUT = ($REQ: javax.servlet.http.HttpServletRequest).getParameter(...);
                    ...
                - pattern-inside: |
                    $FORMAT_STR = <... $INPUT ...>;
            - patterns:
                - pattern-inside: |
                    val $INPUT = ($REQ: javax.servlet.http.HttpServletRequest).getParameter(...);
                    ...
                - pattern-inside: |
                    val $FORMAT_STR = <... $INPUT ...>;
                    ...
            - pattern-inside: |
                val $FORMAT_STR = ... + ($REQ: javax.servlet.http.HttpServletRequest).getParameter(...) + ...; ...
            - pattern-inside: |
                val $FORMAT_STR = ... + ($REQ: javax.servlet.http.HttpServletRequest).getParameter(...); ...
        - pattern-either:
            - pattern: $VAL = <... $INPUT ...>
            - pattern: String.format($FORMAT_STR, ...);
            - pattern: String.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: '($F: java.util.Formatter).format($FORMAT_STR, ...);'
            - pattern: '($F: java.util.Formatter).format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);'
            - pattern: '($F: java.io.PrintStream).printf($FORMAT_STR, ...);'
            - pattern: '($F: java.io.PrintStream).printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...);'
            - pattern: '($F: java.io.PrintStream).format($FORMAT_STR, ...);'
            - pattern: '($F: java.io.PrintStream).format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);'
            - pattern: System.out.printf($FORMAT_STR, ...);
            - pattern: System.out.printf(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
            - pattern: System.out.format($FORMAT_STR, ...);
            - pattern: System.out.format(java.util.Locale.$LOCALE, $FORMAT_STR, ...);
      severity: ERROR
    - id: scala_strings_rule-ImproperUnicode
      languages:
        - scala
      message: |
        Improper Handling of Unicode Encoding
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-176
        security-severity: Medium
        shortDescription: Improper Handling of Unicode Encoding
      pattern-either:
        - patterns:
            - pattern-either:
                - pattern: |
                    $S = ($INPUT: String).$TRANSFORM(...);
                    ...
                    $S.$METHOD(...);
                - pattern: '($INPUT: String).$TRANSFORM().$METHOD(...);'
            - metavariable-regex:
                metavariable: $METHOD
                regex: (equals|equalsIgnoreCase|indexOf)
            - metavariable-regex:
                metavariable: $TRANSFORM
                regex: (toLowerCase|toUpperCase)
        - pattern: java.text.Normalizer.normalize(...);
        - pattern: java.net.IDN.toASCII(...);
        - pattern: '($U: URI).toASCIIString()'
      severity: ERROR
    - id: scala_strings_rule-ModifyAfterValidation
      languages:
        - scala
      message: |
        CERT: IDS11-J. Perform any string modifications before validation
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-182
        security-severity: Info
        shortDescription: Collapse of data into unsafe value
      patterns:
        - pattern: |
            $Y.matcher($VAR);
            ...
            $VAR.$METHOD(...);
        - metavariable-regex:
            metavariable: $METHOD
            regex: (replace)
      severity: WARNING
    - id: scala_strings_rule-NormalizeAfterValidation
      languages:
        - scala
      message: |
        IDS01-J. Normalize strings before validating them
      metadata:
        category: security
        confidence: HIGH
        cwe: CWE-182
        security-severity: Info
        shortDescription: Collapse of data into unsafe value
      patterns:
        - pattern: |
            $Y = java.util.regex.Pattern.compile("[<>]");
            ...
            $Y.matcher($VAR);
            ...
            java.text.Normalizer.normalize($VAR, ...);
      severity: WARNING
    - id: scala_templateinjection_rule-TemplateInjection
      languages:
        - scala
      message: |
        A malicious user in control of a template can run malicious code on the
        server-side. Velocity templates should be seen as scripts.
      metadata:
        category: security
        cwe: CWE-94
        security-severity: Info
        shortDescription: Improper Control of Generation of Code ('Code Injection')
      pattern-either:
        - patterns:
            - pattern: org.apache.velocity.app.Velocity.evaluate(..., $VAR)
            - pattern-not: org.apache.velocity.app.Velocity.evaluate(..., "...")
        - patterns:
            - pattern-not-inside: |
                $C = ($CFG: freemarker.template.Configuration).getTemplate("...");
                ...
            - pattern-inside: |
                $C = ($CFG: freemarker.template.Configuration).getTemplate($IN);
                ...
            - pattern: $C.process(...)
        - patterns:
            - pattern-inside: |
                import com.mitchellbosecke.pebble.PebbleEngine;
                ...
            - pattern-inside: |
                $C = $T.getTemplate($IN);
                ...
            - pattern-not-inside: |
                $C = $T.getTemplate("...");
                ...
            - pattern: $C.evaluate(...)
      severity: ERROR
    - id: scala_unsafe_rule-InformationExposure
      languages:
        - scala
      message: |
        The sensitive information may be valuable information on its own (such as a password), or it
        may be useful for launching other, more deadly attacks. If an attack fails, an attacker may use
        error information provided by the server to launch another more focused attack. For example, an
        attempt to exploit a path traversal weakness (CWE-22) might yield the full pathname of the
        installed application.
      metadata:
        category: security
        cwe: CWE-209
        security-severity: Low
        shortDescription: Information Exposure Through an Error Message
        technology:
            - scala
      patterns:
        - pattern: $E.printStackTrace(...)
      severity: WARNING
    - id: scala_xml_rule-ApacheXmlRpc
      languages:
        - scala
      message: |
        Enabling extensions in Apache XML RPC server or client can lead to deserialization
        vulnerability which would allow an attacker to execute arbitrary code.
      metadata:
        category: security
        cwe: CWE-502
        security-severity: Info
        shortDescription: Deserialization of Untrusted Data
      patterns:
        - pattern-either:
            - patterns:
                - pattern-inside: |
                    val $VAR = new XmlRpcServerConfigImpl();
                    ...
                - pattern: $VAR.setEnabledForExtensions(true);
            - patterns:
                - pattern-inside: |
                    val $VAR = new org.apache.xmlrpc.client.XmlRpcClientConfigImpl();
                    ...
                - pattern: $VAR.setEnabledForExtensions(true);
      severity: WARNING
    - id: scala_xml_rule-SAMLIgnoreComments
      languages:
        - scala
      message: |
        Ignoring XML comments in SAML may lead to authentication bypass
      metadata:
        category: security
        cwe: CWE-1390
        security-severity: Medium
        shortDescription: Weak authentication
      pattern: '($POOL: BasicParserPool).setIgnoreComments(false);'
      severity: WARNING
    - id: scala_xml_rule-XsltTransform
      languages:
        - java
      message: |
        It is possible to attach malicious behavior to those style sheets. Therefore, if an attacker
        can control the content or the source of the style sheet, he might be able to trigger remote
        code execution.
      metadata:
        category: security
        cwe: CWE-91
        security-severity: Medium
        shortDescription: XML injection (aka Blind XPath injection)
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: (javax.xml.transform.TransformerFactory $T).newTransformer($SRC, ...)
                - pattern-inside: (javax.xml.transform.Transformer $T).transform($SRC, ...)
            - pattern: $SRC
      pattern-sources:
        - patterns:
            - pattern-either:
                - patterns:
                    - pattern-inside: |
                        $FUNC(...,String $VAR, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: new FileInputStream(<... $VAR ...>);
                        - pattern: getClass.getResourceAsStream(<... $VAR ...>)
                - patterns:
                    - pattern-inside: |
                        class $CLZ {
                          String $X = "...";
                          ...
                        }
                    - pattern-inside: |
                        $FUNC(...,String $Y, ...) {
                          ...
                        }
                    - pattern-either:
                        - pattern: new FileInputStream($X + $Y);
                        - pattern: getClass.getResourceAsStream($X + $Y)
      severity: WARNING
    - id: scala_xpathi_rule-XpathInjection
      languages:
        - scala
      message: |
        The input values included in SQL queries need to be passed in safely. Bind
        variables in prepared statements can be used to easily mitigate the risk of
        SQL injection.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      mode: taint
      pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |-
                    import javax.xml.xpath._
                    ...
                - pattern-inside: |-
                    import javax.xml.xpath.XPath
                    ...
            - pattern-either:
                - pattern: $Y.compile(...)
                - pattern: $X.evaluate(..., $ARG2)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $ARG: $TYPE,...): $RET = {
                  ...
                }
            - pattern: $ARG
      severity: ERROR
    - id: scala_xss_rule-MVCApi
      languages:
        - scala
      message: |
        Disabling HTML escaping put the application at risk for Cross-Site Scripting (XSS).
      metadata:
        category: security
        cwe: CWE-79
        security-severity: Info
        shortDescription: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
      mode: taint
      pattern-sanitizers:
        - pattern: org.owasp.encoder.Encode.forHtml(...)
      pattern-sinks:
        - pattern: Ok(...)
      pattern-sources:
        - patterns:
            - pattern-inside: |
                def $FUNC(..., $ARG: String, ...) = Action {
                  ...
                }
            - focus-metavariable: $ARG
      severity: WARNING
    - id: scala_xss_rule-WicketXSS
      languages:
        - scala
      message: |
        Disabling HTML escaping put the application at risk for Cross-Site Scripting (XSS).
      metadata:
        category: security
        cwe: CWE-79
        security-severity: Medium
        shortDescription: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
      patterns:
        - pattern: '($X: Label).setEscapeModelStrings(false);'
      severity: WARNING
    - id: scala_xss_rule-XSSReqParamToServletWriter
      languages:
        - scala
      message: |
        Servlet reflected cross site scripting vulnerability
      metadata:
        category: security
        cwe: CWE-79
        security-severity: Medium
        shortDescription: Improper Neutralization of Input During Web Page Generation
        technology:
            - scala
      mode: taint
      pattern-sanitizers:
        - pattern: Encode.forHtml(...)
        - pattern: org.owasp.esapi.Encoder.encodeForSQL(...)
      pattern-sinks:
        - patterns:
            - pattern-inside: 'def $FUNC(..., $RES: HttpServletResponse, ...): $TYPE = {...}'
            - pattern-inside: |
                $WRITER = $RES.getWriter
                ...
            - pattern: $WRITER.write(...)
        - patterns:
            - pattern-inside: 'def $FUNC(..., $RES: HttpServletResponse, ...): $TYPE = {...}'
            - pattern: $RES.getWriter.write(...)
        - patterns:
            - pattern-inside: 'def $FUNC(..., $RES: HttpServletResponse, ...): $TYPE = {...}'
            - pattern: $RES.getWriter.print(...)
      pattern-sources:
        - patterns:
            - pattern-inside: 'def $FUNC(..., $REQ: HttpServletRequest, ...): $TYPE = {...}'
            - pattern-either:
                - pattern: $REQ.getParameter(...)
                - pattern: $REQ.getQueryString
      severity: WARNING
    - id: scala_xss_rule-XSSServlet
      languages:
        - scala
      message: |
        A potential XSS was found. It could be used to execute unwanted JavaScript in a
        client's browser.
      metadata:
        category: security
        cwe: CWE-79
        security-severity: Info
        shortDescription: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
      mode: taint
      pattern-sanitizers:
        - patterns:
            - pattern-inside: org.owasp.encoder.Encode.forHtml($TAINTED);
            - pattern: $TAINTED
      pattern-sinks:
        - patterns:
            - pattern-inside: 'def $FUNC(..., $RES: HttpServletResponse, ...): $TYPE = {...}'
            - pattern-inside: |
                $WRITER = $RES.getWriter;
                ...
            - pattern: $WRITER.write($DATA,...);
            - pattern: $DATA
        - patterns:
            - pattern-inside: 'def $FUNC(..., $RES: HttpServletResponse, ...): $TYPE = {...}'
            - pattern: $RES.getWriter.write($DATA,...);
            - pattern: $DATA
      pattern-sources:
        - patterns:
            - pattern-inside: 'def $FUNC(..., $REQ: HttpServletRequest, ...): $TYPE = {...}'
            - pattern: $REQ.getParameter(...);
      severity: WARNING
    - id: scala_xxe_rule-Document
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      patterns:
        - pattern-inside: |
            $DF = DocumentBuilderFactory.newInstance
            ...
        - pattern-not-inside: |
            $DF.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
        - pattern-not-inside: |
            $DF.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)
            ...
        - pattern: $DB.parse(...)
      severity: ERROR
    - id: scala_xxe_rule-SaxParserXXE
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Info
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      patterns:
        - pattern-inside: |
            val $SF = SAXParserFactory.newInstance
            ...
        - pattern-not-inside: |
            $SF.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)
            ...
        - pattern-not-inside: |
            $SF.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
        - pattern-inside: |
            val $P = $SFP.newSAXParser
            ...
        - pattern: $P.parse(...);
      severity: ERROR
    - id: scala_xxe_rule-Trans
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      mode: taint
      pattern-sanitizers:
        - pattern: $T.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");
        - pattern: $T.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
        - pattern: $T.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
      pattern-sinks:
        - pattern: $T.transform(...)
      pattern-sources:
        - patterns:
            - pattern-either:
                - pattern-inside: |-
                    import javax.xml.transform._
                    ...
                - pattern-inside: |-
                    import javax.xml.transform.Transformer
                    ...
            - pattern: $FACT.newTransformer
      severity: ERROR
    - id: scala_xxe_rule-XMLRdr
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      patterns:
        - pattern-inside: |
            val $R = XMLReaderFactory.createXMLReader
            ...
        - pattern-not-inside: |
            $R.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)
            ...
        - pattern: $R.parse(...)
      severity: ERROR
    - id: scala_xxe_rule-XMLStreamRdr
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      patterns:
        - pattern-inside: |
            $SF = XMLInputFactory.newFactory
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.SUPPORT_DTD, false)
            ...
        - pattern-not-inside: |
            $SF.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false)
            ...
        - pattern: $SF.createXMLStreamReader(...)
      severity: ERROR
    - id: scala_xxe_rule-XPathXXE
      languages:
        - scala
      message: |
        XML External Entity (XXE) attacks can occur when an XML parser supports XML
        entities while processing XML received from an untrusted source.
      metadata:
        category: security
        cwe: CWE-611
        security-severity: Medium
        shortDescription: Improper Restriction of XML External Entity Reference ('XXE')
      patterns:
        - pattern-inside: |
            val $DF = DocumentBuilderFactory.newInstance
            ...
        - pattern-not-inside: |
            $DF.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "")
            ...
        - pattern-not-inside: |
            $DF.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "")
            ...
        - pattern-not-inside: |
            $DF.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)
            ...
        - pattern-not-inside: |
            $DF.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)
            ...
        - pattern-inside: |
            $B = $DF.newDocumentBuilder
            ...
        - pattern: $XPATH.evaluate(...)
      severity: ERROR
    - id: codacy.java.security.hard-coded-password
      languages:
        - java
      message: Hardcoded passwords are a security risk. They can be easily found by attackers and used to gain unauthorized access to the system.
      metadata:
        category: security
        confidence: MEDIUM
        description: Hardcoded passwords are a security risk.
        impact: HIGH
        owasp:
            - A3:2017 Sensitive Data Exposure
        technology:
            - java
      patterns:
        - pattern-either:
            - pattern: String $PASSWORD = "$VALUE";
        - metavariable-regex:
            metavariable: $PASSWORD
            regex: (?i).*(password|motdepasse|heslo|adgangskode|wachtwoord|salasana|passwort|passord|senha|geslo|clave|losenord|clave|parola|secret|pwd).*
      severity: ERROR
    - id: codacy.csharp.security.hard-coded-password
      languages:
        - csharp
      message: Hardcoded passwords are a security risk. They can be easily found by attackers and used to gain unauthorized access to the system.
      metadata:
        category: security
        confidence: MEDIUM
        description: Hardcoded passwords are a security risk.
        impact: HIGH
        owasp:
            - A3:2017 Sensitive Data Exposure
        technology:
            - .net
      patterns:
        - pattern-either:
            - pattern: var $PASSWORD = "$VALUE";
        - metavariable-regex:
            metavariable: $PASSWORD
            regex: (?i).*(password|motdepasse|heslo|adgangskode|wachtwoord|salasana|passwort|passord|senha|geslo|clave|losenord|clave|parola|secret|pwd).*
      severity: ERROR
    - id: codacy.javascript.security.hard-coded-password
      languages:
        - javascript
        - typescript
      message: Hardcoded passwords are a security risk. They can be easily found by attackers and used to gain unauthorized access to the system.
      metadata:
        category: security
        confidence: MEDIUM
        description: Hardcoded passwords are a security risk.
        impact: HIGH
        owasp:
            - A3:2017 Sensitive Data Exposure
        technology:
            - javascript
      patterns:
        - pattern-either:
            - pattern: let $PASSWORD = "$VALUE"
            - pattern: const $PASSWORD = "$VALUE"
            - pattern: var $PASSWORD = "$VALUE"
            - pattern: let $PASSWORD = '$VALUE'
            - pattern: const $PASSWORD = '$VALUE'
            - pattern: var $PASSWORD = '$VALUE'
            - pattern: let $PASSWORD = `$VALUE`
            - pattern: const $PASSWORD = `$VALUE`
            - pattern: var $PASSWORD = `$VALUE`
        - metavariable-regex:
            metavariable: $PASSWORD
            regex: (?i).*(password|motdepasse|heslo|adgangskode|wachtwoord|salasana|passwort|passord|senha|geslo|clave|losenord|clave|parola|secret|pwd).*
      severity: ERROR
    - id: codacy.generic.plsql.empty-strings
      languages:
        - generic
      message: Empty strings can lead to unexpected behavior and should be handled carefully.
      metadata:
        category: security
        confidence: MEDIUM
        description: Detects empty strings in the code which might cause issues or bugs.
        impact: MEDIUM
      pattern: $VAR VARCHAR2($LENGTH) := '';
      severity: WARNING
    - id: codacy.generic.plsql.find-all-passwords
      languages:
        - generic
      message: |
        Hardcoded or exposed passwords are a security risk. They can be easily found by attackers and used to gain unauthorized access to the system.
      metadata:
        category: security
        confidence: MEDIUM
        description: Finding all occurrences of passwords in different languages and formats, while avoiding common false positives.
        impact: HIGH
        owasp:
            - A3:2017 Sensitive Data Exposure
      options:
        generic_ellipsis_max_span: 0
      patterns:
        - pattern: |
            $PASSWORD VARCHAR2($LENGTH) := $...VALUE;
        - metavariable-regex:
            metavariable: $PASSWORD
            regex: (?i).*(password|motdepasse|heslo|adgangskode|wachtwoord|salasana|passwort|passord|senha|geslo|clave|losenord|clave|parola|secret|pwd).*
      severity: ERROR
    - id: codacy.generic.plsql.resource-injection
      languages:
        - generic
      message: Resource injection detected. This can lead to unauthorized access or manipulation of resources.
      metadata:
        category: security
        confidence: MEDIUM
        description: Detects assignments in PL/SQL involving risky DBMS functions that might cause security issues.
        impact: HIGH
        owasp:
            - A3:2017 Sensitive Data Exposure
      options:
        generic_ellipsis_max_span: 0
      patterns:
        - pattern-either:
            - pattern: |
                $RESOURCE := DBMS_CUBE.BUILD($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_FILE_TRANSFER.COPY_FILE($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_FILE_TRANSFER.GET_FILE($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_FILE_TRANSFER.PUT_FILE($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_SCHEDULER.GET_FILE($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_SCHEDULER.PUT_FILE($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_SCHEDULER.CREATE_PROGRAM($...ARGS);
            - pattern: |
                $RESOURCE := DBMS_SERVICE.CREATE_SERVICE($...ARGS);
            - pattern: |
                $RESOURCE := UTL_TCP.OPEN_CONNECTION($...ARGS);
            - pattern: |
                $RESOURCE := UTL_SMTP.OPEN_CONNECTION($...ARGS);
            - pattern: |
                $RESOURCE := WPG_DOCLOAD.DOWNLOAD_FILE($...ARGS);
      severity: ERROR
    - id: codacy.java.security.flexible-search-sql-injection
      languages:
        - java
      message: 'Possible SQL Injection: Avoid concatenating user input in FlexibleSearchQuery.'
      metadata:
        category: security
        confidence: LOW
        technology:
            - sap-commerce
            - hybris
      patterns:
        - pattern-either:
            - pattern: |
                new FlexibleSearchQuery("SELECT " + ...)
            - pattern: |
                new FlexibleSearchQuery("..." + $VAR + "...")
        - pattern-not: |
            new FlexibleSearchQuery("SELECT ... ?param")
      severity: ERROR
    - id: codacy.generic.security.detect-invisible-unicode
      languages:
        - yaml
        - json
      message: It's possible to embed malicious secret instructions to AI rules files using unicode characters that are invisible to human reviewers.This can lead to future AI-generated code that has security vulnerabilities or other weaknesses baked in which may not be noticed.
      metadata:
        category: security
        confidence: MEDIUM
        description: Detects the invisible unicode characters
        technology:
            - AI
            - Copilot
            - Cursor
      paths:
        include:
            - '*.json'
            - '*.yaml'
            - '*.yml'
      pattern-regex: "[\uFEFF]"
      severity: WARNING
    - id: codacy.python.openai.non-guardrails-direct-call
      languages:
        - python
      message: Direct OpenAI SDK call detected. Use Guardrails client (GuardrailsOpenAI/GuardrailsAsyncOpenAI) instead.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-20: Improper Input Validation'
        justification: |
            Guardrails is a drop-in replacement that automatically validates inputs/outputs. Prefer Guardrails clients over raw openai.* calls.
        references:
            - https://openai.github.io/openai-guardrails-python/
      patterns:
        - pattern-either:
            - pattern: openai.ChatCompletion.create(...)
            - pattern: openai.Completion.create(...)
            - pattern: openai.chat.completions.create(...)
            - pattern: openai.responses.create(...)
            - pattern: openai.embeddings.create(...)
            - pattern: openai.images.generate(...)
            - pattern: openai.audio.transcriptions.create(...)
            - pattern: openai.audio.speech.create(...)
      severity: WARNING
    - id: codacy.python.openai.non-guardrails-client-usage
      languages:
        - python
      message: OpenAI client used without Guardrails. Replace with GuardrailsOpenAI / GuardrailsAsyncOpenAI.
      metadata:
        category: security
        confidence: MEDIUM
        cwe: 'CWE-20: Improper Input Validation'
        justification: |
            Guardrails advises using GuardrailsOpenAI/GuardrailsAsyncOpenAI as a drop-in replacement so validation runs automatically on every API call.
        references:
            - https://openai.github.io/openai-guardrails-python/
      patterns:
        - pattern-either:
            - pattern: |
                $C = OpenAI(...)
                ...
                $C.chat.completions.create(...)
            - pattern: |
                $C = OpenAI(...)
                ...
                $C.responses.create(...)
            - pattern: |
                $C = OpenAI(...)
                ...
                $C.embeddings.create(...)
            - pattern: |
                $C = AsyncOpenAI(...)
                ...
                $C.chat.completions.create(...)
            - pattern: |
                $C = AsyncOpenAI(...)
                ...
                $C.responses.create(...)
            - pattern: |
                $C = AsyncOpenAI(...)
                ...
                $C.embeddings.create(...)
        - pattern-not: |
            $C = GuardrailsOpenAI(...)
        - pattern-not: |
            $C = GuardrailsAsyncOpenAI(...)
      severity: WARNING
    - id: codacy.python.openai.import-without-guardrails
      languages:
        - python
      message: OpenAI SDK imported without Guardrails import. Consider GuardrailsOpenAI / GuardrailsAsyncOpenAI.
      metadata:
        category: security
        confidence: MEDIUM
        references:
            - https://openai.github.io/openai-guardrails-python/
      pattern: |
        import openai
      pattern-not: "from guardrails import GuardrailsOpenAI |\nfrom guardrails import GuardrailsAsyncOpenAI    \n"
      severity: INFO
